window._createLoadingScreen=window._createLoadingScreen||function(){pc.script.createLoadingScreen((function(A){let a=0,e=0,n=0;let i=0,t=0,o=null;const updateProgressSimulation=()=>{i+=1,n=pc.math.clamp(i/t,0,1),updateProgress()};const updateProgress=()=>{a=.875*e+.125*n,setProgress(a)};var r,l,setProgress=function(A){APIMediator.sendPreloadProgress(100*A);var a=document.getElementById("progress-bar");a&&(A=Math.min(1,Math.max(0,A)),a.style.width=100*A+"%")};r=["body {","    background-color: #ffcedb;","}","","#application-splash-wrapper {","    position: absolute;","    top: 0;","    left: 0;","    height: 100%;","    width: 100%;","    background: radial-gradient(#ffe4f3, #f585c4);","}","","#application-splash {","    position: absolute;","    top: calc(50% - 150px);","    width: 264px;","    left: calc(50% - 132px);","}","","#application-splash img {","    width: 100%;","    border-radius: 24px;","}","","#progress-bar-container {","    margin: 20px auto 0 auto;","    height: 12px;","    width: 100%;","    background: #ffffff;","    border: 1px solid #cc3a8e;","    border-radius: 12px;","}","","#progress-bar {","    width: 0%;","    height: 100%;","    background-color: #ff85cb;","    border-radius: 12px;","}","\n            :root {\n                --preloader-transition-duration: 0.2s;\n            }\n\n            #preloader {\n                display: block;\n                position: absolute;\n                background: #000000;\n                top: 0;\n                left: 0;\n                width: 100vw;\n                height: 100vh;\n                margin: 0;\n                z-index: 9999;\n                transition: visibility var(--preloader-transition-duration), opacity var(--preloader-transition-duration) linear;\n            }\n\n            .preloader-hidden {\n                opacity: 0;\n                visibility: hidden;\n            }\n\n            .preloader-visible {\n                opacity: 1;\n                visibility: visible;\n            }\n\n            #preloaderAnimation {\n                display: block;\n                position: absolute;\n                top: calc(50% - 48px);\n                left: 50%;\n                z-index: 9999;\n            }\n\n            #loading-text {\n                font-family: 'system-ui';\n                font-size: 28px;\n                text-align: center;\n                font-weight: lighter;\n                color: #ffffff;\n                width: 240px;\n                margin-left: -120px;\n                margin-top: 10px;\n            }\n\n            #walking-model {\n                background: transparent;\n                background-size: cover;\n                width: 256px;\n                height: 256px;\n                margin-left: -128px;\n                margin-top: -128px;\n            }\n\n            @media (max-width: 480px) or (max-height: 480px) {\n\n                #application-splash {\n                    width: 170px;\n                    left: calc(50% - 85px);\n                    top: calc(50% - 120px);\n                }\n\n                #preloaderAnimation {\n                    top: calc(50% - 32px);\n                }\n\n                #loading-text {\n                    font-size: 21px;\n                    width: 180px;\n                    margin-left: -90px;\n                    margin-top: 5px;\n                }\n\n\n                #walking-model {\n                    width: 192px;\n                    height: 192px;\n                    margin-left: -98px;\n                    margin-top: -98px;\n                }\n            }\n\n           "].join("\n"),(l=document.createElement("style")).type="text/css",l.styleSheet?l.styleSheet.cssText=r:l.appendChild(document.createTextNode(r)),document.head.appendChild(l),function(){var A=document.createElement("div");A.id="application-splash-wrapper",document.body.appendChild(A);var a=document.createElement("div");a.id="application-splash",A.appendChild(a),a.style.display="none";var e=document.createElement("img");e.src="data:image/jpeg;base64,/9j/4gxYSUNDX1BST0ZJTEUAAQEAAAxITGlubwIQAABtbnRyUkdCIFhZWiAHzgACAAkABgAxAABhY3NwTVNGVAAAAABJRUMgc1JHQgAAAAAAAAAAAAAAAAAA9tYAAQAAAADTLUhQICAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABFjcHJ0AAABUAAAADNkZXNjAAABhAAAAGx3dHB0AAAB8AAAABRia3B0AAACBAAAABRyWFlaAAACGAAAABRnWFlaAAACLAAAABRiWFlaAAACQAAAABRkbW5kAAACVAAAAHBkbWRkAAACxAAAAIh2dWVkAAADTAAAAIZ2aWV3AAAD1AAAACRsdW1pAAAD+AAAABRtZWFzAAAEDAAAACR0ZWNoAAAEMAAAAAxyVFJDAAAEPAAACAxnVFJDAAAEPAAACAxiVFJDAAAEPAAACAx0ZXh0AAAAAENvcHlyaWdodCAoYykgMTk5OCBIZXdsZXR0LVBhY2thcmQgQ29tcGFueQAAZGVzYwAAAAAAAAASc1JHQiBJRUM2MTk2Ni0yLjEAAAAAAAAAAAAAABJzUkdCIElFQzYxOTY2LTIuMQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWFlaIAAAAAAAAPNRAAEAAAABFsxYWVogAAAAAAAAAAAAAAAAAAAAAFhZWiAAAAAAAABvogAAOPUAAAOQWFlaIAAAAAAAAGKZAAC3hQAAGNpYWVogAAAAAAAAJKAAAA+EAAC2z2Rlc2MAAAAAAAAAFklFQyBodHRwOi8vd3d3LmllYy5jaAAAAAAAAAAAAAAAFklFQyBodHRwOi8vd3d3LmllYy5jaAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABkZXNjAAAAAAAAAC5JRUMgNjE5NjYtMi4xIERlZmF1bHQgUkdCIGNvbG91ciBzcGFjZSAtIHNSR0IAAAAAAAAAAAAAAC5JRUMgNjE5NjYtMi4xIERlZmF1bHQgUkdCIGNvbG91ciBzcGFjZSAtIHNSR0IAAAAAAAAAAAAAAAAAAAAAAAAAAAAAZGVzYwAAAAAAAAAsUmVmZXJlbmNlIFZpZXdpbmcgQ29uZGl0aW9uIGluIElFQzYxOTY2LTIuMQAAAAAAAAAAAAAALFJlZmVyZW5jZSBWaWV3aW5nIENvbmRpdGlvbiBpbiBJRUM2MTk2Ni0yLjEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHZpZXcAAAAAABOk/gAUXy4AEM8UAAPtzAAEEwsAA1yeAAAAAVhZWiAAAAAAAEwJVgBQAAAAVx/nbWVhcwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAo8AAAACc2lnIAAAAABDUlQgY3VydgAAAAAAAAQAAAAABQAKAA8AFAAZAB4AIwAoAC0AMgA3ADsAQABFAEoATwBUAFkAXgBjAGgAbQByAHcAfACBAIYAiwCQAJUAmgCfAKQAqQCuALIAtwC8AMEAxgDLANAA1QDbAOAA5QDrAPAA9gD7AQEBBwENARMBGQEfASUBKwEyATgBPgFFAUwBUgFZAWABZwFuAXUBfAGDAYsBkgGaAaEBqQGxAbkBwQHJAdEB2QHhAekB8gH6AgMCDAIUAh0CJgIvAjgCQQJLAlQCXQJnAnECegKEAo4CmAKiAqwCtgLBAssC1QLgAusC9QMAAwsDFgMhAy0DOANDA08DWgNmA3IDfgOKA5YDogOuA7oDxwPTA+AD7AP5BAYEEwQgBC0EOwRIBFUEYwRxBH4EjASaBKgEtgTEBNME4QTwBP4FDQUcBSsFOgVJBVgFZwV3BYYFlgWmBbUFxQXVBeUF9gYGBhYGJwY3BkgGWQZqBnsGjAadBq8GwAbRBuMG9QcHBxkHKwc9B08HYQd0B4YHmQesB78H0gflB/gICwgfCDIIRghaCG4IggiWCKoIvgjSCOcI+wkQCSUJOglPCWQJeQmPCaQJugnPCeUJ+woRCicKPQpUCmoKgQqYCq4KxQrcCvMLCwsiCzkLUQtpC4ALmAuwC8gL4Qv5DBIMKgxDDFwMdQyODKcMwAzZDPMNDQ0mDUANWg10DY4NqQ3DDd4N+A4TDi4OSQ5kDn8Omw62DtIO7g8JDyUPQQ9eD3oPlg+zD88P7BAJECYQQxBhEH4QmxC5ENcQ9RETETERTxFtEYwRqhHJEegSBxImEkUSZBKEEqMSwxLjEwMTIxNDE2MTgxOkE8UT5RQGFCcUSRRqFIsUrRTOFPAVEhU0FVYVeBWbFb0V4BYDFiYWSRZsFo8WshbWFvoXHRdBF2UXiReuF9IX9xgbGEAYZRiKGK8Y1Rj6GSAZRRlrGZEZtxndGgQaKhpRGncanhrFGuwbFBs7G2MbihuyG9ocAhwqHFIcexyjHMwc9R0eHUcdcB2ZHcMd7B4WHkAeah6UHr4e6R8THz4faR+UH78f6iAVIEEgbCCYIMQg8CEcIUghdSGhIc4h+yInIlUigiKvIt0jCiM4I2YjlCPCI/AkHyRNJHwkqyTaJQklOCVoJZclxyX3JicmVyaHJrcm6CcYJ0kneierJ9woDSg/KHEooijUKQYpOClrKZ0p0CoCKjUqaCqbKs8rAis2K2krnSvRLAUsOSxuLKIs1y0MLUEtdi2rLeEuFi5MLoIuty7uLyQvWi+RL8cv/jA1MGwwpDDbMRIxSjGCMbox8jIqMmMymzLUMw0zRjN/M7gz8TQrNGU0njTYNRM1TTWHNcI1/TY3NnI2rjbpNyQ3YDecN9c4FDhQOIw4yDkFOUI5fzm8Ofk6Njp0OrI67zstO2s7qjvoPCc8ZTykPOM9Ij1hPaE94D4gPmA+oD7gPyE/YT+iP+JAI0BkQKZA50EpQWpBrEHuQjBCckK1QvdDOkN9Q8BEA0RHRIpEzkUSRVVFmkXeRiJGZ0arRvBHNUd7R8BIBUhLSJFI10kdSWNJqUnwSjdKfUrESwxLU0uaS+JMKkxyTLpNAk1KTZNN3E4lTm5Ot08AT0lPk0/dUCdQcVC7UQZRUFGbUeZSMVJ8UsdTE1NfU6pT9lRCVI9U21UoVXVVwlYPVlxWqVb3V0RXklfgWC9YfVjLWRpZaVm4WgdaVlqmWvVbRVuVW+VcNVyGXNZdJ114XcleGl5sXr1fD19hX7NgBWBXYKpg/GFPYaJh9WJJYpxi8GNDY5dj62RAZJRk6WU9ZZJl52Y9ZpJm6Gc9Z5Nn6Wg/aJZo7GlDaZpp8WpIap9q92tPa6dr/2xXbK9tCG1gbbluEm5rbsRvHm94b9FwK3CGcOBxOnGVcfByS3KmcwFzXXO4dBR0cHTMdSh1hXXhdj52m3b4d1Z3s3gReG54zHkqeYl553pGeqV7BHtje8J8IXyBfOF9QX2hfgF+Yn7CfyN/hH/lgEeAqIEKgWuBzYIwgpKC9INXg7qEHYSAhOOFR4Wrhg6GcobXhzuHn4gEiGmIzokziZmJ/opkisqLMIuWi/yMY4zKjTGNmI3/jmaOzo82j56QBpBukNaRP5GokhGSepLjk02TtpQglIqU9JVflcmWNJaflwqXdZfgmEyYuJkkmZCZ/JpomtWbQpuvnByciZz3nWSd0p5Anq6fHZ+Ln/qgaaDYoUehtqImopajBqN2o+akVqTHpTilqaYapoum/adup+CoUqjEqTepqaocqo+rAqt1q+msXKzQrUStuK4trqGvFq+LsACwdbDqsWCx1rJLssKzOLOutCW0nLUTtYq2AbZ5tvC3aLfguFm40blKucK6O7q1uy67p7whvJu9Fb2Pvgq+hL7/v3q/9cBwwOzBZ8Hjwl/C28NYw9TEUcTOxUvFyMZGxsPHQce/yD3IvMk6ybnKOMq3yzbLtsw1zLXNNc21zjbOts83z7jQOdC60TzRvtI/0sHTRNPG1EnUy9VO1dHWVdbY11zX4Nhk2OjZbNnx2nba+9uA3AXcit0Q3ZbeHN6i3ynfr+A24L3hROHM4lPi2+Nj4+vkc+T85YTmDeaW5x/nqegy6LzpRunQ6lvq5etw6/vshu0R7ZzuKO6070DvzPBY8OXxcvH/8ozzGfOn9DT0wvVQ9d72bfb794r4Gfio+Tj5x/pX+uf7d/wH/Jj9Kf26/kv+3P9t////7gAhQWRvYmUAZIAAAAABAwAQAwIDBgAAAAAAAAAAAAAAAP/bAIQADAgICAkIDAkJDBELCgsRFQ8MDA8VGBMTFRMTGBEMDAwMDAwRDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAENCwsNDg0QDg4QFA4ODhQUDg4ODhQRDAwMDAwREQwMDAwMDBEMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwM/8IAEQgA8ADwAwEiAAIRAQMRAf/EAOAAAAEFAQEAAAAAAAAAAAAAAAIAAQMEBQYHAQADAQEBAQAAAAAAAAAAAAAAAQIDBAUGEAABBAMAAgMAAQQBBQEAAAABAAIDBBESBRAGICETBzAxFBUiQEEjMyQWEQACAQIDAwULCAYIAwkAAAABAgMREgAhBDEiEyBBUTJCEGFxUmKCkiMzQwUwgZGxwXKiFKFTY3OTo0DwwuKDwyQ00fHSsvKz0+NElBUGEgABAwEFBAULBQEAAAAAAAABABECISAxQRIiEDBRA2FxMkJigZGhscHhUnKCkqJAUNGy0hP/2gAMAwEBAhEDEQAAALSlHb7AZGNSIWBFCpCtxPI7UalQhNziAc3SjaUQhaVrqF5XbiKR5mJp4whhni22iaRru20hefzwFKFju5KYVM1gOcFZyoyTjM5Uq7yJKNpgZE0qqonkSBclKjjmgu4QlbbaJpBdWZYZeHnMTlnOtISts0guOexsr0GfJDUiKfQN5H2uNSpKJpWbiaVNxKRkwYxbhjmDTSIZgq4glGtJTYuTIpY5JyJOSgSd3PnnU8tuZeZvnzvXvqjeR9tIlKwRkTMjGXMHcbK2CohlC7iGULuIZRekIyp05ifLDmxKCNiM3oaGas8UM+ZcvY0d7IeGw5u+uNSMKNpE3F5d6pxEKPs8jXmwCUOnaMZAq4xlRcbEMtiNshGJEmYGZlzfS8sscfcyIJ5fW8DhtJZ926e+h2dhCJi6Hj+t8/zjrb/nPbjuAY9HXHIAumFxLEXZ2RQlgTPGRBmBOQ4/s/NVy2rbsphuVLodzNmaDDeNAQoW62Bu85ljN0GNqKpQcOrsQOL0FnYsUTJ3q21Ll4vMlrO+zLKzXe5HBZyjD5vuLOePKdFBtoo2K8nRpIo1RIwMN8zRy+ch2qZQ5RYe/ZwQu3FhKNgZPq0yx+YhmZxuyYI6mhTWuRZyeLz6/Qc/o/OtK7SxnXL65VEqcrRsOGtxupjz9dzm949Z7ENG1t2GIi9CQJM0DJ9WmWPyroUBFGgOpJizr5xoLZfR3vmPpvnTfQdBw/dk58WjBU54a3OV18B6RzHXO4eA7rCrom1+T6h6EwNXSTAxUjRsPtRsV+X5BJIEmQoOQ6zmDo5TXRrfu/P+240VXuuK6gXQtPA+MPNfTa4ch2mfpguX6XDennHe+VewX1ZzdVRv0sFtGhXcCTVr6Nnaufx/GxJJpJMEfn3feZHToUdEVv0ePZ5px0r4lZaepzpp4Xgay1XVmvUpMgxi2EDpnBJIKNHcVdd0YrmXPlIhuEkgq8P6EJryWjtovkeZ6aoawYXdZC6O8ky9F+XaijkkhtHWm7FeO01Xe3XqATOx0zgkkC08fWz0q1dPMuEkmkkgSSDz6Ptqx0ZGHu2j1NLSilPFdJEqxXQW6qtTVKzJUmr1evZage9BUwoSaiv0LOWl/P0ILmgkqlJIEkgSSBVLaKEk5KSQJJAkkB2qSRZqz2ZvOsPWl6UFSxS//9oACAECAAEFAA5EprllZWUfAQWUXIHKYsrbCBz4BQyVlHwPGUU0ILKIQOFnKBU0rgYJHuB8BZ8BN+kCh4I8yt2ULcDPknCBBAQKys/LbPkFTbFlUHQIFbLOVsPJTs4aHZ8y4KhP34x41WPB+Uoyq4DSPGUSVn7ByVOSG/qWiVzgW/2x4t/+tkZjm848Ywsp32nRbF7WuQH1hYUsP6OljDiPGER8C36+kUCg4oOCaQnDIZ9tx4ws+T4Ax8Q4hNeWoShBwKyEPifGCEHfIPcED8T5LcrBCDln4BD4j4Fq+wg5Z8BD+lhFq+wg5f/aAAgBAwABBQDKJQctkXLZErKBWVsi5Apqyi7C2yiVsnzNYt0XnOyDlstllNQKBTkXYRdlF2A6R8kkUmRstlstlsgU0oFAolORKJTJC2WN4J2WyzkbAAOBQKBQKDkSiUSn5xLLhrZjvstllO+yxpa4FAoOQK2ySipWucJA0ua1mV/3BUriBA5+QsZQCCLUQiFOQCGiN4JwBkaoBTEtfBIS8BAeMlR3pmlvRjIZNFIpx/x0+3MwNVqtUWhNbggIBALXxnI1TJpQ1lgaiy2RzQHDVapspdPclfEmfYDVhY+EX/J8sYYue1u9waTMvTsUfSYVRfEVch3gpHeuGrVao+ajNpZ4S1U2l5tQuBx5jmlaqvQfA2Lq13KOaOQBO81GOLrLHltGXRWpiTkFFqI+AJBi6NqNEeYJfzfZsfq6nFsJ6+S4YIcsgotRB+BR+EFkxLT92vBD/Acv7otRHgo/2+DHvYSST5BQd4IX/9oACAEBAAEFACxAAINAQajGFoEGgHTBDBgNC0C0Ca1BgWq1Wv0W/WoWoRYgxaDIYAtAnNwiAE8LUIgLVapoQGFrkOYtVrkBq1wtVqgPrC1WEQiPrCIWqDUGnGqLcAtT0QiFhaosWuE0IBFq1wdcHVaoNWqDVqtVqi1Fq1Wq1Wqwg1EZT/pOGUQsIgJoQblFi1wmjKARag3KwAJbbWFmHt1QapZP1Oq1WEWrVaoNWqwinfQd9ohaohEJmEFhFiDUBlarXC7PfgrDn9Dvd23z7UleXVarVarVaotRatVqtVjCwnIhaohEIhAYTSh9qGON7y37AwsKaH9ofYWAdriQ3eVye/M2Wpz5/wDLoarVarVarVarVarCwnBOCLUQiEQi1BAJpQ+1haoBALoGrT904vaxHf6k3486madANWq1Wq1ULhG9+HO1RCIRCIRaiEQiEQiEGgoBBNTUAsIlrW9KN13u+ncCWw7rst8/v64QatVqtVharVdju8/kM5XtnI6dgtRCIRCIRCIRCERctUEAgEAgEAvYLX+Hx43Vr9Gr3LdObjdTkexx0H2eP2NVhYWFhFqIXU5nQ7Pfv2bFeo4IhEIhEIhakkMARQQ+0AgE0ZIQXsZd/r7F0yv9Tpc/rex9evQFO/wJKHOwgFqi1YWFhM9Htcy03hOtVgwNaQiEQiFqsIokJjXOdqWkIIIIL3KV36dAt6PN/jKGg2Av54ge+O11QFhDILjsSEVhM73WdJT6ItA/3KKIRdF+JRKKOE1oa4teSEEEEF0afH6HY6Vh5u0J+xQmb7l7XKPTLwi64QWUUG7EqeZkEPTpdStyIafsENDkVLleuUUUSiUSiiEHIFZBWAggVendXo1qNmeu+s+R3Pk5da7cfRk6N67C+xUtMtVcrKyiUSurqeZNJEKNieJpZJ+kZKJRKJRWV9laEkFByDkHIFAqSOKaKea/Tt2Ln+xqxw0IK1W3I+x+V9lLgPB4uVstllErqDfmw9CNtKBjJRX2Y0lEolEohfQWQtk/lQxwy0p2oH7BQKBQKqUacs3sHr8Mg5rqDDyeZXuUR6vx2x8+FlanstlstkSnhr28uOCnbtOdDYe8OaSiUSiUXLKJRKsQGSuC0Log6v5NZ4k5NhikhnhQcqM35snmLbLgwRTkihG4Ojgd/wCLZbLZbLZFyLsdK1D+9OlJ+nPJRKJRKJWy2Ky5ZWfqxXdIg5uSC05UlWtImUo32OrmoZ3kU7UkUNPl+5VJqXPn/Wrstlstlsun06/OgrOcZS8Acr3H11tYuRciUSshZCyFkfDYEBr2gPjcXNcxNje6T3TpPlf0ej0pKM3Kpz0vWBRHK48etfcLZbLZbL+Sbhkv+gc2SvzXEEWKjqV7j2nWeQXIuRctgtllZWVlZWVlF7XgMmjHRNR9NnS6U3d4XMd1+kTles8ij/rPX4KvM6c8IkTq8Lk6pKpGyRnZdSJ/e9xiZHDEXL3ql/j9j1Gf9OAXIuRci5bLZbuCysokBZWVkqWWSIe09aMc/osZXveoSVv/ANRbY+Ct6/bot5/Q7VGu5kkcjJIdj+bswlwXvnbj4vK/jb16S1BLzr0aLiD7jS/zOH6JaDq5ci5FyJWVlZTmua7C+vhadl3trqsl7s87mGn6vMyT2HrCerzeLFzG1fYoaDaPrlhsvMX0U+Bjl/LDbpt/xhc/TkCfCkZFM33iNnL9d9Ec49qerarrOUSiVlErJVxmHfGVjhJ3GMf1JuZQlqeriGG97PZkj9X5HKpf4/sXrnPHN9Qgo0bDqjsH6cr/ADqHSg4/rXF4jzggxFq90r2L/rRbZ5l/072uLvUpqFKdTevQuU3D6MakjfG4hEKeP9IvjJDu61Yfc6f69TX1Rv59b3C6Y/WOU1prddhZzeVZDOoHSwvbbjka6mHB20Z8kAjp+m+udWfj+o8Hi2fLw2Rs/F5sym9blQIIsx6S/C/cbRo8mgySMUpSvUqUUFz31rX+r8fmn8L/ACJ5qPAqxVbDbDJBJTOGufG5l0OBpxSCRksSBBH9Go/aC5HtH8OpQj6XPi4HU5PUhodWaTlesVOPH7+Zx65ybs8FSbqtK5Vjp2KLJGysjkfGf1gsCWnJGmucwxXinVa0wkhniTXBw+fPf9kAiRhY/wCEkUcgjgiiUozH7zIRy+No2rCYQqcb2weuStl4PiKxJEi2taU1aWJNc5pivOCdBVsqStYiTXtd8qz9Jlej+/kRkfyNfirR8nrUmw/7fnwrj9GS4z1znXeZyPhFce1OrwTiWGSIglpivPanR1bQkpzxrYZ+ET945mfpH873E5t949X46t8mTmSQXa0xquLq/wAWuc0x22uElNjw+N8ZBIMV17V/81pslF7EXFjvFF+Ylbj0l/oEAh/LpOkYwMZ845XxlliKYS0U5rmkEgxXZGpskFhslADxSfrMrce8X/SRWZI0HQWGy0ntRBBUV2Ri/9oACAECAgY/AN69qm/aBIwi39kc5fhI97fOKkJ+NlwXsVtX2Dlwr5k5DZi/v3LBn6VqbyWIgszvXoWkgwH4nw74AoxB7VfKLNURw2MMUAdSFSHAKHVtHzLlue0PS1qirRMU7oOLEXlpjfFQkSdBcNx3F9moV9TsG+oUzKtFQ7qtq/8Abv/aAAgBAwIGPwD9HqLJwhun2FlIyLRgdXD5dKb4aX76UT2ZSkpAUy09+1juiBegYtp0mnbTkHoaxGjh0auD1ezcZYkRJxNEAXJjSWXvdKBD3966wAHc0YLLIHy7BaDjSacPOhkY0zZp4+GKkQxE9WmOnTqQO2JGATSxs5jL/o7vGSB5kTB/rC0TEuh9X27Ilg8ePqQ6mfosO1bkKNaAOCpVECRLNpNaYsgZX9SGUUAqJfF9KfaeUI0j3vWoGIBcm9AjEPbiMSQpai/8qWZsGdZoFnHdOIV4mPGPb2lrgR8upTlKcRzOZInKSxbAKTXx1j6Vyz0Zfs0224AlGRYafTFEhsL0SWuBsZYTlF6MDpqsmQTg7/DL7lqzcs+IZo+eCeE4z+U5rJMepPK4A4ohnq6Zr48bbgsVTmGQ4T1+mWqwCXMcQFpcQFwN/wCKd2ookniiOBbeszqMxMZfAK/l/lSBLkEgnq3zxkYnwlk5x3H/2gAIAQEBBj8A2dzvY2eHGzubPDjZjwY2Y2Y2YGNnPjZjZ/WmBlg5dz9ONmKU242bMeDFPpxSnhxWngx9eK8ih2Ypz83criuPBySOn5GuKcw2Dvn/AJdzv472Pqx3uVQ4+v8AoPg5FObH19zv/VjvfXye/wAjPIDOuKBanorT6cB12EVHdBtC0AFFy2d3ZX5Dv93+uXc7+Psx9uPs7vf5+5XAAaiGtudLqbX+4uOB8K07NCuc09q0Vdly8Z4kuu8v/DwnwrXK0erRN1nFvEp2lyWN/vQXxfK/VyKfox9vc+3Hf/RjwYtkawUO9tz5sZd14qlb1K3DaK41Ebt+YXTsIo1UUBIAJBWrXPxXdLcQQwwTaiSUq802nERRZHIWx45HjmaOJfV/7fchS/ckxHp9XGiSvvQykMCkwDGPgv7p2sfrP7P1eNNqiKGeJJCO+6hz9f8AQMu5n3Mvo5eqmMPFjidZGiOW9JFG0ksf7RHl40d/vcLLCxaFsmVtoPisKm11xKEhY/mUCacsy2NI3q7VA3495o96T+X7zTaQtedPEkZcCgJRQl3KDlQwHMcEgUB5vk+k4y+jufbyS7GiqCWJ2ADGs+IIOFptQqtppJQY+IqRRrLRXF6+yu9bw/Vb+NZq745NKjtA1rVNyb/E3eolrbnEsx8PvST/AOtWSPe2oZWfhtVv2d8Mm98iv5pi00leFBGLpGA2tQlVRP2kjY/KIzQas9WCagLDyGRnTzOv8jnkO5nnjLk6mcI8hoqcOMXO3EdIrUXz8cfUwoXDAAKA0sZVro2PE6s6u/ixphdRFCY73EGsBkRUanqVbh1lTrcP2n/t/wB3FifQFYpJVBWbTpKCjxvlInqXvSzy/wDuL8AmkOo0zGVdNI7XSpZ6+CKS653u0vb/AKy8v4jqTRIotW2mcs28ixi2OyNuy0S3p5eIvhU3wsz6PRnTT6bUQEyCgmjDgTSpD/q5LnSWNP1knufWcvLGeZ5VBz/N3VjQgNJKo3tlAGl/y8WkGMw5zTI5WOZU7OnZaNLw2CcT3kGI4tbHG2i0kLarUq4BWabUEcCOZXu4ixwsv8DC6j4ZDDH8R0Klvh8qxqoRhvfljIF9Vp9Xb+Xm8iTEv/6SfVySfGYn/OahUN8LZWN8Nhh9X6rhSNp4NT/ufeez9R8hJrofihdCzM8DxEtKpO7HJKZ24km97bh+0w+m1U0kcDMpKQsY2JUpL7RT1ew/+XgKNigAVzOXf5OeKDuhVFScgNuCCKEbRytHHcvBjDyzozmMEmyOC6RN6z/ceXiUsjwRRFVOnpSVgWWpZEtZIGRmeLhv6/2mPirahDHPLqUUpaN2NI1eHZetvrpLcCK62MGuwj7MJpoZ1l00LGaSNWDAlPYxyLvWcKWSDUfvEh7oI5sEnn5Gs/OfD7NNc7aXWFqgiN1WNbAPVyNH62LeT+3hXMi2KaXKcyaXOrxm7srf2HwRzjkBQvrAc273I6cBo2KMNmCx3icyRypddqRxZIQNNC9XCx8OrO4kX1aMszv6xsRwRUnUq1kwooksIeSGgDK3DU77xdv2cXtca3XfDX08c5ISWBqusiKFeCRb+D66JWkVfHwX48FlgYjhLwgPWdoXycT1bJIjTfw8S/m5IjqPiiK5CkAq90skcVhd2VfaP+8m95yabPD3Hnc0SNS7HvKLsDS6fUzTajWSoVWZsoXIeaTgvT1cXCjkTyPd4VxNGJhvyRkFXBQBWdiGaFpv9RD7OziJv44munM2pmVS603UoPZI2TSW3e0f5PPGXdnnRSzxxsyKvWLAbirXysXajWsqc0NqhCAaE6qaFIp5EZtxuA8afq5ON6vETjTNH8O0xNGBIQ1HDmMUaFPy8NvrJIrOHxOLJ178amKMQhyIiqhQxyXhtSweMu9iWZdPIWBibIGNS1ps4kUnDvtaNGXEJ4biRSGVygaxllhaJ24V9u/2sRalOrMgcDoqK083laoP1eC//ZOINRY0i33WpRjkpVesdztdvHDVHdmzc8NwLnXUTWdXfVPy2kgj/wAHCyUpeoam2lRWnyHRy3hlAeOVSkikZFWFrL6OG0fxLUIkELtTSuLTOUZ0SV5ku3nX/b+6s9jFFgSQgfloiplWuQUGx+r4ni4ljMvrtMMl0xZCIzvrbHpjxeqtl7ye74uEWGBlEUb3TuCC9tA3rGu4u9C/E/Vez/WYkMqia6aNbQFYdaIubbdO/tXl6vExoyoIHCUUNaim72t7m5WrXbWGTLzWwGZXKI2/bHVUDeNL2cRyi+QOqs7OaAFWFa+Y3UxwyKBQCMiu3aLW5XT3UffLsBVblFK9bO09XAkijeSF1DKwoxoRXqpvfhxQ7RtHJk1bwRtI68FnZFLMoPUckbyeTgyaURjSJENPJCF3Igpe22FSkdvrLf2eFgbUcZzDY8cJooMJsb2G8nt29pLjQjVwtHpmaaJoGFt3EPHD3Kd5LuJiyFHhF3ErG5FWrfvbVfe8fEUEdbUBoTSpqSzE2hV63KZHAZWBDKcwQciDjV6dVpEzCgOzMDc/HhJUJ4TPmOySAGV1+8jdrCuNjCvyLxRNYxUhK1oDSm6V34/MwFI4fiqaUp5DdTEqyWXMAIlZCZGNN1YWr1uJ/wCpgEXRNTO01FfOuxWNlkHR1T+nd/Hj1iMg6SMvT6vcMZzZnNnn3yKD6DYg1MQ3ZCaqdhDe1ienlxYLUFQDQ0xFLtMZSX9O9+F8BhsIwp6RX6c+XPQArQE+G1efBiIAYC5aczdb7bMQv0bp+Q29yhzB2g7MRcJqcKVZOG5yy22N2duLWrG47L/9eKEUPc3oxU843T9K0xbE1gVlcXZs3BJWS23qpdJZe3bxHp5VCni3ROOcNQdbLxPTwzLtK0B8O7iUyAmJIzcBTqgU7VMKtUR0Zot4sa2Hh35InWwrXBqErVdm7u83KWWZ1UyyLFEGNoLv1RX5rsG7elmzLHLLnxXmGHifWWkkMtY5Qvp8KxfkNnItYXL0Hm+6ezikLXrzxP8AZ/dxQnhNzhtnpdZfOxvCldh5j52BwqfmNLfRSaXB2Dp5jxNKvkS40/w8aZ31FknHEe/ww6twPZB7nfgs/wCy957WHiCaPTHTFJFcvMeHbxI0S5ruH73T9TDQMpAeLhkoaVBW3qtcv4cKJU04cl2KMUMlGbn4h4jS/dl/h+yxKIYyIxKzbpvAuz66NKq713vf/L5Wk0QJthiMrLzXSGxcvuRfjwfiE5Yvqt3ToxNEhU9hW6nHkW/93HBgg7DkfBjU6CStYXaPPnANEbzk3saKduvJBGzfetF/4vlaSi7oYZMPnwWhbiR86/8AVHiWaReE8KM4cbBQXN5SYed4ZGi1EhMdhCusZHqk4bB+omIfh7RNHppAJp3cx3yRQyPI6sqLe/E4kUXtOpqMdAOIZGDM4W8PcRXtjdw8Ubso162qrNUXxB5Vs/wWm9DFzANlsKgk+fuv+LGV0Z728PRbe/m43GV+9W0/zLV9F8UkRkrsuBFfBXuTaaNjbJNwbvFjhFk7r93hysmEhiUJFGoREGwKotVR5vch1yiiaxKMf2kdEb0omhxApNWieSMjoActH/LdeVt5Gfc2Y/qcBkqD42E0kqhZtfJweIDQWANLPep8ZE4P+NiCce8IKyXUFVI73ZXCQiSlun1SErmARJBZd2fdy4lmyaNI2a9dmSltmIIjKhlZFUAZkkgLjSarTzorxamOuwVXO9N8dtd3CyxMHjkAZHGYKsLkZT5S4qhAJ6wOw4I7Q7JyOPVtWvWjOQP9lsJJptOq67VOYomO7w6KXefhr6uazdtVsav408gErOdNFxLjWlk2okZxd7R2jX2fu3wTwi46Y9/8K+s9JMFTkRtB24ldRWTSEahfAtRL/JaTGq03OGWYeevCb0eAvyBUnMZGnKC9A+vGm0+ooSIWaNTkas1rHrRLaqxfrcLK4G4wYKZ0IoTY3vF/Z+9x8OXRqFhkYmcp7NboJ8qlm4snGlvdt/2nX/Va0moX8vLUjNTuNiMkQVVcuG6F/wDCrqpN7xMRyHTwELKpPDeNdgdqrwtem5u+JhYQFU6Nm05jU3WhKNDHcHmusgeJPadzPFV3W6Rj4a8o/wBMscqIwr7QsjS3Hq70XBs+5JjUaKM0l0k3EKcxSYVR/wCLFOuKSKUPTzYpKqyrzXAN9F2NTrtElkwKR5m5QJWETPY93Vv3MJpUO9qI3ijUmgLALOBVt3qwPis0TxjxiN3+ItY/xcsONjZHwjlZkbxyOJkdQ5iVEBoD2eLz/v8AEqrAt0iHaDQHwN5WPhcalV33VAMg2cuShgvVXHxVa7raSZQOi5THu+lhZQrXJmDccEgPRWXIN3ivP5WNboyDbqG44qSSCDZcO1vI8f8ADxdCwlXoOR9Lq4tYFW8U5Hufl/iGnj1UNbgkqhgGoVvXxHtbrJiV/hmnMDTKFkJkkkqqksq+vkkt62KHMdGKxG09HNjWaKONmnkMJVUFxIWeF3tXterV8SQMxi1WjlZDJGTVZImtvjb7y3JiyQ2fEtOq/moxkHHVGph/Zye8T3Eu57PgySkywIWO1lFjenHY2KwTNH5LgOPSXhsv8zG6gmHTE1fwPw5PwYskUxt4rAqfRbulefaPCOUGBxrdXpNQVHHZGQ0eMGMnTqOHbxIFth8vie7wAvBjFAWZrjmetYFDbnm40LTyGbUvLIqGlAqhGl9UnYTdb1vb4v77iawjJ24SV+/LEjfhxXxlrke9iR4+stpFd6m8K5NXHwxVIu1dsSjpU6VtSw/+RjKqMNoxZqEBHTSv6MX6aQEeK2Y9LrYtlUoe/sPgbkUIqOg4/MazRq052yozRsf3jQPFxer72/B1fw/TtHqChj4jSSPusQWWySR07K8iyQB0PZcBh6LVwSIzCx7UTU/lvxI/wYJ086OOZZAUNPvLxUb+XgEbDg02NmOTqNa/V00TynzFLUxxOJwtUpJM8RNTdm7N1eu3XxlrHQjrEAAk+NiGlTIzyu7sbmY2yLvPXrY1MbGl7xAUpWvEVqb7IvZ8bEMi6m2gUhWjkFfCY1kXs41IXXIpdGa08a4HN1VlRD1WW3HwnVmZpZoJoUVipjVa6j8pbdM8csjvppH3EXh/51moW4eMNoxfCeIvRz4qpKsNuLJ1DA7SB9a4v0z2+TtX6Ozj1q0HjjNcVGY+SXpXdPzYuG1Pq5M2hkZkSdbWZCAwzDZXB17PaTDwGMaqF47o5UKIDQ034pWWx0/Z8fr4CQwxIWzbiSHdAoLqRRvfjjl21OsNQ2ofIKGzdNPCN2GNm/eTfrJnw40/tDNHTZsqfH3cQtPpFYWgVUvDstGf5dlTs+JjhtBJJcoa46iUE3b9KRt4rWYmOghXTmJ5qyKSWJSNTDfLqOLI1sl+5hZk6sih1p0ML1+vFUNOnoxbMLX5mH/HFV317236MXKSD0jFsoqPGH2ri+BrG6V2ecmN9bl8dM/pXFQaj5B06d4fVgg7DkcFDzHkgSIHoai4A0PeweGoUnaf+eGHer9GIo628SSt3RaP72IlOa2jOmWDsyagoNlMasEAXSORmDQMMxu9V7VuxoGQkqsCRi7M+rHB3v4fdoDVfFP2Yy3JP0/3sVIuXxh9uKqSD0jFJRcPGG3F6ZN4y5HzhioHFXpXJvRxQHMbRz8pDzE0Pz5dwSDnyPLI6caOCS7fLPuiuWS730YiVmZTaKllP4sANLmxuFFJyOzYMalNBp3nEk1eKw4cYBuS5pH3bV7WIdHrpI5Z463GEMEFTdYvE3mt8fk0k3l6efF8RtPe2ecuN8ZczDZiqmhHOMUkFw6RtxXIt0jJhisZ4q9BybFrVVhtVsjyVfpFcMvTs8PyAfV6aDUsuSmaJJCATW1WdWtXFBotOgGyxbP/AArMKyQrLCuSy0BYIOqjfdxw1a1/1bbrej2vNxGW227fBlyqqaHpGLZht5+b5xi6E0rzbQcUcUOKg0I2EYpILx07DihAfvHaP7WKwtcPEf7GxbIpjboOz5j3Svin9B7hI2Nn8jQiowJeGFcbGXLbtwqLsUAD5vkKqcucc2LJAATzHZisR80/YcWsCD0HFRkRsOKPvjp58W5N0q236MVga3yGzXuW8zinzjPuVG1c/m5/6LTrL0H7MUOZ6DtGKx7w6OfFDkRtGK8+KPvr39v04//Z",a.appendChild(e),e.onload=function(){a.style.display="block"};var n=document.createElement("div");n.id="progress-bar-container",a.appendChild(n);var i=document.createElement("div");i.id="progress-bar",n.appendChild(i);const t=document.createElement("div");t.id="preloader",t.classList.add("preloader-hidden"),document.body.appendChild(t);const o=document.createElement("div");o.id="preloaderAnimation",t.appendChild(o);const r=document.createElement("img");r.id="walking-model",o.appendChild(r);const l=document.createElement("div");l.id="loading-text",o.appendChild(l)}(),A.on("preload:start",(function(){((A=10)=>{i=0,t=Math.ceil(A/.05),o=setInterval(updateProgressSimulation,50)})(10)})),A.on("preload:end",(function(){A.off("preload:progress")})),A.on("preload:progress",(A=>{e=A,updateProgress()})),A.on("start",(()=>{pc.app.fire(EventTypes.SHOW_TRANSITION_SCREEN,0),A.once(EventTypes.LOCATION_CHANGED,(()=>{AssetsLoader.getInstance().loadPendingAssets().then((()=>{appReadyToStart=!0,clearInterval(o),n=1,updateProgress(),pc.app.fire(EventTypes.HIDE_TRANSITION_SCREEN,.5,(()=>{})),LoadingOverlay.transition({color:"#fcb6dd",transitionDuration:0,displayLoadingAnimation:!1},{color:"#fcb6dd",transitionDuration:.5},(()=>{var A=document.getElementById("application-splash-wrapper");A.parentElement.removeChild(A),APIMediator.sendPreloadProgress(100),APIMediator.initCallbacks(),APIMediator.reportGameReady()}))}))}))}))}))},APIMediator.isPlaycanvasEnvironment()?window.GameInterface.init().then((()=>{window._createLoadingScreen()})):window._createLoadingScreen();var SoundController=pc.createScript("soundController");SoundController.attributes.add("preloadSoundAssets",{title:"Preload sounds",type:"boolean",default:!1}),SoundController.attributes.add("preloadMusicAssets",{title:"Preload music",type:"boolean",default:!1}),SoundController.attributes.add("autoPlayMelodyKey",{title:"Auto play melody key",type:"string",default:""}),SoundController.attributes.add("musicAssets",{title:"Music assets",type:"json",schema:[{name:"key",type:"string",default:""},{name:"asset",type:"asset",assetType:"audio"},{name:"overlap",type:"boolean",default:!1},{name:"volume",type:"number",default:1},{name:"loop",type:"boolean",default:!0}],array:!0}),SoundController.attributes.add("soundAssets",{title:"Sound assets",type:"json",schema:[{name:"key",type:"string",default:""},{name:"asset",type:"asset",assetType:"audio"},{name:"overlap",type:"boolean",default:!1},{name:"volume",type:"number",default:1},{name:"autoPlay",type:"boolean",default:!1},{name:"loop",type:"boolean",default:!1}],array:!0}),SoundController.attributes.add("soundSeries",{title:"Sound series",type:"json",schema:[{name:"key",type:"string",default:""},{name:"startPitch",type:"number",default:1},{name:"endPitch",type:"number",default:1.5},{name:"steps",type:"number",default:10,min:2,max:25},{name:"timeout",type:"number",default:1e3}],array:!0}),SoundController.sfxStateLoaded=!1,SoundController.sfxVolume=.5,SoundController.musicStateLoaded=!1,SoundController.musicVolume=.5,Object.defineProperty(SoundController,"musicEnabled",{get:()=>SoundController.musicVolume>0,set(t){t?SoundController.musicVolume=SoundController._prevMusicVolume||.5:(SoundController._prevMusicVolume=SoundController.musicVolume,SoundController.musicVolume=0),pc.AppBase.getApplication().fire(EventTypes.SET_MUSIC_VOLUME,SoundController.musicVolume)}}),Object.defineProperty(SoundController,"sfxEnabled",{get:()=>SoundController.sfxVolume>0,set(t){t?SoundController.sfxVolume=SoundController._prevSFXVolume||.5:(SoundController._prevSFXVolume=SoundController.sfxVolume,SoundController.sfxVolume=0),pc.AppBase.getApplication().fire(EventTypes.SET_SFX_VOLUME,SoundController.sfxVolume)}}),SoundController.masterVolume=1,SoundController.apiVolumeMultiplier=1,SoundController.prototype.initialize=function(){this.musicSlotKeys=new Set,this.sfxSlotKeys=new Set,this.app.on(EventTypes.PLAY_SFX,this.playSfx,this),this.app.on(EventTypes.PLAY_EXTERNAL_SFX,this.playExternalSfx,this),this.app.on(EventTypes.STOP_SFX,this.stopSfx,this),this.app.on(EventTypes.PLAY_MUSIC,this.playMusic,this),this.app.on(EventTypes.STOP_MUSIC,this.stopMusic,this),this.app.on(EventTypes.MUTE_SOUND,this.muteSound,this),this.app.on(EventTypes.UNMUTE_SOUND,this.unmuteSound,this),this.app.on(EventTypes.ENABLE_SFX,this.enableSfx,this),this.app.on(EventTypes.DISABLE_SFX,this.disableSfx,this),this.app.on(EventTypes.ENABLE_MUSIC,this.enableMusic,this),this.app.on(EventTypes.DISABLE_MUSIC,this.disableMusic,this),this.app.on(EventTypes.CHOKE_MUSIC,this.chokeMusic,this),this.app.on(EventTypes.UNCHOKE_MUSIC,this.unchokeMusic,this),this.app.on(EventTypes.SET_MUSIC_VOLUME,this.setMusicVolume,this),this.app.on(EventTypes.SET_SFX_VOLUME,this.setSFXVolume,this),this.app.on("postinitialize",this.onAppLoaded,this),this.app.on(EventTypes.SET_MASTER_VOLUME,this.setMasterVolume,this),this.app.on(EventTypes.SET_VOLUME_MULTIPLIER,this.setVolumeMultiplier,this),this.app.on(EventTypes.SAVEDATA_LOADED,this.loadSavedValues,this),this.setMasterVolume(1),SoundController.sfxStateLoaded=!0,this.setSFXVolume(1),SoundController.musicStateLoaded=!0,this.setMusicVolume(1),this.soundSeriesMap=new Map,this.soundSeries.forEach((t=>{t.key.split(",").forEach((o=>this.soundSeriesMap.set(o,t)))})),this._applyIOSAudioContextFix();const t=APIMediator.isMuted();SoundController.sfxEnabled=!t,SoundController.musicEnabled=!t,APIMediator.onAudioStateChange((t=>{SoundController.externalMuteStatus=t,SoundController.sfxEnabled=!t,SoundController.musicEnabled=!t}))},SoundController.prototype._applyIOSAudioContextFix=function(){pc.platform.ios&&this.app.touch.on(pc.EVENT_TOUCHEND,(()=>{"interrupted"!==this.app.soundManager.context.state&&"suspended"!==this.app.soundManager.context.state||this.app.soundManager.context.resume().then((()=>{console.log("[iOS audio] Audio context restored")})).catch((t=>{console.log("[iOS audio] Can not resume audio context")}))}))},SoundController.prototype.loadSavedValues=function(){const t=LocalStorageController.getSavedValue(Constants.Storage.SFX_VOLUME);null!=t?(SoundController.sfxStateLoaded=!0,this.setSFXVolume(t)):(SoundController.sfxStateLoaded=!0,this.setSFXVolume(1));const o=LocalStorageController.getSavedValue(Constants.Storage.MUSIC_VOLUME);null!=o?(SoundController.musicStateLoaded=!0,this.setMusicVolume(o)):(SoundController.musicStateLoaded=!0,this.setMusicVolume(1));const e=APIMediator.isMuted();SoundController.sfxEnabled=!e,SoundController.musicEnabled=!e},SoundController.prototype.update=function(t){},SoundController.prototype.playSfx=function(t,o){Array.isArray(t)&&(t=Utils.getRandomItem(t));const e=(new Date).getTime(),s=this.entity.sound.slot(t);if(!s)return console.warn("wrong sound slot ",s);s.lastTimeStamp;if(o){const t=s.lastTimeStamp;if(t&&e-t<o)return}if(this.soundSeriesMap.has(t)){const o=this.soundSeriesMap.get(t),n=o._lastSeriesIndex||0;e-(o.lastTimeStamp||0)<=o.timeout?(s.pitch=pc.math.clamp(o.startPitch+n*(o.endPitch-o.startPitch)/(o.steps-1),o.startPitch,o.endPitch),o._lastSeriesIndex+=1):(s.pitch=o.startPitch,o._lastSeriesIndex=0),o.lastTimeStamp=e}s.lastTimeStamp=e,s?this._loadAndPlayAsset(t):console.warn("No sound with key '"+t+"' in storage!")},SoundController.prototype.playExternalSfx=function(t,o,e){o&&o.sound&&o.sound.slot(t)&&SoundController.sfxEnabled&&o.sound.play(t)},SoundController.prototype.stopSfx=function(t){this.entity.sound.stop(t)},SoundController.prototype.playMusic=function(t,o=!0){this.currentMusicKey=t,o&&this.musicAssets.forEach((t=>{const o=this.entity.sound.slot(t.key);o&&o.isPlaying&&o.stop()})),this._loadAndPlayAsset(t)},SoundController.prototype.stopMusic=function(t){t?this.entity.sound.stop(t):this.musicAssets.forEach((t=>{const o=this.entity.sound.slot(t.key);o&&o.isPlaying&&o.stop()}))},SoundController.prototype.muteSound=function(t){this.entity.sound.slot(t)._initialVolume=0,this.entity.sound.slot(t).volume=0},SoundController.prototype.unmuteSound=function(t,o){this.entity.sound.slot(t)._initialVolume=o*SoundController.sfxVolume,this.entity.sound.slot(t).volume=o*SoundController.sfxVolume},SoundController.prototype.enableSfx=function(t=!0){SoundController.sfxEnabled=!0},SoundController.prototype.disableSfx=function(t=!0){SoundController.sfxEnabled=!1},SoundController.prototype.enableMusic=function(t=!0){SoundController.musicEnabled=!0,this.currentMusicKey&&this.app.fire(EventTypes.PLAY_MUSIC,this.currentMusicKey)},SoundController.prototype.disableMusic=function(t=!0){SoundController.musicEnabled=!1},SoundController.prototype.chokeMusic=function(){this.musicSlotKeys.forEach((t=>{const o=this.entity.sound.slot(t);o&&(o.volume=o._initialVolume*SoundController.musicVolume*.2)}))},SoundController.prototype.unchokeMusic=function(){this.musicSlotKeys.forEach((t=>{const o=this.entity.sound.slot(t);o&&(o.volume=o._initialVolume*SoundController.musicVolume*1)}))},SoundController.prototype.fireSoundStateChangedEvent=function(){this.app.fire(EventTypes.SOUND_STATE_CHANGED,SoundController.sfxEnabled,SoundController.sfxVolume)},SoundController.prototype.fireMusicStateChangedEvent=function(){this.app.fire(EventTypes.MUSIC_STATE_CHANGED,SoundController.musicEnabled,SoundController.musicVolume)},SoundController.prototype.setMusicVolume=function(t){SoundController.musicVolume=t,this.musicSlotKeys.forEach((t=>{const o=this.entity.sound.slot(t);o&&(o.volume=o._initialVolume*SoundController.musicVolume)})),this.fireMusicStateChangedEvent()},SoundController.prototype.setSFXVolume=function(t){SoundController.sfxVolume=t,this.sfxSlotKeys.forEach((t=>{const o=this.entity.sound.slot(t);o&&(o.volume=o._initialVolume*SoundController.sfxVolume)})),this.fireSoundStateChangedEvent()},SoundController.prototype.onAppLoaded=function(){this.createSoundsSlots(),this.createMusicSlots()},SoundController.prototype.createSoundsSlots=function(){this.preloadSoundAssets&&console.log("Preloading "+this.soundAssets.length+" sfx..."),this.soundAssets.forEach((t=>{const o=this.entity.sound.addSlot(t.key,t);o._initialVolume=o.volume,this.sfxSlotKeys.add(t.key),this.preloadSoundAssets&&this.entity.sound.slot(t.key)&&!this.entity.sound.slot(t.key).isLoaded&&this.entity.sound.slot(t.key).load()})),this.setSFXVolume(SoundController.sfxVolume)},SoundController.prototype.createMusicSlots=function(){this.preloadMusicAssets&&console.log("Preloading "+this.musicAssets.length+" melodies...");const playMusicTask=t=>{this.autoPlayMelodyKey!==t&&this.currentMusicKey!==t||this.entity.sound.slot(t).play()};this.musicAssets.forEach((t=>{const o=this.entity.sound.addSlot(t.key,t);o._initialVolume=o.volume,this.musicSlotKeys.add(t.key),this.preloadMusicAssets&&(this.entity.sound.slot(t.key)&&!this.entity.sound.slot(t.key).isLoaded?(this.entity.sound.slot(t.key).load(),this.entity.sound.slot(t.key).once("load",(()=>{playMusicTask(t.key)}))):this.entity.sound.slot(t.key).isLoaded&&playMusicTask(t.key))})),this.setMusicVolume(SoundController.musicVolume)},SoundController.prototype._loadAndPlayAsset=function(t){if(!this.entity.sound.slot(t))return console.warn("No sound with key "+t);this.entity.sound.slot(t).isLoaded?this.entity.sound.slot(t).play():(this.entity.sound.slot(t).load(),this.entity.sound.slot(t).once("load",(()=>{this.entity.sound.slot(t).play()})))},SoundController.prototype.updateVolume=function(){this.app.systems.sound.volume=SoundController.masterVolume*SoundController.apiVolumeMultiplier},SoundController.prototype.setMasterVolume=function(t){SoundController.masterVolume=t,this.updateVolume()},SoundController.prototype.setVolumeMultiplier=function(t){SoundController.apiVolumeMultiplier=t,this.updateVolume()};"undefined"!=typeof document&&(
/*! FPSMeter 0.3.1 - 9th May 2013 | https://github.com/Darsain/fpsmeter */
function(t,e){function s(t,e){for(var n in e)try{t.style[n]=e[n]}catch(t){}return t}function H(t){return null==t?String(t):"object"==typeof t||"function"==typeof t?Object.prototype.toString.call(t).match(/\s([a-z]+)/i)[1].toLowerCase()||"object":typeof t}function R(t,e){if("array"!==H(e))return-1;if(e.indexOf)return e.indexOf(t);for(var n=0,o=e.length;n<o;n++)if(e[n]===t)return n;return-1}function I(){var t,e=arguments;for(t in e[1])if(e[1].hasOwnProperty(t))switch(H(e[1][t])){case"object":e[0][t]=I({},e[0][t],e[1][t]);break;case"array":e[0][t]=e[1][t].slice(0);break;default:e[0][t]=e[1][t]}return 2<e.length?I.apply(null,[e[0]].concat(Array.prototype.slice.call(e,2))):e[0]}function N(t){return 1===(t=Math.round(255*t).toString(16)).length?"0"+t:t}function S(t,e,n,o){t.addEventListener?t[o?"removeEventListener":"addEventListener"](e,n,!1):t.attachEvent&&t[o?"detachEvent":"attachEvent"]("on"+e,n)}function D(t,e){function g(t,e,n,o){return h[0|t][Math.round(Math.min((e-n)/(o-n)*M,M))]}function r(){F.legend.fps!==q&&(F.legend.fps=q,F.legend[c]=q?"FPS":"ms"),b=q?v.fps:v.duration,F.count[c]=999<b?"999+":b.toFixed(99<b?0:O.decimals)}function m(){for(l=n(),P<l-O.threshold&&(v.fps-=v.fps/Math.max(1,60*O.smoothing/O.interval),v.duration=1e3/v.fps),w=O.history;w--;)T[w]=0===w?v.fps:T[w-1],j[w]=0===w?v.duration:j[w-1];if(r(),O.heat){if(z.length)for(w=z.length;w--;)z[w].el.style[o[z[w].name].heatOn]=q?g(o[z[w].name].heatmap,v.fps,0,O.maxFps):g(o[z[w].name].heatmap,v.duration,O.threshold,0);if(F.graph&&o.column.heatOn)for(w=C.length;w--;)C[w].style[o.column.heatOn]=q?g(o.column.heatmap,T[w],0,O.maxFps):g(o.column.heatmap,j[w],O.threshold,0)}if(F.graph)for(y=0;y<O.history;y++)C[y].style.height=(q?T[y]?Math.round(x/O.maxFps*Math.min(T[y],O.maxFps)):0:j[y]?Math.round(x/O.threshold*Math.min(j[y],O.threshold)):0)+"px"}function k(){20>O.interval?(p=i(k),m()):(p=setTimeout(k,O.interval),f=i(m))}function G(t){(t=t||window.event).preventDefault?(t.preventDefault(),t.stopPropagation()):(t.returnValue=!1,t.cancelBubble=!0),v.toggle()}function U(){O.toggleOn&&S(F.container,O.toggleOn,G,1),t.removeChild(F.container)}function V(){if(F.container&&U(),o=D.theme[O.theme],!(h=o.compiledHeatmaps||[]).length&&o.heatmaps.length){for(y=0;y<o.heatmaps.length;y++)for(h[y]=[],w=0;w<=M;w++){var e,n=h[y],a=w;e=.33/M*w;var i=o.heatmaps[y].saturation,l=o.heatmaps[y].lightness,p=void 0,c=void 0,u=void 0,d=u=void 0,f=p=c=void 0;f=void 0;0===(u=.5>=l?l*(1+i):l+i-l*i)?e="#000":(c=(u-(d=2*l-u))/u,f=(e*=6)-(p=Math.floor(e)),f*=u*c,0===p||6===p?(p=u,c=d+f,u=d):1===p?(p=u-f,c=u,u=d):2===p?(p=d,c=u,u=d+f):3===p?(p=d,c=u-f):4===p?(p=d+f,c=d):(p=u,c=d,u-=f),e="#"+N(p)+N(c)+N(u)),n[a]=e}o.compiledHeatmaps=h}for(var b in F.container=s(document.createElement("div"),o.container),F.count=F.container.appendChild(s(document.createElement("div"),o.count)),F.legend=F.container.appendChild(s(document.createElement("div"),o.legend)),F.graph=O.graph?F.container.appendChild(s(document.createElement("div"),o.graph)):0,z.length=0,F)F[b]&&o[b].heatOn&&z.push({name:b,el:F[b]});if(C.length=0,F.graph)for(F.graph.style.width=O.history*o.column.width+(O.history-1)*o.column.spacing+"px",w=0;w<O.history;w++)C[w]=F.graph.appendChild(s(document.createElement("div"),o.column)),C[w].style.position="absolute",C[w].style.bottom=0,C[w].style.right=w*o.column.width+w*o.column.spacing+"px",C[w].style.width=o.column.width+"px",C[w].style.height="0px";s(F.container,O),r(),t.appendChild(F.container),F.graph&&(x=F.graph.clientHeight),O.toggleOn&&("click"===O.toggleOn&&(F.container.style.cursor="pointer"),S(F.container,O.toggleOn,G))}"object"===H(t)&&undefined===t.nodeType&&(e=t,t=document.body),t||(t=document.body);var o,h,l,p,f,x,b,w,y,v=this,O=I({},D.defaults,e||{}),F={},C=[],M=100,z=[],E=O.threshold,A=0,P=n()-E,T=[],j=[],q="fps"===O.show;v.options=O,v.fps=0,v.duration=0,v.isPaused=0,v.tickStart=function(){A=n()},v.tick=function(){l=n(),E+=(l-P-E)/O.smoothing,v.fps=1e3/E,v.duration=A<P?E:l-A,P=l},v.pause=function(){return p&&(v.isPaused=1,clearTimeout(p),a(p),a(f),p=f=0),v},v.resume=function(){return p||(v.isPaused=0,k()),v},v.set=function(t,e){return O[t]=e,q="fps"===O.show,-1!==R(t,u)&&V(),-1!==R(t,d)&&s(F.container,O),v},v.showDuration=function(){return v.set("show","ms"),v},v.showFps=function(){return v.set("show","fps"),v},v.toggle=function(){return v.set("show",q?"ms":"fps"),v},v.hide=function(){return v.pause(),F.container.style.display="none",v},v.show=function(){return v.resume(),F.container.style.display="block",v},v.destroy=function(){v.pause(),U(),v.tick=v.tickStart=function(){}},V(),k()}var n,o=t.performance;n=o&&(o.now||o.webkitNow)?o[o.now?"now":"webkitNow"].bind(o):function(){return+new Date};for(var a=t.cancelAnimationFrame||t.cancelRequestAnimationFrame,i=t.requestAnimationFrame,h=0,l=0,p=(o=["moz","webkit","o"]).length;l<p&&!a;++l)i=(a=t[o[l]+"CancelAnimationFrame"]||t[o[l]+"CancelRequestAnimationFrame"])&&t[o[l]+"RequestAnimationFrame"];a||(i=function(e){var o=n(),a=Math.max(0,16-(o-h));return h=o+a,t.setTimeout((function(){e(o+a)}),a)},a=function(t){clearTimeout(t)});var c="string"===H(document.createElement("div").textContent)?"textContent":"innerText";D.extend=I,window.FPSMeter=D,D.defaults={interval:100,smoothing:10,show:"fps",toggleOn:"click",decimals:1,maxFps:60,threshold:100,position:"absolute",zIndex:10,left:"5px",top:"5px",right:"auto",bottom:"auto",margin:"0 0 0 0",theme:"dark",heat:0,graph:0,history:20};var u=["toggleOn","theme","heat","graph","history"],d="position zIndex left top right bottom margin".split(" ")}(window),function(t,e){e.theme={};var n=e.theme.base={heatmaps:[],container:{heatOn:null,heatmap:null,padding:"5px",minWidth:"95px",height:"30px",lineHeight:"30px",textAlign:"right",textShadow:"none"},count:{heatOn:null,heatmap:null,position:"absolute",top:0,right:0,padding:"5px 10px",height:"30px",fontSize:"24px",fontFamily:"Consolas, Andale Mono, monospace",zIndex:2},legend:{heatOn:null,heatmap:null,position:"absolute",top:0,left:0,padding:"5px 10px",height:"30px",fontSize:"12px",lineHeight:"32px",fontFamily:"sans-serif",textAlign:"left",zIndex:2},graph:{heatOn:null,heatmap:null,position:"relative",boxSizing:"padding-box",MozBoxSizing:"padding-box",height:"100%",zIndex:1},column:{width:4,spacing:1,heatOn:null,heatmap:null}};e.theme.dark=e.extend({},n,{heatmaps:[{saturation:.8,lightness:.8}],container:{background:"#222",color:"#fff",border:"1px solid #1a1a1a",textShadow:"1px 1px 0 #222"},count:{heatOn:"color"},column:{background:"#3f3f3f"}}),e.theme.light=e.extend({},n,{heatmaps:[{saturation:.5,lightness:.5}],container:{color:"#666",background:"#fff",textShadow:"1px 1px 0 rgba(255,255,255,.5), -1px -1px 0 rgba(255,255,255,.5)",boxShadow:"0 0 0 1px rgba(0,0,0,.1)"},count:{heatOn:"color"},column:{background:"#eaeaea"}}),e.theme.colorful=e.extend({},n,{heatmaps:[{saturation:.5,lightness:.6}],container:{heatOn:"backgroundColor",background:"#888",color:"#fff",textShadow:"1px 1px 0 rgba(0,0,0,.2)",boxShadow:"0 0 0 1px rgba(0,0,0,.1)"},column:{background:"#777",backgroundColor:"rgba(0,0,0,.2)"}}),e.theme.transparent=e.extend({},n,{heatmaps:[{saturation:.8,lightness:.5}],container:{padding:0,color:"#fff",textShadow:"1px 1px 0 rgba(0,0,0,.5)"},count:{padding:"0 5px",height:"40px",lineHeight:"40px"},legend:{padding:"0 5px",height:"40px",lineHeight:"42px"},graph:{height:"40px"},column:{width:5,background:"#999",heatOn:"backgroundColor",opacity:.5}})}(window,FPSMeter));var Fps=pc.createScript("fps");Fps.prototype.initialize=function(){this.fps=new FPSMeter({heat:!0,graph:!0})},Fps.prototype.update=function(t){this.fps.tick()};var EventTypes=pc.createScript("eventTypes");EventTypes.APP_LOADED="app:onLoaded",EventTypes.SAVE_APP="app:save",EventTypes.SAVEDATA_LOADED="app:savedataLoaded",EventTypes.POSTINITIALIZE="postinitialize",EventTypes.ASSETS_LOADER_STARTED_LOADING="assetsLoader:started",EventTypes.ASSETS_LOADER_PROGRESS="assetsLoader:progress",EventTypes.ASSETS_LOADER_COMPLETE="assetsLoader:complete",EventTypes.ASSETS_LOADER_ASSET_LOADED="assetsLoader:assetLoaded",EventTypes.ASSETS_LOADER_ASSET_FAILED="assetsLoader:assetFailed",EventTypes.LEVEL_RESET="level:reset",EventTypes.LEVEL_FINISHED="level:finished",EventTypes.GAME_DATA_READY="gameData:ready",EventTypes.LOCATION_CHANGED="location:changed",EventTypes.SET_NEXT_CITY="location:setNextCity",EventTypes.SHOW_GAMEPLAY_TUTORIAL_HAND="tutorial:gameplay:show",EventTypes.HIDE_GAMEPLAY_TUTORIAL_HAND="tutorial:gameplay:hide",EventTypes.USERNAME_CHANGED="username:changed",EventTypes.SCORE_CHANGED="score:changed",EventTypes.LEVEL_CHANGED="level:changed",EventTypes.CHAPTER_CHANGED="chapter:changed",EventTypes.GEMS_AMOUNT_CHANGED="gems:changed",EventTypes.GEMS_BOOST_LEVEL_CHANGED="gemsBoost:changed",EventTypes.LIKES_BOOST_LEVEL_CHANGED="likesBoost:changed",EventTypes.INTERNAL_CAMERA_TRANSITION_FINISHED="camera:internalTransitionFinished",EventTypes.CAMERA_TRANSITION_FINISHED="camera:transitionFinished",EventTypes.SHOW_FEEDBACK_EFFECT="feedback:showEffect",EventTypes.BUTTON_PRESSED="button:pressed",EventTypes.BUTTON_UP="button:up",EventTypes.BUTTON_DOWN="button:down",EventTypes.BUTTON_DRAG="button:drag",EventTypes.GUI={SCREEN_SHOWN:"gui:screenShown",SCREEN_HIDDEN:"gui:screenHidden"},EventTypes.Screen={RESIZED:"app:screen:resized",SET_SCALE_BLEND:"app:screen:setScaleBlend",SET_SHADOWS_ENABLED:"app:screen:shadowsEnabled"},EventTypes.UI_ELEMENT={APPEAR:"uiElement:appear",APPEAR_MANUALLY:"uiElement:appearManually",DISAPPEAR:"uiElement:disappear",APPEARED:"uiElement:appeared",DISAPPEARED:"uiElement:disappeared"},EventTypes.SHOW_TRANSITION_SCREEN="show:transitionScreen",EventTypes.HIDE_TRANSITION_SCREEN="hide:transitionScreen",EventTypes.ENABLE_MUSIC="music:enable",EventTypes.DISABLE_MUSIC="music:disable",EventTypes.ENABLE_SFX="sfx:enable",EventTypes.DISABLE_SFX="sfx:disable",EventTypes.SET_SFX_VOLUME="sfx:setVolume",EventTypes.SET_MUSIC_VOLUME="music:setVolume",EventTypes.PLAY_MUSIC="music:play",EventTypes.STOP_MUSIC="music:stop",EventTypes.CHOKE_MUSIC="music:choke",EventTypes.UNCHOKE_MUSIC="music:unchoke",EventTypes.PLAY_EXTERNAL_SFX="sfx:playExternal",EventTypes.PLAY_SFX="sfx:play",EventTypes.STOP_SFX="sfx:stop",EventTypes.MUTE_SOUND="audio:mute",EventTypes.UNMUTE_SOUND="audio:unmute",EventTypes.SOUND_STATE_CHANGED="sound:stateChanged",EventTypes.MUSIC_STATE_CHANGED="music:stateChanged",EventTypes.SET_VOLUME_MULTIPLIER="audio:setVolumeMultiplier",EventTypes.SET_MASTER_VOLUME="audio:setMasterVolume",EventTypes.QUALITY_CHANGED="quality:changed",EventTypes.QUALITY_UPDATE="quality:update",EventTypes.QUALITY_NEXT="quality:next",EventTypes.VIEWPORT_RESIZE="viewport:resize",EventTypes.MEASURE_PERFORMANCE="performance:measure",EventTypes.TAP_AT="input:tapAt",EventTypes.INPUT_DOWN="input:down",EventTypes.INPUT_UP="input:up",EventTypes.INPUT_MOVE="input:move",EventTypes.SWIPE_LEFT="input:swipeLeft",EventTypes.SWIPE_RIGHT="input:swipeRight",EventTypes.SWIPE_UP="input:swipeUp",EventTypes.SWIPE_DOWN="input:swipeDown",EventTypes.GameInput={MOUSE_DOWN:"gameInput:mouse_down",MOUSE_UP:"gameInput:mouse_up",MOUSE_MOVE:"gameInput:mouse_move",TOUCH_STARTED:"gameInput:touch_started",TOUCH_ENDED:"gameInput:touch_ended",TOUCH_UPDATED:"gameInput:touch_updated",TOUCH_MOVE:"gameInput:touch_move",KEYBOARD_STARTED:"gameInput:keyboard_started",KEYBOARD_ENDED:"gameInput:keyboard_ended",KEYBOARD_UPDATED:"gameInput:keyboard_updated"},EventTypes.afterAll=async function(...e){return Promise.all(e.map((e=>new Promise(((E,t)=>{pc.AppBase.getApplication().once(e,(()=>E()))})))))},EventTypes.afterAny=async function(...e){let E=!1;const t=e.map((e=>new Promise(((t,s)=>{pc.AppBase.getApplication().once(e,(()=>{E||(E=!0,t(e))}))}))));return Promise.any(t)};var Utils=pc.createScript("utils");Utils.prototype.initialize=function(){Utils.app=this.app},Utils.prototype.update=function(t){},Utils.stopTween=function(...t){t.forEach((t=>{t&&t.playing&&t.stop()}))},Utils.formatMoney=function(t,e){return new Intl.NumberFormat(e||LocalizationManager.getClientLanguage()).format(t)},Utils.postMessage=function(t){window.parent&&window.parent.postMessage(t,"*")},Utils.wait=function(t){return new Promise(((e,n)=>{void 0!==t?setTimeout((()=>e()),t):e()}))},Utils.worldToLocalPosition=function(t,e){return t.parent?(this._transformMatrix=this._transformMatrix||new pc.Mat4,this._transformMatrix.copy(t.parent.getWorldTransform()),this._transformMatrix.invert().transformPoint(e)):(console.warn("worldToLocalPosition: entity is not parented!"),pc.Vec3.ZERO)},Utils.localToWorldPosition=function(t,e){return this._transformMatrix=this._transformMatrix||new pc.Mat4,this._transformMatrix.copy(t.getWorldTransform()),this._transformMatrix.transformPoint(e)},Utils.worldToLocalEulerAngles=function(t,e){const n=t.getLocalEulerAngles().clone();t.setEulerAngles(e);const i=t.getLocalEulerAngles().clone();return t.setLocalEulerAngles(n),i},Utils._fadeDiffuseRecursive=function(t,e,n){t.render&&t.render.meshInstances.forEach((i=>{i.material.diffuse.equals(pc.Color.WHITE)&&(i.material=i.material.clone(),i.material.diffuse=(new pc.Color).fromString("#FEFEFE"),i.material.update()),i.__originalDiffuse||(i.__originalDiffuse=i.material.diffuse.clone()),i.__diffuseValues=i.__diffuseValues||i.__originalDiffuse.clone();const a={r:i.__originalDiffuse.r*e,g:i.__originalDiffuse.g*e,b:i.__originalDiffuse.b*e};t.tween(i.__diffuseValues).to(a,n,pc.Linear).onUpdate((()=>{i.setParameter("material_diffuse",Utils.getGammaCorrectedColorUniform(i.__diffuseValues))})).start()})),t.children.forEach((t=>Utils._fadeDiffuseRecursive(t,e,n)))},Utils._tweenOpacityRecursive=function(t,e,n){t.render&&t.render.meshInstances.forEach((i=>{i.material.blendType!==pc.BLEND_NORMAL&&i.material.blendType!==pc.BLEND_ADDITIVEALPHA&&(i.material=i.material.clone(),i.material.blendType=pc.BLEND_NORMAL,i.material.opacity=.999,i.material.update()),i.__originalOpacity||(i.__originalOpacity=i.material.opacity),i.__currentOpacity=i.__originalOpacity,n>0?t.tween(i).to({__currentOpacity:e},n,pc.Linear).onUpdate((()=>{i.setParameter("material_opacity",i.__currentOpacity)})).start():i.setParameter("material_opacity",e)})),t.children.forEach((t=>Utils._tweenOpacityRecursive(t,e,n)))},Utils.getGammaCorrectedColorUniform=function(t,e,n){const i=pc.AppBase.getApplication().scene.gammaCorrection===pc.GAMMA_SRGB?2.2:1;return void 0!==t.r&&void 0!==t.g&&void 0!==t.b?[Math.pow(t.r,i),Math.pow(t.g,i),Math.pow(t.b,i)]:[Math.pow(t,i),Math.pow(e,i),Math.pow(n,i)]},pc.Entity.prototype.delayedCall=function(t,e,n){for(var i=0;this["delayedExecuteTween"+i];)i++;var a="delayedExecuteTween"+i;return this[a]=this.tween(undefined).to(1,t/1e3,pc.Linear),this[a].start(),this[a].once("complete",(function(){e.call(n),this[a]=null}),this),this[a]},Utils.raycastAll=function(t,e,n){if(n=n||[],lastResult=this.app.systems.rigidbody.raycastFirst(t,e),lastResult&&lastResult.entity){for(var i=0;i<n.length;i++)if(n[i]===lastResult.entity)return n;n.push(lastResult.entity),Utils.raycastAll(lastResult.point.sub(lastResult.normal.scale(.01)),e,n)}return n},Utils.raycastAllAdvanced=function(t,e,n){if(n=n||[],lastResult=this.app.systems.rigidbody.raycastFirst(t,e),lastResult&&lastResult.entity){for(var i=0;i<n.length;i++)if(n[i].entity===lastResult.entity)return n;n.push(lastResult),Utils.raycastAllAdvanced(lastResult.point.sub(lastResult.normal.scale(.01)),e,n)}return n},pc.Entity.prototype.childrenAlphaAppear=function(t,e,n,i){for(var a=this.children.length-1;a>-1;a--){var o=this.children[a];if(o instanceof pc.Entity&&o.childrenAlphaAppear(t,e,n,i),o.element){var r=o.element.opacity;o.element.opacity=t,o.tween(o.element).to({opacity:r},e,n).delay(i).start()}}},pc.GraphicsDevice.prototype.updateClientRect=function(){window.visualViewport?(this.clientRect=this.canvas.getBoundingClientRect(),this.clientRect.x=window.visualViewport.offsetLeft,this.clientRect.y=window.visualViewport.offsetTop,this.clientRect.width=window.visualViewport.width,this.clientRect.height=window.visualViewport.height):this.clientRect=this.canvas.getBoundingClientRect()},Utils.lerpColor=function(t,e,n,i){return i.set(t.r+(e.r-t.r)*n,t.g+(e.g-t.g)*n,t.b+(e.b-t.b)*n,1)},Utils.distanceBetween=function(t,e,n,i){return Math.sqrt((n-t)*(n-t)+(i-e)*(i-e))},Utils.checkContact=function(t,e){var n=t.getPosition(),i=e.getPosition();return Math.sqrt((n.x-i.x)*(n.x-i.x)+(n.z-i.z)*(n.z-i.z))<=t.script.item.collisionDiameter*t.collisionScale/2+e.script.item.collisionDiameter*e.collisionScale/2&&Math.abs(n.y-i.y)<=t.script.item.collisionHeight*t.collisionScale/2+e.script.item.collisionHeight*e.collisionScale/2},Utils.checkContactRough=function(t,e){var n=1.1,i=t.getPosition(),a=e.getPosition();return Math.sqrt((i.x-a.x)*(i.x-a.x)+(i.z-a.z)*(i.z-a.z))<=t.script.item.collisionDiameter*t.collisionScale*n/2+e.script.item.collisionDiameter*e.collisionScale*n/2&&Math.abs(i.y-a.y)<=t.script.item.collisionHeight*t.collisionScale*n/2+e.script.item.collisionHeight*e.collisionScale*n/2},Utils.distanceXZ=function(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.z-e.z)*(t.z-e.z))},Utils.distanceBetweenEntities=function(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)+(t.z-e.z)*(t.z-e.z))},Utils.tweenText=function(t,e,n,i,a,o){t.element.textValue=e,t.element.text=""+Math.round(e),t.tween(t.element).to({textValue:n},i,o).delay(a).onUpdate((function(){t.element.text=""+Math.round(t.element.textValue)})).onComplete((function(){t.element.text=""+n})).start()},Utils.tweenColor=function(t,e,n,i,a=0,o=pc.Linear){pc.AppBase.getApplication().tween(t).to(e,n,o).delay(a).onUpdate((()=>{i&&i(t)})).onComplete((()=>{i&&i(t)})).start()},Utils.getRandomItem=function(t,e,n){if(null===t)return null;void 0===e&&(e=0),void 0===n&&(n=t.length);var i=e+Math.floor(Math.random()*n);return void 0===t[i]?null:t[i]},Utils.getRandomItemBut=function(t,e){return Utils.getRandomItem(t.slice().filter((t=>t!==e)))},Utils.removeRandomItem=function(t,e,n){if(null===t)return null;void 0===e&&(e=0),void 0===n&&(n=t.length);var i=e+Math.floor(Math.random()*n);if(i<t.length){var a=t.splice(i,1);return void 0===a[0]?null:a[0]}return null},Utils.shuffle=function(t){for(var e=t.length-1;e>0;e--){var n=Math.floor(Math.random()*(e+1)),i=t[e];t[e]=t[n],t[n]=i}return t},Utils.humanizeTime=function(t){var e=t,n=Math.floor(e/3600);e%=3600;var i=Math.floor(e/60);return(n<10?"0":"")+n+":"+(i<10?"0":"")+i+":"+((e%=60)<10?"0":"")+Math.floor(e)},Utils.humanizeTimeShort=function(t){var e=t;Math.floor(e/3600);e%=3600;var n=Math.floor(e/60);return(n<10?"0":"")+n+":"+((e%=60)<10?"0":"")+Math.floor(e)},Utils.getBoundingBox=function(t,e){if(t.model&&t.model.meshInstances&&t.model.meshInstances.length>0){var n=t.model.meshInstances,i=new pc.BoundingBox;i.copy(n[0].aabb);for(var a=1;a<n.length;a++)i.add(n[a].aabb);return e&&i.halfExtents.add(e),i}return null};var log=function(...t){GameConfig.getAttribute("enableLogging")?(console.log(1,arguments),console.log(...t)):console.log(2)};Utils.normalizeAngle=function(t){return(t%=2*Math.PI)>Math.PI?t-2*Math.PI:t<-Math.PI?t+2*Math.PI:t},Utils.normalizeAngleDegrees=function(t){return(t%=360)>180?t-360:t<-180?t+360:t},Utils.getYawFromRotation=function(t){return Utils._transformedForward=Utils._transformedForward||new pc.Vec3,t.transformVector(pc.Vec3.FORWARD,Utils._transformedForward),Math.atan2(-Utils._transformedForward.x,-Utils._transformedForward.z)*pc.math.RAD_TO_DEG},Utils.getYawBetweenVectors=function(t,e){return Math.atan2(e.x-t.x,e.z-t.z)*pc.math.RAD_TO_DEG},Utils.getAngleValue=function(t){return(t=(t%(2*Math.PI)+2*Math.PI)%(2*Math.PI))/(2*Math.PI)},Utils.angleDifference=function(t,e){const n=(e-t+180)%360-180;return n<-180?n+360:n},Utils.randomInRangeSigned=function(t,e){return Math.random()<=.5?pc.math.random(Math.min(-t,-e),Math.max(-t,-e)):pc.math.random(Math.min(t,e),Math.max(t,e))},Utils.vibrate=function(t){GameplayController.enableVibration&&window.navigator&&window.navigator.vibrate&&window.navigator.vibrate(t)},Utils.setMat4Forward=function(){var t,e,n;return t=new pc.Vec3,e=new pc.Vec3,n=new pc.Vec3,function(i,a,o){n.copy(a).scale(-1),e.copy(o).normalize(),t.cross(e,n).normalize(),e.cross(n,t);var r=i.data;return r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=0,r[4]=e.x,r[5]=e.y,r[6]=e.z,r[7]=0,r[8]=n.x,r[9]=n.y,r[10]=n.z,r[11]=0,r[15]=1,i}}(),Utils.checkPointBelongsToSegment=function(t,e,n,i,a,o){return t>=Math.min(n,a)&&t<=Math.max(n,a)&&e>=Math.min(i,o)&&e<=Math.max(i,o)},Utils.findLineCircleIntersections=function(t,e,n,i,a,o,r,l=!0){let s,c,u,p,f,h,m;if(s=o-i,c=r-a,u=s*s+c*c,p=2*(s*(i-t)+c*(a-e)),f=(i-t)*(i-t)+(a-e)*(a-e)-n*n,h=p*p-4*u*f,u<=1e-7||h<0)return null;if(0==h){m=-p/(2*u);let t=new pc.Vec2(i+m*s,a+m*c);return Utils.checkPointBelongsToSegment(t.x,t.y,i,a,o,r)?t:null}{m=(-p+Math.sqrt(h))/(2*u);let t=new pc.Vec2(i+m*s,a+m*c);m=(-p-Math.sqrt(h))/(2*u);let e=new pc.Vec2(i+m*s,a+m*c);return t=Utils.checkPointBelongsToSegment(t.x,t.y,i,a,o,r)?t:null,e=Utils.checkPointBelongsToSegment(e.x,e.y,i,a,o,r)?e:null,t&&e?Utils.distanceBetween(i,a,t.x,t.y)<=Utils.distanceBetween(i,a,e.x,e.y)?l?t:e:l?e:t:t||(e||null)}},function(){for(var t=[],e=[],n=0,i=0,a=0;a<256;a++)e.push(new pc.Vec3),t.push(new pc.Quat);function Q(e){var i=t[255&n++];return!1!==e&&i.copy(e||pc.Quat.IDENTITY),i}function V(t,n,a){var o=e[255&i++];if(void 0!==n&&void 0!==a){var r=o.data;return r[0]=t,r[1]=n,r[2]=a,o}if(void 0!==t){var l=o.data,s=t.data;l[0]=s[0],l[1]=s[1],l[2]=s[2]}return o}function orthogonal(t){var e=Math.abs(t.x),n=Math.abs(t.y),i=Math.abs(t.z),a=e<n?e<i?pc.Vec3.RIGHT:pc.Vec3.FORWARD:n<i?pc.Vec3.UP:pc.Vec3.FORWARD;return V().cross(t,a)}pc.Vec3.temp=V,pc.Quat.temp=Q,pc.Vec3.prototype.angle=function(t,e){return function angleBetween(t,e,n){return n=n||pc.Vec3.UP,Math.atan2(V().cross(t,e).dot(n),t.dot(e))*pc.math.RAD_TO_DEG}(this,t,e)},pc.Quat.prototype.fromToRotation=function(t,e){return function fromToRotation(t,e,n){var i=t.dot(e);if(n=n||Q(),i<=-.999){n.w=0;var a=orthogonal(t).normalize();return n.x=a.x,n.y=a.y,n.z=a.z,n}var o=V(t).add(e).scale(.5);n.w=t.dot(o);var r=V().cross(t,o);return n.x=r.x,n.y=r.y,n.z=r.z,n.normalize()}(t,e,this)},pc.Quat.prototype.twist=function(t){var e=orthogonal(t),n=this.transformVector(e,V()),i=V(n).sub(V(t).scale(n.dot(t))).normalize(),a=Math.acos(e.dot(i))*pc.math.RAD_TO_DEG;return V(this.x,this.y,this.z).dot(t)>0?-a:a};var o=new pc.Mat4;pc.Quat.prototype.lookAt=function(t,e,n){return o.setLookAt(t,e,n||pc.Vec3.UP),this.setFromMat4(o),this};var r=pc.Vec3.prototype.mul;pc.Vec3.prototype.mul=function(t,e,n){return t instanceof pc.Quat?t.transformVector(this,this):r.call(this,t,e,n)}}();var Constants=pc.createScript("constants");Constants.GAME_NAME="FashionBattle",Constants.GAME_VERSION="v0.1",Constants.Screens={MAIN_MENU:"Screen_MainMenu",GAMEPLAY:"Screen_Gameplay",VICTORY:"Screen_Victory",DEFEAT:"Screen_Defeat",SETTINGS:"Popup_Settings",HAMMER_GAME:"Screen_HammerGame",CITY_UNLOCK:"Screen_CityUnlock"},Constants.Cameras={MAIN:"Camera_Main",DEBUG:"Camera_Debug"},Constants.Storage={CURRENT_LEVEL:"level",CHAPTER:"chapter",GEMS:"gems",VIBRATION:"vibration",MUSIC_VOLUME:"musicVolue",SFX_VOLUME:"sfxVolume",LIKES_BOOST_LEVEL:"likesBoost",GEMS_BOOST_LEVEL:"gemsBoost"},Constants.ClothingType={Hair:"Hair",Dress:"Dress",Top:"Top",Bottom:"Bottom",Shoes:"Shoes",Accessories:"Accessories"},Constants.ChoiceCorrectness={Good:1,Bad:0,Empty:-1},Constants.City={NewYork:"NewYork",Milan:"Milan",Paris:"Paris",London:"London",Rome:"Rome",Tokyo:"Tokyo",Moscow:"Moscow",Barcelona:"Barcelona",Cairo:"Cairo",Amsterdam:"Amsterdam",Shanghai:"Shanghai",Athens:"Athens",Guatemala:"Guatemala"},Constants.CityNamesMapping={NewYork:"NEW YORK",Milan:"MILAN",Paris:"PARIS",London:"LONDON",Rome:"ROME",Tokyo:"TOKYO",Moscow:"MOSCOW",Barcelona:"BARCELONA",Cairo:"CAIRO",Amsterdam:"AMSTERDAM",Shanghai:"SHANGHAI",Athens:"ATHENS",Guatemala:"GUATEMALA"},Constants.Concepts={NightClub:"NightClub",Sport:"Sport",Gala:"Gala",Formal:"Formal",Date:"Date",Beach:"Beach",Eighties:"Eighties",PyjamaParty:"PyjamaParty",Bohemian:"Bohemian",School:"School",Winter:"Winter",Masculine:"Masculine",Spring:"Spring",Fifties:"Fifties",Teen:"Teen",Christmas:"Christmas",Western:"Western",Cyberpunk:"Cyberpunk",Halloween:"Halloween",Festival:"Festival",Warrior:"Warrior",Tribal:"Tribal",Kpop:"Kpop",Gothic:"Gothic",Hiphop:"Hiphop",UpperClass:"UpperClass",Military:"Military",Cosplay:"Cosplay",Princess:"Princess",FlowerFairy:"FlowerFairy",NatureFairy:"NatureFairy",Foodie:"Foodie",FruitStyle:"FruitStyle",Centaurs:"Centaurs",Animals:"Animals",Sailor:"Sailor",Doll:"Doll",Parisian:"Parisian",Greek:"Greek",Prom:"Prom",Futuristic:"Futuristic",Astrology:"Astrology",Jeans:"Jeans",Pirate:"Pirate",FairyTales:"FairyTales",Fall:"Fall",BlackLace:"BlackLace",Circus:"Circus",AvantGarde:"AvantGarde",Bridal:"Bridal",FarEast:"FarEast",Fighter:"Fighter",Glitter:"Glitter",Hawaiian:"Hawaiian",Latino:"Latino",Mermaid:"Mermaid",OfficeLife:"OfficeLife",PinkShowGirl:"PinkShowGirl",RockAndRoll:"RockAndRoll",SpaceLife:"SpaceLife",FashionWeek:"FashionWeek",Viking:"Viking",OldMoney:"OldMoney"},Constants.ConceptNamesMapping={NightClub:"Night Club",Eighties:"80's",PyjamaParty:"Pyjama Party",Fifties:"50's",UpperClass:"Upper Class",FlowerFairy:"Flower Fairy",NatureFairy:"Nature Fairy",FruitStyle:"Fruit Style",FairyTales:"Fairy Tales",BlackLace:"Black Lace",AvantGarde:"Avant Garde",OfficeLife:"Office Life",PinkShowGirl:"Pink Show Girl",RockAndRoll:"Rock & Roll",SpaceLife:"Space Life",FashionWeek:"Fashion Week",OldMoney:"Old Money"};var GameConfig=pc.createScript("gameConfig");GameConfig.EASINGS=[{Linear:"Linear"},{QuadraticIn:"QuadraticIn"},{QuadraticOut:"QuadraticOut"},{QuadraticInOut:"QuadraticInOut"},{CubicIn:"CubicIn"},{CubicOut:"CubicOut"},{CubicInOut:"CubicInOut"},{QuarticIn:"QuarticIn"},{QuarticOut:"QuarticOut"},{QuarticInOut:"QuarticInOut"},{QuinticIn:"QuinticIn"},{QuinticOut:"QuinticOut"},{QuinticInOut:"QuinticInOut"},{SineIn:"SineIn"},{SineOut:"SineOut"},{SineInOut:"SineInOut"},{ExponentialIn:"ExponentialIn"},{ExponentialOut:"ExponentialOut"},{ExponentialInOut:"ExponentialInOut"},{CircularIn:"CircularIn"},{CircularOut:"CircularOut"},{CircularInOut:"CircularInOut"},{BackIn:"BackIn"},{BackOut:"BackOut"},{BackInOut:"BackInOut"},{BounceIn:"BounceIn"},{BounceOut:"BounceOut"},{BounceInOut:"BounceInOut"},{ElasticIn:"ElasticIn"},{ElasticOut:"ElasticOut"},{ElasticInOut:"ElasticInOut"}],GameConfig.attributes.add("gameplay",{type:"json",schema:[{name:"initialLikeLevelUpgradePrice",type:"number",default:20},{name:"initialGemsLevelUpgradePrice",type:"number",default:25},{name:"likesLevelPriceIncrement",type:"number",default:1},{name:"gemsLevelPriceIncrement",type:"number",default:1},{name:"likesPerSecondInitial",type:"number",default:1},{name:"likesPerSecondPerUpgradeLevel",type:"number",default:.3},{name:"likesPerSelectionInitial",type:"number",default:10},{name:"likesPerSelectionPerUpgradeLevel",type:"number",default:3},{name:"gesRewardInitial",type:"number",default:100},{name:"gesRewardPerUpgradeLevel",type:"number",default:6},{name:"chapterPriceIncrementPerLevel",type:"number",default:250}]}),GameConfig.attributes.add("UI",{type:"json",schema:[{name:"enableVibration",type:"boolean",default:!0},{name:"enablePrivacyPolicy",type:"boolean",default:!0}]}),GameConfig.attributes.add("debug",{type:"json",schema:[{name:"rewardedAds",title:"Rewarded Ads",type:"boolean",default:!0},{name:"overlay",type:"boolean",default:!1},{name:"physics",type:"boolean",default:!1},{name:"hotkeys",type:"boolean",default:!1}]}),GameConfig.prototype.initialize=function(){GameConfig.app=this.app,GameConfig.instance=this},GameConfig.getAttribute=function(e,n){return e?void 0===GameConfig.instance[e]?(console.warn("GameConfig doesn't contain  category  "+e),null):void 0!==n?void 0===GameConfig.instance[e][n]?(console.warn("GameConfig doesn't contain key  "+e+" > "+n),null):GameConfig.instance[e][n]:GameConfig.instance[e]:(console.warn("GameConfig.getAttribute: invalid category param ",e),null)},GameConfig.setAttribute=function(e,n,t){void 0!==GameConfig.instance[e]?void 0!==GameConfig.instance[e][n]?GameConfig.instance[e][n]=t:console.warn("GameConfig.setAttribute: invalid key  "+e+" > "+n):console.warn("GameConfig.setAttribute: invalid category  "+e)};pc.extend(pc,function(){var TweenManager=function(t){this._app=t,this._tweens=[],this._add=[]};TweenManager.prototype={add:function(t){return this._add.push(t),t},update:function(t){for(var i=0,e=this._tweens.length;i<e;)this._tweens[i].update(t)?i++:(this._tweens.splice(i,1),e--);if(this._add.length){for(let t=0;t<this._add.length;t++)this._tweens.indexOf(this._add[t])>-1||this._tweens.push(this._add[t]);this._add.length=0}}};var Tween=function(t,i,e){pc.events.attach(this),this.manager=i,e&&(this.entity=null),this.time=0,this.complete=!1,this.playing=!1,this.stopped=!0,this.pending=!1,this.target=t,this.duration=0,this._currentDelay=0,this.timeScale=1,this._reverse=!1,this._delay=0,this._yoyo=!1,this._count=0,this._numRepeats=0,this._repeatDelay=0,this._from=!1,this._slerp=!1,this._fromQuat=new pc.Quat,this._toQuat=new pc.Quat,this._quat=new pc.Quat,this.easing=pc.Linear,this._sv={},this._ev={}},_parseProperties=function(t){var i;return t instanceof pc.Vec2?i={x:t.x,y:t.y}:t instanceof pc.Vec3?i={x:t.x,y:t.y,z:t.z}:t instanceof pc.Vec4||t instanceof pc.Quat?i={x:t.x,y:t.y,z:t.z,w:t.w}:t instanceof pc.Color?(i={r:t.r,g:t.g,b:t.b},void 0!==t.a&&(i.a=t.a)):i=t,i};Tween.prototype={to:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this},from:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this._from=!0,this},rotate:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this._slerp=!0,this},start:function(){var t,i,e,s;if(this.playing=!0,this.complete=!1,this.stopped=!1,this._count=0,this.pending=this._delay>0,this._reverse&&!this.pending?this.time=this.duration:this.time=0,this._from){for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this._properties[t],this._ev[t]=this.target[t]);this._slerp&&(this._toQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,s=void 0!==this._properties.z?this._properties.z:this.target.z,this._fromQuat.setFromEulerAngles(i,e,s))}else{for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this.target[t],this._ev[t]=this._properties[t]);this._slerp&&(i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,s=void 0!==this._properties.z?this._properties.z:this.target.z,void 0!==this._properties.w?(this._fromQuat.copy(this.target),this._toQuat.set(i,e,s,this._properties.w)):(this._fromQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),this._toQuat.setFromEulerAngles(i,e,s)))}return this._currentDelay=this._delay,this.manager.add(this),this.fire("start"),this},pause:function(){this.playing=!1},resume:function(){this.playing=!0},stop:function(){this.playing=!1,this.stopped=!0},delay:function(t){return this._delay=t,this.pending=!0,this},repeat:function(t,i){return this._count=0,this._numRepeats=t,this._repeatDelay=i||0,this},loop:function(t){return t?(this._count=0,this._numRepeats=1/0):this._numRepeats=0,this},yoyo:function(t){return this._yoyo=t,this},reverse:function(){return this._reverse=!this._reverse,this},chain:function(){for(var t=arguments.length;t--;)t>0?arguments[t-1]._chained=arguments[t]:this._chained=arguments[t];return this},onStart:function(t){return this.on("start",t),this},onUpdate:function(t){return this.on("update",t),this},onComplete:function(t){return this.on("complete",t),this},onLoop:function(t){return this.on("loop",t),this},update:function(t){if(this.stopped)return!1;if(!this.playing)return!0;if(!this._reverse||this.pending?this.time+=t*this.timeScale:this.time-=t*this.timeScale,this.pending){if(!(this.time>this._currentDelay))return!0;this._reverse?this.time=this.duration-(this.time-this._currentDelay):this.time-=this._currentDelay,this.pending=!1}var i=0;(!this._reverse&&this.time>this.duration||this._reverse&&this.time<0)&&(this._count++,this.complete=!0,this.playing=!1,this._reverse?(i=this.duration-this.time,this.time=0):(i=this.time-this.duration,this.time=this.duration));var e,s,n=0===this.duration?1:this.time/this.duration,r=this.easing(n);for(var h in this._properties)this._properties.hasOwnProperty(h)&&(e=this._sv[h],s=this._ev[h],this.target[h]=e+(s-e)*r);if(this._slerp&&this._quat.slerp(this._fromQuat,this._toQuat,r),this.entity&&(this.entity._dirtifyLocal(),this.element&&this.entity.element&&(this.entity.element[this.element]=this.target),this._slerp&&this.entity.setLocalRotation(this._quat)),this.fire("update",t),this.complete){var a=this._repeat(i);return a?this.fire("loop"):(this.fire("complete",i),this.entity&&this.entity.off("destroy",this.stop,this),this._chained&&this._chained.start()),a}return!0},_repeat:function(t){if(this._count<this._numRepeats){if(this._reverse?this.time=this.duration-t:this.time=t,this.complete=!1,this.playing=!0,this._currentDelay=this._repeatDelay,this.pending=!0,this._yoyo){for(var i in this._properties){var e=this._sv[i];this._sv[i]=this._ev[i],this._ev[i]=e}this._slerp&&(this._quat.copy(this._fromQuat),this._fromQuat.copy(this._toQuat),this._toQuat.copy(this._quat))}return!0}return!1}};var BounceOut=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},BounceIn=function(t){return 1-BounceOut(1-t)};return{TweenManager:TweenManager,Tween:Tween,Linear:function(t){return t},QuadraticIn:function(t){return t*t},QuadraticOut:function(t){return t*(2-t)},QuadraticInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},CubicIn:function(t){return t*t*t},CubicOut:function(t){return--t*t*t+1},CubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},QuarticIn:function(t){return t*t*t*t},QuarticOut:function(t){return 1- --t*t*t*t},QuarticInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},QuinticIn:function(t){return t*t*t*t*t},QuinticOut:function(t){return--t*t*t*t*t+1},QuinticInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},SineIn:function(t){return 0===t?0:1===t?1:1-Math.cos(t*Math.PI/2)},SineOut:function(t){return 0===t?0:1===t?1:Math.sin(t*Math.PI/2)},SineInOut:function(t){return 0===t?0:1===t?1:.5*(1-Math.cos(Math.PI*t))},ExponentialIn:function(t){return 0===t?0:Math.pow(1024,t-1)},ExponentialOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},ExponentialInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},CircularIn:function(t){return 1-Math.sqrt(1-t*t)},CircularOut:function(t){return Math.sqrt(1- --t*t)},CircularInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},BackIn:function(t){var i=1.70158;return t*t*((i+1)*t-i)},BackOut:function(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},BackInOut:function(t){var i=2.5949095;return(t*=2)<1?t*t*((i+1)*t-i)*.5:.5*((t-=2)*t*((i+1)*t+i)+2)},BounceIn:BounceIn,BounceOut:BounceOut,BounceInOut:function(t){return t<.5?.5*BounceIn(2*t):.5*BounceOut(2*t-1)+.5},ElasticIn:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),-e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/.4))},ElasticOut:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),e*Math.pow(2,-10*t)*Math.sin((t-i)*(2*Math.PI)/.4)+1)},ElasticInOut:function(t){var i,e=.1,s=.4;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=s*Math.asin(1/e)/(2*Math.PI),(t*=2)<1?e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/s)*-.5:e*Math.pow(2,-10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/s)*.5+1)}}}()),function(){pc.AppBase.prototype.addTweenManager=function(){this._tweenManager=new pc.TweenManager(this),this.on("update",(function(t){this._tweenManager.update(t)}))},pc.AppBase.prototype.stopAllTweens=function(t){for(var i=this._tweenManager._tweens.length-1;i>-1;i--)this._tweenManager._tweens[i].entity===t&&this._tweenManager._tweens[i].stop()},pc.AppBase.prototype.tween=function(t){return new pc.Tween(t,this._tweenManager)},pc.Entity.prototype.tween=function(t,i){var e=this._app.tween(t);return e.entity=this,this.once("destroy",e.stop,e),i&&i.element&&(e.element=i.element),e};var t=pc.AppBase.getApplication();t&&t.addTweenManager()}();var UIController=pc.createScript("uicontroller");UIController.attributes.add("initialWindow",{type:"entity"}),UIController.attributes.add("initialPopups",{type:"entity",array:!0}),UIController.attributes.add("autoEnableOnStart",{type:"boolean",default:!1}),UIController.attributes.add("enableInputBlocker",{type:"boolean",default:!0}),UIController.getInstance=function(){return UIController._instance||console.error("UIController is not initialized yet"),UIController._instance},UIController.prototype.initialize=function(){UIController._app=this.app,UIController._instance||(UIController._instance=this),this.app.on(EventTypes.Screen.SET_SCALE_BLEND,this.setScaleBlend,this),this.autoEnableOnStart&&(this._initializeWindows(),this._autoInitializeElements()),this._screenHideWaiters=new Map;if(this.entity.findByName("ScreenBlocker").enabled=!0,this.enableInputBlocker){const t=this.entity.findByName("InputBlocker");t&&(t.enabled=!0)}},UIController.prototype.postInitialize=function(){this.hideAllImmediately();const showInitialWindows=()=>{this.initialWindow&&this.showWindow(this.initialWindow.name),this.initialPopups&&this.initialPopups.forEach((t=>{t&&this.showPopup(t.name)}))};this.on("attr:initialWindow",showInitialWindows),this.on("attr:initialPopups",showInitialWindows),showInitialWindows()},UIController.prototype.update=function(t){},UIController.prototype._initializeWindows=function(){this.entity.children.forEach((t=>{t.tags.has("ui-window")?(t.enabled?console.error("Please disable UI '"+t.name+"'!"):t.enabled=!0,t.enabled=!1):t.tags.has("common-ui")||console.log("[Note] UI location "+t.name+" should probably have a 'ui-window' tag in order to be properly initialized")}))},UIController.prototype._autoInitializeElements=function(){this.entity.children.forEach((t=>{t.tags.has("auto-initialize")&&(t.enabled||(t.enabled=!0))}))},UIController.prototype.showWindow=function(t,e=!0,n=null){const i=this.entity.children.find((e=>e.name===t));i||console.warn("Attempt to display non-existent screen: "+t),e?this.hideAll(i).then((()=>{i&&this._showWindow(i,n)})):i&&this._showWindow(i,n)},UIController.prototype.showPopup=function(t){const e=this.entity.children.find((e=>e.name===t));e&&this._showWindow(e)},UIController.prototype.hide=function(t,e=!1){return new Promise(((n,i)=>{const o=this.entity.children.find((e=>e.name===t));o?this._hideWindow(o,e).then((()=>n())):n()}))},UIController.prototype.showWindowOverTransition=function(t,e){e=e||{};const n=this.entity.children.find((e=>e.name===t)),i=void 0===e.hideOthers||e.hideOthers,o=void 0!==e.windowToOpenOnExit?e.windowToOpenOnExit:null,r=void 0!==e.fadeInDuration?e.fadeInDuration:.175,s=void 0!==e.fadeOutDuration?e.fadeOutDuration:.35,l=void 0!==e.callback?e.callback:void 0;this.app.fire(EventTypes.SHOW_TRANSITION_SCREEN,r,(()=>{i?this.hideAllImmediately(n).then((()=>{n&&this._showWindow(n,o)})):n&&this._showWindow(n,o),l&&l(),this.app.fire(EventTypes.HIDE_TRANSITION_SCREEN,s)}))},UIController.prototype.transition=function(t){const e=void 0!==(t=t||{}).fadeInDuration?t.fadeInDuration:.15,n=void 0!==t.fadeOutDuration?t.fadeOutDuration:.25,i=void 0!==t.callback?t.callback:void 0;this.app.fire(EventTypes.SHOW_TRANSITION_SCREEN,e,(()=>{i&&i(),this.app.fire(EventTypes.HIDE_TRANSITION_SCREEN,n)}))},UIController.prototype.showWindowImmediately=function(t,e=!0,n=null){const i=this.entity.children.find((e=>e.name===t));e&&this.hideAll(i),i&&this._showWindow(i,n)},UIController.prototype.hideAll=async function(...t){const e=this.entity.children.filter((e=>e.tags.has("ui-window")&&-1===t.indexOf(e))).map((t=>this._hideWindow(t)));return await Promise.all(e)},UIController.prototype.hideAllImmediately=async function(...t){const e=this.entity.children.filter((e=>e.tags.has("ui-window")&&-1===t.indexOf(e))).map((t=>this._hideWindow(t,!0)));return await Promise.all(e)},UIController.prototype._showWindow=async function(t,e=null){return t.show&&"function"==typeof t.show?t.show(e):(t.enabled=!0,!0)},UIController.prototype._hideWindow=async function(t,e=!1){return t.hide&&"function"==typeof t.hide?t.hide(e):new Promise(((e,n)=>{t.enabled=!1,e()}))},UIController.prototype.dispatchWindowShown=function(t){this.app.fire(EventTypes.GUI.SCREEN_SHOWN,t)},UIController.prototype.dispatchWindowHidden=function(t){const e=this._screenHideWaiters.get(t);if(e&&e.length>0)for(;e.length>0;){e.pop()(t)}this.app.fire(EventTypes.GUI.SCREEN_HIDDEN,t)},UIController.prototype.waitWhenScreenHidden=function(t){return new Promise(((e,n)=>{this._screenHideWaiters.has(t)||this._screenHideWaiters.set(t,[]);this._screenHideWaiters.get(t).push((t=>e(t)))}))},UIController.prototype.getWindow=function(t){return this.entity.children.find((e=>e.name===t))},UIController.prototype.getScreenResolution=function(){return this.entity.screen.resolution},UIController.prototype.getScreenReferenceResolution=function(){return this.entity.screen.referenceResolution},UIController.prototype.getScreenScale=function(){return this.entity.screen.scale},UIController.prototype.getScreenWidth=function(){return this.entity.screen.resolution.x/this.entity.screen.scale},UIController.prototype.getScreenHeight=function(){return this.entity.screen.resolution.y/this.entity.screen.scale},UIController.prototype.getScaleBlend=function(){return this.entity.screen.scaleBlend},UIController.prototype.setScaleBlend=function(t){this.entity.screen.scaleBlend=t},UIController.prototype.worldToScreen=function(t){this._screenPos=this._screenPos||new pc.Vec3,CameraController.getInstance().getActiveCamera().camera.worldToScreen(t,this._screenPos);const e=this.app.graphicsDevice.maxPixelRatio;this._screenPos.x*=e,this._screenPos.y*=e;const n=this.app.graphicsDevice;return new pc.Vec3(this._screenPos.x/n.width*2-1,2*(1-this._screenPos.y/n.height)-1,0)};var InputController=pc.createScript("inputController");InputController.tapDistanceTolerance=1,InputController.clickDistanceTolerance=1,InputController.inputPosition=null,InputController.attributes.add("listenToSwipes",{type:"boolean",default:!0}),InputController.attributes.add("minSwipeDistance",{type:"number",default:75}),InputController.getInstance=function(){return InputController._instance||console.error("InputController is not initialized yet"),InputController._instance},InputController.prototype.initialize=function(){InputController._app=this.app,InputController._instance||(InputController._instance=this);const t=!!this.app.mouse;!!this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this),this.app.touch.on(pc.EVENT_TOUCHEND,this.onTouchEnd,this),this.app.touch.on(pc.EVENT_TOUCHCANCEL,this.onTouchCancel,this),this.app.touch.on(pc.EVENT_TOUCHEND,(function(t){t.event.preventDefault()}))),t&&(this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this)),this.app.keyboard&&this.app.keyboard.on(pc.EVENT_KEYDOWN,this.onKeyDown,this),this.app.mouse&&(this.app.mouse.disableContextMenu(),this.app.mouse.on(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this)),this.on("destroy",this.destroy,this)},InputController.prototype.update=function(t){},InputController.prototype.postUpdate=function(t){},InputController.prototype.onTouchStart=function(t){t.touches.length>=1&&(this.touchDownPosition={id:t.touches[0].id,x:t.touches[0].x,y:t.touches[0].y},InputController.inputPosition={x:t.touches[0].x,y:t.touches[0].y,traveledDistance:0},this.app.fire(EventTypes.INPUT_DOWN,t.touches[0].x,t.touches[0].y,t.touches[0].x/this.app.graphicsDevice.canvas.width*(window.devicePixelRatio||1),t.touches[0].y/this.app.graphicsDevice.canvas.height*(window.devicePixelRatio||1)))},InputController.prototype.onTouchMove=function(t){if(t.changedTouches&&t.changedTouches[0]){if(InputController.inputPosition?(InputController.inputPosition.traveledDistance+=Utils.distanceBetween(InputController.inputPosition.x||0,InputController.inputPosition.y||0,t.changedTouches[0].x,t.changedTouches[0].y),InputController.inputPosition.x=t.changedTouches[0].x,InputController.inputPosition.y=t.changedTouches[0].y):InputController.inputPosition={x:t.changedTouches[0].x,y:t.changedTouches[0].y,traveledDistance:0},this.touchDownPosition){const o=Utils.distanceBetween(this.touchDownPosition.x,this.touchDownPosition.y,t.changedTouches[0].x,t.changedTouches[0].y)*(window.devicePixelRatio||1)*1.25;if(this.listenToSwipes&&o>=this.minSwipeDistance){let o=t.changedTouches[0].x-this.touchDownPosition.x,i=t.changedTouches[0].y-this.touchDownPosition.y;Math.abs(o)/Math.abs(i||1)>1.8?(this.app.fire(o>0?EventTypes.SWIPE_RIGHT:EventTypes.SWIPE_LEFT),this.touchDownPosition=null,InputController.inputPosition=null):Math.abs(i)/Math.abs(o||1)>1.8&&(this.app.fire(i>0?EventTypes.SWIPE_DOWN:EventTypes.SWIPE_UP),this.touchDownPosition=null,InputController.inputPosition=null)}}this.app.fire(EventTypes.GameInput.TOUCH_MOVE,t.changedTouches[0].x,t.changedTouches[0].y),this.app.fire(EventTypes.INPUT_MOVE,t.changedTouches[0].x,t.changedTouches[0].y,t.changedTouches[0].x/this.app.graphicsDevice.canvas.width*(window.devicePixelRatio||1),t.changedTouches[0].y/this.app.graphicsDevice.canvas.height*(window.devicePixelRatio||1))}},InputController.prototype.onTouchEnd=function(t){t.changedTouches.length>=1&&(this.touchDownPosition&&InputController.inputPosition&&InputController.inputPosition.traveledDistance<InputController.tapDistanceTolerance&&this.touchDownPosition.id===t.changedTouches[0].id&&this.handleTouch(t.changedTouches[0].x,t.changedTouches[0].y),this.app.fire(EventTypes.INPUT_UP,t.changedTouches[0].x,t.changedTouches[0].y,t.changedTouches[0].x/this.app.graphicsDevice.canvas.width*(window.devicePixelRatio||1),t.changedTouches[0].y/this.app.graphicsDevice.canvas.height*(window.devicePixelRatio||1)))},InputController.prototype.onTouchCancel=function(t){this.touchDownPosition=null},InputController.prototype.onKeyDown=function(t){pc.platform.desktop&&(t.key,pc.KEY_A)},InputController.prototype.onMouseWheel=function(t){t.event.preventDefault()},InputController.prototype.onMouseDown=function(t){InputController.inputPosition={x:t.x,y:t.y,traveledDistance:0},this.mouseDownPosition={x:t.x,y:t.y},this.app.fire(EventTypes.INPUT_DOWN,t.x,t.y,t.x/this.app.graphicsDevice.canvas.width*(window.devicePixelRatio||1),t.y/this.app.graphicsDevice.canvas.height*(window.devicePixelRatio||1)),this.app.fire(EventTypes.GameInput.MOUSE_DOWN,t.x,t.y)},InputController.prototype.onMouseUp=function(t){this.app.fire(EventTypes.INPUT_UP,t.x,t.y,t.x/this.app.graphicsDevice.canvas.width*(window.devicePixelRatio||1),t.y/this.app.graphicsDevice.canvas.height*(window.devicePixelRatio||1)),this.app.fire(EventTypes.GameInput.MOUSE_UP,t.x,t.y),InputController.inputPosition&&InputController.inputPosition.traveledDistance<InputController.clickDistanceTolerance&&this.handleTouch(t.x,t.y),this.mouseDownPosition=null,InputController.inputPosition=null},InputController.prototype.onMouseMove=function(t){if(this.lastMouseX=t.x,this.lastMouseY=t.y,InputController.inputPosition&&(InputController.inputPosition.traveledDistance+=Utils.distanceBetween(InputController.inputPosition.x||0,InputController.inputPosition.y||0,t.x,t.y),InputController.inputPosition.x=t.x,InputController.inputPosition.y=t.y,this.app.fire(EventTypes.GameInput.MOUSE_MOVE,t.x,t.y),this.app.fire(EventTypes.INPUT_MOVE,t.x,t.y,t.x/this.app.graphicsDevice.canvas.width*(window.devicePixelRatio||1),t.y/this.app.graphicsDevice.canvas.height*(window.devicePixelRatio||1))),this.mouseDownPosition){const o=Utils.distanceBetween(this.mouseDownPosition.x,this.mouseDownPosition.y,t.x,t.y)*(window.devicePixelRatio||1);if(this.listenToSwipes&&o>=this.minSwipeDistance){let o=t.x-this.mouseDownPosition.x,i=t.y-this.mouseDownPosition.y;Math.abs(o)/Math.abs(i||1)>1.8?(this.app.fire(o>0?EventTypes.SWIPE_RIGHT:EventTypes.SWIPE_LEFT),this.mouseDownPosition=null,InputController.inputPosition=null):Math.abs(i)/Math.abs(o||1)>1.8&&(this.app.fire(i>0?EventTypes.SWIPE_DOWN:EventTypes.SWIPE_UP),this.mouseDownPosition=null,InputController.inputPosition=null)}}},InputController.prototype.handleTouch=function(t,o){this.app.fire(EventTypes.TAP_AT,t,o,t/this.app.graphicsDevice.canvas.width*(window.devicePixelRatio||1),o/this.app.graphicsDevice.canvas.height*(window.devicePixelRatio||1))},InputController.prototype.destroy=function(){this.app.touch.off(pc.EVENT_TOUCHSTART,this.onTouchStart,this),this.app.touch.off(pc.EVENT_TOUCHMOVE,this.onTouchMove,this),this.app.touch.off(pc.EVENT_TOUCHEND,this.onTouchEnd,this),this.app.touch.off(pc.EVENT_TOUCHCANCEL,this.onTouchCancel,this),this.app.mouse&&(this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.off(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.off(pc.EVENT_MOUSEMOVE,this.onMouseMove,this)),this.app.keyboard&&this.app.keyboard.off(pc.EVENT_KEYDOWN,this.onKeyDown,this)};var DataManager=pc.createScript("dataManager");DataManager.getInstance=function(){return DataManager._instance||console.error("DataManager is not initialized yet"),DataManager._instance},DataManager.prototype.initialize=function(){DataManager._app=this.app,DataManager._instance||(DataManager._instance=this),this.app.on(EventTypes.LEVEL_RESET,(()=>this.resetData()),this),this.app.on(EventTypes.SAVEDATA_LOADED,this._loadSavedData,this),this._level=1,Object.defineProperty(this,"level",{get:()=>this._level,set:e=>{this._level=e,this.app.fire(EventTypes.LEVEL_CHANGED,this._level)}}),this._chapter=1,Object.defineProperty(this,"chapter",{get:()=>this._chapter,set:e=>{this._chapter=e,this.app.fire(EventTypes.CHAPTER_CHANGED,this._chapter)}}),this._gems=0,Object.defineProperty(this,"gems",{get:()=>this._gems,set:e=>{this._gems=e,this.app.fire(EventTypes.GEMS_AMOUNT_CHANGED,this._gems)}}),this._likesBoostLevel=1,Object.defineProperty(this,"likesBoostLevel",{get:()=>this._likesBoostLevel,set:e=>{this._likesBoostLevel=e,this.app.fire(EventTypes.LIKES_BOOST_LEVEL_CHANGED,this._likesBoostLevel)}}),this._gemsBoostLevel=1,Object.defineProperty(this,"gemsBoostLevel",{get:()=>this._gemsBoostLevel,set:e=>{this._gemsBoostLevel=e,this.app.fire(EventTypes.GEMS_BOOST_LEVEL_CHANGED,this._gemsBoostLevel)}}),this._lastLevelRewardGems=0,Object.defineProperty(this,"lastLevelRewardGems",{get:()=>this._lastLevelRewardGems,set:e=>{this._lastLevelRewardGems=e}}),this._playerlevelScore=0,Object.defineProperty(this,"playerlevelScore",{get:()=>this._playerlevelScore,set:e=>{this._playerlevelScore=e}}),this._opponentLevelScore=0,Object.defineProperty(this,"opponentLevelScore",{get:()=>this._opponentLevelScore,set:e=>{this._opponentLevelScore=e}}),this._score=0,Object.defineProperty(this,"score",{get:()=>this._score,set:e=>{this._score=e,this.app.fire(EventTypes.SCORE_CHANGED,this._score)}}),this._username="You",Object.defineProperty(this,"username",{get:()=>this._username,set:e=>{this._username=e,this.app.fire(EventTypes.USERNAME_CHANGED,this._username)}}),this._started=!1,Object.defineProperty(this,"started",{get:()=>this._started,set:e=>{this._started=e}}),this._finished=!1,Object.defineProperty(this,"finished",{get:()=>this._finished,set:e=>{this._finished=e}}),this._lastMatchResultWasVictory=!1,Object.defineProperty(this,"lastMatchResultWasVictory",{get:()=>this._lastMatchResultWasVictory,set:e=>{this._lastMatchResultWasVictory=e}})},DataManager.prototype._loadSavedData=function(){DataManager.getInstance().username="You",DataManager.getInstance().level=LocalStorageController.getSavedValue(Constants.Storage.CURRENT_LEVEL)||1,DataManager.getInstance().chapter=LocalStorageController.getSavedValue(Constants.Storage.CHAPTER)||0,DataManager.getInstance().gems=LocalStorageController.getSavedValue(Constants.Storage.GEMS)||0,DataManager.getInstance().likesBoostLevel=LocalStorageController.getSavedValue(Constants.Storage.LIKES_BOOST_LEVEL)||1,DataManager.getInstance().gemsBoostLevel=LocalStorageController.getSavedValue(Constants.Storage.GEMS_BOOST_LEVEL)||1,this.app.fire(EventTypes.GAME_DATA_READY)},DataManager.prototype.resetData=function(){this.score=0,this.lastLevelRewardGems=0,this.started=!1,this.finished=!1,this.lastMatchResultWasVictory=!1},DataManager.prototype.getNextLikesBoostUpgradePrice=function(){return GameConfig.getAttribute("gameplay","initialLikeLevelUpgradePrice")+(this.likesBoostLevel-1)*GameConfig.getAttribute("gameplay","likesLevelPriceIncrement")},DataManager.prototype.getNextGemsBoostUpgradePrice=function(){return GameConfig.getAttribute("gameplay","initialGemsLevelUpgradePrice")+(this.gemsBoostLevel-1)*GameConfig.getAttribute("gameplay","gemsLevelPriceIncrement")},DataManager.prototype.getLikesRate=function(){return GameConfig.getAttribute("gameplay","likesPerSecondInitial")+(this.likesBoostLevel-1)*GameConfig.getAttribute("gameplay","likesPerSecondPerUpgradeLevel")},DataManager.prototype.getLikesPerSelection=function(){return GameConfig.getAttribute("gameplay","likesPerSelectionInitial")+(this.likesBoostLevel-1)*GameConfig.getAttribute("gameplay","likesPerSelectionPerUpgradeLevel")},DataManager.prototype.getGemsReward=function(){return GameConfig.getAttribute("gameplay","gesRewardInitial")+(this.gemsBoostLevel-1)*GameConfig.getAttribute("gameplay","gesRewardPerUpgradeLevel")},DataManager.prototype.getNeededLikesForNextChapter=function(){return(this.chapter+1)*GameConfig.getAttribute("gameplay","chapterPriceIncrementPerLevel")},DataManager.prototype.update=function(e){this.started&&this.finished};var HierarchyManager=pc.createScript("hierarchyManager");HierarchyManager.getInstance=function(){return HierarchyManager._instance||console.error("HierarchyManager is not initialized yet"),HierarchyManager._instance},HierarchyManager.prototype.initialize=function(){HierarchyManager._app=this.app,HierarchyManager._instance||(HierarchyManager._instance=this),this.hierarchyNameMap=new Map,this.hierarchyPathMap=new Map},HierarchyManager.prototype.getByName=function(r){const a=this.hierarchyNameMap.get(r);if(a)return a;{const a=this.app.root.findByName(r);if(a)return this.hierarchyNameMap.set(r,a),a;console.error(`Entity [ ${r} ] not found in hierarchy!`)}},HierarchyManager.prototype.getByPath=function(r){r.startsWith("Root")||(r="Root/"+r);const a=this.hierarchyPathMap.get(r);if(a)return a;{const a=this.app.root.findByPath(r);if(a)return this.hierarchyPathMap.set(r,a),a;console.error(`Entity path ${r} not found in hierarchy!`)}},HierarchyManager.prototype.update=function(r){};var TouchInput=pc.createScript("touchInput");TouchInput.attributes.add("orbitSensitivity",{type:"number",default:.4,title:"Orbit Sensitivity",description:"How fast the camera moves around the orbit. Higher is faster"}),TouchInput.attributes.add("distanceSensitivity",{type:"number",default:.2,title:"Distance Sensitivity",description:"How fast the camera moves in and out. Higher is faster"}),TouchInput.prototype.initialize=function(){this.orbitCamera=this.entity.script.orbitCamera,this.lastTouchPoint=new pc.Vec2,this.lastPinchMidPoint=new pc.Vec2,this.lastPinchDistance=0,this.orbitCamera&&this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHEND,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHCANCEL,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this),this.on("destroy",(function(){this.app.touch.off(pc.EVENT_TOUCHSTART,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHEND,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHCANCEL,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHMOVE,this.onTouchMove,this)})))},TouchInput.prototype.getPinchDistance=function(t,i){var o=t.x-i.x,n=t.y-i.y;return Math.sqrt(o*o+n*n)},TouchInput.prototype.calcMidPoint=function(t,i,o){o.set(i.x-t.x,i.y-t.y),o.scale(.5),o.x+=t.x,o.y+=t.y},TouchInput.prototype.onTouchStartEndCancel=function(t){var i=t.touches;1==i.length?this.lastTouchPoint.set(i[0].x,i[0].y):2==i.length&&(this.lastPinchDistance=this.getPinchDistance(i[0],i[1]),this.calcMidPoint(i[0],i[1],this.lastPinchMidPoint))},TouchInput.fromWorldPoint=new pc.Vec3,TouchInput.toWorldPoint=new pc.Vec3,TouchInput.worldDiff=new pc.Vec3,TouchInput.prototype.pan=function(t){var i=TouchInput.fromWorldPoint,o=TouchInput.toWorldPoint,n=TouchInput.worldDiff,h=this.entity.camera,c=this.orbitCamera.distance;h.screenToWorld(t.x,t.y,c,i),h.screenToWorld(this.lastPinchMidPoint.x,this.lastPinchMidPoint.y,c,o),n.sub2(o,i),this.orbitCamera.pivotPoint.add(n)},TouchInput.pinchMidPoint=new pc.Vec2,TouchInput.prototype.onTouchMove=function(t){var i=TouchInput.pinchMidPoint,o=t.touches;if(1==o.length){var n=o[0];this.orbitCamera.pitch-=(n.y-this.lastTouchPoint.y)*this.orbitSensitivity,this.orbitCamera.yaw-=(n.x-this.lastTouchPoint.x)*this.orbitSensitivity,this.lastTouchPoint.set(n.x,n.y)}else if(2==o.length){var h=this.getPinchDistance(o[0],o[1]),c=h-this.lastPinchDistance;this.lastPinchDistance=h,this.orbitCamera.distance-=c*this.distanceSensitivity*.1*(.1*this.orbitCamera.distance),this.calcMidPoint(o[0],o[1],i),this.pan(i),this.lastPinchMidPoint.copy(i)}};var OrbitCamera=pc.createScript("orbitCamera");OrbitCamera.attributes.add("autoRender",{type:"boolean",default:!0,title:"Auto Render",description:"Disable to only render when camera is moving (saves power when the camera is still)"}),OrbitCamera.attributes.add("distanceMax",{type:"number",default:0,title:"Distance Max",description:"Setting this at 0 will give an infinite distance limit"}),OrbitCamera.attributes.add("distanceMin",{type:"number",default:0,title:"Distance Min"}),OrbitCamera.attributes.add("pitchAngleMax",{type:"number",default:90,title:"Pitch Angle Max (degrees)"}),OrbitCamera.attributes.add("pitchAngleMin",{type:"number",default:-90,title:"Pitch Angle Min (degrees)"}),OrbitCamera.attributes.add("inertiaFactor",{type:"number",default:0,title:"Inertia Factor",description:"Higher value means that the camera will continue moving after the user has stopped dragging. 0 is fully responsive."}),OrbitCamera.attributes.add("focusEntity",{type:"entity",title:"Focus Entity",description:"Entity for the camera to focus on. If blank, then the camera will use the whole scene"}),OrbitCamera.attributes.add("frameOnStart",{type:"boolean",default:!0,title:"Frame on Start",description:'Frames the entity or scene at the start of the application."'}),Object.defineProperty(OrbitCamera.prototype,"distance",{get:function(){return this._targetDistance},set:function(t){this._targetDistance=this._clampDistance(t)}}),Object.defineProperty(OrbitCamera.prototype,"pitch",{get:function(){return this._targetPitch},set:function(t){this._targetPitch=this._clampPitchAngle(t)}}),Object.defineProperty(OrbitCamera.prototype,"yaw",{get:function(){return this._targetYaw},set:function(t){this._targetYaw=t;var i=(this._targetYaw-this._yaw)%360;this._targetYaw=i>180?this._yaw-(360-i):i<-180?this._yaw+(360+i):this._yaw+i}}),Object.defineProperty(OrbitCamera.prototype,"pivotPoint",{get:function(){return this._pivotPoint},set:function(t){this._pivotPoint.copy(t)}}),OrbitCamera.prototype.focus=function(t){this._buildAabb(t,0);var i=this._modelsAabb.halfExtents,e=Math.max(i.x,Math.max(i.y,i.z));e/=Math.tan(.5*this.entity.camera.fov*pc.math.DEG_TO_RAD),e*=2,this.distance=e,this._removeInertia(),this._pivotPoint.copy(this._modelsAabb.center)},OrbitCamera.distanceBetween=new pc.Vec3,OrbitCamera.prototype.resetAndLookAtPoint=function(t,i){this.pivotPoint.copy(i),this.entity.setPosition(t),this.entity.lookAt(i);var e=OrbitCamera.distanceBetween;e.sub2(i,t),this.distance=e.length(),this.pivotPoint.copy(i);var a=this.entity.getRotation();this.yaw=this._calcYaw(a),this.pitch=this._calcPitch(a,this.yaw),this._removeInertia(),this._updatePosition(),this.autoRender||(this.app.renderNextFrame=!0)},OrbitCamera.prototype.resetAndLookAtEntity=function(t,i){this._buildAabb(i,0),this.resetAndLookAtPoint(t,this._modelsAabb.center)},OrbitCamera.prototype.reset=function(t,i,e){this.pitch=i,this.yaw=t,this.distance=e,this._removeInertia(),this.autoRender||(this.app.renderNextFrame=!0)},OrbitCamera.prototype.initialize=function(){this._checkAspectRatio(),this._modelsAabb=new pc.BoundingBox,this._buildAabb(this.focusEntity||this.app.root,0),this.entity.lookAt(this._modelsAabb.center),this._pivotPoint=new pc.Vec3,this._pivotPoint.copy(this._modelsAabb.center),this._lastFramePivotPoint=this._pivotPoint.clone();var t=this.entity.getRotation();if(this._yaw=this._calcYaw(t),this._pitch=this._clampPitchAngle(this._calcPitch(t,this._yaw)),this.entity.setLocalEulerAngles(this._pitch,this._yaw,0),this._distance=0,this._targetYaw=this._yaw,this._targetPitch=this._pitch,this.frameOnStart)this.focus(this.focusEntity||this.app.root);else{var i=new pc.Vec3;i.sub2(this.entity.getPosition(),this._pivotPoint),this._distance=this._clampDistance(i.length())}this._targetDistance=this._distance,this._autoRenderDefault=this.app.autoRender,this.app.autoRender&&(this.app.autoRender=this.autoRender),this.autoRender||(this.app.renderNextFrame=!0),this.on("attr:autoRender",(function(t,i){this.app.autoRender=t,this.autoRender||(this.app.renderNextFrame=!0)}),this),this.on("attr:distanceMin",(function(t,i){this._targetDistance=this._clampDistance(this._distance)}),this),this.on("attr:distanceMax",(function(t,i){this._targetDistance=this._clampDistance(this._distance)}),this),this.on("attr:pitchAngleMin",(function(t,i){this._targetPitch=this._clampPitchAngle(this._pitch)}),this),this.on("attr:pitchAngleMax",(function(t,i){this._targetPitch=this._clampPitchAngle(this._pitch)}),this),this.on("attr:focusEntity",(function(t,i){this.frameOnStart?this.focus(t||this.app.root):this.resetAndLookAtEntity(this.entity.getPosition(),t||this.app.root)}),this),this.on("attr:frameOnStart",(function(t,i){t&&this.focus(this.focusEntity||this.app.root)}),this);var onResizeCanvas=function(){this._checkAspectRatio(),this.autoRender||(this.app.renderNextFrame=!0)};this.app.graphicsDevice.on("resizecanvas",onResizeCanvas,this),this.on("destroy",(function(){this.app.graphicsDevice.off("resizecanvas",onResizeCanvas,this),this.app.autoRender=this._autoRenderDefault}),this)},OrbitCamera.prototype.update=function(t){if(!this.autoRender){var i=Math.abs(this._targetDistance-this._distance),e=Math.abs(this._targetYaw-this._yaw),a=Math.abs(this._targetPitch-this._pitch),s=this._lastFramePivotPoint.distance(this._pivotPoint);this.app.renderNextFrame=this.app.renderNextFrame||i>.01||e>.01||a>.01||s>0}var n=0===this.inertiaFactor?1:Math.min(t/this.inertiaFactor,1);this._distance=pc.math.lerp(this._distance,this._targetDistance,n),this._yaw=pc.math.lerp(this._yaw,this._targetYaw,n),this._pitch=pc.math.lerp(this._pitch,this._targetPitch,n),this._lastFramePivotPoint.copy(this._pivotPoint),this._updatePosition()},OrbitCamera.prototype._updatePosition=function(){this.entity.setLocalPosition(0,0,0),this.entity.setLocalEulerAngles(this._pitch,this._yaw,0);var t=this.entity.getPosition();t.copy(this.entity.forward),t.scale(-this._distance),t.add(this.pivotPoint),this.entity.setPosition(t)},OrbitCamera.prototype._removeInertia=function(){this._yaw=this._targetYaw,this._pitch=this._targetPitch,this._distance=this._targetDistance},OrbitCamera.prototype._checkAspectRatio=function(){var t=this.app.graphicsDevice.height,i=this.app.graphicsDevice.width;this.entity.camera.horizontalFov=t>i},OrbitCamera.prototype._buildAabb=function(t,i){var e,a=0,s=0;if(t instanceof pc.Entity){var n=[],r=t.findComponents("render");for(a=0;a<r.length;++a)if(e=r[a].meshInstances)for(s=0;s<e.length;s++)n.push(e[s]);var h=t.findComponents("model");for(a=0;a<h.length;++a)if(e=h[a].meshInstances)for(s=0;s<e.length;s++)n.push(e[s]);for(a=0;a<n.length;a++)0===i?this._modelsAabb.copy(n[a].aabb):this._modelsAabb.add(n[a].aabb),i+=1}for(a=0;a<t.children.length;++a)i+=this._buildAabb(t.children[a],i);return i},OrbitCamera.prototype._calcYaw=function(t){var i=new pc.Vec3;return t.transformVector(pc.Vec3.FORWARD,i),Math.atan2(-i.x,-i.z)*pc.math.RAD_TO_DEG},OrbitCamera.prototype._clampDistance=function(t){return this.distanceMax>0?pc.math.clamp(t,this.distanceMin,this.distanceMax):Math.max(t,this.distanceMin)},OrbitCamera.prototype._clampPitchAngle=function(t){return pc.math.clamp(t,-this.pitchAngleMax,-this.pitchAngleMin)},OrbitCamera.quatWithoutYaw=new pc.Quat,OrbitCamera.yawOffset=new pc.Quat,OrbitCamera.prototype._calcPitch=function(t,i){var e=OrbitCamera.quatWithoutYaw,a=OrbitCamera.yawOffset;a.setFromEulerAngles(0,-i,0),e.mul2(a,t);var s=new pc.Vec3;return e.transformVector(pc.Vec3.FORWARD,s),Math.atan2(s.y,-s.z)*pc.math.RAD_TO_DEG};var MouseInput=pc.createScript("mouseInput");MouseInput.attributes.add("orbitSensitivity",{type:"number",default:.3,title:"Orbit Sensitivity",description:"How fast the camera moves around the orbit. Higher is faster"}),MouseInput.attributes.add("distanceSensitivity",{type:"number",default:.15,title:"Distance Sensitivity",description:"How fast the camera moves in and out. Higher is faster"}),MouseInput.prototype.initialize=function(){if(this.orbitCamera=this.entity.script.orbitCamera,this.orbitCamera){var t=this,onMouseOut=function(o){t.onMouseOut(o)};this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),window.addEventListener("mouseout",onMouseOut,!1),this.on("destroy",(function(){this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.off(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.off(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.off(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),window.removeEventListener("mouseout",onMouseOut,!1)}))}this.app.mouse.disableContextMenu(),this.lookButtonDown=!1,this.panButtonDown=!1,this.lastPoint=new pc.Vec2},MouseInput.fromWorldPoint=new pc.Vec3,MouseInput.toWorldPoint=new pc.Vec3,MouseInput.worldDiff=new pc.Vec3,MouseInput.prototype.pan=function(t){var o=MouseInput.fromWorldPoint,e=MouseInput.toWorldPoint,i=MouseInput.worldDiff,s=this.entity.camera,n=this.orbitCamera.distance;s.screenToWorld(t.x,t.y,n,o),s.screenToWorld(this.lastPoint.x,this.lastPoint.y,n,e),i.sub2(e,o),this.orbitCamera.pivotPoint.add(i)},MouseInput.prototype.onMouseDown=function(t){switch(t.button){case pc.MOUSEBUTTON_LEFT:this.lookButtonDown=!0;break;case pc.MOUSEBUTTON_MIDDLE:case pc.MOUSEBUTTON_RIGHT:this.panButtonDown=!0}},MouseInput.prototype.onMouseUp=function(t){switch(t.button){case pc.MOUSEBUTTON_LEFT:this.lookButtonDown=!1;break;case pc.MOUSEBUTTON_MIDDLE:case pc.MOUSEBUTTON_RIGHT:this.panButtonDown=!1}},MouseInput.prototype.onMouseMove=function(t){pc.app.mouse;this.lookButtonDown?(this.orbitCamera.pitch-=t.dy*this.orbitSensitivity,this.orbitCamera.yaw-=t.dx*this.orbitSensitivity):this.panButtonDown&&this.pan(t),this.lastPoint.set(t.x,t.y)},MouseInput.prototype.onMouseWheel=function(t){this.orbitCamera.distance-=t.wheel*this.distanceSensitivity*(.1*this.orbitCamera.distance),t.event.preventDefault()},MouseInput.prototype.onMouseOut=function(t){this.lookButtonDown=!1,this.panButtonDown=!1};var CameraPath=pc.createScript("cameraPath");CameraPath.attributes.add("pathRoot",{type:"entity",title:"Path Root"}),CameraPath.attributes.add("duration",{type:"number",default:10,title:"Duration Secs"}),CameraPath.attributes.add("startTime",{type:"number",default:0,title:"Start Time (Secs)",description:"Start the path from a specific point in time"}),CameraPath.attributes.add("manualMovement",{type:"boolean",default:!1}),CameraPath.attributes.add("progressEvent",{type:"string"}),CameraPath.attributes.add("tweenCurve",{type:"curve",curves:["time"],default:{keys:[0,0,1,1]}}),CameraPath.attributes.add("useEasing",{type:"boolean",default:!0}),CameraPath.attributes.add("easing",{type:"string",enum:[{Linear:"Linear"},{QuadraticIn:"QuadraticIn"},{QuadraticOut:"QuadraticOut"},{QuadraticInOut:"QuadraticInOut"},{CubicIn:"CubicIn"},{CubicOut:"CubicOut"},{CubicInOut:"CubicInOut"},{QuarticIn:"QuarticIn"},{QuarticOut:"QuarticOut"},{QuarticInOut:"QuarticInOut"},{QuinticIn:"QuinticIn"},{QuinticOut:"QuinticOut"},{QuinticInOut:"QuinticInOut"},{SineIn:"SineIn"},{SineOut:"SineOut"},{SineInOut:"SineInOut"},{ExponentialIn:"ExponentialIn"},{ExponentialOut:"ExponentialOut"},{ExponentialInOut:"ExponentialInOut"},{CircularIn:"CircularIn"},{CircularOut:"CircularOut"},{CircularInOut:"CircularInOut"},{BackIn:"BackIn"},{BackOut:"BackOut"},{BackInOut:"BackInOut"},{BounceIn:"BounceIn"},{BounceOut:"BounceOut"},{BounceInOut:"BounceInOut"},{ElasticIn:"ElasticIn"},{ElasticOut:"ElasticOut"},{ElasticInOut:"ElasticInOut"}],default:"Linear"}),CameraPath.attributes.add("loop",{type:"boolean",default:!1,title:"Loop"}),CameraPath.prototype.initialize=function(){this.createPath(),this.on("attr:pathRoot",(function(t,i){t&&(this.createPath(),this.time=0)})),this.on("attr:duration",(function(t,i){t&&(this.createPath(),this.time=0)})),this.on("attr:startTime",(function(t,i){this.time=pc.math.clamp(this.startTime,0,this.duration)})),this.on("state",(t=>{t&&(this.time=0,this.finished=!1)})),this.time=pc.math.clamp(this.startTime,0,this.duration),this.finished=!1,this.entity.setPathProgress=t=>this.setPathProgress(t),this.lookAt=new pc.Vec3,this.up=new pc.Vec3,this.flyingThrough=!0,this.manualMovement&&this.progressEvent&&this.app.on(this.progressEvent,this._setManualProgress,this)},CameraPath.prototype.update=function(t){this.finished||this.manualMovement||(this.time+=t,this.time>=this.duration&&(this.loop?this.time-=this.duration:this.time=this.duration),this.setPathProgress(pc.math.clamp(this.time/this.duration,0,1)))},CameraPath.prototype._setManualProgress=function(t){this.finished||(this.time=t*this.duration,this.time>=this.duration&&(this.loop?this.time-=this.duration:this.time=this.duration),this.setPathProgress(pc.math.clamp(this.time/this.duration,0,1)))},CameraPath.prototype.setPathProgress=function(t){let i=t;i=this.useEasing?pc[this.easing](t):this.tweenCurve.value(t),!this.finished&&i>=1&&(this.finished=!0,this.app.fire(EventTypes.CAMERA_TRANSITION_FINISHED,this.entity.name)),this.entity.setPosition(this.px.value(i),this.py.value(i),this.pz.value(i)),this.lookAt.set(this.tx.value(i),this.ty.value(i),this.tz.value(i)),this.up.set(this.ux.value(i),this.uy.value(i),this.uz.value(i)),this.entity.lookAt(this.lookAt,this.up)},CameraPath.prototype.createPath=function(){var t=pc.CURVE_CARDINAL;this.px=new pc.Curve,this.px.type=t,this.py=new pc.Curve,this.py.type=t,this.pz=new pc.Curve,this.pz.type=t,this.tx=new pc.Curve,this.tx.type=t,this.ty=new pc.Curve,this.ty.type=t,this.tz=new pc.Curve,this.tz.type=t,this.ux=new pc.Curve,this.ux.type=t,this.uy=new pc.Curve,this.uy.type=t,this.uz=new pc.Curve,this.uz.type=t;var e=this.pathRoot.children,a=0,s=[],n=new pc.Vec3;for(s.push(0),i=1;i<e.length;i++){var u=e[i-1],h=e[i];n.sub2(u.getPosition(),h.getPosition()),a+=n.length(),s.push(a)}for(i=0;i<e.length;i++){var r=s[i]/a,o=e[i],c=o.getPosition();this.px.add(r,c.x),this.py.add(r,c.y),this.pz.add(r,c.z);var p=c.clone().add(o.forward);this.tx.add(r,p.x),this.ty.add(r,p.y),this.tz.add(r,p.z);var d=o.up;this.ux.add(r,d.x),this.uy.add(r,d.y),this.uz.add(r,d.z)}};var KeyboardInput=pc.createScript("keyboardInput");KeyboardInput.prototype.initialize=function(){this.orbitCamera=this.entity.script.orbitCamera},KeyboardInput.prototype.postInitialize=function(){this.orbitCamera&&(this.startDistance=this.orbitCamera.distance,this.startYaw=this.orbitCamera.yaw,this.startPitch=this.orbitCamera.pitch,this.startPivotPosition=this.orbitCamera.pivotPoint.clone())},KeyboardInput.prototype.update=function(t){this.orbitCamera};var LerpAndSlerpCamera=pc.createScript("lerpAndSlerpCamera");LerpAndSlerpCamera.attributes.add("pointA",{type:"entity",title:"Point A"}),LerpAndSlerpCamera.attributes.add("pointB",{type:"entity",title:"Point B"}),LerpAndSlerpCamera.attributes.add("manualMovement",{type:"boolean",default:!1}),LerpAndSlerpCamera.attributes.add("tweenCurve",{type:"curve",curves:["time"],default:{keys:[0,0,1,1]}}),LerpAndSlerpCamera.attributes.add("useEasing",{type:"boolean",default:!1}),LerpAndSlerpCamera.attributes.add("easing",{type:"string",enum:[{Linear:"Linear"},{QuadraticIn:"QuadraticIn"},{QuadraticOut:"QuadraticOut"},{QuadraticInOut:"QuadraticInOut"},{CubicIn:"CubicIn"},{CubicOut:"CubicOut"},{CubicInOut:"CubicInOut"},{QuarticIn:"QuarticIn"},{QuarticOut:"QuarticOut"},{QuarticInOut:"QuarticInOut"},{QuinticIn:"QuinticIn"},{QuinticOut:"QuinticOut"},{QuinticInOut:"QuinticInOut"},{SineIn:"SineIn"},{SineOut:"SineOut"},{SineInOut:"SineInOut"},{ExponentialIn:"ExponentialIn"},{ExponentialOut:"ExponentialOut"},{ExponentialInOut:"ExponentialInOut"},{CircularIn:"CircularIn"},{CircularOut:"CircularOut"},{CircularInOut:"CircularInOut"},{BackIn:"BackIn"},{BackOut:"BackOut"},{BackInOut:"BackInOut"},{BounceIn:"BounceIn"},{BounceOut:"BounceOut"},{BounceInOut:"BounceInOut"},{ElasticIn:"ElasticIn"},{ElasticOut:"ElasticOut"},{ElasticInOut:"ElasticInOut"}],default:"Linear"}),LerpAndSlerpCamera.attributes.add("duration",{type:"number",default:5,title:"Duration (Secs)"}),LerpAndSlerpCamera.attributes.add("loop",{type:"boolean",default:!1,title:"Loop"}),LerpAndSlerpCamera.attributes.add("fireEventOnComplete",{type:"string",default:"",title:"Fire event on complete"}),LerpAndSlerpCamera.prototype.initialize=function(){this.time=0,this.finished=!1,this.on("state",(t=>{t&&(this.time=0,this.finished=!1)})),this.entity.setPathProgress=t=>this.setPathProgress(t)},LerpAndSlerpCamera.prototype.update=function(t){this.finished||this.manualMovement||(this.time+=t,this.time>=this.duration&&(this.loop?this.time-=this.duration:this.time=this.duration),this.setPathProgress(pc.math.clamp(this.time/this.duration,0,1)))},LerpAndSlerpCamera.prototype.setPathProgress=function(t){let e=t;e=this.useEasing?pc[this.easing](t):this.tweenCurve.value(t),!this.finished&&e>=1&&(this.finished=!0,this.app.fire(EventTypes.CAMERA_TRANSITION_FINISHED,this.entity.name));var i=this.entity.getRotation(),n=this.entity.getPosition();i.slerp(this.pointA.getRotation(),this.pointB.getRotation(),e),n.lerp(this.pointA.getPosition(),this.pointB.getPosition(),e),this.entity.setRotation(i),this.entity.setPosition(n),!this.loop&&t>=1&&!this.finished&&(this.finished=!0,this.fireEventOnComplete&&this.app.fire(this.fireEventOnComplete))};var CameraController=pc.createScript("cameraController");CameraController.attributes.add("initialCamera",{type:"entity"}),CameraController.getInstance=function(){return CameraController._instance||console.error("CameraController is not initialized yet"),CameraController._instance},CameraController.prototype.initialize=function(){CameraController._app=this.app,CameraController._instance||(CameraController._instance=this),this.camerasList=this.entity.findComponents("camera").map((e=>e.entity)),this.activeCamera=void 0,this.activeCameraName=void 0},CameraController.prototype.postInitialize=function(){this.initialCamera&&CameraController.getInstance().changeCamera(this.initialCamera.name)},CameraController.prototype.changeCamera=function(e,t=!1){return new Promise(((a,r)=>{const n=this.getActiveCamera(),i=this.getCameraByName(e);i?(this.activeCameraName=e,this.activeCamera=i,this.camerasList.forEach((e=>e.enabled=!1)),t&&(this.activeCamera.setPosition(n.getPosition()),this.activeCamera.setRotation(n.getRotation())),i.enabled=!0,i.startTransition?i.startTransition().then((()=>{a(i)})):a(i)):(console.warn(`Camera ${e} not exists!`),a(null))}))},CameraController.prototype.getActiveCamera=function(){return this.activeCamera},CameraController.prototype.getCameraByName=function(e){return this.camerasList.find((t=>t.name===e))},CameraController.prototype.getActiveCameraName=function(){return this.activeCamera.name},CameraController.prototype._switchToNextCamera=function(){this._testCameraIndex=((this._testCameraIndex||0)+1)%this.entity.children.length;const e=this.entity.children[this._testCameraIndex];e.camera&&CameraController.getInstance().changeCamera(e.name)},CameraController.prototype.update=function(e){GameConfig.getAttribute("debug","hotkeys")&&this.app.keyboard.wasPressed(pc.KEY_C)&&this._switchToNextCamera(),GameConfig.getAttribute("debug","overlay")&&(HierarchyManager.getInstance().getByPath("UIContainer/Debug/ActiveCameraText").element.text=this.activeCameraName)};var ScaleManager=pc.createScript("scaleManager");ScaleManager.attributes.add("minPortraitScreenRatio",{type:"number",default:.5625}),ScaleManager.attributes.add("landscapeBlend",{type:"number",default:.75}),ScaleManager.attributes.add("portraitBlend",{type:"number",default:0}),ScaleManager.getInstance=function(){return ScaleManager._instance||console.error("ScaleManager is not initialized yet"),ScaleManager._instance},ScaleManager.prototype.initialize=function(){ScaleManager._app=this.app,ScaleManager._instance||(ScaleManager._instance=this),this.app.graphicsDevice.on("resizecanvas",this.onCanvasResized,this),this.on("attr:landscapeBlend",this.refresh,this),this.on("attr:portraitBlend",this.refresh,this),this.on("attr:mainLight",this.refresh,this),this.onCanvasResized(this.app.graphicsDevice.canvas.width,this.app.graphicsDevice.canvas.height)},ScaleManager.prototype.update=function(a){},ScaleManager.prototype.refresh=function(){this.onCanvasResized(this.app.graphicsDevice.canvas.width,this.app.graphicsDevice.canvas.height)},ScaleManager.prototype.onCanvasResized=function(a,e){const t=this.isLandscape(),i=t?this.landscapeBlend:this.portraitBlend,fireResizedEvent=()=>{this.app.fire(EventTypes.Screen.RESIZED,a,e,t),this.app.fire(EventTypes.Screen.SET_SCALE_BLEND,i)};setTimeout((()=>fireResizedEvent()),0),pc.platform.ios&&setTimeout((()=>fireResizedEvent()),500)},ScaleManager.prototype.isLandscape=function(){return this.app.graphicsDevice.canvas.width/this.app.graphicsDevice.canvas.height>=this.minPortraitScreenRatio},ScaleManager.prototype.isPortrait=function(){return!this.isLandscape()},ScaleManager.prototype.getWidth=function(){return this.app.graphicsDevice.canvas.width*this.app.graphicsDevice.maxPixelRatio},ScaleManager.prototype.getHeight=function(){return this.app.graphicsDevice.canvas.height*this.app.graphicsDevice.maxPixelRatio};var PerformanceMonitor=pc.createScript("performanceMonitor");PerformanceMonitor.attributes.add("autoAdjustQuality",{type:"boolean",default:!0}),PerformanceMonitor.attributes.add("autoShadows",{title:"Auto shadows",type:"boolean",deafult:!1}),PerformanceMonitor.attributes.add("shadowLights",{title:"Shadow lights",type:"entity",array:!0}),PerformanceMonitor.attributes.add("debugOutput",{type:"boolean",default:!1}),PerformanceMonitor.attributes.add("maxDevicePixelRatio",{type:"number",default:3}),PerformanceMonitor.attributes.add("minDevicePixelRatio",{type:"number",default:1}),PerformanceMonitor.attributes.add("pixelRatioStep",{type:"number",default:.25,min:0,max:1}),PerformanceMonitor.attributes.add("targetFPS",{type:"number",default:60}),PerformanceMonitor.attributes.add("acceptableFPS",{type:"number",default:45}),PerformanceMonitor.attributes.add("minAcceptableFPS",{type:"number",default:30}),PerformanceMonitor.attributes.add("fpsCheckInterval",{type:"number",default:1.5}),PerformanceMonitor.attributes.add("sampleFrames",{type:"number",default:100}),PerformanceMonitor.attributes.add("confidenceInterval",{type:"number",default:.8,min:.4,max:1}),PerformanceMonitor.prototype.initialize=function(){this._shadowsTurnOffCounter=0,this.maxSupportedPixelRatio=window.devicePixelRatio||1,this.debugText=HierarchyManager.getInstance().getByPath("UIContainer/Debug/PerformanceMonitorText"),this.on("attr:debugOutput",this._switchDebugTextVisibility,this),this._switchDebugTextVisibility(),pc.platform.desktop&&this.app.graphicsDevice.maxPixelRatio,this.setPixelRatio(this.getDeviceOptimalDPR()),this.startPerformanceMonitoring(2e3)},PerformanceMonitor.prototype.update=function(t){document.hidden||this.updatePerformanceMonitor(t)},PerformanceMonitor.prototype.swap=function(t){this.initialize()},PerformanceMonitor.prototype.updateShadowsSettings=function(t,e=!1){this.shadowLights.length>0&&(this.autoShadows||e)&&this.shadowLights.forEach((e=>{if(t){if(this._shadowsTurnOffCounter>1)return}else this._shadowsTurnOffCounter+=1;e.enabled&&e.light.castShadows!==t&&(e.light.castShadows=t)}))},PerformanceMonitor.prototype.startPerformanceMonitoring=function(t){this.app.root.delayedCall(t,(()=>{this.performanceMonitoringStarted=!0,this.performanceMonitoringCounter=0,this.elapsedTime=0,this.frameTimes=[],this.lastFPSMeasurements=[]}))},PerformanceMonitor.prototype.updatePerformanceMonitor=function(t){if(this.performanceMonitoringStarted){this.performanceMonitoringCounter+=1,this.elapsedTime+=t;const e=t;this.autoAdjustQuality&&(this.frameTimes.push(e),(this.frameTimes.length>=this.sampleFrames||this.elapsedTime>=this.fpsCheckInterval)&&(this.elapsedTime=0,this.calculateAverageFPS()))}},PerformanceMonitor.prototype.calculateAverageFPS=function(){if(this.frameTimes.length<12)return;const t=this.frameTimes.slice().sort(((t,e)=>t-e)),e=Math.floor(t.length*(1-this.confidenceInterval)/2),i=Math.floor(t.length*(.5+this.confidenceInterval/2)),a=t.slice(e,i),o=a.reduce(((t,e)=>t+e),0),r=a.length/o;for(this.lastFPSMeasurements.push(r);this.lastFPSMeasurements.length>20;)this.lastFPSMeasurements.shift();this.adjustRendererScale(r),this.frameTimes.splice(0,this.frameTimes.length)},PerformanceMonitor.prototype.adjustRendererScale=function(t){t<this.minAcceptableFPS?this.decreaseQuality():t<=this.acceptableFPS?this.setMediumQuality():t>.95*this.targetFPS&&this.increaseQuality(),this.calculateShadowSettings(),this.debugOutput&&this.debugText.enabled&&(this.debugText.element.text=`${t.toFixed(1)} / ${this.app.graphicsDevice.maxPixelRatio.toFixed(3)} of ${this.maxDevicePixelRatio}, frames ${this.frameTimes.length}, fps-samples ${this.lastFPSMeasurements.length}`)},PerformanceMonitor.prototype.calculateShadowSettings=function(){const t=this.app.graphicsDevice.maxPixelRatio;this.lastFPSMeasurements.length>3&&this.lastFPSMeasurements.slice(this.lastFPSMeasurements.length-3).every((t=>t<this.minAcceptableFPS))?this.updateShadowsSettings(!1):t>=this.getDeviceOptimalDPR()&&this.lastFPSMeasurements.length>3&&this.lastFPSMeasurements.slice(this.lastFPSMeasurements.length-3).every((t=>t>=this.acceptableFPS))&&this.updateShadowsSettings(!0)},PerformanceMonitor.prototype.decreaseQuality=function(){const t=pc.math.clamp(this.app.graphicsDevice.maxPixelRatio-this.pixelRatioStep,this.getMinDPR(),this.getMaxDPR());this.setPixelRatio(t)},PerformanceMonitor.prototype.increaseQuality=function(){const t=pc.math.clamp(this.app.graphicsDevice.maxPixelRatio+this.pixelRatioStep,this.getMinDPR(),this.getMaxDPR());this.setPixelRatio(t)},PerformanceMonitor.prototype.setMediumQuality=function(){this.setPixelRatio(this.getDeviceOptimalDPR())},PerformanceMonitor.prototype.setPixelRatio=function(t){t!==this.app.graphicsDevice.maxPixelRatio&&(this.app.graphicsDevice.maxPixelRatio=t)},PerformanceMonitor.prototype.getDeviceOptimalDPR=function(){const t=this.getMinDPR(),e=this.getMaxDPR();return pc.math.clamp(t+(e-t)/2,t,e)},PerformanceMonitor.prototype.getMinDPR=function(){return Math.min(window.devicePixelRatio||1,this.minDevicePixelRatio)},PerformanceMonitor.prototype.getMaxDPR=function(){return Math.min(this.maxSupportedPixelRatio,this.maxDevicePixelRatio)},PerformanceMonitor.prototype._switchDebugTextVisibility=function(){this.debugText&&(this.debugText.enabled=this.debugOutput)};var BasicButton=pc.createScript("basicButton");BasicButton.attributes.add("applyScalingTween",{title:"Apply scaling tween",type:"boolean",default:!0}),BasicButton.attributes.add("defaultScale",{title:"Default scale",type:"number",default:1,min:.5,max:1.5}),BasicButton.attributes.add("hoverScale",{title:"Hover scale",type:"number",default:1.03,min:.5,max:1.5}),BasicButton.attributes.add("pressedScale",{title:"Pressed scale",type:"number",default:.97,min:.5,max:1.5}),BasicButton.attributes.add("upScaleDuration",{title:"Tween duration",type:"number",default:.085,min:.005,max:1}),BasicButton.attributes.add("clickSound",{title:"Play sound",type:"boolean",default:!0}),BasicButton.attributes.add("soundOnRelease",{title:"Sound on release",type:"boolean",default:!0}),BasicButton.attributes.add("allowClickThrough",{title:"Click through",type:"boolean",default:!1}),BasicButton.attributes.add("preventDoubleClick",{title:"Prevent rapid double click",type:"boolean",default:!0}),BasicButton.attributes.add("doubleClickMinCooldown",{title:"Double click min cooldown",type:"number",default:30}),BasicButton.prototype.initialize=function(){this.hovered=!1,this.lastClickTimestamp=0,this._addEventListeners(this.entity),this.available=!0,this.entity.setAvailable=this._setAvailable.bind(this)},BasicButton.prototype._addEventListeners=function(t){this.app.touch&&(t.element.on("touchstart",this.onPress,this),t.element.on("touchend",this.onRelease,this),t.element.on("touchleave",this.onLeave,this)),this.app.mouse&&(t.element.on("mouseenter",this.onEnter,this),t.element.on("mousedown",this.onPress,this),t.element.on("mouseup",this.onRelease,this),t.element.on("mouseleave",this.onLeave,this))},BasicButton.prototype._setAvailable=function(t){this.available=t,this.entity.element.useInput=this.available},BasicButton.prototype.onEnter=function(t){this.hovered=!0,this.applyScalingTween&&t.element.entity.tween(t.element.entity.getLocalScale()).to(new pc.Vec3(this.defaultScale*this.hoverScale,this.defaultScale*this.hoverScale,this.defaultScale*this.hoverScale),this.upScaleDuration,pc.Linear).start(),document.body.style.cursor="pointer"},BasicButton.prototype.onLeave=function(t){this.hovered=!1,this.applyScalingTween&&t.element.entity.tween(t.element.entity.getLocalScale()).to(new pc.Vec3(this.defaultScale,this.defaultScale,this.defaultScale),this.upScaleDuration,pc.Linear).start(),document.body.style.cursor="default"},BasicButton.prototype.onPress=function(t){this.hovered=!0,this.allowClickThrough||t.stopPropagation(),this.clickSound&&!this.soundOnRelease&&this.app.fire(EventTypes.PLAY_SFX,"click"),this.wasPressed=!0,this.applyScalingTween&&t.element.entity.tween(t.element.entity.getLocalScale()).to(new pc.Vec3(this.defaultScale*this.pressedScale,this.defaultScale*this.pressedScale,this.defaultScale*this.pressedScale),.5*this.upScaleDuration,pc.SineOut).start()},BasicButton.prototype.onRelease=function(t){this.applyScalingTween&&(this.hovered?t.element.entity.tween(t.element.entity.getLocalScale()).to(new pc.Vec3(this.defaultScale*this.hoverScale,this.defaultScale*this.hoverScale,this.defaultScale*this.hoverScale),.5*this.upScaleDuration,pc.Linear).start():t.element.entity.tween(t.element.entity.getLocalScale()).to(new pc.Vec3(this.defaultScale,this.defaultScale,this.defaultScale),.5*this.upScaleDuration,pc.Linear).start());const e=(new Date).getTime()-this.lastClickTimestamp;this.hovered&&this.wasPressed&&(!this.preventDoubleClick||e>=this.doubleClickMinCooldown)&&this.triggerClick(),this.wasPressed=!1},BasicButton.prototype.triggerClick=function(){this.entity.fire(EventTypes.BUTTON_PRESSED),this.clickSound&&this.soundOnRelease&&this.app.fire(EventTypes.PLAY_SFX,"click"),VibrationManager.getInstance().hapticSuccess(),this.lastClickTimestamp=(new Date).getTime()},BasicButton.assignSimpleAction=function(t,e,i){this.triggerEvent=this.triggerEvent||"down",pc.app.touch&&t.element.on("down"===this.triggerEvent?"touchstart":"touchend",e,i),pc.app.mouse&&t.element.on("down"===this.triggerEvent?"mousedown":"mouseup",e,i)},BasicButton.assignAction=BasicButton.assignTapAction=function(t,e,i){pc.app.touch&&(t.element.on("touchstart",(e=>{t.inputDownParams={x:e.touch.clientX,y:e.touch.clientY}})),t.element.on("touchend",(n=>{t.inputDownParams&&Utils.distanceBetween(n.touch.clientX,n.touch.clientY,t.inputDownParams.x,t.inputDownParams.y)<10&&e.call(i,n),t.inputDownParams=null}))),pc.app.mouse&&(t.element.on("mousedown",(e=>{t.inputDownParams={x:e.x,y:e.y}})),t.element.on("mouseup",(n=>{t.inputDownParams&&Utils.distanceBetween(n.x,n.y,t.inputDownParams.x,t.inputDownParams.y)<10&&e.call(i,n),t.inputDownParams=null})))};var ScreenBlocker=pc.createScript("screenBlocker");ScreenBlocker.attributes.add("windowOpacity",{type:"number",default:1}),ScreenBlocker.prototype.initialize=function(){this.app.on(EventTypes.SHOW_TRANSITION_SCREEN,this.showTransitionScreen,this),this.app.on(EventTypes.HIDE_TRANSITION_SCREEN,this.hideTransitionScreen,this),this.initialColor=this.entity.element.color.clone()},ScreenBlocker.prototype.postInitialize=function(){this.entity.enabled=!1},ScreenBlocker.prototype.update=function(t){},ScreenBlocker.prototype.swap=function(t){},ScreenBlocker.prototype.showTransitionScreen=function(t=.3,e=null,n=null){this.resetActiveTween(),this.entity.enabled=!0,this.entity.element.color=(new pc.Color).fromString(n||this.initialColor.toString()),t>0?(this.entity.element.opacity=0,this.transitionTween=this.entity.tween(this.entity.element).to({opacity:this.windowOpacity},t,pc.Linear).onComplete((()=>{e&&e()})).start()):(this.entity.element.opacity=this.windowOpacity,e&&e())},ScreenBlocker.prototype.hideTransitionScreen=function(t=.25,e=null){this.resetActiveTween(),this.entity.element.opacity=1,this.transitionTween=this.entity.tween(this.entity.element).to({opacity:0},t,pc.SineOut).onComplete((()=>{this.entity.enabled=!1,e&&e()})).start()},ScreenBlocker.prototype.resetActiveTween=function(){this.transitionTween&&this.transitionTween.playing&&this.transitionTween.stop(),this.transitionTween=null};var RotateLocal=pc.createScript("rotateLocal");RotateLocal.attributes.add("angularSpeed",{type:"vec3",default:[0,180,0]}),RotateLocal.prototype.initialize=function(){},RotateLocal.prototype.update=function(t){this.entity.rotateLocal(this.angularSpeed.x*t,this.angularSpeed.y*t,this.angularSpeed.z*t)};var UiElementAnimator=pc.createScript("uiElementAnimator");UiElementAnimator.EASINGS=[{Linear:"Linear"},{QuadraticIn:"QuadraticIn"},{QuadraticOut:"QuadraticOut"},{QuadraticInOut:"QuadraticInOut"},{CubicIn:"CubicIn"},{CubicOut:"CubicOut"},{CubicInOut:"CubicInOut"},{QuarticIn:"QuarticIn"},{QuarticOut:"QuarticOut"},{QuarticInOut:"QuarticInOut"},{QuinticIn:"QuinticIn"},{QuinticOut:"QuinticOut"},{QuinticInOut:"QuinticInOut"},{SineIn:"SineIn"},{SineOut:"SineOut"},{SineInOut:"SineInOut"},{ExponentialIn:"ExponentialIn"},{ExponentialOut:"ExponentialOut"},{ExponentialInOut:"ExponentialInOut"},{CircularIn:"CircularIn"},{CircularOut:"CircularOut"},{CircularInOut:"CircularInOut"},{BackIn:"BackIn"},{BackOut:"BackOut"},{BackInOut:"BackInOut"},{BounceIn:"BounceIn"},{BounceOut:"BounceOut"},{BounceInOut:"BounceInOut"},{ElasticIn:"ElasticIn"},{ElasticOut:"ElasticOut"},{ElasticInOut:"ElasticInOut"}],UiElementAnimator.attributes.add("appearManually",{type:"boolean",default:!1}),UiElementAnimator.attributes.add("stopAllTweensOnStart",{type:"boolean",default:!0}),UiElementAnimator.attributes.add("disabledUntilTweenStarts",{type:"boolean",default:!1}),UiElementAnimator.attributes.add("disableInputWhileTweening",{type:"boolean",default:!0}),UiElementAnimator.attributes.add("delayDependsOnChildIndex",{type:"boolean",default:!1}),UiElementAnimator.attributes.add("resetTransformOnStart",{type:"boolean",default:!0}),UiElementAnimator.attributes.add("commonAppearDelay",{type:"number",default:0}),UiElementAnimator.attributes.add("commonDisappearDelay",{type:"number",default:0}),UiElementAnimator.attributes.add("autoDisappearAfter",{type:"number",default:0}),UiElementAnimator.attributes.add("appearOpacityTween",{type:"json",schema:[{name:"enabled",type:"boolean",default:!1},{name:"applyToChildrenRecursive",type:"boolean",default:!0},{name:"startOpacity",type:"number",default:0},{name:"targetOpacity",type:"number",default:1},{name:"duration",type:"number",default:.25},{name:"delay",type:"number",default:0},{name:"easing",type:"string",default:"Linear",enum:UiElementAnimator.EASINGS}]}),UiElementAnimator.attributes.add("appearScaleTween",{type:"json",schema:[{name:"enabled",type:"boolean",default:!1},{name:"startScale",type:"vec3",default:[0,0,0]},{name:"targetScale",type:"vec3",default:[1,1,1]},{name:"duration",type:"number",default:.25},{name:"delay",type:"number",default:0},{name:"easing",type:"string",default:"Linear",enum:UiElementAnimator.EASINGS}]}),UiElementAnimator.attributes.add("appearPositionTween",{type:"json",schema:[{name:"enabled",type:"boolean",default:!1},{name:"startDeltaPosition",type:"vec3",default:[0,-50,0]},{name:"toCustomPosition",type:"boolean",default:!1},{name:"customTargetPosition",type:"vec3",default:[0,0,0]},{name:"duration",type:"number",default:.25},{name:"delay",type:"number",default:0},{name:"easing",type:"string",default:"Linear",enum:UiElementAnimator.EASINGS}]}),UiElementAnimator.attributes.add("disappearOpacityTween",{type:"json",schema:[{name:"enabled",type:"boolean",default:!1},{name:"applyToChildrenRecursive",type:"boolean",default:!0},{name:"targetOpacity",type:"number",default:0},{name:"duration",type:"number",default:.25},{name:"delay",type:"number",default:0},{name:"easing",type:"string",default:"Linear",enum:UiElementAnimator.EASINGS}]}),UiElementAnimator.attributes.add("disappearScaleTween",{type:"json",schema:[{name:"enabled",type:"boolean",default:!1},{name:"targetScale",type:"vec3",default:[0,0,0]},{name:"duration",type:"number",default:.25},{name:"delay",type:"number",default:0},{name:"easing",type:"string",default:"Linear",enum:UiElementAnimator.EASINGS}]}),UiElementAnimator.attributes.add("disappearPositionTween",{type:"json",schema:[{name:"enabled",type:"boolean",default:!1},{name:"endDeltaPosition",type:"vec3",default:[0,-50,0]},{name:"duration",type:"number",default:.25},{name:"delay",type:"number",default:0},{name:"easing",type:"string",default:"Linear",enum:UiElementAnimator.EASINGS}]}),UiElementAnimator.prototype.initialize=function(){this.entity._isAnimatedUIElement=!0,this.initialScale=this.entity.getLocalScale().clone(),this.initialPosition=this.entity.getLocalPosition().clone(),this.initialOpacity=this.entity.element.opacity,this.initialInputStatus=this.entity.element.useInput,this.appearManually?this.entity.on(EventTypes.UI_ELEMENT.APPEAR_MANUALLY,this.doAppearManually,this):this.entity.on(EventTypes.UI_ELEMENT.APPEAR,this.doAppear,this),this.entity.on(EventTypes.UI_ELEMENT.DISAPPEAR,this.doDisappear,this)},UiElementAnimator.prototype.doAppearManually=function(){this.doAppear(),this.appearManually&&this.entity.children.forEach((t=>t.fire(EventTypes.UI_ELEMENT.APPEAR_MANUALLY)))},UiElementAnimator.prototype.doAppear=function(){this.stopAllTweensOnStart&&this.app.stopAllTweens(this.entity),this.resetTransformOnStart&&(this.entity.setLocalScale(this.initialScale),this.entity.setLocalPosition(this.initialPosition),this.entity.element.opacity=this.initialOpacity,this.entity.element.useInput=this.initialInputStatus),this._processAppearTweens().then((()=>{this.entity.fire(EventTypes.UI_ELEMENT.APPEARED),this.autoDisappearAfter>0&&this.entity.delayedCall(1e3*this.autoDisappearAfter,(()=>{this.doDisappear()}))}))},UiElementAnimator.prototype.doDisappear=function(){this.stopAllTweensOnStart&&this.app.stopAllTweens(this.entity),this._processDisappearTweens().then((()=>{this.entity.fire(EventTypes.UI_ELEMENT.DISAPPEARED)}))},UiElementAnimator.prototype.findChildrenWithOpacityValue=function(t,e){e=e||[t];for(let i=0;i<t.children.length;i++){const n=t.children[i];n.element&&void 0!==n.element.opacity&&e.push(n),this.findChildrenWithOpacityValue(n,e)}return e},UiElementAnimator.prototype._processAppearTweens=async function(){const t=[];this.disableInputWhileTweening&&(this.entity.element.useInput=!1),this.disabledUntilTweenStarts&&(this.entity.enabled=!1);const e=this.entity.parent&&this.entity.parent.script&&this.entity.parent.script.uiElementAnimator&&this.entity.parent.script.uiElementAnimator.commonAppearDelay||0,i=this.commonAppearDelay+e;if(this.appearOpacityTween.enabled){const e=this.appearOpacityTween.applyToChildrenRecursive?this.findChildrenWithOpacityValue(this.entity):[this.entity];t.push(...e.map((t=>new Promise(((e,n)=>{const a=this.appearOpacityTween;t.element.opacity=a.startOpacity,t.tween(t.element).to({opacity:a.targetOpacity},a.duration,pc[a.easing]).delay(i+a.delay*(this.delayDependsOnChildIndex?this.entity.parent.children.indexOf(this.entity)+1:1)).onComplete((()=>e())).onStart((()=>{this.disabledUntilTweenStarts&&(this.entity.enabled=!0)})).start()})))))}return this.appearScaleTween.enabled&&t.push(new Promise(((t,e)=>{const n=this.appearScaleTween;this.entity.setLocalScale(n.startScale),this.entity.tween(this.entity.getLocalScale()).to(n.targetScale,n.duration,pc[n.easing]).delay(i+n.delay*(this.delayDependsOnChildIndex?this.entity.parent.children.indexOf(this.entity)+1:1)).onComplete((()=>t())).onStart((()=>{this.disabledUntilTweenStarts&&(this.entity.enabled=!0)})).start()}))),this.appearPositionTween.enabled&&t.push(new Promise(((t,e)=>{const n=this.appearPositionTween;this.entity.setLocalPosition(this.initialPosition.x+n.startDeltaPosition.x,this.initialPosition.y+n.startDeltaPosition.y,this.initialPosition.z+n.startDeltaPosition.z),this.entity.tween(this.entity.getLocalPosition()).to(n.toCustomPosition?n.customTargetPosition:this.initialPosition,n.duration,pc[n.easing]).delay(i+n.delay*(this.delayDependsOnChildIndex?this.entity.parent.children.indexOf(this.entity)+1:1)).onComplete((()=>t())).onStart((()=>{this.disabledUntilTweenStarts&&(this.entity.enabled=!0)})).start()}))),await Promise.all(t),this.entity.element&&(this.entity.element.useInput=this.initialInputStatus),!0},UiElementAnimator.prototype._processDisappearTweens=async function(){const t=[];this.disableInputWhileTweening&&(this.entity.element.useInput=!1);const e=this.entity.parent&&this.entity.parent.script&&this.entity.parent.script.uiElementAnimator?this.entity.parent.script.uiElementAnimator.commonDisappearDelay:0,i=this.commonDisappearDelay+e;if(this.disappearOpacityTween.enabled){const e=this.disappearOpacityTween.applyToChildrenRecursive?this.findChildrenWithOpacityValue(this.entity):[this.entity];t.push(...e.map((t=>new Promise(((e,n)=>{const a=this.disappearOpacityTween;t.tween(t.element).to({opacity:a.targetOpacity},a.duration,pc[a.easing]).delay(i+a.delay*(this.delayDependsOnChildIndex?this.entity.parent.children.indexOf(this.entity)+1:1)).onComplete((()=>e())).start()})))))}return this.disappearScaleTween.enabled&&t.push(new Promise(((t,e)=>{const n=this.disappearScaleTween;this.entity.tween(this.entity.getLocalScale()).to(n.targetScale,n.duration,pc[n.easing]).delay(i+n.delay*(this.delayDependsOnChildIndex?this.entity.parent.children.indexOf(this.entity)+1:1)).onComplete((()=>t())).start()}))),this.disappearPositionTween.enabled&&t.push(new Promise(((t,e)=>{const n=this.disappearPositionTween;this.entity.tween(this.entity.getLocalPosition()).to(this.initialPosition.clone().add(n.endDeltaPosition),n.duration,pc[n.easing]).delay(i+n.delay*(this.delayDependsOnChildIndex?this.entity.parent.children.indexOf(this.entity)+1:1)).onComplete((()=>t())).start()}))),await Promise.all(t),this.entity.element.useInput=this.initialInputStatus,!0},UiElementAnimator.prototype.update=function(t){};var DebugOverlay=pc.createScript("debugOverlay");DebugOverlay.prototype.initialize=function(){this.changeCameraButton=this.entity.findByName("ButtonChangeCamera"),this.nextScreenButton=this.entity.findByName("ButtonNextScreen"),this.changeCameraButton&&BasicButton.assignAction(this.changeCameraButton,this.onChangeCameraClicked,this),this.nextScreenButton&&BasicButton.assignAction(this.nextScreenButton,this.onNextScreenClicked,this)},DebugOverlay.prototype.onChangeCameraClicked=function(){CameraController.getInstance()._switchToNextCamera()},DebugOverlay.prototype.onNextScreenClicked=function(){const e=[Constants.Screens.START,Constants.Screens.RESULTS];this._lastScreenIndex||(this._lastScreenIndex=0),this._lastScreenIndex=(this._lastScreenIndex+1)%e.length;const t=e[this._lastScreenIndex];UIController.getInstance().showWindow(t)},DebugOverlay.prototype.update=function(e){this.entity.enabled=GameConfig.getAttribute("debug","overlay")};var ScalePulseTween=pc.createScript("scalePulseTween");ScalePulseTween.attributes.add("targetScale",{type:"vec3",default:[1.1,.925,1]}),ScalePulseTween.attributes.add("duration",{type:"number",default:.9}),ScalePulseTween.attributes.add("yoyo",{type:"boolean",default:!0}),ScalePulseTween.attributes.add("loop",{type:"boolean",default:!0}),ScalePulseTween.attributes.add("startOnlyAfterElementAppeared",{type:"boolean",default:!1}),ScalePulseTween.attributes.add("easing",{type:"string",enum:[{Linear:"Linear"},{QuadraticIn:"QuadraticIn"},{QuadraticOut:"QuadraticOut"},{QuadraticInOut:"QuadraticInOut"},{CubicIn:"CubicIn"},{CubicOut:"CubicOut"},{CubicInOut:"CubicInOut"},{QuarticIn:"QuarticIn"},{QuarticOut:"QuarticOut"},{QuarticInOut:"QuarticInOut"},{QuinticIn:"QuinticIn"},{QuinticOut:"QuinticOut"},{QuinticInOut:"QuinticInOut"},{SineIn:"SineIn"},{SineOut:"SineOut"},{SineInOut:"SineInOut"},{ExponentialIn:"ExponentialIn"},{ExponentialOut:"ExponentialOut"},{ExponentialInOut:"ExponentialInOut"},{CircularIn:"CircularIn"},{CircularOut:"CircularOut"},{CircularInOut:"CircularInOut"},{BackIn:"BackIn"},{BackOut:"BackOut"},{BackInOut:"BackInOut"},{BounceIn:"BounceIn"},{BounceOut:"BounceOut"},{BounceInOut:"BounceInOut"},{ElasticIn:"ElasticIn"},{ElasticOut:"ElasticOut"},{ElasticInOut:"ElasticInOut"}],default:"Linear"}),ScalePulseTween.prototype.initialize=function(){this.initialScale=this.entity.getLocalScale().clone(),this.startOnlyAfterElementAppeared?this.entity.on(EventTypes.UI_ELEMENT.APPEARED,(()=>this._restartTween())):this._restartTween(),this.on("attr",this._restartTween,this)},ScalePulseTween.prototype.update=function(t){},ScalePulseTween.prototype._restartTween=function(){this.entity.setLocalScale(this.initialScale),this.entity.tween(this.entity.getLocalScale()).to(this.targetScale,this.duration,pc[this.easing]).yoyo(this.yoyo).loop(this.loop).start()};var HoldButton=pc.createScript("holdButton");HoldButton.attributes.add("applyScalingTween",{title:"Apply scaling tween",type:"boolean",default:!0}),HoldButton.attributes.add("defaultScale",{title:"Default scale",type:"number",default:1,min:.5,max:1.5}),HoldButton.attributes.add("hoverScale",{title:"Hover scale",type:"number",default:1.03,min:.5,max:1.5}),HoldButton.attributes.add("pressedScale",{title:"Pressed scale",type:"number",default:.97,min:.5,max:1.5}),HoldButton.attributes.add("upScaleDuration",{title:"Tween duration",type:"number",default:.085,min:.005,max:1}),HoldButton.attributes.add("allowClickThrough",{title:"Click through",type:"boolean",default:!1}),HoldButton.prototype.initialize=function(){this.hovered=!1,this.pressed=!1;const e=this;Object.defineProperty(this.entity,"isPressed",{get:()=>e.pressed}),pc.platform.mobile&&this.app.touch?(this.entity.element.on("touchstart",this.onPress,this),this.entity.element.on("touchend",this.onRelease,this)):(this.entity.element.on("mouseenter",this.onEnter,this),this.entity.element.on("mousedown",this.onPress,this),this.entity.element.on("mouseup",this.onRelease,this),this.entity.element.on("mouseleave",this.onLeave,this))},HoldButton.prototype.onEnter=function(e){this.hovered=!0,this.applyScalingTween&&e.element.entity.tween(e.element.entity.getLocalScale()).to(new pc.Vec3(this.defaultScale*this.hoverScale,this.defaultScale*this.hoverScale,this.defaultScale*this.hoverScale),this.upScaleDuration,pc.Linear).start(),document.body.style.cursor="pointer"},HoldButton.prototype.onLeave=function(e){this.hovered=!1,this.applyScalingTween&&e.element.entity.tween(e.element.entity.getLocalScale()).to(new pc.Vec3(this.defaultScale,this.defaultScale,this.defaultScale),this.upScaleDuration,pc.Linear).start(),document.body.style.cursor="default"},HoldButton.prototype.onPress=function(e){this.allowClickThrough||e.stopPropagation(),this.pressed=!0,this.entity.element.opacity=.9,this.applyScalingTween&&e.element.entity.tween(e.element.entity.getLocalScale()).to(new pc.Vec3(this.defaultScale*this.pressedScale,this.defaultScale*this.pressedScale,this.defaultScale*this.pressedScale),.5*this.upScaleDuration,pc.SineOut).start()},HoldButton.prototype.onRelease=function(e){this.applyScalingTween&&(this.hovered?e.element.entity.tween(e.element.entity.getLocalScale()).to(new pc.Vec3(this.defaultScale*this.hoverScale,this.defaultScale*this.hoverScale,this.defaultScale*this.hoverScale),.5*this.upScaleDuration,pc.Linear).start():e.element.entity.tween(e.element.entity.getLocalScale()).to(new pc.Vec3(this.defaultScale,this.defaultScale,this.defaultScale),.5*this.upScaleDuration,pc.Linear).start()),this.entity.element.opacity=.4,this.pressed=!1};var LookAtactiveCamera=pc.createScript("lookAtactiveCamera");LookAtactiveCamera.attributes.add("extraAngle",{type:"vec3",default:[0,0,0]}),LookAtactiveCamera.prototype.initialize=function(){},LookAtactiveCamera.prototype.update=function(t){const e=CameraController.getInstance().getActiveCamera();e&&(this.entity.lookAt(e.getPosition()),this.entity.rotateLocal(this.extraAngle))};class BaseWindow extends pc.ScriptType{initialize(){this._initEntityMethods(),this._initComponents(),this._pointerDown=!1,this._pointerX=0,this._pointerY=0,this.app.on(EventTypes.INPUT_DOWN,this._handleInputDown,this),this.app.on(EventTypes.INPUT_UP,this._handleInputUp,this),this.app.on(EventTypes.TAP_AT,this._handleTapAt,this),this.app.on(EventTypes.SWIPE_LEFT,this._handleSwipeLeft,this),this.app.on(EventTypes.SWIPE_RIGHT,this._handleSwipeRight,this),this.app.on(EventTypes.SWIPE_UP,this._handleSwipeUp,this),this.app.on(EventTypes.SWIPE_DOWN,this._handleSwipeDown,this)}_handleTapAt(n,t,e,i){this.entity.enabled&&this.onTap(e,i)}_handleInputDown(n,t,e,i){this.entity.enabled&&(this._pointerDown=!0,this._pointerX=e,this._pointerY=i,this.onPointerDown(e,i))}_handleInputUp(n,t,e,i){this.entity.enabled&&(this._pointerDown&&(this._pointerDown=!1),this.onPointerUp(e,i))}_handleSwipeLeft(){this.entity.enabled&&this.onSwipeLeft()}_handleSwipeRight(){this.entity.enabled&&this.onSwipeRight()}_handleSwipeUp(){this.entity.enabled&&this.onSwipeUp()}_handleSwipeDown(){this.entity.enabled&&this.onSwipeDown()}onSwipeLeft(){}onSwipeRight(){}onSwipeUp(){}onSwipeDown(){}onTap(n,t){}onPointerDown(n,t){}onPointerUp(n,t){}update(n){}appearElements(){const n=this.entity.find((n=>n._isAnimatedUIElement&&!n._uiElementAppearManually));n.forEach((n=>{n.fire(EventTypes.UI_ELEMENT.APPEAR)}));const t=n.map((n=>new Promise(((t,e)=>{n.once(EventTypes.UI_ELEMENT.APPEARED,(()=>t()))}))));return Promise.all(t)}disappearElements(){const n=this.entity.find((n=>n._isAnimatedUIElement));n.forEach((n=>{n.fire(EventTypes.UI_ELEMENT.DISAPPEAR)}));const t=n.map((n=>new Promise(((t,e)=>{n.once(EventTypes.UI_ELEMENT.DISAPPEARED,(()=>t()))}))));return Promise.all(t)}_initEntityMethods(){const n=this;this.entity.show=function(t){return new Promise(((e,i)=>{this._windowToOpenOnExit=t,this.enabled=!0,n.appearElements().then((()=>{e(),n._onAppeared&&n._onAppeared(),UIController.getInstance().dispatchWindowShown(this.name)})),n._onShow()}))}.bind(this.entity),this.entity.hide=function(t){return new Promise(((e,i)=>{const disableWindow=()=>{if(this.enabled&&n._onHide(),this.enabled=!1,UIController.getInstance().dispatchWindowHidden(this.name),this._windowToOpenOnExit){const n=this._windowToOpenOnExit;this._windowToOpenOnExit=null,UIController.getInstance().showWindow(n)}};t||!this.enabled?(disableWindow(),e(),n._onHidden&&n._onHidden()):n.disappearElements().then((()=>{disableWindow(),e(),n._onHidden&&n._onHidden()}))}))}.bind(this.entity),this.entity.clearPendingWindow=function(){this._windowToOpenOnExit=null}.bind(this.entity)}_initComponents(){}_onShow(){}_onHide(){}}pc.registerScript(BaseWindow,"baseWindow");class CloseableWindow extends BaseWindow{initialize(){super.initialize()}_initComponents(){this.closeButton=this.entity.findByName("CloseButton"),BasicButton.assignAction(this.closeButton,this.onCloseClicked,this)}onCloseClicked(){this.entity.hide()}}pc.registerScript(CloseableWindow,"closeableWindow");var LibraryManager=pc.createScript("libraryManager");LibraryManager.attributes.add("assets",{type:"json",schema:[{name:"key",type:"string",default:""},{name:"asset",type:"asset"}],array:!0}),LibraryManager.getInstance=function(){return LibraryManager._instance||console.error("LibraryManager is not initialized yet"),LibraryManager._instance},LibraryManager.prototype.initialize=function(){LibraryManager._app=this.app,LibraryManager._instance||(LibraryManager._instance=this)},LibraryManager.prototype.isEditorEnvironment=function(){return"launch.playcanvas.com"===window.location.host},LibraryManager.prototype.getAssetURL=function(a){let r=this.assets.find((r=>r.key===a));if(!r||!r.asset)return console.warn("No assets with key "+a),null;if(this.isEditorEnvironment()){return`api/assets/${r.asset.id}/file/${a}`}return r.asset.file.url},LibraryManager.prototype.getAssetURLFromLibrary=function(a){let r=this.app.assets.find(a);if(!r)return console.warn("No assets with key "+a),null;if(this.isEditorEnvironment()){return`api/assets/${r.id}/file/${r.name}`}return r.file.url},LibraryManager.prototype.update=function(a){};var LocalizationManager=pc.createScript("localizationManager");LocalizationManager.attributes.add("autoDetectLanguage",{type:"boolean",default:!0}),LocalizationManager._currentLocale=null,LocalizationManager.getInstance=function(){if(!LocalizationManager._instance)throw new Error("LocalizationManager is not initialized yet");return LocalizationManager._instance},LocalizationManager.prototype.initialize=function(){LocalizationManager._app=this.app,LocalizationManager._instance||(LocalizationManager._instance=this)},LocalizationManager.prototype.postInitialize=function(){this.restartService()},LocalizationManager.prototype.addJSON=function(a){a&&this.app.i18n.addData(a)},LocalizationManager.prototype.restartService=function(){if(this.autoDetectLanguage){const a=new URLSearchParams(window.location.search).get("language");if(a)this._setCurrentLocale(pc.app.i18n.findAvailableLocale(a));else{const a=(window.location.search||"").replace("?","");a&&a.length<7?this._setCurrentLocale(pc.app.i18n.findAvailableLocale(a)):this._setCurrentLocale(pc.app.i18n.findAvailableLocale(LocalizationManager.getClientLanguage()))}}},LocalizationManager.prototype.update=function(a){},LocalizationManager.prototype._setCurrentLocale=function(a){LocalizationManager._currentLocale=a,this.app.i18n.locale=LocalizationManager._currentLocale,this.app.fire("app:changeLocale",this.app.i18n.locale),console.log("Set locale to "+LocalizationManager._currentLocale)},LocalizationManager.prototype.getCurrentLocale=function(){return LocalizationManager._currentLocale},LocalizationManager.prototype.getCountryCode=function(){return this.getCurrentLocale().substr(0,2)},LocalizationManager.prototype.getLocalizedText=function(a,...e){let t=this.app.i18n.getText(a,this.getCurrentLocale());for(let a=0;a<e.length;a++)t=t.replace(`{${a}}`,e[a]);return t},LocalizationManager.prototype.getCharactersList=function(...a){const e=new Set("!\"#$%&'()*+,-0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}~АБВГДЕЄЖЗИІЇЙКЛМНОПРСТУФХЦЧШЩЬЮЯЇабвгдеєжзиіїйклмнопрстуфхцчшщьюяїЁё¿ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÚÛÜÝÞßàáâãäåæçèéêëìíîïðñòóôõö÷øùúûüýþÿ".split(""));return a.forEach((a=>{const t=this.app.i18n.findAvailableLocale(a),n=this.app.assets.find(t,"json");n?(n.resource.data.forEach((a=>{Object.keys(a.messages).forEach((t=>{a.messages[t].split("").forEach((a=>e.add(a)))}))})),console.log("File for "+t+": ",n)):console.warn("No locale file for "+a)})),Array.from(e).sort().join("")},LocalizationManager.getClientLanguage=function(){const a=navigator.language||"en-US";return console.log("Browser language: "+a),a};var CanvasFontHelper=pc.createScript("canvasFontHelper");CanvasFontHelper.attributes.add("fontAssets",{type:"json",array:!0,schema:[{name:"name",type:"string",description:"Name for the font face for the canvas font to reference"},{name:"asset",type:"asset",assetType:"binary",description:"Font asset"}]}),CanvasFontHelper.attributes.add("canvasFonts",{type:"json",array:!0,schema:[{name:"assetName",type:"string",default:"Arial Canvas Font White",description:"If possible, keep this unique to make this easy to find in the assets registry!"},{name:"fontFaces",type:"string",default:"Arial",description:"This has to be written as though it was in a CSS file (https://www.w3schools.com/cssref/pr_font_font-family.asp)"},{name:"textureSize",type:"vec2",default:[2048,2048],description:"The larger the size, the more VRAM is used. More textures are created to fit the glyphs as the canvas font is updated"},{name:"fontSize",type:"number",default:64,description:"The larger the size, the sharper the glyph but the more space it takes up on the texture"},{name:"padding",type:"number",default:0,description:"Glyph padding, try to keep it reasonably small (~1/4 of font size)"},{name:"color",type:"rgb",default:[1,1,1]}]}),CanvasFontHelper.prototype.initialize=function(){var e,t=this,s=this.app;for(e=0;e<this.canvasFonts.length;++e){var a=this.canvasFonts[e];a.asset=new pc.Asset(a.assetName,"font",{}),s.assets.add(a.asset),a.asset.loaded=!1}var n=0,o=[];for(e=0;e<this.fontAssets.length;++e){var r=this.fontAssets[e];new FontFace(r.name,"url("+r.asset.getFileUrl()+")").load().then((e=>{document.fonts.add(e),o.push(e),(n+=1)==t.fontAssets.length&&t._onFontFacesLoaded()})).catch((e=>{console.error(e)}))}this.on("destroy",(function(){var e;for(e=0;e<o.length;++e)document.fonts.delete(o[e]);for(e=0;e<this.canvasFonts.length;++e){var t=this.canvasFonts[e];t.asset.resource.destroy(),s.assets.remove(t.asset)}}),this)},CanvasFontHelper.prototype._onFontFacesLoaded=function(){for(var e=0;e<this.canvasFonts.length;++e){var t=this.canvasFonts[e],s=new pc.CanvasFont(this.app,{color:t.color,fontName:t.fontFaces,fontSize:t.fontSize,width:t.textureSize.x,height:t.textureSize.y,padding:t.padding,getCharScale:function(e){return 9757===e||127752===e?.8:-1}});t.asset.resource=s,s.createTextures(" "),t.asset.loaded=!0,t.asset.fire("load",t.asset)}};const _setTextOriginal=pc.TextElement.prototype._setText;pc.TextElement.prototype._setText=function(){this._entity.fire("bitmaptext:render",...arguments),_setTextOriginal.call(this,...arguments)};var BitmapText=pc.createScript("bitmapText");BitmapText.attributes.add("fontAssetName",{type:"string",default:"CeraPro-Black"}),BitmapText.prototype.initialize=function(){this.entity.__useBitmapFontRenderer__=!0,this.initialString=this.entity.element.key||this.entity.element.text,this.initialKey=this.entity.element.key,this.entity.element&&(this.entity.element.rtlReorder=!0,this.entity.element.unicodeConverter=!0)},BitmapText.prototype.postInitialize=function(){this._canvasFontAsset=this.app.assets.find(this.fontAssetName),null==this._canvasFontAsset?console.warn("Can't find font asset: "+this.fontAssetName+" on "+this.entity.path):this._canvasFontAsset.loaded?this._onCanvasFontAssetLoaded(this._canvasFontAsset):this._canvasFontAsset.ready(this._onCanvasFontAssetLoaded,this)},BitmapText.prototype._onCanvasFontAssetLoaded=function(t){this.entity.element.fontAsset=this._canvasFontAsset,this.entity.on("bitmaptext:render",this._renderText,this),this._updateText(this.entity.element.text)},BitmapText.prototype._updateText=function(t){if(!this._canvasFontAsset)return console.error("Asset not loaded: ",this.entity.path);this._canvasFontAsset.loaded?(this._canvasFontAsset.resource.updateTextures(t),this.entity.element.text=t):this.initialString=t},BitmapText.prototype._renderText=function(t){this._canvasFontAsset.loaded&&(this._lastLocale=this.app.i18n.locale,this._canvasFontAsset.resource.updateTextures(t))},BitmapText.prototype.update=function(t){(this.entity.element.key||this.initialKey)&&this.app.i18n.locale!==this._lastLocale&&this._updateText(this.app.i18n.getText(this.entity.element.key||this.initialKey))};var TemplateManager=pc.createScript("templateManager");TemplateManager.getInstance=function(){return TemplateManager._instance||console.error("TemplateManager is not initialized yet"),TemplateManager._instance},TemplateManager.prototype.initialize=function(){TemplateManager._app=this.app,TemplateManager._instance||(TemplateManager._instance=this),this.templateAssets=new Map},TemplateManager.prototype.instantiate=function(e){const t=this.templateAssets.get(e);if(t)return t.resource.instantiate();{const t=this.app.assets.find(e,"template");if(t)return this.templateAssets.set(e,t),t.resource||console.warn(`No resource in template '${t.name}'`),t.resource.instantiate();console.error('No template "'+e+'" in library!')}},TemplateManager.prototype.update=function(e){};var AssetsLoader=pc.createScript("assetsLoader");AssetsLoader.getInstance=function(){return AssetsLoader._instance||console.error("AssetsLoader is not initialized yet"),AssetsLoader._instance},AssetsLoader.prototype.initialize=function(){AssetsLoader._app=this.app,AssetsLoader._instance||(AssetsLoader._instance=this),this.pendingAssets=[],this.numAssetsLoaded=0,this.totalAssetsInQueue=0},AssetsLoader.prototype.update=function(s){},AssetsLoader.prototype.loadAsset=function(s){return new Promise(((e,t)=>{if(s.loaded)return Promise.resolve(s);s.once("load",(()=>{this.app.fire(EventTypes.ASSETS_LOADER_ASSET_LOADED,s),e(s)})),s.once("error",(()=>{console.warn("failed to load "+s.id+" "+s.name),this.app.fire(EventTypes.ASSETS_LOADER_ASSET_FAILED,s),t("an error occurred during asset "+s.id+" ("+assetName+") loading")})),this.app.assets.load(s)}))},AssetsLoader.prototype.loadAssetByName=function(s,e){const t=this.app.assets.find(s,e);return t?this.loadAsset(t):Pormise.reject(`Asset '${s}' not found in the app library!`)},AssetsLoader.prototype.loadAssets=function(s){return new Promise(((e,t)=>{let o=s.filter((s=>!s.loaded)),a=o.length,n=0;this.app.fire(EventTypes.ASSETS_LOADER_STARTED_LOADING,a);const handleAsset=s=>{-1!==o.indexOf(s)&&(n+=1),this.app.fire(EventTypes.ASSETS_LOADER_PROGRESS,n/a)};this.app.on(EventTypes.ASSETS_LOADER_ASSET_LOADED,handleAsset),this.app.on(EventTypes.ASSETS_LOADER_ASSET_FAILED,handleAsset);const i=o.map((s=>this.loadAsset(s)));Promise.all(i).then((s=>{this.app.fire(EventTypes.ASSETS_LOADER_COMPLETE),e()})).catch((s=>{console.log("All the assets have finished loading, however some failed"),this.app.fire(EventTypes.ASSETS_LOADER_COMPLETE),t(s)})).finally((s=>{this.app.off(EventTypes.ASSETS_LOADER_ASSET_LOADED,handleAsset),this.app.off(EventTypes.ASSETS_LOADER_ASSET_FAILED,handleAsset)}))}))},AssetsLoader.prototype.loadByTag=function(...s){return this.loadAssets(this.app.assets.findByTag(...s))},AssetsLoader.prototype.getAssetsByTag=function(...s){return this.app.assets.findByTag(...s)},AssetsLoader.prototype.loadByTagWithLoadingOverlay=function(s,e=0){return"string"==typeof s&&(s=[s]),new Promise(((t,o)=>{const a=AssetsLoader.getInstance().getAssetsByTag(...s);a.length>0?(LoadingOverlay.show(.15),AssetsLoader.getInstance().loadAssets(a).then((s=>{})).catch((s=>{console.warn("asset loading error",s)})).finally((()=>{Utils.wait(e).then((()=>{LoadingOverlay.hide(.35)})),t()}))):t()}))},AssetsLoader.prototype.loadPendingAssets=function(){return this.loadAssets(this.app.assets.filter((s=>s.loading)))},AssetsLoader.prototype.loadNotLoadedAssets=function(){return this.loadAssets(this.app.assets.filter((s=>!s.loaded)))};var LoadingOverlay=pc.createScript("loadingOverlay");LoadingOverlay.getDefaultBackground=function(){return`url(${LibraryManager.getInstance().getAssetURL("loading_bg_final.jpg")}) no-repeat center`},LoadingOverlay.show=function(e={}){return new Promise(((n,t)=>{const o=void 0!==e.color?e.color:LoadingOverlay.getDefaultBackground(),r=Math.max(.001,void 0!==e.transitionDuration?e.transitionDuration:.2),i=e.text||"",a=document.querySelector("#preloader");if(!a)return;const s=document.querySelector("#preloaderAnimation");if(s){s.style.display="block";const e=document.querySelector("#walking-model");e&&(e.src=LibraryManager.getInstance().getAssetURL("loading_walk_animation.gif"))}const d=document.querySelector("#loading-text");d&&(d.innerHTML=i),a.style.background=o,a.style.backgroundSize="cover",document.documentElement.style.setProperty("--preloader-transition-duration",r+"s"),r>0?a.addEventListener("transitionend",(function onTransitionEnd(){a.removeEventListener("transitionend",onTransitionEnd),n()}),!1):setTimeout((()=>n()),0),a.classList.contains("preloader-hidden")&&a.classList.remove("preloader-hidden"),a.classList.contains("preloader-visible")||a.classList.add("preloader-visible")}))},LoadingOverlay.hide=function(e={}){return new Promise(((n,t)=>{const o=Math.max(.001,void 0!==e.transitionDuration?e.transitionDuration:.2),r=document.querySelector("#preloader");if(!r)return;const i=void 0!==e.color?e.color:LoadingOverlay.getDefaultBackground();r.style.background=i,r.style.backgroundSize="cover",document.documentElement.style.setProperty("--preloader-transition-duration",o+"s");const a=document.querySelector("#preloaderAnimation");function onTransitionEnd(){r.removeEventListener("transitionend",onTransitionEnd),n()}a&&(a.style.display="none"),r.classList.contains("preloader-visible")&&r.classList.remove("preloader-visible"),r.classList.contains("preloader-hidden")||r.classList.add("preloader-hidden"),o>0?setTimeout((()=>r.addEventListener("transitionend",onTransitionEnd,!1)),0):setTimeout((()=>n()),0)}))},LoadingOverlay.transition=async function(e,n,t){return await LoadingOverlay.show(e),t&&t(),await LoadingOverlay.hide(n),Promise.resolve(!0)};var UiParticleSystemFix=pc.createScript("uiParticleSystemFix");UiParticleSystemFix.prototype.initialize=function(){this.app.on(EventTypes.Screen.RESIZED,this.onScreenResized,this),this._originalScale=this.entity.getLocalScale().clone(),this._scaleCorrectionVec=new pc.Vec2(1,1),this.onScreenResized(UIController.getInstance().getScreenWidth(),UIController.getInstance().getScreenHeight())},UiParticleSystemFix.prototype.update=function(e){},UiParticleSystemFix.prototype.onScreenResized=function(e,t,i){const c=UIController.getInstance().getScreenWidth()/UIController.getInstance().getScreenHeight();c>=1?this._scaleCorrectionVec.set(e/t,1):this._scaleCorrectionVec.set(1,1/c),this.entity.setLocalScale(this._scaleCorrectionVec.y,this._scaleCorrectionVec.x,this._originalScale.z)};var PositionTween=pc.createScript("positionTween");PositionTween.attributes.add("deltaPosition",{type:"vec3",default:[0,1,0]}),PositionTween.attributes.add("duration",{type:"number",default:.9}),PositionTween.attributes.add("yoyo",{type:"boolean",default:!0}),PositionTween.attributes.add("loop",{type:"boolean",default:!0}),PositionTween.attributes.add("randomPhase",{type:"boolean",default:!0}),PositionTween.attributes.add("easing",{type:"string",enum:[{Linear:"Linear"},{QuadraticIn:"QuadraticIn"},{QuadraticOut:"QuadraticOut"},{QuadraticInOut:"QuadraticInOut"},{CubicIn:"CubicIn"},{CubicOut:"CubicOut"},{CubicInOut:"CubicInOut"},{QuarticIn:"QuarticIn"},{QuarticOut:"QuarticOut"},{QuarticInOut:"QuarticInOut"},{QuinticIn:"QuinticIn"},{QuinticOut:"QuinticOut"},{QuinticInOut:"QuinticInOut"},{SineIn:"SineIn"},{SineOut:"SineOut"},{SineInOut:"SineInOut"},{ExponentialIn:"ExponentialIn"},{ExponentialOut:"ExponentialOut"},{ExponentialInOut:"ExponentialInOut"},{CircularIn:"CircularIn"},{CircularOut:"CircularOut"},{CircularInOut:"CircularInOut"},{BackIn:"BackIn"},{BackOut:"BackOut"},{BackInOut:"BackInOut"},{BounceIn:"BounceIn"},{BounceOut:"BounceOut"},{BounceInOut:"BounceInOut"},{ElasticIn:"ElasticIn"},{ElasticOut:"ElasticOut"},{ElasticInOut:"ElasticInOut"}],default:"Linear"}),PositionTween.prototype.initialize=function(){this.initialLocalPosition=this.entity.getLocalPosition().clone(),this._restartTween(),this.on("attr",this._restartTween,this)},PositionTween.prototype.update=function(t){},PositionTween.prototype._restartTween=function(){this.entity.setLocalPosition(this.initialLocalPosition),this._targetLocalPosition=this.initialLocalPosition.clone().add(this.deltaPosition),this.entity.tween(this.entity.getLocalPosition()).to(this._targetLocalPosition,this.duration,pc[this.easing]).delay(this.randomPhase?pc.math.random(0,this.duration):0).yoyo(this.yoyo).loop(this.loop).start()};var OpacityTween=pc.createScript("opacityTween");OpacityTween.attributes.add("targetOpacity",{type:"number",default:.5}),OpacityTween.attributes.add("duration",{type:"number",default:.9}),OpacityTween.attributes.add("yoyo",{type:"boolean",default:!0}),OpacityTween.attributes.add("loop",{type:"boolean",default:!0}),OpacityTween.attributes.add("sprite",{type:"boolean",default:!1}),OpacityTween.attributes.add("easing",{type:"string",enum:[{Linear:"Linear"},{QuadraticIn:"QuadraticIn"},{QuadraticOut:"QuadraticOut"},{QuadraticInOut:"QuadraticInOut"},{CubicIn:"CubicIn"},{CubicOut:"CubicOut"},{CubicInOut:"CubicInOut"},{QuarticIn:"QuarticIn"},{QuarticOut:"QuarticOut"},{QuarticInOut:"QuarticInOut"},{QuinticIn:"QuinticIn"},{QuinticOut:"QuinticOut"},{QuinticInOut:"QuinticInOut"},{SineIn:"SineIn"},{SineOut:"SineOut"},{SineInOut:"SineInOut"},{ExponentialIn:"ExponentialIn"},{ExponentialOut:"ExponentialOut"},{ExponentialInOut:"ExponentialInOut"},{CircularIn:"CircularIn"},{CircularOut:"CircularOut"},{CircularInOut:"CircularInOut"},{BackIn:"BackIn"},{BackOut:"BackOut"},{BackInOut:"BackInOut"},{BounceIn:"BounceIn"},{BounceOut:"BounceOut"},{BounceInOut:"BounceInOut"},{ElasticIn:"ElasticIn"},{ElasticOut:"ElasticOut"},{ElasticInOut:"ElasticInOut"}],default:"Linear"}),OpacityTween.prototype.initialize=function(){this.targetElement=this.sprite?this.entity.sprite:this.entity.element,this.initialOpacity=this.targetElement.opacity,this._restartTween(),this.on("attr",this._restartTween,this)},OpacityTween.prototype._restartTween=function(){this.targetElement.opacity=this.initialOpacity,this.entity.tween(this.targetElement).to({opacity:this.targetOpacity},this.duration,pc[this.easing]).yoyo(this.yoyo).loop(this.loop).start()},OpacityTween.prototype.update=function(t){};var DynamicFov=pc.createScript("dynamicFov");DynamicFov.attributes.add("minLandscapeAspectRatio",{type:"number",default:.8}),DynamicFov.attributes.add("copyInitialCameraFov",{type:"boolean",default:!1}),DynamicFov.attributes.add("portraitFovMode",{type:"boolean",enum:[{Vertical:!1},{Horizontal:!0}],default:!1}),DynamicFov.attributes.add("portraitFov",{type:"number",default:45}),DynamicFov.attributes.add("landscapeFovMode",{type:"boolean",enum:[{Vertical:!1},{Horizontal:!0}],default:!1}),DynamicFov.attributes.add("landscapeFov",{type:"number",default:45}),DynamicFov.prototype.initialize=function(){this._originalFov=this.entity.camera.fov,this.app.on("attr",this.onResizeCanvas,this),this.app.graphicsDevice.on("resizecanvas",this.onResizeCanvas,this),this.onResizeCanvas()},DynamicFov.prototype.update=function(t){},DynamicFov.prototype.onResizeCanvas=function(){const t=this.app.graphicsDevice.height;this.app.graphicsDevice.width/t>this.minLandscapeAspectRatio?(this.entity.camera.fov=this.copyInitialCameraFov?this._originalFov:this.landscapeFov,this.entity.camera.horizontalFov=this.landscapeFovMode):(this.entity.camera.fov=this.copyInitialCameraFov?this._originalFov:this.portraitFov,this.entity.camera.horizontalFov=this.portraitFovMode)};var CameraTransition=pc.createScript("cameraTransition");CameraTransition.attributes.add("autoStart",{title:"Auto Start On Enable",type:"boolean",default:!0}),CameraTransition.attributes.add("startCamera",{type:"entity",title:"Start Camera"}),CameraTransition.attributes.add("endCamera",{type:"entity",title:"End Camera"}),CameraTransition.attributes.add("duration",{type:"number",default:1,title:"Duration (Secs)"}),CameraTransition.attributes.add("tweenCurve",{type:"curve",curves:["time"],default:{keys:[0,0,1,1]}}),CameraTransition.attributes.add("useEasing",{type:"boolean",default:!0}),CameraTransition.attributes.add("easing",{type:"string",enum:[{Linear:"Linear"},{QuadraticIn:"QuadraticIn"},{QuadraticOut:"QuadraticOut"},{QuadraticInOut:"QuadraticInOut"},{CubicIn:"CubicIn"},{CubicOut:"CubicOut"},{CubicInOut:"CubicInOut"},{QuarticIn:"QuarticIn"},{QuarticOut:"QuarticOut"},{QuarticInOut:"QuarticInOut"},{QuinticIn:"QuinticIn"},{QuinticOut:"QuinticOut"},{QuinticInOut:"QuinticInOut"},{SineIn:"SineIn"},{SineOut:"SineOut"},{SineInOut:"SineInOut"},{ExponentialIn:"ExponentialIn"},{ExponentialOut:"ExponentialOut"},{ExponentialInOut:"ExponentialInOut"},{CircularIn:"CircularIn"},{CircularOut:"CircularOut"},{CircularInOut:"CircularInOut"},{BackIn:"BackIn"},{BackOut:"BackOut"},{BackInOut:"BackInOut"},{BounceIn:"BounceIn"},{BounceOut:"BounceOut"},{BounceInOut:"BounceInOut"},{ElasticIn:"ElasticIn"},{ElasticOut:"ElasticOut"},{ElasticInOut:"ElasticInOut"}],default:"Linear"}),CameraTransition.attributes.add("tweenPosition",{type:"boolean",default:!0}),CameraTransition.attributes.add("tweenRotation",{type:"boolean",default:!0}),CameraTransition.attributes.add("tweenFov",{type:"boolean",default:!0}),CameraTransition.attributes.add("createPathOnceInitialized",{type:"boolean",default:!1}),CameraTransition.attributes.add("recreatePathEveryStart",{type:"boolean",default:!0}),CameraTransition.prototype.initialize=function(){this._initialWorldPosition=this.entity.getPosition().clone(),this._initialWorldRotation=this.entity.getRotation().clone(),this.time=pc.math.clamp(this.startTime,0,this.duration),this.started=!1,this.finished=!1,this.lookAt=new pc.Vec3,this.up=new pc.Vec3,this.on("state",(t=>{t&&this.autoStart&&(this.reset(),this.startTransition())})),this.createPathOnceInitialized&&this.createPath(),this.entity.setPathProgress=this.setPathProgress.bind(this),this.entity.startTransition=this.startTransition.bind(this),this.entity.reset=this.reset.bind(this)},CameraTransition.prototype.reset=function(){this.started=!1,this.finished=!1,this.time=0,this.px&&this.setPathProgress(0)},CameraTransition.prototype.startTransition=function(){return new Promise(((t,i)=>{this.startCamera||(this.entity.setPosition(this._initialWorldPosition),this.entity.setRotation(this._initialWorldRotation)),!this.recreatePathEveryStart&&this._pathCreated||this.createPath(),this.time=0,this.started=!0,this.finished=!1,this.entity.off(EventTypes.INTERNAL_CAMERA_TRANSITION_FINISHED),this.entity.once(EventTypes.INTERNAL_CAMERA_TRANSITION_FINISHED,(()=>t(this.entity)))}))},CameraTransition.prototype.update=function(t){this.started&&!this.finished&&this._updatePlayback(t)},CameraTransition.prototype._updatePlayback=function(t){this.time+=t,this.time>=this.duration&&(this.time=this.duration),this.setPathProgress(pc.math.clamp(this.time/this.duration,0,1))},CameraTransition.prototype.setPathProgress=function(t){let i=t;if(i=this.useEasing?pc[this.easing](t):this.tweenCurve.value(t),!this.finished&&i>=1&&(this.finished=!0,this.entity.fire(EventTypes.INTERNAL_CAMERA_TRANSITION_FINISHED),this.app.fire(EventTypes.CAMERA_TRANSITION_FINISHED,this.entity.name)),this.tweenPosition&&this.entity.setPosition(this.px.value(i),this.py.value(i),this.pz.value(i)),this.tweenRotation&&(this.lookAt.set(this.tx.value(i),this.ty.value(i),this.tz.value(i)),this.up.set(this.ux.value(i),this.uy.value(i),this.uz.value(i)),this.entity.lookAt(this.lookAt,this.up)),this.tweenFov){const t=this.startCamera?this.startCamera:this.entity;this.entity.camera.fov=pc.math.lerp(t.camera.fov,this.endCamera.camera.fov,i),this.entity.camera.horizontalFov=i>.5?this.endCamera.camera.horizontalFov:t.camera.horizontalFov}},CameraTransition.prototype.createPath=function(){const t=pc.CURVE_CARDINAL;this.px=new pc.Curve,this.px.type=t,this.py=new pc.Curve,this.py.type=t,this.pz=new pc.Curve,this.pz.type=t,this.tx=new pc.Curve,this.tx.type=t,this.ty=new pc.Curve,this.ty.type=t,this.tz=new pc.Curve,this.tz.type=t,this.ux=new pc.Curve,this.ux.type=t,this.uy=new pc.Curve,this.uy.type=t,this.uz=new pc.Curve,this.uz.type=t;var e=[this.startCamera||this.entity,this.endCamera],a=0,n=[],s=new pc.Vec3;for(n.push(0),i=1;i<e.length;i++){var r=e[i-1],u=e[i];s.sub2(r.getPosition(),u.getPosition()),a+=s.length(),n.push(a)}for(i=0;i<e.length;i++){var o=n[i]/a,h=e[i],c=h.getPosition();this.px.add(o,c.x),this.py.add(o,c.y),this.pz.add(o,c.z);var d=c.clone().add(h.forward);this.tx.add(o,d.x),this.ty.add(o,d.y),this.tz.add(o,d.z);var p=h.up;this.ux.add(o,p.x),this.uy.add(o,p.y),this.uz.add(o,p.z)}this._pathCreated=!0};var LandscapeFov=pc.createScript("landscapeFov");LandscapeFov.attributes.add("minAspectRatio",{type:"number",default:.5625}),LandscapeFov.attributes.add("maxAspectRatio",{type:"number",default:1.5}),LandscapeFov.attributes.add("startFov",{type:"number",default:30}),LandscapeFov.attributes.add("endFov",{type:"number",default:30}),LandscapeFov.prototype.initialize=function(){this.on("attr",this.onResizeCanvas,this),this.app.graphicsDevice.on("resizecanvas",this.onResizeCanvas,this),this.onResizeCanvas()},LandscapeFov.prototype.update=function(t){},LandscapeFov.prototype.onResizeCanvas=function(){this.entity.camera.horizontalFov=!0;const t=this.app.graphicsDevice.height,a=this.app.graphicsDevice.width/t,e=(pc.math.clamp(a,this.minAspectRatio,this.maxAspectRatio)-this.minAspectRatio)/(this.maxAspectRatio-this.minAspectRatio);a>=this.maxAspectRatio?this.entity.camera.fov=this.endFov*a/this.maxAspectRatio:this.entity.camera.fov=pc.math.lerp(this.startFov,this.endFov,e)};var LocalStorageController=pc.createScript("localStorageController");LocalStorageController.prototype.initialize=function(){LocalStorageController.app=this.app,LocalStorageController.currentLocalStorage=APIMediator.getStorageObject(),this.app.on(EventTypes.SAVE_APP,(()=>LocalStorageController.saveData()),this),this.app.on(EventTypes.POSTINITIALIZE,this.unlockLocalStorageForWriting,this)},LocalStorageController.prototype.postInitialize=function(){LocalStorageController.loadData(),this.app.fire(EventTypes.SAVEDATA_LOADED)},LocalStorageController.prototype.unlockLocalStorageForWriting=function(t){LocalStorageController._writingAllowed=!0,LocalStorageController._hasPendingWriteRequests&&LocalStorageController.saveData()},LocalStorageController.getLocalStorage=function(){return LocalStorageController.currentLocalStorage},LocalStorageController.prepareDefaultSaveData=function(){const t={};return t[Constants.Storage.CURRENT_LEVEL]=1,t[Constants.Storage.CHAPTER]=0,t[Constants.Storage.GEMS]=0,t[Constants.Storage.VIBRATION]=!0,t[Constants.Storage.MUSIC_VOLUME]=.5,t[Constants.Storage.SFX_VOLUME]=.5,t[Constants.Storage.LIKES_BOOST_LEVEL]=1,t[Constants.Storage.GEMS_BOOST_LEVEL]=1,t},LocalStorageController.getActualSaveData=function(){const t={};return t[Constants.Storage.CURRENT_LEVEL]=DataManager.getInstance().level,t[Constants.Storage.CHAPTER]=DataManager.getInstance().chapter,t[Constants.Storage.GEMS]=DataManager.getInstance().gems,t[Constants.Storage.VIBRATION]=VibrationManager.getInstance().isVibrationEnabled(),t[Constants.Storage.MUSIC_VOLUME]=SoundController.musicStateLoaded?SoundController.musicVolume:1,t[Constants.Storage.SFX_VOLUME]=SoundController.sfxStateLoaded?SoundController.sfxVolume:1,t[Constants.Storage.LIKES_BOOST_LEVEL]=DataManager.getInstance().likesBoostLevel,t[Constants.Storage.GEMS_BOOST_LEVEL]=DataManager.getInstance().gemsBoostLevel,t},LocalStorageController.getSlotKey=function(){return Constants.GAME_NAME+"_"+Constants.GAME_VERSION},LocalStorageController.save=function(t=!0){LocalStorageController.saveData(null,t)},LocalStorageController.saveData=function(t=null,o=!0){LocalStorageController._writingAllowed?o?(LocalStorageController.lastSaveData=t||LocalStorageController.getActualSaveData(),LocalStorageController.currentLocalStorage.setItem(LocalStorageController.getSlotKey(),JSON.stringify(LocalStorageController.lastSaveData))):setTimeout((()=>{LocalStorageController.lastSaveData=t||LocalStorageController.getActualSaveData(),LocalStorageController.currentLocalStorage.setItem(LocalStorageController.getSlotKey(),JSON.stringify(LocalStorageController.lastSaveData))}),50):console.warn("[localStorage] saving is not allowed until the app has fully initialized")},LocalStorageController.loadData=function(){var t=LocalStorageController.currentLocalStorage.getItem(LocalStorageController.getSlotKey());if(t)try{t=JSON.parse(t),!0}catch(o){t=LocalStorageController.prepareDefaultSaveData(),LocalStorageController.saveData(t)}else t=LocalStorageController.prepareDefaultSaveData(),LocalStorageController.saveData(t);LocalStorageController.lastSaveData=t,VibrationManager.getInstance().setVibrationEnabled(LocalStorageController.getSavedValue(Constants.Storage.VIBRATION))},LocalStorageController.getSavedValue=function(t){if(LocalStorageController.lastSaveData)return LocalStorageController.lastSaveData[t];console.warn(`getSavedValue: No saved value with key '${t}' was loaded`)};class ScreenMainMenu extends BaseWindow{initialize(){super.initialize(),this.levelText=this.entity.findByName("LevelText"),this.buttonSettings=this.entity.findByName("ButtonSettings"),this.likesBoostButton=this.entity.findByName("LikesButton"),this.likesPriceText=this.likesBoostButton.findByName("CostText"),this.likesLevelText=this.likesBoostButton.findByName("LevelText"),this.gemsBoostButton=this.entity.findByName("GemsButton"),this.gemsPriceText=this.gemsBoostButton.findByName("CostText"),this.gemsLevelText=this.gemsBoostButton.findByName("LevelText"),this.likesParticleSystem=this.likesBoostButton.findByName("StarParticleSystem"),this.gemsParticleSystem=this.gemsBoostButton.findByName("StarParticleSystem"),this.tapToPlayZone=this.entity.findByName("TapToPlayInputZone"),this.tapToPlayZone.on(EventTypes.BUTTON_PRESSED,this.onPlayPressed,this),this.likesBoostButton.on(EventTypes.BUTTON_PRESSED,this.onBoostLikesPressed,this),this.gemsBoostButton.on(EventTypes.BUTTON_PRESSED,this.onBoostGemsPressed,this),this.buttonSettings.on(EventTypes.BUTTON_PRESSED,this.onSettingsPressed,this),this.app.on(EventTypes.LEVEL_CHANGED,this.handleLevelChanged,this)}_initComponents(){super._initComponents()}_onShow(){super._onShow(),this._disableButtons(),this.updateButtonsVisibility(),this.updateBoostersVisibility(),this.startCurrentLevel()}updateButtonsVisibility(){this.buttonSettings.enabled=APIMediator.areAudioControlsAllowed()&&VibrationManager.getInstance().isVibrationSupported()}updateBoostersVisibility(){const e=DataManager.getInstance().getNextLikesBoostUpgradePrice(),t=DataManager.getInstance().getNextGemsBoostUpgradePrice(),s=DataManager.getInstance().gems>Math.min(e,t);this.likesLevelText.element.text=`LEVEL ${DataManager.getInstance().likesBoostLevel}`,this.gemsLevelText.element.text=`LEVEL ${DataManager.getInstance().gemsBoostLevel}`,this.likesPriceText.element.text=`${e}`,this.gemsPriceText.element.text=`${t}`,DataManager.getInstance().level>1&&s?(this.likesBoostButton.enabled=!0,this.gemsBoostButton.enabled=!0):(this.likesBoostButton.enabled=!1,this.gemsBoostButton.enabled=!1)}async startCurrentLevel(){LevelController.getInstance().reset(),this.handleLevelChanged(DataManager.getInstance().level),CameraController.getInstance().changeCamera(Constants.Cameras.MAIN),MainCameraManager.getInstance().startLobbyCameraEase()}_onAppeared(){this._enableButtons()}_onHide(){super._onHide()}update(e){}handleLevelChanged(e){this.levelText.element.text=`Battle ${e}`}async onPlayPressed(){this._disableButtons(),await APIMediator.gameStart(),UIController.getInstance().showWindow(Constants.Screens.GAMEPLAY)}onShopPressed(){}onBoostGemsPressed(){const e=DataManager.getInstance().getNextGemsBoostUpgradePrice();DataManager.getInstance().gems>=e&&(DataManager.getInstance().gems-=e,DataManager.getInstance().gemsBoostLevel+=1,this.app.fire("particles:applyClothing"),this.app.fire(EventTypes.PLAY_SFX,"change"),this.gemsParticleSystem.particlesystem.stop(),this.gemsParticleSystem.particlesystem.reset(),this.gemsParticleSystem.particlesystem.play(),this.updateBoostersVisibility(),LocalStorageController.save())}onBoostLikesPressed(){const e=DataManager.getInstance().getNextLikesBoostUpgradePrice();DataManager.getInstance().gems>=e&&(DataManager.getInstance().gems-=e,DataManager.getInstance().likesBoostLevel+=1,this.app.fire("particles:applyClothing"),this.likesParticleSystem.particlesystem.stop(),this.likesParticleSystem.particlesystem.reset(),this.likesParticleSystem.particlesystem.play(),this.app.fire(EventTypes.PLAY_SFX,"change"),this.updateBoostersVisibility(),LocalStorageController.save())}onSettingsPressed(){UIController.getInstance().showPopup(Constants.Screens.SETTINGS)}_disableButtons(){}_enableButtons(){}}pc.registerScript(ScreenMainMenu,"screenMainMenu");class VibrationManager{static getInstance(){return VibrationManager._instance||(VibrationManager._instance=new VibrationManager),VibrationManager._instance}constructor(){this.vibrationSupported=window.navigator&&"function"==typeof window.navigator.vibrate,GameConfig.getAttribute("UI","enableVibration")||(this.vibrationSupported=!1,console.log("Haptic feedback is disabled")),this.vibrationEnabled=!0,this.LightDuration=20,this.MediumDuration=40,this.HeavyDuration=80,this.LightAmplitude=40,this.MediumAmplitude=120,this.HeavyAmplitude=255,this._selectionPattern=[0,this.LightDuration],this._lightimpactPattern=[0,this.LightDuration],this._mediumimpactPattern=[0,this.MediumDuration],this._heavyImpactPattern=[0,this.HeavyDuration],this._successPattern=[0,this.LightDuration,this.LightDuration,this.HeavyDuration],this._warningPattern=[0,this.HeavyDuration,this.LightDuration,this.MediumDuration],this._failurePattern=[0,this.MediumDuration,this.LightDuration,this.MediumDuration,this.LightDuration,this.HeavyDuration,this.LightDuration,this.LightDuration]}isVibrationSupported(){return this.vibrationSupported}isVibrationEnabled(){return this.vibrationEnabled}setVibrationEnabled(t){this.vibrationEnabled=t}_hapticAllowed(){return this.vibrationSupported&&this.vibrationEnabled}hapticSuccess(){this._hapticAllowed()&&window.navigator.vibrate(this._successPattern)}hapticFailure(){this._hapticAllowed()&&window.navigator.vibrate(this._failurePattern)}hapticWarning(){this._hapticAllowed()&&window.navigator.vibrate(this._warningPattern)}hapticSelection(){this._hapticAllowed()&&window.navigator.vibrate(this._selectionPattern)}hapticLightImpact(){this._hapticAllowed()&&window.navigator.vibrate(this._lightimpactPattern)}hapticMediumImpact(){this._hapticAllowed()&&window.navigator.vibrate(this._mediumimpactPattern)}hapticHeavyImpact(){this._hapticAllowed()&&window.navigator.vibrate(this._heavyImpactPattern)}}var Character=pc.createScript("character");Character.attributes.add("isPlayer",{type:"boolean",default:!1}),Character.prototype.initialize=function(){this.armatureBone=this.entity.findByName("Armature"),this.clothesContainer=this.entity.findByName("Clothes"),this.bikiniSetsContainer=this.entity.findByName("BikiniSetsContainer"),this.equippedClothes=new Map,this.equippedClothesCorrectness=new Map,this.characterName="",this.isPlayer||(this.entity.findByName("ClothChangeEffect").enabled=!1),this.characterUI=this.entity.findByName("CharacterUI"),this.nameText=this.characterUI.findByName("NameText"),this.emojiesGroup=this.characterUI.findByName("EmojiesGroup"),this.starsCounter=this.characterUI.findByName("StarsCounter"),this.emojiesPlayer=this.emojiesGroup.findByName("EmojiesPlayer"),this.emojiesOpponent=this.emojiesGroup.findByName("EmojiesOpponent"),this.entity.reset=this.reset.bind(this),this.entity.setName=this._setName.bind(this),this.entity.showNameText=this._showNameText.bind(this),this.entity.hideNameText=this._hideNameText.bind(this),this.entity.getEmojiesContainer=this._getEmojiesContainer.bind(this),this.entity.showStarsCounter=this._showStarsCounter.bind(this),this.entity.hideStarsCounter=this._hideStarsCounter.bind(this),this.entity.isPlayer=()=>this.isPlayer,this.entity.equipClothTemplate=this._equipClothTemplate.bind(this),this.entity.loadDefaultBikiniSet=this._loadDefaultBikiniSet.bind(this),this.entity.loadRandomBikiniSet=this._loadRandomBikiniSet.bind(this),this.entity.clearAllClothes=this.clearAllClothes.bind(this),this.entity.initLevelClothing=this._initLevelClothing.bind(this),this.entity.getEquippedClothes=this._getEquippedClothes.bind(this),this.entity.getEquippedClothesCorrectness=this._getEquippedClothesCorrectness.bind(this),this.entity.playIdleAnim=this.playIdleAnim.bind(this),this.entity.playWalkingAnim=this.playWalkingAnim.bind(this),this.entity.playPosingAnim=this.playPosingAnim.bind(this),this.entity.playVictoryAnim=this.playVictoryAnim.bind(this),this.entity.playDefeatAnim=this.playDefeatAnim.bind(this),this.entity.playFinalIdleAnim=this.playFinalIdleAnim.bind(this),this.entity.playKickAnim=this.playKickAnim.bind(this),this.entity.playKickedOutAnim=this.playKickedOutAnim.bind(this),this.entity.playFinalDanceAnim=this.playFinalDanceAnim.bind(this),this.entity.walkToOpponent=this.walkToOpponent.bind(this),this.emojiesGroup.enabled||(this.emojiesGroup.enabled=!0),this.starsCounter.enabled||(this.starsCounter.enabled=!0)},Character.prototype.postInitialize=function(){this._loadDefaultBikiniSet()},Character.prototype.update=function(t){},Character.prototype.reset=function(){this.entity.setLocalEulerAngles(pc.Vec3.ZERO),this.entity.setLocalScale(pc.Vec3.ONE),this.resetAllBooleans()},Character.prototype._loadDefaultBikiniSet=function(){this._equipBikiniSet(Constants.ClothingType.Top,this.entity.findByName("AA_Bikini_top")),this._equipBikiniSet(Constants.ClothingType.Bottom,this.entity.findByName("AA_bikini_bottom"))},Character.prototype._loadRandomBikiniSet=function(){this._loadDefaultBikiniSet();const t=Utils.getRandomItem(this.bikiniSetsContainer.children.map((t=>t.name)));this.bikiniSetsContainer.children.forEach((e=>{e.enabled=e.name===t,e.enabled&&(this._equipBikiniSet(Constants.ClothingType.Hair,e.children[1]),this._equipBikiniSet(Constants.ClothingType.Top,e.children[2]),this._equipBikiniSet(Constants.ClothingType.Bottom,e.children[3]))}))},Character.prototype._initLevelClothing=function(t){this.equippedClothesCorrectness.clear();for(let e of t)this.equippedClothesCorrectness.set(e,Constants.ChoiceCorrectness.Empty)},Character.prototype._getEquippedClothes=function(){return this.equippedClothes},Character.prototype._getEquippedClothesCorrectness=function(){return this.equippedClothesCorrectness},Character.prototype._equipBikiniSet=function(t,e){this.removeClothIfEquipped(t),e.enabled=!0,this.equippedClothes.set(t,e)},Character.prototype._equipClothTemplate=function(t,e){t===Constants.ClothingType.Dress&&(this.removeClothIfEquipped(Constants.ClothingType.Top),this.removeClothIfEquipped(Constants.ClothingType.Bottom)),this.removeClothIfEquipped(t);const i=e.resource.instantiate();this.clothesContainer.addChild(i),this.equippedClothes.set(t,i);const n=e.name.toLowerCase().includes("wrong")?Constants.ChoiceCorrectness.Bad:Constants.ChoiceCorrectness.Good;this.equippedClothesCorrectness.set(t,n),i.children.forEach((t=>{t.render&&(t.render.rootBone=this.armatureBone)}))},Character.prototype.removeClothIfEquipped=function(t){const e=this.equippedClothes.get(t);e&&(e.parent===this.clothesContainer?e.destroy():e.enabled=!1,this.equippedClothes.delete(t)),this.equippedClothesCorrectness.get(t)&&this.equippedClothesCorrectness.delete(t)},Character.prototype.clearAllClothes=function(){const t=[...this.equippedClothes.keys()];for(;t.length>0;){const e=t.shift();this.removeClothIfEquipped(e)}this.equippedClothesCorrectness.clear(),this._loadDefaultBikiniSet()},Character.prototype.walkToOpponent=function(){return new Promise(((t,e)=>{this.playWalkingAnim(),this.entity.tween(this.entity.getLocalEulerAngles()).rotate({x:0,y:this.isPlayer?90:-90,z:0},.2,pc.Linear).onComplete((()=>{const e=this.entity.getLocalPosition();this.entity.tween(e).to({x:0},.5,pc.Linear).start(),this.entity.tween(this.entity.getLocalEulerAngles()).rotate({x:0,y:0,z:0},.125,pc.SineOut).delay(.375).onComplete((()=>{this.playKickAnim(),t()})).start()})).start()}))},Character.prototype._setName=function(t){this.characterName=t,this.nameText.element.text=this.characterName,this.starsCounter.setPlayerName(t)},Character.prototype._showNameText=function(){this.app.stopAllTweens(this.nameText),this.nameText.enabled=!0,this.nameText.element.opacity=0,this.nameText.tween(this.nameText.element).to({opacity:1},.25,pc.Linear).start()},Character.prototype._hideNameText=function(){this.nameText.tween(this.nameText.element).to({opacity:0},.5,pc.Linear).onComplete((()=>{this.nameText.enabled=!1})).start()},Character.prototype._showStarsCounter=function(t){this.starsCounter.show(t)},Character.prototype._hideStarsCounter=function(){this.starsCounter.hide()},Character.prototype._getEmojiesContainer=function(){return this.isPlayer?this.emojiesPlayer:this.emojiesOpponent},Character.prototype.resetAllBooleans=function(){this.entity.anim.setBoolean("walking",!1)},Character.prototype.playIdleAnim=function(){this.resetAllBooleans(),this.entity.anim.setTrigger("idle",!0)},Character.prototype.playWalkingAnim=function(){this.entity.anim.setBoolean("walking",!0)},Character.prototype.playPosingAnim=function(){this.resetAllBooleans(),this.entity.anim.setTrigger("posing",!0)},Character.prototype.playVictoryAnim=function(){this.resetAllBooleans(),this.entity.anim.setTrigger("victory",!0)},Character.prototype.playDefeatAnim=function(){this.entity.tween(this.entity.getLocalEulerAngles()).rotate({x:0,y:this.isPlayer?75:-75,z:0},.2,pc.Linear).onComplete((()=>{this.resetAllBooleans(),this.entity.anim.setTrigger("defeat",!0)})).start()},Character.prototype.playFinalIdleAnim=function(){this.resetAllBooleans(),this.entity.anim.setTrigger("final_idle",!0)},Character.prototype.playKickAnim=function(){this.resetAllBooleans(),this.entity.anim.setTrigger("kick",!0)},Character.prototype.playKickedOutAnim=function(){this.resetAllBooleans(),this.entity.anim.setTrigger("kicked_out",!0),Utils.wait(1e3).then((()=>{this.entity.setLocalScale(pc.Vec3.ZERO),this.playIdleAnim()}))},Character.prototype.playFinalDanceAnim=function(){this.resetAllBooleans(),this.entity.anim.setTrigger("final_dance",!0)};var LevelController=pc.createScript("levelController");LevelController.attributes.add("walkingSpeed",{type:"number",default:.025}),LevelController.attributes.add("roundDecisionDistance",{type:"number",default:5}),LevelController.attributes.add("roundSlowdownFactor",{type:"number",default:.15}),LevelController.getInstance=function(){return LevelController._instance||console.error("LevelController is not initialized yet"),LevelController._instance},LevelController.prototype.initialize=function(){LevelController._app=this.app,LevelController._instance||(LevelController._instance=this),this.playersController=this.entity.findByName("PlayerController"),this.started=!1,this.finished=!1,this.speedMultiplier=0,this.progress=0,this.round=0,this.totalRounds=1,this.roundClothingData=[],this.selectedPlayerClothes=[],this.selectedOpponentClothes=[],this.app.on("selectPlayerClothes",this._selectPlayerClothes,this),this.app.on("endRound",this._endRound,this)},LevelController.prototype.postInitialize=function(){this.player=PlayerController.getInstance().getPlayerCharacter(),this.opponent=PlayerController.getInstance().getOpponentCharacter(),this.opponentNameText=this.opponent.findByName("NameText")},LevelController.prototype.update=function(e){this.started&&!this.finished&&this.updateWalking(e)},LevelController.prototype.reset=function(){this.app.fire(EventTypes.LEVEL_RESET),PlayerController.getInstance().reset(),JuryController.getInstance().reset(),CameraController.getInstance().changeCamera(Constants.Cameras.MAIN),this.speedMultiplier=0,this.decisionStartZ=100,this.decisionEndZ=100,this.progress=0,this.round=-1,this.totalRounds=1,this.roundClothingData=[]},LevelController.prototype._endRound=function(){if(this.roundEnded)return;this.roundEnded=!0,this.app.fire("hideClothesPanel",this.round),this.entity.tween(this).to({speedMultiplier:1},.15,pc.Linear).start(),this.currentPlayerClothes,this._preloadNextLevelClothes();const e=Utils.getRandomItem([0,1,2].filter((e=>e!==this.currentPlayerClothes)));this.equip(this.opponent,this.roundClothingData.variants[e].template)},LevelController.prototype._preloadNextLevelClothes=function(){const e=this.levelData.clothes[this.round+1],t=[];if(e){const n=e.variants;n&&n.forEach((e=>{const n=e.template;if(n){const e=Array.from(new Set([...this.app.assets.findAll(n.name),...this.app.assets.findByTag(n.name)]));t.push(...e)}const a=e.icon;a&&t.push(this.app.assets.find(a.name,"texture"))}))}t.length>0&&(console.log("preloading round assets ("+t.length+")"),AssetsLoader.getInstance().loadAssets(t))},LevelController.prototype._selectPlayerClothes=function(e){this.currentPlayerClothes=e,this.selectedPlayerClothes[this.round]=e,this.equip(this.player,this.roundClothingData.variants[e].template)},LevelController.prototype.equip=function(e,t){e.equipClothTemplate(this.roundClothingData.clothingType,t)},LevelController.prototype.start=function(e){this.levelData=LevelStorage.getInstance().getLevelData(e),this.levelData||(this.levelData=LevelStorage.getInstance().getRandomLevelData()),console.log("starting level "+e+"..."),PlatformManager.getInstance().initLevel(this.levelData),this.roundCheckpoints=PlatformManager.getInstance().getRoundCheckpoints(),this.podiumZ=PlatformManager.getInstance().getPodiumZ(),this.player.loadDefaultBikiniSet(),this.opponent.loadRandomBikiniSet(),this.round=-1,this.totalRounds=this.levelData.clothes.length,this.player.initLevelClothing(this.levelData.clothes.map((e=>e.clothingType))),this.opponent.initLevelClothing(this.levelData.clothes.map((e=>e.clothingType))),this._preloadNextLevelClothes(),MainCameraManager.getInstance().completeLobbyCameraEase(1.25),MainCameraManager.getInstance().translateLobbyToSearchCamera(1),PlayerController.getInstance().walkFromLobby(1.25).then((()=>{this.player.playPosingAnim(),this.opponent.playPosingAnim(),this.showOpponentSearchAnimation(),Utils.wait(1750).then((()=>{this.player.playWalkingAnim(),this.opponent.playWalkingAnim(),this.started=!0,this.finished=!1,MainCameraManager.getInstance().translateSearchToGameplayCamera(4),PlayerController.getInstance().canMove=!0,this.speedMultiplier=1,this.startMatch()}))}))},LevelController.prototype.showOpponentSearchAnimation=async function(){this.player.setName("You"),this.opponent.setName(""),this.player.showNameText(),this.opponent.showNameText();const e=Utils.shuffle(["Maisy","Josie","Louisa","Lana","Jane","Hana","Libby","Matilda","Summer","Emilie","Amanda","Maria","Kian"]);let t="";for(;e.length>0;)t=e.shift(),this.opponentNameText.element.text=t,await Utils.wait(100);this.opponent.setName(t),this.player.hideNameText(),this.opponent.hideNameText()},LevelController.prototype.finish=async function(){this.finished=!0,this.speedMultiplier=1,PlayerController.getInstance().canMove=!1,this.app.fire("hideConcept"),LikesManager.getInstance().hideGameplayHeart(),PlayerController.getInstance().walkToPodium(),await MainCameraManager.getInstance().zoomFinalOpponentStepA(),MainCameraManager.getInstance().zoomFinalOpponentStepB();const e=pc.math.lerp(.667,1,pc.math.clamp(DataManager.getInstance().level/10,0,1)),t=await JuryController.getInstance().judgeCharacterOutfit(this.opponent)*pc.math.random(e,1),n=JuryController.getInstance().splitScoreIntoThreePoints(t);DataManager.getInstance().opponentLevelScore=n.reduce(((e,t)=>e+t),0),await Utils.wait(750),JuryController.getInstance().showJuryPoints(n),Utils.wait(650).then((()=>this.opponent.showStarsCounter(DataManager.getInstance().opponentLevelScore))),await Utils.wait(3500),await MainCameraManager.getInstance().zoomFinalPlayerStepA(),MainCameraManager.getInstance().zoomFinalPlayerStepB();const a=await JuryController.getInstance().judgeCharacterOutfit(this.player),o=JuryController.getInstance().splitScoreIntoThreePoints(a);DataManager.getInstance().playerLevelScore=o.reduce(((e,t)=>e+t),0),await Utils.wait(750),JuryController.getInstance().showJuryPoints(o),Utils.wait(650).then((()=>this.player.showStarsCounter(DataManager.getInstance().playerLevelScore))),await Utils.wait(3500),JuryController.getInstance().hideAllEmojies(),this.player.hideStarsCounter(),this.opponent.hideStarsCounter();const i=DataManager.getInstance().playerLevelScore>=DataManager.getInstance().opponentLevelScore;DataManager.getInstance().lastMatchResultWasVictory=i,MainCameraManager.getInstance().showFinalBattle(),await Utils.wait(350),i?await this._playPlayerKickOpponentAnim():await this._playOpponentKickPlayerAnim()},LevelController.prototype.playHammerMetaGame=async function(){HammerController.getInstance().show(),MainCameraManager.getInstance().lookAtHammer(1),PlayerController.getInstance().movePlayerToHammerGame(1),await Utils.wait(1e3),await HammerController.getInstance().playHeartJumpingAnimation(),await HammerController.getInstance().playBarFillingAnimation()},LevelController.prototype._playPlayerKickOpponentAnim=async function(){this.opponent.playDefeatAnim(),await this.player.walkToOpponent(),await Utils.wait(450),this.opponent.playKickedOutAnim(),await Utils.wait(1e3),this.player.playFinalDanceAnim()},LevelController.prototype._playOpponentKickPlayerAnim=async function(){this.player.playDefeatAnim(),await this.opponent.walkToOpponent(),await Utils.wait(450),this.player.playKickedOutAnim(),await Utils.wait(1e3),this.opponent.playFinalDanceAnim()},LevelController.prototype.updateWalking=function(e){const t=e*this.walkingSpeed*this.speedMultiplier;PlayerController.getInstance().moveForward(t,this.podiumZ);const n=PlayerController.getInstance().getPlayerPosition().z,a=pc.math.clamp((this.decisionEndZ-n)/this.roundDecisionDistance,0,1);this.app.fire("roundProgressLeft",a),n>=this.podiumZ?this.finishMatch():a<=0&&!this.roundEnded?this._endRound():n>=this.roundCheckpoints[this.round+1]&&this.startNextRound(),this.player.anim.speed=this.speedMultiplier,this.opponent.anim.speed=this.speedMultiplier},LevelController.prototype.startNextRound=function(){this.round<this.totalRounds?this._startRound(this.round+1):this.finishMatch()},LevelController.prototype._startRound=function(e){console.log("starting round #"+e),this.roundEnded=!1,this.round=e,this.decisionStartZ=this.roundCheckpoints[e]+.8,this.decisionEndZ=this.decisionStartZ+this.roundDecisionDistance,this.currentPlayerClothes=-1,this.roundClothingData=this.levelData.clothes[this.round],this.entity.tween(this).to({speedMultiplier:this.roundSlowdownFactor},.55,pc.Linear).start(),this.app.fire("showClothesPanel",this.roundClothingData.variants),this.app.fire("roundProgressLeft",1)},LevelController.prototype.startMatch=function(){LikesManager.getInstance().showGameplayHeart(),this.app.fire("showConcept",this.levelData.concept)},LevelController.prototype.finishMatch=function(){this.speedMultiplier=0,this.finish().then((async()=>{DataManager.getInstance().playerLevelScore>=DataManager.getInstance().opponentLevelScore?(DataManager.getInstance().lastLevelRewardGems=DataManager.getInstance().playerLevelScore*DataManager.getInstance().gemsBoostLevel,await APIMediator.gameComplete(),UIController.getInstance().showWindow(Constants.Screens.VICTORY),this.app.fire("particles:finalLeft"),this.app.fire("particles:finalRight")):(await APIMediator.gameOver(),UIController.getInstance().showWindow(Constants.Screens.DEFEAT))}))},LevelController.prototype.exitToMainMenu=function(){UIController.getInstance().showWindowOverTransition(Constants.Screens.MAIN_MENU,{inDuration:.175,outDuration:.65,callback:()=>{LevelController.getInstance().reset()}})};class ScreenGameplay extends BaseWindow{initialize(){super.initialize(),this.conceptContainer=this.entity.findByName("ConceptContainer"),this.optionsPanelContainer=this.entity.findByName("OptionsPanelContainer"),this.optionsPanel=this.optionsPanelContainer.findByName("OptionsPanel"),this.optionsContainer=this.optionsPanel.findByName("OptionsContainer"),this.options=this.optionsContainer.children,this.roundProgressMask=this.entity.findByName("TimerMask"),this.app.on("showConcept",this._showConcept,this),this.app.on("hideConcept",this._hideConcept,this),this.app.on("showClothesPanel",this._showClothesPanel,this),this.app.on("hideClothesPanel",this._hideClothesPanel,this),this.app.on("roundProgressLeft",this._updateVisibleProgress,this)}_initComponents(){super._initComponents()}_showConcept(e){let t=!1;if(this.conceptContainer.children.forEach((n=>{n.enabled=n.name===e;const i=n.findByName("BattleCounter");i&&(i.element.text=`Battle ${DataManager.getInstance().level}`),n.name===e&&(t=!0)})),!t){const t=this.conceptContainer.children[this.conceptContainer.children.length-1];t.enabled=!0;const n=t.findByName("BattleCounter");n&&(n.element.text=`Battle ${DataManager.getInstance().level}`);const i=t.findByName("ConceptText"),s=Constants.ConceptNamesMapping[e]||e;i&&(i.element.text=`${s}`)}this.conceptContainer.enabled=!0,this.conceptContainer.fire(EventTypes.UI_ELEMENT.APPEAR_MANUALLY)}_hideConcept(){this.conceptContainer.once(EventTypes.UI_ELEMENT.DISAPPEARED,(()=>{this.conceptContainer.enabled=!1})),this.conceptContainer.fire(EventTypes.UI_ELEMENT.DISAPPEAR)}_showClothesPanel(e){this._showOptionsSet(e)}_hideClothesPanel(e){this.optionsPanel.fire(EventTypes.UI_ELEMENT.DISAPPEAR)}_updateVisibleProgress(e){this.roundProgressMask.element.width=768*e}_onShow(){super._onShow(),this.optionsPanel.enabled=!1,this.conceptContainer.enabled=!1,LevelController.getInstance().start(DataManager.getInstance().level)}_onAppeared(){}_onHide(){super._onHide()}_showOptionsSet(e){const t=Utils.shuffle(this.options.slice());for(let n=0;n<e.length;n++)t[n].setClothingVariant(n,e[n]);this.optionsPanel.enabled=!0,this.optionsPanel.fire(EventTypes.UI_ELEMENT.APPEAR_MANUALLY),1===DataManager.getInstance().level?this._showTutorial(t):this.app.fire(EventTypes.HIDE_GAMEPLAY_TUTORIAL_HAND,!0)}_showTutorial(e){const t=e.filter((e=>e.isCorrectOption())),n=Utils.getRandomItem(t);Utils.wait(250).then((()=>{this.app.fire(EventTypes.SHOW_GAMEPLAY_TUTORIAL_HAND,n.getPosition())})),this.app.once("hideClothesPanel",(()=>{this.app.fire(EventTypes.HIDE_GAMEPLAY_TUTORIAL_HAND)})),this.app.once("selectPlayerClothes",(t=>{this.app.fire(EventTypes.HIDE_GAMEPLAY_TUTORIAL_HAND);const n=e[t].findByName("ButtonApply");Utils.wait(350).then((()=>{this.app.fire(EventTypes.SHOW_GAMEPLAY_TUTORIAL_HAND,n.getPosition()),this.app.once("endRound",(()=>{this.app.fire(EventTypes.HIDE_GAMEPLAY_TUTORIAL_HAND)}))}))}))}update(e){}}pc.registerScript(ScreenGameplay,"screenGameplay");class ScreenVictory extends BaseWindow{initialize(){super.initialize(),this.gemsContainer=this.entity.findByName("GemsContainer"),this.gemsAmountText=this.gemsContainer.findByName("GemsAmountText"),this.buttonContinue=this.entity.findByName("ButtonContinue"),this.buttonContinue.on(EventTypes.BUTTON_PRESSED,this.onContinuePressed,this)}_initComponents(){super._initComponents()}_onShow(){super._onShow(),this.app.fire(EventTypes.PLAY_SFX,"victory"),DataManager.getInstance().level+=1,LocalStorageController.save(),this._processVictoryTweens()}_onAppeared(){}_onHide(){super._onHide()}update(e){}async _processVictoryTweens(){this.buttonContinue.enabled=!1;const e=DataManager.getInstance().lastLevelRewardGems;e>0?(Utils.tweenText(this.gemsAmountText,0,e,.5,0,pc.Linear,!0),await Utils.wait(500),Utils.wait(500).then((()=>this.gemsContainer.fire(EventTypes.UI_ELEMENT.DISAPPEAR))),await GemCounter.getInstance().spawnAndPickupGems(this.gemsContainer.getPosition(),e,1.5)):(this.gemsAmountText.element.text=`${e}`,await Utils.wait(750)),this.buttonContinue.setAvailable(!0),this.buttonContinue.enabled=!0,this.buttonContinue.fire(EventTypes.UI_ELEMENT.APPEAR_MANUALLY)}onContinuePressed(){this.buttonContinue.enabled=!1,this.buttonContinue.setAvailable(!1),DataManager.getInstance().lastMatchResultWasVictory?(UIController.getInstance().hide(Constants.Screens.VICTORY),LevelController.getInstance().playHammerMetaGame()):LevelController.getInstance().exitToMainMenu()}}pc.registerScript(ScreenVictory,"screenVictory");var Option=pc.createScript("option");Option.prototype.initialize=function(){this.backgroundSelected=this.entity.findByName("BackgroundSelected"),this.backgroundNotSelected=this.entity.findByName("BackgroundNotSelected"),this.optionIcon=this.entity.findByName("OptionIcon"),this.optionIndex=0,this.applyButton=this.entity.findByName("ButtonApply"),this.entity.applyButton=this.applyButton,this.entity.setSelected=t=>{this.applyButton.enabled=t,this.backgroundSelected.enabled=t,this.backgroundNotSelected.enabled=!t},this.entity.setSelected(!1),this.entity.setClothingVariant=this._setClothingVariant.bind(this),this.entity.isCorrectOption=this._isCorrectOption.bind(this),this.entity.on(EventTypes.BUTTON_PRESSED,this.onOptionSelected,this),this.applyButton.on(EventTypes.BUTTON_PRESSED,this.onApplyPressed,this)},Option.prototype.onOptionSelected=function(){this.entity.parent.children.forEach((t=>t.setSelected(t===this.entity))),this.app.fire("selectPlayerClothes",this.optionIndex),this.app.fire(EventTypes.PLAY_SFX,"cloth_selection")},Option.prototype.onApplyPressed=function(){this.onOptionSelected(),this.app.fire("endRound"),this.app.fire("particles:applyClothing"),this.app.fire(EventTypes.PLAY_SFX,"change"),this.app.fire(EventTypes.SHOW_FEEDBACK_EFFECT)},Option.prototype._setClothingVariant=function(t,e){this.optionIndex=t,this.optionIcon.element.textureAsset=e.icon.id,this._optionCorrect=!e.template.name.toLowerCase().includes("wrong"),this.entity.setSelected(!1)},Option.prototype._isCorrectOption=function(){return this._optionCorrect},Option.prototype.update=function(t){};var MainCameraManager=pc.createScript("mainCameraManager");MainCameraManager.attributes.add("cameraParent",{type:"entity"}),MainCameraManager.attributes.add("cameraPivot",{type:"entity"}),MainCameraManager.attributes.add("mainCamera",{type:"entity"}),MainCameraManager.attributes.add("juryContainer",{type:"entity"}),MainCameraManager.attributes.add("rootStartPosition",{type:"vec3",default:[0,0,-3.161]}),MainCameraManager.attributes.add("lobbyCameraPosition",{type:"vec3",default:[-3.63,3.45,-4.08]}),MainCameraManager.attributes.add("lobbyCameraRotation",{type:"vec3",default:[-16.8,-39.4,0]}),MainCameraManager.attributes.add("gameplayCameraPosition",{type:"vec3",default:[-3.63,3.45,-4.08]}),MainCameraManager.attributes.add("gameplayCameraRotation",{type:"vec3",default:[-16.8,-39.4,0]}),MainCameraManager.attributes.add("opponentSearchCameraPosition",{type:"vec3",default:[-4.35,3.93,-4.13]}),MainCameraManager.attributes.add("opponentSearchCameraRotation",{type:"vec3",default:[-16.8,-42.85,0]}),MainCameraManager.attributes.add("aiFocusDuration",{type:"number",default:2}),MainCameraManager.attributes.add("playerFocusDuration",{type:"number",default:2}),MainCameraManager.attributes.add("battleFocusDuration",{type:"number",default:.6}),MainCameraManager.attributes.add("aiPlayerLookDuration",{type:"number",default:5}),MainCameraManager.attributes.add("myPlayerLookDuration",{type:"number",default:5}),MainCameraManager.attributes.add("hammerCameraPosition",{type:"vec3",default:[-.52,4.13,16.2]}),MainCameraManager.attributes.add("hammerCameraRotation",{type:"vec3",default:[.458,13,-.052]}),MainCameraManager.getInstance=function(){return MainCameraManager._instance||console.error("AssetsLoader is not initialized yet"),MainCameraManager._instance},MainCameraManager.prototype.initialize=function(){MainCameraManager._app=this.app,MainCameraManager._instance||(MainCameraManager._instance=this),this.cameraRoot=this.entity,this.cameraPivotPositionTween=null,this.cameraPivotRotationTween=null,this.cameraParentPositionTween=null,this.cameraParentRotationTween=null},MainCameraManager.prototype.reset=function(){this.resetLobbyTweens(),this.resetLevelEndTweens(),this.cameraParent.setLocalPosition(pc.Vec3.ZERO),this.cameraParent.setLocalRotation(pc.Quat.IDENTITY),this.cameraPivot.setLocalPosition(pc.Vec3.ZERO),this.cameraPivot.setLocalRotation(pc.Quat.IDENTITY),this.cameraRoot.setLocalPosition(this.rootStartPosition),this.mainCamera.setLocalPosition(this.lobbyCameraPosition),this.mainCamera.setLocalEulerAngles(this.lobbyCameraRotation),this.cameraPivot.setLocalPosition(.18,0,0),this.cameraPivot.setLocalRotation(pc.Quat.IDENTITY),this.cameraParent.setLocalPosition(-1.14,0,0),this.cameraParent.setLocalEulerAngles(0,-10,0)},MainCameraManager.prototype.startLobbyCameraEase=function(){this.reset(),this.cameraParentRotationTween=this.cameraParent.tween(this.cameraParent.getLocalEulerAngles()).rotate({x:0,y:5,z:0},40,pc.SineOut).start()},MainCameraManager.prototype.completeLobbyCameraEase=function(a){Utils.stopTween(this.cameraPivotPositionTween,this.cameraPivotRotationTween,this.cameraParentPositionTween,this.cameraParentRotationTween),PlayerController.getInstance().isLobbyWalk=!0,this.cameraPivotPositionTween=this.cameraPivot.tween(this.cameraPivot.getLocalPosition()).to(pc.Vec3.ZERO,a,pc.SineIn).onComplete((()=>{PlayerController.getInstance().isLobbyWalk=!1})).start(),this.cameraPivotRotationTween=this.cameraPivot.tween(this.cameraPivot.getLocalEulerAngles()).rotate(pc.Vec3.ZERO,a,pc.SineIn).start();this.cameraParent.getLocalPosition();this.cameraParentPositionTween=this.cameraParent.tween(this.cameraParent.getLocalPosition()).to({x:0},a,pc.SineIn).start(),this.cameraParentRotationTween=this.cameraParent.tween(this.cameraParent.getLocalEulerAngles()).rotate(pc.Vec3.ZERO,a,pc.SineIn).start()},MainCameraManager.prototype.translateLobbyToSearchCamera=function(a){Utils.stopTween(this.anzuMainCameraMoveTween,this.anzuMainCameraRotateTween),this.anzuMainCameraMoveTween=this.mainCamera.tween(this.mainCamera.getLocalPosition()).to(this.opponentSearchCameraPosition,a,pc.Linear).start(),this.levelEndRotationTween=this.mainCamera.tween(this.mainCamera.getLocalEulerAngles()).rotate(this.opponentSearchCameraRotation,a,pc.Linear).start()},MainCameraManager.prototype.translateSearchToGameplayCamera=function(a){Utils.stopTween(this.anzuMainCameraMoveTween,this.anzuMainCameraRotateTween),this.anzuMainCameraMoveTween=this.mainCamera.tween(this.mainCamera.getLocalPosition()).to(this.gameplayCameraPosition,a,pc.Linear).start(),this.levelEndRotationTween=this.mainCamera.tween(this.mainCamera.getLocalEulerAngles()).rotate(this.gameplayCameraRotation,a,pc.Linear).start()},MainCameraManager.prototype.resetLobbyTweens=function(){Utils.stopTween(this.cameraPivotPositionTween,this.cameraPivotRotationTween,this.cameraParentPositionTween,this.cameraParentRotationTween)},MainCameraManager.prototype.lookAtAICharacter=function(a){const e=this.cameraPivot.getPosition(),t=a.clone();t.x=a.x,this.cameraParent.setPosition(t),this.cameraPivot.setPosition(e),Utils.stopTween(this.aiPlayerLookTween,this.myPlayerLookTween);const n=this.cameraParent.getLocalEulerAngles();this.aiPlayerLookTween=this.cameraParent.tween(n).rotate({x:0,y:9,z:0},this.aiPlayerLookDuration,pc.Linear).start()},MainCameraManager.prototype.lookAtMyCharacter=function(a){const e=this.cameraPivot.getPosition(),t=a.clone();t.x=a.x,this.cameraParent.setPosition(t),this.cameraPivot.setPosition(e),Utils.stopTween(this.aiPlayerLookTween,this.myPlayerLookTween);const n=this.cameraParent.getLocalEulerAngles();this.myPlayerLookTween=this.cameraParent.tween(n).rotate({x:0,y:0,z:0},this.myPlayerLookDuration,pc.Linear).start()},MainCameraManager.prototype.resetLevelEndTweens=function(){Utils.stopTween(this.aiPlayerLookTween,this.myPlayerLookTween,this.levelEndPositionTween,this.levelEndRotationTween)},MainCameraManager.prototype.handleLevelEndTween=function(a,e,t,n=!1,i=pc.SineOut,o=pc.SineOut){Utils.stopTween(this.levelEndPositionTween,this.levelEndRotationTween);let r=a.getPosition().add(e);n&&(r=new pc.Vec3(0,r.y,r.z));const s=Utils.worldToLocalPosition(this.mainCamera,r);this.levelEndPositionTween=this.mainCamera.tween(this.mainCamera.getLocalPosition()).to(s,t,i).start();const l=Utils.worldToLocalEulerAngles(this.mainCamera,a.getEulerAngles());if(this.levelEndRotationTween=this.mainCamera.tween(this.mainCamera.getLocalEulerAngles()).rotate(l,t,o).start(),n){Utils.stopTween(this.parentPosTween,this.parentRotTween,this.pivotPosTween,this.pivotRotTween);const a=t;this.parentPosTween=this.cameraParent.tween(this.cameraParent.getLocalPosition()).to(pc.Vec3.ZERO,a,pc.Linear).start(),this.parentRotTween=this.cameraParent.tween(this.cameraParent.getLocalEulerAngles()).rotate(pc.Vec3.ZERO,a,pc.Linear).start(),this.pivotPosTween=this.cameraPivot.tween(this.cameraPivot.getLocalPosition()).to(pc.Vec3.ZERO,a,pc.Linear).start(),this.pivotRotTween=this.cameraPivot.tween(this.cameraPivot.getLocalEulerAngles()).rotate(pc.Vec3.ZERO,a,pc.Linear).start()}},MainCameraManager.prototype.zoomFinalOpponentStepA=async function(){this.resetLobbyTweens(),this.resetLevelEndTweens(),this.handleLevelEndTween(PlatformManager.getInstance().aiPosingCameraPos,new pc.Vec3(1,0,1),this.aiFocusDuration),await Utils.wait(1e3*this.aiFocusDuration)},MainCameraManager.prototype.zoomFinalOpponentStepB=async function(){this.lookAtAICharacter(PlatformManager.getInstance().aiTarget.getPosition()),await Utils.wait(1e3*this.aiPlayerLookDuration)},MainCameraManager.prototype.zoomFinalPlayerStepA=async function(){this.resetLobbyTweens(),this.resetLevelEndTweens(),this.handleLevelEndTween(PlatformManager.getInstance().playerPosingCameraPos,new pc.Vec3(-.6,0,1),this.playerFocusDuration),await Utils.wait(1e3*this.playerFocusDuration)},MainCameraManager.prototype.zoomFinalPlayerStepB=async function(){this.lookAtMyCharacter(PlatformManager.getInstance().playerTarget.getPosition()),await Utils.wait(1e3*this.myPlayerLookDuration)},MainCameraManager.prototype.showFinalBattle=async function(){this.resetLobbyTweens(),this.resetLevelEndTweens(),this.handleLevelEndTween(PlatformManager.getInstance().battleCameraPos,new pc.Vec3(0,-.5,0),this.battleFocusDuration),await Utils.wait(1e3*this.battleFocusDuration)},MainCameraManager.prototype.lookAtHammer=async function(a=1){Utils.stopTween(this.levelEndPositionTween,this.levelEndRotationTween),this.levelEndPositionTween=this.mainCamera.tween(this.mainCamera.getLocalPosition()).to(this.hammerCameraPosition,a,pc.SineOut).start(),this.levelEndRotationTween=this.mainCamera.tween(this.mainCamera.getLocalEulerAngles()).rotate(this.hammerCameraRotation,a,pc.SineOut).start(),await Utils.wait(1e3*a)},MainCameraManager.prototype.followPlayerDuringLobbyExit=function(){const a=PlayerController.getInstance().getPlayerPosition(),e=PlayerController.getInstance().getPlayerCharacterPosition();this._followTargetPosition=this._followTargetPosition||new pc.Vec3,this._followTargetPosition.set(a.x,a.y,e.z),this.cameraRoot.setPosition(this._followTargetPosition)},MainCameraManager.prototype.followPlayerDuringGameplay=function(){this.cameraRoot.setPosition(PlayerController.getInstance().getPlayerPosition())},MainCameraManager.prototype.followHammerGameIndicator=function(a,e,t,n){this.levelEndPositionTween=this.mainCamera.tween(this.mainCamera.getLocalPosition()).to({y:a},e,n).delay(t).start()},MainCameraManager.prototype.getCameraWorldPosition=function(){return this.mainCamera.getPosition()},MainCameraManager.prototype.getJuryContainerPosition=function(){return this.juryContainer.getPosition()},MainCameraManager.prototype.getJuryContainerRotation=function(){return this.juryContainer.getRotation()},MainCameraManager.prototype.update=function(a){},MainCameraManager.prototype.postUpdate=function(a){PlayerController.getInstance().isLobbyWalk?this.followPlayerDuringLobbyExit():PlayerController.getInstance().canMove&&this.followPlayerDuringGameplay()};var ParticleSystemTrigger=pc.createScript("particleSystemTrigger");ParticleSystemTrigger.attributes.add("eventKey",{type:"string"}),ParticleSystemTrigger.prototype.initialize=function(){if(!this.eventKey)return console.warn(`Particle System [${this.entity.path}] doesn't have trigger key set`);this.app.on(this.eventKey,this.burstParticles,this)},ParticleSystemTrigger.prototype.burstParticles=function(){this.entity.particlesystem.reset(),this.entity.particlesystem.play()},ParticleSystemTrigger.prototype.update=function(t){};var LevelData=pc.createScript("levelData");function mapEnum(e){var t={},a=[];for(var i in e)if(e.hasOwnProperty(i)){var s={};s[i]=e[i],a.push(s),t[e[i]]=i}return e.toString=function(e){return t[e]},a}const LimitedConcepts={NightClub:"NightClub",Sport:"Sport",Gala:"Gala",Formal:"Formal",Date:"Date",Beach:"Beach",Eighties:"Eighties",PyjamaParty:"PyjamaParty",Bridal:"Bridal",Warrior:"Warrior",Glitter:"Glitter",RockAndRoll:"RockAndRoll",Bohemian:"Bohemian",School:"School",Winter:"Winter",Masculine:"Masculine",Spring:"Spring",Fifties:"Fifties",Teen:"Teen",Christmas:"Christmas"},ClothingType={Hair:"Hair",Dress:"Dress",Top:"Top",Bottom:"Bottom",Shoes:"Shoes",Accessories:"Accessories"};LevelData.attributes.add("presetName",{type:"string",default:""}),LevelData.attributes.add("concept",{name:"concept",type:"string",enum:mapEnum(LimitedConcepts),default:LimitedConcepts.NightClub}),LevelData.attributes.add("clothes",{type:"json",schema:[{name:"clothingType",type:"string",enum:mapEnum(ClothingType),default:ClothingType.Top},{name:"template_A",type:"asset",assetType:"template"},{name:"icon_A",type:"asset",assetType:"texture"},{name:"template_B",type:"asset",assetType:"template"},{name:"icon_B",type:"asset",assetType:"texture"},{name:"template_C",type:"asset",assetType:"template"},{name:"icon_C",type:"asset",assetType:"texture"},{name:"template_Celebrity",type:"asset",assetType:"template"},{name:"icon_Celebrity",type:"asset",assetType:"texture"}],array:!0}),LevelData.prototype.initialize=function(){this.entity.getDataObject=()=>this._prepareDataObject()},LevelData.prototype._prepareDataObject=function(){return{presetName:this.presetName,concept:this.concept,clothes:this.clothes.map((e=>({clothingType:e.clothingType,variants:[{template:e.template_A,icon:e.icon_A},{template:e.template_B,icon:e.icon_B},{template:e.template_C,icon:e.icon_C}],celebrityVariant:{template:e.template_Celebrity,icon:e.icon_Celebrity}})))}},LevelData.prototype.update=function(e){};var LevelStorage=pc.createScript("levelStorage");LevelStorage.attributes.add("startFromOneNotZero",{type:"boolean",title:"Start from 1st not 0",default:!0}),LevelStorage.attributes.add("testLevel",{type:"entity",title:"Test level"}),LevelStorage.attributes.add("levels",{type:"json",schema:[{name:"levelData",type:"entity"}],array:!0}),LevelStorage.getInstance=function(){return LevelStorage._instance||console.error("LevelStorage is not initialized yet"),LevelStorage._instance},LevelStorage.prototype.initialize=function(){LevelStorage._app=this.app,LevelStorage._instance||(LevelStorage._instance=this)},LevelStorage.prototype.getLevelData=function(e){if(this.testLevel)return console.warn("Loading test level: "+this.testLevel.name),this.testLevel.getDataObject();let t=this._findLevelRecord(e);return t||(console.error(`Can not find level '${e}'`),t=this.getRandomLevelData()),t.levelData?t.levelData.getDataObject():(console.error(`No levelData for level '${e}'`),null)},LevelStorage.prototype.getRandomLevelData=function(){if(this.testLevel)return this.testLevel.getDataObject();const e=Utils.getRandomItem(this.levels);return console.log("Fetching random level #"+e.name),e.levelData.getDataObject()},LevelStorage.prototype._findLevelRecord=function(e){return this.startFromOneNotZero?e>=this.levels.length?this.levels[(e-1)%(this.levels.length-1)+1]:this.levels[e]:e>=this.levels.length?this.levels[e%this.levels.length]:this.levels[e]},LevelStorage.prototype._findFallbackLevelRecord=function(e){return this.levels[e%this.levels.length]},LevelStorage.prototype.getLevelsAmount=function(){return this.levels.length},LevelStorage.prototype.update=function(e){};var FeedbackEffect=pc.createScript("feedbackEffect");FeedbackEffect.prototype.initialize=function(){feedbackSpritesContainer=this.entity.findByName("FeedbackSpriteContainer"),this.feedbackImages=feedbackSpritesContainer.children,this.feedbackImagesNames=this.feedbackImages.map((e=>e.name)),this.lastFeedbackImageIndex=Math.floor(Math.random()*this.feedbackImages.length),this.lastFeedbackSprite=null,this.particles=this.entity.findByName("FeedbackParticleSystem").children,this.app.on(EventTypes.SHOW_FEEDBACK_EFFECT,this.showFeedbackEffect,this)},FeedbackEffect.prototype.showFeedbackEffect=async function(e){this.lastFeedbackImageIndex=(this.lastFeedbackImageIndex+1)%this.feedbackImages.length,e=e||this.feedbackImagesNames[this.lastFeedbackImageIndex]||Utils.getRandomItem(this.feedbackImagesNames);const t=this.feedbackImages.find((t=>t.name===e));t&&(this.lastFeedbackSprite=t,this.feedbackImages.forEach((t=>t.enabled=t.name===e)),t.element.opacity=1,t.setLocalScale(.5,.5,.5),t.setLocalPosition(pc.Vec3.ZERO),this.particles.forEach((e=>{e.setPosition(t.getPosition()),e.particlesystem.reset(),e.particlesystem.play()})),this.app.fire(EventTypes.PLAY_SFX,"feedback"+e),this.scaleUpTween=t.tween(t.getLocalScale()).to({x:1.35,y:1.35,z:1.35},.15,pc.SineOut).start(),await Utils.wait(150),this.scaleDownTween=t.tween(t.getLocalScale()).to({x:1,y:1,z:1},.1,pc.SineOut).start(),await Utils.wait(100),await Utils.wait(150),this.movementTween=t.tween(t.getLocalPosition()).to({x:0,y:120,z:0},.8,pc.SineOut).start(),this.disappearingTween=t.tween(t.element).to({opacity:.2},.8,pc.SineIn).onComplete((()=>{t.enabled=!1})).start())},FeedbackEffect.prototype.update=function(e){};var PlatformPart=pc.createScript("platformPart");PlatformPart.prototype.initialize=function(){this.iconsContainer=this.entity.findByName("ClothesIcons"),this.entity.setClothType=this._setClothType.bind(this)},PlatformPart.prototype._setClothType=function(t){this.iconsContainer.children.forEach((o=>o.enabled=o.name===t))},PlatformPart.prototype.update=function(t){};var PlatformManager=pc.createScript("platformManager");PlatformManager.attributes.add("platformPartTemplate",{type:"asset",assetType:"template"}),PlatformManager.attributes.add("platformStartZ",{type:"number",default:5.5}),PlatformManager.attributes.add("platformLength",{type:"number",default:15}),PlatformManager.getInstance=function(){return PlatformManager._instance||console.error("PlatformManager is not initialized yet"),PlatformManager._instance},PlatformManager.prototype.initialize=function(){PlatformManager._app=this.app,PlatformManager._instance||(PlatformManager._instance=this),this.platformsContainer=this.entity.findByName("PlatformParts"),this.platforms=this.platformsContainer.children.slice(),this.podium=this.entity.findByName("Podium"),this.podiumMovable=this.podium.findByName("PodiumMovable"),this.playerTarget=this.entity.findByName("PlayerTargetPosition"),this.aiTarget=this.entity.findByName("AITargetPosition"),this.cameraStartPos=this.entity.findByName("CameraStartPosition"),this.aiPosingCameraPos=this.entity.findByName("AIPosingCameraPosition"),this.playerPosingCameraPos=this.entity.findByName("PlayerPosingCameraPosition"),this.battleCameraPos=this.entity.findByName("BattleCameraPosition"),this.gemCounterPos=this.entity.findByName("GemCounterPosition"),this.hammerPosition=this.entity.findByName("HammerPosition"),this.heartHammerStartPosition=this.entity.findByName("HeartHammerStartPosition"),this.app.on(EventTypes.LEVEL_RESET,this.reset,this)},PlatformManager.prototype.reset=function(){this.podiumMovable.setLocalPosition(pc.Vec3.ZERO)},PlatformManager.prototype.initLevel=function(t){this.clearPlatforms();const a=t.clothes.length;let e=this.platformStartZ;for(let o=0;o<a;o++){e=this.platformStartZ+o*this.platformLength;let a=this.platformPartTemplate.resource.instantiate();this.platformsContainer.addChild(a),this.platforms.push(a),a.setLocalPosition(0,0,e),a.setClothType(t.clothes[o].clothingType)}const o=this.podium.getLocalPosition();o.z=e+this.platformLength,this.podium.setLocalPosition(o),this.podiumMovable.setLocalPosition(pc.Vec3.ZERO)},PlatformManager.prototype.getRoundCheckpoints=function(){const t=[];for(let a=0;a<this.platforms.length;a++){const e=this.platforms[a].getPosition().z+this.platformLength/2;t.push(e)}return t},PlatformManager.prototype.getPodiumZ=function(){return this.podium.getPosition().z},PlatformManager.prototype.getHammerPosition=function(){return this.hammerPosition.getPosition()},PlatformManager.prototype.getHeartHammerStartPosition=function(){return this.heartHammerStartPosition.getPosition()},PlatformManager.prototype.movePodiumYForHammerGame=function(t,a,e,o){this.podiumMovable.tween(this.podiumMovable.getLocalPosition()).to({y:t},a,o).delay(e).start()},PlatformManager.prototype.clearPlatforms=function(){for(let t=this.platforms.length-1;t>-1;t--){const a=this.platforms[t];this.platforms.splice(t,1),a.destroy()}},PlatformManager.prototype.update=function(t){};var Podium=pc.createScript("podium");Podium.prototype.initialize=function(){this.juryPositionsContainer=this.entity.findByName("JuryPositions")},Podium.prototype.update=function(i){};var PlayerController=pc.createScript("playerController");PlayerController.attributes.add("playerLobbyPosition",{type:"vec3",default:[-1.14,1.03,-7]}),PlayerController.attributes.add("playerWalkingPosition",{type:"vec3",default:[-1.14,1.03,0]}),PlayerController.attributes.add("opponentWalkingPosition",{type:"vec3",default:[1.14,1.03,0]}),PlayerController.getInstance=function(){return PlayerController._instance||console.error("PlayerController is not initialized yet"),PlayerController._instance},PlayerController.prototype.initialize=function(){PlayerController._app=this.app,PlayerController._instance||(PlayerController._instance=this),this._intitialControllerPosition=this.entity.getPosition().clone(),this.playersContainer=this.entity.findByName("Players"),this.playerCharacter=this.playersContainer.findByName("basic-character"),this.opponentCharacter=this.playersContainer.findByName("basic-character-opponent"),this.isLobbyWalk=!1,this.canMove=!1},PlayerController.prototype.reset=function(){this.canMove=!1,this.isLobbyWalk=!1,this.playersContainer.setLocalPosition(pc.Vec3.ZERO),this.playerCharacter.reset(),this.opponentCharacter.reset(),this.playerCharacter.setLocalPosition(this.playerLobbyPosition),this.opponentCharacter.setLocalPosition(this.opponentWalkingPosition),this.playerCharacter.clearAllClothes(),this.opponentCharacter.clearAllClothes(),this.playerCharacter.playIdleAnim(),this.opponentCharacter.playPosingAnim()},PlayerController.prototype.getPlayerCharacter=function(){return this.playerCharacter},PlayerController.prototype.getOpponentCharacter=function(){return this.opponentCharacter},PlayerController.prototype.getOffsetZ=function(){return this._intitialControllerPosition.z},PlayerController.prototype.getPlayerCharacterPosition=function(){return this.playerCharacter.getPosition()},PlayerController.prototype.getOpponentCharacterPosition=function(){return this.opponentCharacter.getPosition()},PlayerController.prototype.getPlayerPosition=function(){return this.playersContainer.getPosition()},PlayerController.prototype.moveForward=function(t){this.playersContainer.translateLocal(0,0,t)},PlayerController.prototype.walkFromLobby=async function(t=1.25){return new Promise(((e,r)=>{this.playerCharacter.playWalkingAnim(),this.playerCharacter.tween(this.playerCharacter.getLocalPosition()).to(this.playerWalkingPosition,t,pc.Linear).onComplete((()=>{e()})).start()}))},PlayerController.prototype.walkToPodium=async function(t=2){return new Promise(((e,r)=>{this.playerCharacter.playWalkingAnim(),this.opponentCharacter.playWalkingAnim(),this.playerCharacter.tween(this.playerCharacter.getLocalPosition()).to(Utils.worldToLocalPosition(this.playerCharacter,PlatformManager.getInstance().playerTarget.getPosition()),t,pc.SineOut).onComplete((()=>{e()})).start(),this.opponentCharacter.tween(this.opponentCharacter.getLocalPosition()).to(Utils.worldToLocalPosition(this.playerCharacter,PlatformManager.getInstance().aiTarget.getPosition()),t,pc.SineOut).start(),Utils.wait(1e3*t*.75).then((()=>{this.playerCharacter.playFinalIdleAnim(),this.opponentCharacter.playFinalIdleAnim()}))}))},PlayerController.prototype.movePlayerToHammerGame=async function(t=1){return new Promise(((e,r)=>{this.playerCharacter.playIdleAnim(),this.playerCharacter.tween(this.playerCharacter.getLocalPosition()).to({x:-.75},t,pc.SineOut).onComplete((()=>{e()})).start()}))},PlayerController.prototype.movePlayerUpWithPodium=function(t,e,r,o){this.playerCharacter.playFinalDanceAnim(),this.playerCharacter.tween(this.playerCharacter.getLocalPosition()).to({y:t},e,o).delay(r).start()},PlayerController.prototype.update=function(t){};var JuryHand=pc.createScript("juryHand");JuryHand.prototype.initialize=function(){this.pointsBlock=this.entity.findByName("PointsBlock"),this.pointsText=this.pointsBlock.findByName("PointsCounter"),this.entity.show=this._show.bind(this),this.entity.hide=this._hide.bind(this),this._hide(!0)},JuryHand.prototype._show=async function(t,e=0){this._resetTweens(),this.entity.enabled=!1,this.pointsBlock.setLocalEulerAngles(0,0,180),this.entity.setLocalScale(.5,.5,.5),await Utils.wait(1e3*e),this.entity.enabled=!0,this.pointsText.element.text=`${t}`,this.entity.anim.reset(),this.entity.anim.setTrigger("show"),this.pointsBlock.tween(this.pointsBlock.getLocalEulerAngles()).rotate(pc.Vec3.ZERO,.7,pc.SineOut).start(),this.entity.tween(this.entity.getLocalScale()).to(pc.Vec3.ONE,.25,pc.SineOut).start()},JuryHand.prototype._hide=async function(t=!1,e=0){t?(this.entity.enabled=!1,this._resetTweens()):(await Utils.wait(1e3*e),this.entity.anim.setTrigger("hide"),this.pointsBlock.tween(this.pointsBlock.getLocalEulerAngles()).rotate({x:0,y:0,z:180},.4,pc.SineOut).start(),this.entity.tween(this.entity.getLocalScale()).to({x:.5,y:.5,z:.5},.4,pc.SineOut).start(),await Utils.wait(400),this.entity.enabled=!1)},JuryHand.prototype._resetTweens=function(){this.app.stopAllTweens(this.entity),this.app.stopAllTweens(this.pointsBlock),this.entity.anim.reset()},JuryHand.prototype.update=function(t){};var JuryController=pc.createScript("juryController");JuryController.attributes.add("emojiIcons",{type:"json",schema:[{name:"name",type:"string"},{name:"icon",type:"asset",assetType:"texture"}],array:!0}),JuryController.getInstance=function(){return JuryController._instance||console.error("JuryController is not initialized yet"),JuryController._instance},JuryController.prototype.initialize=function(){JuryController._app=this.app,JuryController._instance||(JuryController._instance=this),this.handsContainer=this.entity.findByName("HandsContainer"),this.hands=this.handsContainer.children.slice()},JuryController.prototype.showJuryPoints=async function(t,o=1.8,i=1.5){const e=[];this.hands.forEach(((i,s)=>{e.push(i.show(t[s],s*o/3))})),await Promise.all(e),await Utils.wait(1e3*i),await this.hideJuryPoints()},JuryController.prototype.hideJuryPoints=async function(){const t=[];this.hands.forEach(((o,i)=>{t.push(o.hide(!1,.2*i))})),await Promise.all(t)},JuryController.prototype.splitScoreIntoThreePoints=function(t){t=Math.floor(pc.math.clamp(t,3,30));const o=[0,0,0];for(let i=0;i<3;i++)o[i]+=1,t-=1;for(;t>0;){const i=o.map(((t,o)=>t<10?o:-1)).filter((t=>-1!==t));o[Utils.getRandomItem(i)]+=1,t-=1}return o},JuryController.prototype.reset=function(){this.hands.forEach((t=>t.hide(!0))),this._initEmojies()},JuryController.prototype.update=function(t){},JuryController.prototype.postUpdate=function(t){this.handsContainer.setPosition(MainCameraManager.getInstance().getJuryContainerPosition()),this.handsContainer.setRotation(MainCameraManager.getInstance().getJuryContainerRotation())},JuryController.prototype._initEmojies=function(){if(this.__emojiiesInitialized)return;this.__emojiiesInitialized=!0;const t=PlayerController.getInstance().getPlayerCharacter().getEmojiesContainer(),o=PlayerController.getInstance().getOpponentCharacter().getEmojiesContainer();this.playerHatEmoji=t.findByName("HatEmoji"),this.playerGlassesEmoji=t.findByName("GlassEmoji"),this.playerNecklaceEmoji=t.findByName("NecklaceEmoji"),this.playerGlovesEmoji=t.findByName("GloveEmoji"),this.playerHairEmoji=t.findByName("HairEmoji"),this.playerTopHalfEmoji=t.findByName("TopEmoji"),this.playerDressEmoji=t.findByName("DressEmoji"),this.playerBottomHalfEmoji=t.findByName("BottomEmoji"),this.playerShoesEmoji=t.findByName("ShoeEmoji"),this.botHatEmoji=o.findByName("HatEmoji"),this.botGlassesEmoji=o.findByName("GlassEmoji"),this.botNecklaceEmoji=o.findByName("NecklaceEmoji"),this.botGlovesEmoji=o.findByName("GloveEmoji"),this.botHairEmoji=o.findByName("HairEmoji"),this.botTopHalfEmoji=o.findByName("TopEmoji"),this.botDressEmoji=o.findByName("DressEmoji"),this.botBottomHalfEmoji=o.findByName("BottomEmoji"),this.botShoesEmoji=o.findByName("ShoeEmoji")},JuryController.prototype.hideEmoji=function(t){t.hide()},JuryController.prototype.hideAllEmojies=function(){this.hideEmoji(this.playerHatEmoji),this.hideEmoji(this.playerGlassesEmoji),this.hideEmoji(this.playerNecklaceEmoji),this.hideEmoji(this.playerGlovesEmoji),this.hideEmoji(this.playerHairEmoji),this.hideEmoji(this.playerTopHalfEmoji),this.hideEmoji(this.playerDressEmoji),this.hideEmoji(this.playerBottomHalfEmoji),this.hideEmoji(this.playerShoesEmoji),this.hideEmoji(this.botHatEmoji),this.hideEmoji(this.botGlassesEmoji),this.hideEmoji(this.botNecklaceEmoji),this.hideEmoji(this.botGlovesEmoji),this.hideEmoji(this.botHairEmoji),this.hideEmoji(this.botTopHalfEmoji),this.hideEmoji(this.botDressEmoji),this.hideEmoji(this.botBottomHalfEmoji),this.hideEmoji(this.botShoesEmoji)},JuryController.prototype.judgeCharacterOutfit=async function(t){const o=t.isPlayer(),i=t.getEquippedClothesCorrectness(),e=[Constants.ClothingType.Top,Constants.ClothingType.Dress,Constants.ClothingType.Bottom,Constants.ClothingType.Hair,Constants.ClothingType.Accessories,Constants.ClothingType.Shoes],s=[];let n=0;e.forEach((t=>{if(i.has(t)){const e=i.get(t),a=e===Constants.ChoiceCorrectness.Good?this.emojiIcons.find((t=>"perfect"===t.name)):this.emojiIcons.find((t=>"null"===t.name));let r=null;switch(t){case Constants.ClothingType.Top:r=o?this.playerTopHalfEmoji:this.botTopHalfEmoji;break;case Constants.ClothingType.Dress:r=o?this.playerDressEmoji:this.botDressEmoji;break;case Constants.ClothingType.Bottom:r=o?this.playerBottomHalfEmoji:this.botBottomHalfEmoji;break;case Constants.ClothingType.Hair:r=o?this.playerHatEmoji:this.botHatEmoji;break;case Constants.ClothingType.Accessories:r=o?this.playerGlovesEmoji:this.botGlovesEmoji;break;case Constants.ClothingType.Shoes:r=o?this.playerShoesEmoji:this.botShoesEmoji}r&&(r.setTextureAsset(a.icon),s.push(r));let h=0;e===Constants.ChoiceCorrectness.Good?h=pc.math.random(9,10):e===Constants.ChoiceCorrectness.Bad?h=pc.math.random(2,7):e===Constants.ChoiceCorrectness.Empty&&(h=pc.math.random(1,4)),n+=h}})),s.forEach(((t,o)=>{t.show(.2*o)}));const a=10*i.size;return n/a*30};var Emoji=pc.createScript("emoji");Emoji.prototype.initialize=function(){this.line=this.entity.findByName("LineSprite"),this.icon=this.entity.findByName("IconEmoji"),this.entity.setTextureAsset=this._setTextureAsset.bind(this),this.entity.show=this._show.bind(this),this.entity.hide=this._hide.bind(this),this._hide(!0)},Emoji.prototype._setTextureAsset=function(t){t&&(this.icon.element.textureAsset=t.id)},Emoji.prototype._show=async function(t=0,e=null){this._setTextureAsset(e),await Utils.wait(1e3*t);this.entity.setLocalScale(pc.Vec3.ZERO),this.entity.tween(this.entity.getLocalScale()).to(pc.Vec3.ONE,.5,pc.BackOut).start(),[this.line,this.icon].forEach((t=>{t.element.opacity=0,t.tween(t.element).to({opacity:1},.2,pc.Linear).start()}))},Emoji.prototype._hide=function(t=!1){t?(this.line.element.opacity=0,this.icon.element.opacity=0):[this.line,this.icon].forEach((t=>{t.tween(t.element).to({opacity:0},.2,pc.Linear).start()}))},Emoji.prototype.update=function(t){};var GemCounter=pc.createScript("gemCounter");GemCounter.attributes.add("tweenValues",{type:"boolean",default:!0}),GemCounter.attributes.add("tweenDuration",{type:"number",default:.5}),GemCounter.getInstance=function(){return GemCounter._instance||console.error("GemCounter is not initialized yet"),GemCounter._instance},GemCounter.prototype.initialize=function(){GemCounter._app=this.app,GemCounter._instance||(GemCounter._instance=this),this.gemsContainer=this.entity.findByName("GemContainer"),this.iconGems=this.gemsContainer.findByName("GemIcon"),this.textGems=this.gemsContainer.findByName("GemAmountText"),this.collectablesSpawnerGems=this.entity.findByName("CollectablesSpawner_Gems"),this.app.on(EventTypes.GEMS_AMOUNT_CHANGED,this._updateGems,this),this._gemsValue=0},GemCounter.prototype.postInitialize=function(){this._updateGems(DataManager.getInstance().gems),this.show()},GemCounter.prototype.show=function(){return new Promise(((e,t)=>{this.entity.enabled=!0,this.collectablesSpawnerGems.clear(),this.gemsContainer.fire(EventTypes.UI_ELEMENT.APPEAR_MANUALLY),this.gemsContainer.once(EventTypes.UI_ELEMENT.APPEARED,(()=>e()))}))},GemCounter.prototype.hide=function(){return new Promise(((e,t)=>{this.collectablesSpawnerGems.clear(),this.gemsContainer.fire(EventTypes.UI_ELEMENT.DISAPPEAR),this.gemsContainer.once(EventTypes.UI_ELEMENT.DISAPPEARED,(()=>e()))}))},GemCounter.prototype.spawnAndPickupGems=async function(e,t,n=1.25){if(!t)return Promise.resolve();if(this.tweenValues){const e=Math.max(n-this.tweenDuration/2);Utils.wait(1e3*e).then((()=>{DataManager.getInstance().gems+=t,LocalStorageController.save()}))}else DataManager.getInstance().gems+=t,LocalStorageController.save();return this.collectablesSpawnerGems.collect(e,this.iconGems.getPosition(),t,n)},GemCounter.prototype._updateGems=function(e){if(e!==this._gemsValue||!this._gemsValue){const t=this._gemsValue;this._gemsValue=e,this.tweenValues?Utils.tweenText(this.textGems,t,this._gemsValue,this.tweenDuration,0,pc.Linear,!0):this.textGems.element.text=`${e}`}},GemCounter.prototype.update=function(e){};var CollectablesSpawner=pc.createScript("collectablesSpawner");CollectablesSpawner.attributes.add("limitAmount",{type:"vec2",default:[0,25]}),CollectablesSpawner.attributes.add("visualAmountModifier",{type:"number",default:.5,min:.01,max:1}),CollectablesSpawner.attributes.add("spawnRadius",{type:"number",default:100}),CollectablesSpawner.attributes.add("startAngle",{type:"number",default:0}),CollectablesSpawner.attributes.add("randomizeStartAngle",{type:"number",default:0}),CollectablesSpawner.attributes.add("endAngle",{type:"number",default:0}),CollectablesSpawner.attributes.add("randomizeEndAngle",{type:"number",default:0}),CollectablesSpawner.attributes.add("startScale",{type:"number",default:1.5}),CollectablesSpawner.attributes.add("randomizeStartScale",{type:"number",default:0}),CollectablesSpawner.attributes.add("endScale",{type:"number",default:.5}),CollectablesSpawner.attributes.add("randomizeEndScale",{type:"number",default:0}),CollectablesSpawner.attributes.add("durationAppearDelayWeight",{type:"number",default:.1}),CollectablesSpawner.attributes.add("durationSpawnWeight",{type:"number",default:.5}),CollectablesSpawner.attributes.add("durationDelayWeight",{type:"number",default:.1}),CollectablesSpawner.attributes.add("durationMovementWeight",{type:"number",default:.75}),CollectablesSpawner.attributes.add("durationRandomWeight",{type:"number",default:.1}),CollectablesSpawner.prototype.initialize=function(){this.sampleIcon=this.entity.findByName("SampleIcon"),this._iconInitialScale=this.sampleIcon.getLocalScale().clone(),this._iconInitialAngles=this.sampleIcon.getLocalEulerAngles().clone(),this._iconInitialPosition=this.sampleIcon.getLocalPosition().clone(),this.sampleIcon.enabled=!1,this.iconsCache=[this.sampleIcon],this.entity.collect=this._collect.bind(this),this.entity.clear=this._clear.bind(this)},CollectablesSpawner.prototype._clear=function(){this.entity.children.forEach((t=>{t!==this.sampleIcon&&this._disposeIcon(t)}))},CollectablesSpawner.prototype._collect=function(t,e,a,n){return new Promise(((i,l)=>{const o=pc.math.clamp(a*this.visualAmountModifier,this.limitAmount.x,this.limitAmount.y);if(0===o)return void i();const s=this.durationAppearDelayWeight+this.durationSpawnWeight+this.durationDelayWeight+this.durationMovementWeight+this.durationRandomWeight;let c=n*this.durationAppearDelayWeight/s,r=n*this.durationSpawnWeight/s,d=n*this.durationDelayWeight/s,p=n*this.durationMovementWeight/s,h=n*this.durationRandomWeight/s;h*=.5;const u=[];for(let a=0;a<o;a++){const a=this._instantiateIcon();a.element.opacity=0,a.enabled=!0,a.setPosition(t);const n=a.getLocalPosition(),i=this.startAngle+pc.math.random(.5*-this.randomizeStartAngle,.5*this.randomizeStartAngle);a.rotateLocal(0,0,i);const l=this.startScale+pc.math.random(.5*-this.randomizeStartScale,.5*this.randomizeStartScale);a.setLocalScale(.5*l,.5*l,.5*l);const o=pc.math.random(-Math.PI,Math.PI),s=pc.math.random(0,this.spawnRadius),m=new pc.Vec3(n.x+Math.sin(o)*s,n.y+Math.cos(o)*s,n.z),b=Math.max(0,c+pc.math.random(0,2*h)),S=Math.max(.001,r+pc.math.random(-h,h)),y=Math.max(.001,p+pc.math.random(-h,h)),w=Math.max(0,d+pc.math.random(-h,h)),g=this.endScale+pc.math.random(.5*-this.randomizeEndScale,.5*this.randomizeEndScale),C=this.endAngle+pc.math.random(.5*-this.randomizeEndAngle,.5*this.randomizeEndAngle),I=Utils.worldToLocalPosition(a,e),f=this._animateIconSpawning(a,b,S,l,m).then((async()=>{await this._animateIconFlying(a,w,y,g,I,C),this._disposeIcon(a)}));u.push(f)}Promise.all(u).then((()=>i()))}))},CollectablesSpawner.prototype._instantiateIcon=function(){if(this.iconsCache.length>0)return this.iconsCache.pop();{const t=this.sampleIcon.clone();return t.reparent(this.sampleIcon.parent),t.setLocalScale(this._iconInitialScale),t.setLocalPosition(this._iconInitialPosition),t.setLocalEulerAngles(this._iconInitialAngles),t}},CollectablesSpawner.prototype._disposeIcon=function(t){-1===this.iconsCache.indexOf(t)&&(this.iconsCache.push(t),t.element.opacity=0,this.app.stopAllTweens(t),t.enabled=!1,t.setLocalScale(this._iconInitialScale),t.setLocalPosition(this._iconInitialPosition),t.setLocalEulerAngles(this._iconInitialAngles))},CollectablesSpawner.prototype._animateIconSpawning=function(t,e,a,n,i){return new Promise(((l,o)=>{t.tween(t.element).to({opacity:1},.5*a,pc.Linear).delay(e).start(),t.tween(t.getLocalScale()).to({x:n,y:n,z:n},a,pc.BackOut).delay(e).start(),t.tween(t.getLocalPosition()).to(i,a,pc.QuarticOut).delay(e).onComplete((()=>l())).start()}))},CollectablesSpawner.prototype._animateIconFlying=function(t,e,a,n,i,l){return new Promise(((o,s)=>{t.tween(t.element).to({opacity:1},.5*a,pc.Linear).delay(e).start(),t.tween(t.getLocalScale()).to({x:n,y:n,z:n},a,pc.CubicIn).delay(e).start(),t.tween(t.getLocalEulerAngles()).to({x:0,y:0,z:l},a,pc.CubicIn).delay(e).start(),t.tween(t.getLocalPosition()).to(i,a,pc.QuadraticIn).delay(e).onComplete((()=>o())).start()}))},CollectablesSpawner.prototype.update=function(t){};class ScreenDefeat extends BaseWindow{initialize(){super.initialize(),this.buttonTryAgain=this.entity.findByName("ButtonTryAgain"),this.buttonTryAgain.on(EventTypes.BUTTON_PRESSED,this.onTryAgainPressed,this)}_initComponents(){super._initComponents()}_onShow(){super._onShow(),this.app.fire(EventTypes.PLAY_SFX,"defeat"),this.buttonTryAgain.enabled=!1,Utils.wait(1250).then((()=>{this.buttonTryAgain.setAvailable(!0),this.buttonTryAgain.enabled=!0,this.buttonTryAgain.fire(EventTypes.UI_ELEMENT.APPEAR_MANUALLY)}))}_onAppeared(){}_onHide(){super._onHide()}update(e){}onTryAgainPressed(){this.buttonTryAgain.enabled=!1,this.buttonTryAgain.setAvailable(!1),LevelController.getInstance().exitToMainMenu()}}pc.registerScript(ScreenDefeat,"screenDefeat");var FamobiSafeArea=pc.createScript("famobiSafeArea");FamobiSafeArea.attributes.add("forceBodyBackgroundColor",{type:"boolean",default:!0,title:"Change <body> background",default:!0}),FamobiSafeArea.attributes.add("bodyBackgroundColor",{type:"rgba",title:"Body Background Color",description:"Background color of body element (where the banner should be displayed). Make sure the checkbox above is checked!",default:[0,0,0,1]}),FamobiSafeArea.attributes.add("debugConfig",{type:"json",title:"Debug / Testing Mode",description:"Force safe areas to be applied to the UI. Useful testing layouts without a device.",schema:[{name:"enabled",type:"boolean",default:!1},{name:"top",type:"number",default:0},{name:"bottom",type:"number",default:0},{name:"left",type:"number",default:0},{name:"right",type:"number",default:0}]}),FamobiSafeArea.prototype.initialize=function(){this.app.graphicsDevice.on("resizecanvas",this._onCanvasResize,this),this.on("attr:debugConfig",(function(e,t){this._updateCanvasSizeAndPosition()}),this),this.on("attr:bodyBackgroundColor",(function(e,t){this._backgroundColorUpdate()}),this),this.on("destroy",(function(){this.app.graphicsDevice.off("resizecanvas",this._onCanvasResize,this)}),this),window.GameInterface&&"function"==typeof window.GameInterface.onOffsetChange?window.GameInterface.onOffsetChange((e=>this._onCanvasResize())):window.famobi&&"function"==typeof window.famobi.onOffsetChange&&window.famobi.onOffsetChange((e=>this._onCanvasResize())),window.visualViewport?(this.useVisualViewport=!0,window.visualViewport.addEventListener("resize",this._onCanvasResize.bind(this))):(this.useVisualViewport=!1,window.addEventListener("resize",this._onCanvasResize.bind(this),!0)),this._onCanvasResize(),this.app.getFamobiAdjustedCanvasSize=()=>({width:this._currentCanvasWidth,height:this._currentCanvasHeight})},FamobiSafeArea.prototype._onCanvasResize=function(){this._updateCanvasSizeAndPosition(),(pc.platform.ios||pc.platform.mobile)&&setTimeout((()=>this._updateCanvasSizeAndPosition()),1500)},FamobiSafeArea.prototype._updateCanvasSizeAndPosition=function(){let e=0,t=0,i=0,a=0;if(this.debugConfig.enabled)e=this.debugConfig.top,t=this.debugConfig.bottom,i=this.debugConfig.left,a=this.debugConfig.right;else{let o={left:0,top:0,right:0,bottom:0};window.GameInterface&&window.GameInterface.getOffsets?o=window.GameInterface.getOffsets():window.famobi&&window.famobi.getOffsets&&(o=window.famobi.getOffsets()),e=o.top,t=o.bottom,i=o.left,a=o.right}const o=this.useVisualViewport?window.visualViewport.height:window.innerHeight,n=this.useVisualViewport?window.visualViewport.width:window.innerWidth;i=Math.min(.9*n,i),a=Math.min(.9*n,a),e=Math.min(.9*o,e),t=Math.min(.9*o,t);const s=n-i-a,r=o-e-t;this._currentCanvasWidth=s,this._currentCanvasHeight=r,this.app.setCanvasResolution(pc.RESOLUTION_FIXED,s,r),this.app.graphicsDevice.canvas.style.width=s+"px",this.app.graphicsDevice.canvas.style.height=r+"px",this.app.graphicsDevice.canvas.style.left=i+"px",this.app.graphicsDevice.canvas.style.right=a+"px",this.app.graphicsDevice.canvas.style.top=e+"px",this.app.graphicsDevice.canvas.style.bottom=t+"px",this.debugConfig.enabled&&console.log(`Canvas size set to ${s}x${r} (window ${window.innerWidth}x${window.innerHeight})`),this.app.fire("famobi:resizeCanvas",s,r),this._backgroundColorUpdate()},FamobiSafeArea.prototype._backgroundColorUpdate=function(){if(!this.forceBodyBackgroundColor)return;const e=this.app.graphicsDevice.canvas.parentElement;e&&(e.style.background=this.bodyBackgroundColor.toString())},FamobiSafeArea.prototype.update=function(e){},pc.CameraComponent.prototype.screenToWorld=function(e,t,i,a){const o=this.system.app.graphicsDevice,n=o.width/o.maxPixelRatio,s=o.height/o.maxPixelRatio;return this._camera.screenToWorld(e,t,i,n,s,a)},pc.CameraComponent.prototype.worldToScreen=function(e,t){const i=this.system.app.graphicsDevice,a=i.width/i.maxPixelRatio,o=i.height/i.maxPixelRatio;return this._camera.worldToScreen(e,a,o,t)};var PauseOverlay=pc.createScript("pauseOverlay");PauseOverlay.prototype.initialize=function(){},PauseOverlay.prototype.postInitialize=function(){this.setPaused(APIMediator.isPaused()),APIMediator.onPauseStateChange((e=>{this.setPaused(e)}))},PauseOverlay.prototype.setPaused=function(e){this.entity.element.enabled=e,this.app.timeScale=e?0:1},PauseOverlay.prototype.update=function(e){};var StarsCounter=pc.createScript("starsCounter");StarsCounter.prototype.initialize=function(){this.characterNameText=this.entity.findByName("CharacterNameText"),this.starsAmountText=this.entity.findByName("StarsAmountText"),this.entity.setPlayerName=this._setPlayerName.bind(this),this.entity.show=this._show.bind(this),this.entity.hide=this._hide.bind(this),this._hide(!0)},StarsCounter.prototype._setPlayerName=function(t){this.characterNameText.element.text=t},StarsCounter.prototype._show=async function(t){this.entity.enabled=!0,Utils.tweenText(this.starsAmountText,0,t,.75,0,pc.Linear,!0),this.entity.setLocalScale(pc.Vec3.ZERO),this.entity.tween(this.entity.getLocalScale()).to(pc.Vec3.ONE,.5,pc.BackOut).start()},StarsCounter.prototype._hide=function(t=!1){t?(this.entity.setLocalScale(pc.Vec3.ZERO),this.entity.enabled=!1):this.entity.tween(this.entity.getLocalScale()).to(pc.Vec3.ZERO,.1,pc.SineOut).onComplete((()=>{this.entity.enabled=!1})).start()},StarsCounter.prototype.update=function(t){};var ToggleButton=pc.createScript("toggleButton");ToggleButton.attributes.add("iconCross",{type:"entity"}),ToggleButton.prototype.initialize=function(){if(!this.iconCross)return console.error("Set cross icon on toggle button "+this.entity.path);this.entity.setToggle=this._setToggle.bind(this),this.entity.getToggleState=this._getToggleState.bind(this),this._setToggle(!0)},ToggleButton.prototype._setToggle=function(t){this._toggleState=t,this.iconCross.enabled=!this._toggleState},ToggleButton.prototype._getToggleState=function(){return this._toggleState=toggle},ToggleButton.prototype.update=function(t){};class PopupSettings extends BaseWindow{initialize(){super.initialize(),this.settingsPanel=this.entity.findByName("SettingsPanel"),this.buttonClose=this.settingsPanel.findByName("CloseButton"),this.buttonSound=this.entity.findByName("SoundButton"),this.buttonMusic=this.entity.findByName("MusicButton"),this.buttonVibration=this.entity.findByName("VibrationButton"),this.buttonPrivacyPolicy=this.entity.findByName("PrivacyPolicyButton"),this.buttonSound.on(EventTypes.BUTTON_PRESSED,this.onSoundPressed,this),this.buttonMusic.on(EventTypes.BUTTON_PRESSED,this.onMusicPressed,this),this.buttonVibration.on(EventTypes.BUTTON_PRESSED,this.onVibrationPressed,this),this.buttonPrivacyPolicy.on(EventTypes.BUTTON_PRESSED,this.onPrivacyPolicyPressed,this),BasicButton.assignAction(this.buttonClose,this.onClosePressed,this),this.app.on(EventTypes.SOUND_STATE_CHANGED,this.updateSoundButtons,this),this.app.on(EventTypes.MUSIC_STATE_CHANGED,this.updateSoundButtons,this)}_initComponents(){super._initComponents()}_onShow(){super._onShow(),this.updateButtonsVisibility(),this.updateSoundButtons(),this.updateVibrationButton()}_onAppeared(){}_onHide(){super._onHide()}onSoundPressed(){SoundController.sfxEnabled?this.app.fire(EventTypes.DISABLE_SFX):this.app.fire(EventTypes.ENABLE_SFX),this.updateSoundButtons(),this.reportVolumeChangedToAPI()}onMusicPressed(){SoundController.musicEnabled?this.app.fire(EventTypes.DISABLE_MUSIC):this.app.fire(EventTypes.ENABLE_MUSIC),this.updateSoundButtons(),this.reportVolumeChangedToAPI()}onVibrationPressed(){const t=VibrationManager.getInstance().isVibrationEnabled();VibrationManager.getInstance().setVibrationEnabled(!t),this.updateVibrationButton()}onPrivacyPolicyPressed(){window.open("https://famobi.com/privacy")}onClosePressed(){this.entity.hide()}updateButtonsVisibility(){this.buttonVibration.enabled=VibrationManager.getInstance().isVibrationSupported()&&GameConfig.getAttribute("UI","enableVibration"),this.buttonPrivacyPolicy.enabled=GameConfig.getAttribute("UI","enablePrivacyPolicy"),this.buttonSound.enabled=APIMediator.areAudioControlsAllowed(),this.buttonMusic.enabled=APIMediator.areAudioControlsAllowed()}updateSoundButtons(){this.buttonSound.setToggle(SoundController.sfxEnabled),this.buttonMusic.setToggle(SoundController.musicEnabled)}updateVibrationButton(){this.buttonVibration.setToggle(VibrationManager.getInstance().isVibrationEnabled())}update(t){}reportVolumeChangedToAPI(){window.famobi_analytics&&famobi_analytics.trackEvent(window.famobi_analytics.EVENT_VOLUMECHANGE,{bgmVolume:+SoundController.musicVolume.toFixed(2),sfxVolume:+SoundController.sfxVolume.toFixed(2)})}}pc.registerScript(PopupSettings,"popupSettings");var HammerController=pc.createScript("hammerController");HammerController.getInstance=function(){return HammerController._instance||console.error("HammerController is not initialized yet"),HammerController._instance},HammerController.prototype.initialize=function(){HammerController._app=this.app,HammerController._instance||(HammerController._instance=this),this.hammer=this.entity.findByName("Hammer_EndGame"),this.topContainer=this.entity.findByName("TopContainer"),this.cityNameContainer=this.topContainer.findByName("CityNameContainer"),this.hammerButton=this.hammer.findByName("button_hammer"),this.innerHeartContainer=this.entity.findByName("HeartContainer"),this.innerHeart=this.innerHeartContainer.findByName("heart"),this.innerHeartLikesText=this.innerHeartContainer.findByName("HeartLikesText"),this._heartContainerInitialPosition=this.innerHeartContainer.getLocalPosition().clone(),this.smokeExplosionsContainer=this.entity.findByName("SmokeExplosionContainer"),this.muzzleParticlesContainer=this.entity.findByName("MuzzleParticleSystem"),this.confettiParticlesContainer=this.entity.findByName("ConfettiParticlesSystemContainer"),this.checkpointsContainer=this.entity.findByName("Checkpoints"),this.scaleSystem=this.entity.findByName("ScaleSystem"),this.bottom=this.entity.findByName("00_bottom"),this.lastRecordIndicator=this.entity.findByName("LastRecordIndicator"),this.progressContainer=this.entity.findByName("Progress"),this.progressBar=this.progressContainer.findByName("ProgressBar"),this.checkpointStartY=10,this.checkpointStep=5,this.totalHeight=25,this._lastRecordValue=0,this.app.on(EventTypes.SET_NEXT_CITY,this._onNextCityRequested,this)},HammerController.prototype.postInitialize=function(){this.hammer.enabled=!1},HammerController.prototype.update=function(t){},HammerController.prototype._updateLastRecordPosition=function(t){const e=this.lastRecordIndicator.getLocalPosition();e.y=Math.max(e.y,t),this.lastRecordIndicator.setLocalPosition(e)},HammerController.prototype.show=function(){this.hammer.enabled=!0,this.innerHeartLikesText.element.text=`${LikesManager.getInstance().getLikesAmountHumanizedText()}`,this.progressContainer.setLocalPosition(pc.Vec3.ZERO),this.muzzleParticlesContainer.children.forEach((t=>{t.particlesystem.stop()}));const t=PlatformManager.getInstance().getHammerPosition();this.entity.setPosition(t);const e=this.entity.getLocalPosition().clone();this.entity.translateLocal(-7.5,0,5),this.entity.tween(this.entity.getLocalPosition()).to(e,1,pc.SineOut).start(),this._preloadAudio(),this.innerHeartContainer.enabled=!1,this._calculateData();const i=this.lastRecordIndicator.getLocalPosition(),n=DataManager.getInstance().getNeededLikesForNextChapter(),a=this.totalHeight-this.checkpointStartY;i.y=this.checkpointStartY+this._lastRecordValue/n*a,this.lastRecordIndicator.setLocalPosition(i)},HammerController.prototype._preloadAudio=function(){AssetsLoader.getInstance().loadByTag("hammer_audio")},HammerController.prototype._calculateData=function(){const t=DataManager.getInstance().getNeededLikesForNextChapter();let e=50;for(;t/e>20;)e+=50;const i=t/e;this.totalHeight=this.checkpointStartY+i*this.checkpointStep,this._buildCheckpoints(i,e,this.totalHeight)},HammerController.prototype.playHeartJumpingAnimation=async function(){this.innerHeartContainer.setPosition(PlatformManager.getInstance().getHeartHammerStartPosition()),this.innerHeartContainer.enabled=!0,this.innerHeartContainer.setLocalScale(pc.Vec3.ZERO),this.innerHeartContainer.tween(this.innerHeartContainer.getLocalScale()).to(pc.Vec3.ONE,.3,pc.BackOut).start();const t=.8;this.innerHeart.anim.reset(),this.innerHeart.anim.setTrigger("jump_heart",!0),Utils.wait(300).then((()=>{this.innerHeartContainer.tween(this.innerHeartContainer.getLocalPosition()).to({x:this._heartContainerInitialPosition.x,z:this._heartContainerInitialPosition.z},t,pc.SineInOut).start(),this.innerHeartContainer.tween(this.innerHeartContainer.getLocalPosition()).to({y:this._heartContainerInitialPosition.y+10},.5,pc.SineOut).start(),Utils.wait(500).then((()=>{this.innerHeartContainer.tween(this.innerHeartContainer.getLocalPosition()).to({y:this._heartContainerInitialPosition.y},.375*t,pc.SineIn).start()}))})),Utils.wait(150).then((()=>{this.app.fire(EventTypes.PLAY_SFX,"bounce_jump_start")}));Utils.wait(900).then((()=>{this.app.fire(EventTypes.PLAY_SFX,"hammer_button")})),await Utils.wait(1100),this.innerHeart.anim.setTrigger("scale_heart",!0),this.hammerButton.anim.reset(),this.hammerButton.anim.setTrigger("press",!0),this.smokeExplosionsContainer.children.forEach((t=>{t.particlesystem.reset(),t.particlesystem.play()}))},HammerController.prototype.playBarFillingAnimation=async function(){const t=DataManager.getInstance().getNeededLikesForNextChapter(),e=LikesManager.getInstance().getNumLikes()/t,i=e>=1,n=this.hammer.getLocalScale().y,a=this.checkpointStartY+pc.math.clamp(e,0,1)*(this.totalHeight-this.checkpointStartY)+(i?.75:0),o=Math.min(15-a*n,0)+a*n,r=i?.4:.75,s=pc.math.clamp(1*this.totalHeight/35*r,1.3,7.5),h=i?pc.SineOut:pc.CubicOut;this.progressBar.setLocalScale(1,this.totalHeight,1),this.progressContainer.setLocalPosition(pc.Vec3.ZERO),this.progressContainer.tween(this.progressContainer.getLocalPosition()).to({y:a},s,h).delay(0).onUpdate((()=>this._updateLastRecordPosition(this.progressContainer.getLocalPosition().y))).start();const c=.25;if(o>15*n){const t=Math.max(o,MainCameraManager.getInstance().getCameraWorldPosition().y);MainCameraManager.getInstance().followHammerGameIndicator(t,s,c,h);const e=h,i=h,n=Math.max(o-3,PlayerController.getInstance().getPlayerCharacter().getPosition().y),a=Math.max(n-1.05,PlatformManager.getInstance().podiumMovable.getPosition().y),r=.1625;PlayerController.getInstance().movePlayerUpWithPodium(n,s,r,e),PlatformManager.getInstance().movePodiumYForHammerGame(a,s,r,i)}i&&Utils.wait(1e3*(c+s-1.2)).then((()=>{this.app.fire(EventTypes.PLAY_SFX,"rocket_whistle")})),await Utils.wait(1e3*(c+s)),i?(this.muzzleParticlesContainer.children.forEach((t=>{t.particlesystem.reset(),t.particlesystem.play()})),this.confettiParticlesContainer.children.forEach((t=>t.children.forEach((t=>{t.particlesystem.reset(),t.particlesystem.play()})))),this.app.fire(EventTypes.PLAY_SFX,"firework_burst"),this.app.fire(EventTypes.PLAY_SFX,"peak_smaller"),await Utils.wait(2e3),LocationsController.getInstance().showLocationUnlockScreen()):(await Utils.wait(750),UIController.getInstance().showPopup(Constants.Screens.HAMMER_GAME))},HammerController.prototype._buildCheckpoints=function(t,e,i){for(;this.checkpointsContainer.children.length>0;)this.checkpointsContainer.children[this.checkpointsContainer.children.length-1].destroy();for(let i=0;i<t;i++){const t=TemplateManager.getInstance().instantiate("HammerUICheckpoint");this.checkpointsContainer.addChild(t),t.setLocalPosition(-3.11,this.checkpointStartY+i*this.checkpointStep,.79),t.findByName("HeartsAmountText").element.text=LikesManager.getInstance().humanizeNumber(e*i)}this.scaleSystem.setLocalScale(1.5,.064*i,1.5),this.topContainer.setLocalPosition(0,i,0),this.bottom.setLocalScale(1.2,1.2,.1*i)},HammerController.prototype._onNextCityRequested=function(t){for(;this.cityNameContainer.children.length>0;)this.cityNameContainer.children[this.cityNameContainer.children.length-1].destroy();const e=TemplateManager.getInstance().instantiate("HammerCity_"+t);this.cityNameContainer.addChild(e)};var TutorialGameplay=pc.createScript("tutorialGameplay");TutorialGameplay.prototype.initialize=function(){this.hand=this.entity.findByName("TutorialHand"),this.app.on(EventTypes.SHOW_GAMEPLAY_TUTORIAL_HAND,this.showTutorial,this),this.app.on(EventTypes.HIDE_GAMEPLAY_TUTORIAL_HAND,this.hideTutorial,this),this.app.on(EventTypes.LEVEL_RESET,this.hideTutorial,this),this.hand.enabled=!1},TutorialGameplay.prototype.showTutorial=function(t){this.entity.setPosition(t),this.appearingTween&&this.appearingTween.playing&&this.appearingTween.stop(),this.hand.element.opacity=0,this.hand.enabled=!0,this.appearingTween=this.hand.tween(this.hand.element).to({opacity:1},.25,pc.SineOut).start()},TutorialGameplay.prototype.hideTutorial=function(t=!1){this.appearingTween&&this.appearingTween.playing&&this.appearingTween.stop(),t?this.hand.enabled=!1:this.appearingTween=this.hand.tween(this.hand.element).to({opacity:0},.125,pc.SineOut).onComplete((()=>this.hand.enabled=!1)).start()},TutorialGameplay.prototype.update=function(t){};var LocationConfig=pc.createScript("locationConfig");LocationConfig.attributes.add("changeFog",{title:"Change fog",type:"boolean",default:!0}),LocationConfig.attributes.add("fogType",{type:"string",enum:[{None:pc.FOG_NONE},{Linear:pc.FOG_LINEAR},{Exponential:pc.FOG_EXP},{"Exponential squared":pc.FOG_EXP2}],default:pc.FOG_LINEAR}),LocationConfig.attributes.add("fogDensity",{title:"Fog density (only for Exponential)",type:"number",default:.01}),LocationConfig.attributes.add("fogColor",{type:"rgb",default:[.7,.7,.7]}),LocationConfig.attributes.add("fogDistance",{title:"Fog density (only for Linear)",type:"vec2",default:[25,125]}),LocationConfig.attributes.add("skybox",{type:"asset",assetType:"cubemap"}),LocationConfig.prototype.initialize=function(){this.on("enable",this.applyCustomFog,this),this.on("attr",this.applyCustomFog,this),this.applyCustomFog()},LocationConfig.prototype.applyCustomFog=function(){this.changeFog&&(this.app.scene.fogColor=this.fogColor,this.app.scene.fog=this.fogType,this.app.scene.fogStart=this.fogDistance.x,this.app.scene.fogEnd=this.fogDistance.y,this.app.scene.fogDensity=this.fogDensity,this.skybox&&this.app.scene.setSkybox([this.skybox.resource]))},LocationConfig.prototype.update=function(t){};var LocationsController=pc.createScript("locationsController");function mapEnum(t){var o={},e=[];for(var n in t)if(t.hasOwnProperty(n)){var i={};i[n]=t[n],e.push(i),o[t[n]]=n}return t.toString=function(t){return o[t]},e}const cityTypesEnum=mapEnum({NewYork:"NewYork",Milan:"Milan",Paris:"Paris",London:"London",Rome:"Rome",Tokyo:"Tokyo",Moscow:"Moscow",Barcelona:"Barcelona",Cairo:"Cairo",Amsterdam:"Amsterdam",Shanghai:"Shanghai",Athens:"Athens",Guatemala:"Guatemala"});LocationsController.attributes.add("defaultLocation",{type:"string",enum:cityTypesEnum,default:"NewYork"}),LocationsController.attributes.add("loadTestLocation",{title:"Load test location",type:"boolean",default:!1}),LocationsController.attributes.add("testLocation",{type:"string",enum:cityTypesEnum,default:""}),LocationsController.attributes.add("locationsLibrary",{type:"json",schema:[{name:"city",type:"string",enum:cityTypesEnum,default:"NewYork"},{name:"template",type:"asset",assetType:"template"}],array:!0}),LocationsController.getInstance=function(){if(!LocationsController._instance)throw new Error("LocationsController is not initialized yet");return LocationsController._instance},LocationsController.prototype.initialize=function(){LocationsController._app=this.app,LocationsController._instance||(LocationsController._instance=this),this._currentCity=void 0,this._nextCity=Constants.City.NewYork,this.on("attr:testLocation",this._switchToTestLocation,this),this.loadTestLocation&&this._switchToTestLocation(),this.app.on(EventTypes.CHAPTER_CHANGED,this._onChapterChanged,this),this.app.on(EventTypes.GAME_DATA_READY,this._onGameDataReady,this)},LocationsController.prototype._switchToTestLocation=function(){this.loadTestLocation&&this.testLocation&&(console.error("Loading test location "+this.testLocation),this.changeLocation(this.testLocation))},LocationsController.prototype._onChapterChanged=function(){this._prepareNextCity()},LocationsController.prototype._onGameDataReady=function(){const t=this.locationsLibrary[DataManager.getInstance().chapter%this.locationsLibrary.length].city;this.changeLocation(t),this._prepareNextCity()},LocationsController.prototype._prepareNextCity=function(){const t=DataManager.getInstance().chapter+1;this._nextCity=this.locationsLibrary[t%this.locationsLibrary.length].city,this.app.fire(EventTypes.SET_NEXT_CITY,this._nextCity)},LocationsController.prototype.update=function(t){},LocationsController.prototype.showLocationUnlockScreen=async function(){const t=`ui_${this._nextCity}`;await AssetsLoader.getInstance().loadByTag(t),UIController.getInstance().showPopup(Constants.Screens.CITY_UNLOCK),await UIController.getInstance().waitWhenScreenHidden(Constants.Screens.CITY_UNLOCK)},LocationsController.prototype.getNextCity=function(){return this._nextCity||console.error("Next city is undefined"),this._nextCity},LocationsController.prototype.getHumanizedCityName=function(t){return Constants.CityNamesMapping[t]||"COLOGNE"},LocationsController.prototype.requestCityAssetsLoading=function(t){console.error("started loading city assets "+t),AssetsLoader.getInstance().loadByTag(t)},LocationsController.prototype.activateDesiredCityAndUnlockNextOne=function(){this.changeLocation(this._nextCity),DataManager.getInstance().chapter+=1,LocalStorageController.save(),this._prepareNextCity()},LocationsController.prototype.changeLocation=async function(t){if(this._currentCity===t)return void console.warn("Location "+t+" is already active");this._currentCity=t;const o=this.locationsLibrary.find((t=>t.city===this._currentCity));if(!o)return console.error("No location template: "+t);const e=this.locationsLibrary.indexOf(o);AssetsLoader.getInstance().loadByTag(this._currentCity).then((()=>{for(;this.entity.children.length>0;)this.entity.children[this.entity.children.length-1].destroy();try{const t=o.template.resource.instantiate();this.entity.addChild(t),t.setLocalEulerAngles(pc.Vec3.ZERO),t.setLocalPosition(pc.Vec3.ZERO),t.setLocalScale(pc.Vec3.ONE),this._activeLocation=t}catch(t){console.warn("Can not instantiate scene template: "+o.city,t)}-1!==e&&this.app.fire(EventTypes.PLAY_MUSIC,"melody"+(e%13+1)),this.app.fire(EventTypes.LOCATION_CHANGED,this._currentCity)}))};class ScreenCityUnlock extends BaseWindow{initialize(){super.initialize(),this.cityContainer=this.entity.findByName("CityContainer"),this.cityNameText=this.entity.findByName("CityName"),this.continueContainer=this.entity.findByName("ContinueContainer"),this.buttonContinue=this.continueContainer.findByName("ButtonContinue"),this.buttonContinue.on(EventTypes.BUTTON_PRESSED,this.onContinuePressed,this)}_initComponents(){super._initComponents()}async _onShow(){super._onShow();const t=LocationsController.getInstance().getNextCity();this.app.fire(EventTypes.PLAY_SFX,"new_chapter_unlock"),await this._loadAndShowCityContent(t),LocationsController.getInstance().activateDesiredCityAndUnlockNextOne(),this.continueContainer.enabled=!1,Utils.wait(1500).then((()=>{this.continueContainer.enabled=!0,this.continueContainer.fire(EventTypes.UI_ELEMENT.APPEAR_MANUALLY)}))}_onAppeared(){}_onHide(){super._onHide()}async _loadAndShowCityContent(t){for(this.cityNameText.element.text=`${LocationsController.getInstance().getHumanizedCityName(t)}`;this.cityContainer.children.length>0;)this.cityContainer.children[this.cityContainer.children.length-1].destroy();const n=TemplateManager.getInstance().instantiate("CityUnlock_"+t);this.cityContainer.addChild(n),n.fire(EventTypes.UI_ELEMENT.APPEAR_MANUALLY)}update(t){}onContinuePressed(){this.continueContainer.enabled=!1,LevelController.getInstance().exitToMainMenu()}}pc.registerScript(ScreenCityUnlock,"screenCityUnlock");var LikesManager=pc.createScript("likesManager");LikesManager.getInstance=function(){return LikesManager._instance||console.error("LikesManager is not initialized yet"),LikesManager._instance},LikesManager.prototype.initialize=function(){LikesManager._app=this.app,LikesManager._instance||(LikesManager._instance=this),this.mainCamera=CameraController.getInstance().getCameraByName(Constants.Cameras.MAIN),this.heartsSpawnerTarget=this.mainCamera.findByName("HeartsSpawnerPosition"),this.heart=this.entity.findByName("Heart"),this.heartAnimated=this.heart.findByName("HeartAnimated"),this.likesAmountText=this.heart.findByName("LikesAmountText"),this.heart.enabled=!1,this.numLikes=0,this._nextViewUpdateTimeout=0,this.app.on(EventTypes.LEVEL_RESET,this.reset,this)},LikesManager.prototype.reset=function(){this.numLikes=0},LikesManager.prototype.getNumLikes=function(){return this.numLikes},LikesManager.prototype.getLikesAmountHumanizedText=function(){return this.humanizeNumber(this.numLikes)},LikesManager.prototype.showGameplayHeart=function(){this.viewMode="gameplay",this.heart.enabled=!0,this.heart.setLocalScale(pc.Vec3.ZERO),this._updateLikesView(),this.heart.tween(this.heart.getLocalScale()).to(pc.Vec3.ONE,.5,pc.BackOut).start()},LikesManager.prototype.hideGameplayHeart=function(){this.heart.enabled=!0,this.heart.tween(this.heart.getLocalScale()).to(pc.Vec3.ZERO,.425,pc.BackIn).onComplete((()=>{this.viewMode=void 0,this.heart.enabled=!1})).start()},LikesManager.prototype.tick=function(e){this.numLikes+=DataManager.getInstance().getLikesRate()*e,this._nextViewUpdateTimeout-=e,this._nextViewUpdateTimeout<=0&&(this._updateLikesView(),this._nextViewUpdateTimeout=pc.math.random(.175,.35))},LikesManager.prototype.humanizeNumber=function(e){return e>=1e6?(e/1e6).toFixed(2)+"M":e>=1e5?this.humanizeNumber(e/1e3)+"K":e>=1e3?(e/1e3).toFixed(2)+"K":e.toFixed(0)},LikesManager.prototype._updateLikesView=function(){this.likesAmountText.element.text=""+this.humanizeNumber(this.numLikes)},LikesManager.prototype.update=function(e){"gameplay"===this.viewMode&&this.tick(e)},LikesManager.prototype.postUpdate=function(e){"gameplay"===this.viewMode&&(this.heart.setPosition(this.heartsSpawnerTarget.getPosition()),this.heart.setRotation(this.heartsSpawnerTarget.getRotation()))};pc.shaderChunks.fogExpPS="\nuniform vec3 fog_color;\nuniform float fog_density;\nfloat dBlendModeFogFactor = 1.0;\n\nvec3 addFog(vec3 color) {\n    float depth = gl_FragCoord.z / gl_FragCoord.w - 5.0;\n    float fogFactor = exp(-depth * fog_density);\n    fogFactor = clamp(fogFactor, 0.0, 1.0);\n    return mix(fog_color * dBlendModeFogFactor, color, fogFactor);\n}\n";class ScreenHammerGame extends BaseWindow{initialize(){super.initialize(),this.buttonContinue=this.entity.findByName("ButtonContinue"),this.buttonContinue.on(EventTypes.BUTTON_PRESSED,this.onContinuePressed,this)}_initComponents(){super._initComponents()}_onShow(){super._onShow(),this.buttonContinue.setAvailable(!0),this.buttonContinue.enabled=!0,this.buttonContinue.fire(EventTypes.UI_ELEMENT.APPEAR_MANUALLY)}_onAppeared(){}_onHide(){super._onHide()}update(e){}onContinuePressed(){this.buttonContinue.enabled=!1,this.buttonContinue.setAvailable(!1),LevelController.getInstance().exitToMainMenu()}}pc.registerScript(ScreenHammerGame,"screenHammerGame");