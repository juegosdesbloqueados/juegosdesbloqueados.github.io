var Module=(()=>{var e="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0;return function(t){var n,r;(t=void 0!==(t=t||{})?t:{}).ready=new Promise((function(e,t){n=e,r=t}));var i,o=Object.assign({},t),a=[],s="./this.program",c=!0,u=!1,l="";(c||u)&&(u?l=self.location.href:"undefined"!=typeof document&&document.currentScript&&(l=document.currentScript.src),e&&(l=e),l=0!==l.indexOf("blob:")?l.substr(0,l.replace(/[?#].*/,"").lastIndexOf("/")+1):"",e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},u&&(i=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),(e,t,n)=>{var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=()=>{200==r.status||0==r.status&&r.response?t(r.response):n()},r.onerror=n,r.send(null)});var f,d=t.print||console.log.bind(console),m=t.printErr||console.warn.bind(console);Object.assign(t,o),o=null,t.arguments&&(a=t.arguments),t.thisProgram&&(s=t.thisProgram),t.quit&&t.quit,t.wasmBinary&&(f=t.wasmBinary);var g;t.noExitRuntime;"object"!=typeof WebAssembly&&D("no native wasm support detected");var h,_,p,E,v,x=!1,T="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function b(e,t,n){for(var r=t+n,i=t;e[i]&&!(i>=r);)++i;if(i-t>16&&e.buffer&&T)return T.decode(e.subarray(t,i));for(var o="";t<i;){var a=e[t++];if(128&a){var s=63&e[t++];if(192!=(224&a)){var c=63&e[t++];if((a=224==(240&a)?(15&a)<<12|s<<6|c:(7&a)<<18|s<<12|c<<6|63&e[t++])<65536)o+=String.fromCharCode(a);else{var u=a-65536;o+=String.fromCharCode(55296|u>>10,56320|1023&u)}}else o+=String.fromCharCode((31&a)<<6|s)}else o+=String.fromCharCode(a)}return o}function A(e,t){return e?b(p,e,t):""}function w(e,t,n,r){if(!(r>0))return 0;for(var i=n,o=n+r-1,a=0;a<e.length;++a){var s=e.charCodeAt(a);if(s>=55296&&s<=57343)s=65536+((1023&s)<<10)|1023&e.charCodeAt(++a);if(s<=127){if(n>=o)break;t[n++]=s}else if(s<=2047){if(n+1>=o)break;t[n++]=192|s>>6,t[n++]=128|63&s}else if(s<=65535){if(n+2>=o)break;t[n++]=224|s>>12,t[n++]=128|s>>6&63,t[n++]=128|63&s}else{if(n+3>=o)break;t[n++]=240|s>>18,t[n++]=128|s>>12&63,t[n++]=128|s>>6&63,t[n++]=128|63&s}}return t[n]=0,n-i}function y(e){for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);r<=127?t++:r<=2047?t+=2:r>=55296&&r<=57343?(t+=4,++n):t+=3}return t}function I(e){h=e,t.HEAP8=_=new Int8Array(e),t.HEAP16=new Int16Array(e),t.HEAP32=E=new Int32Array(e),t.HEAPU8=p=new Uint8Array(e),t.HEAPU16=new Uint16Array(e),t.HEAPU32=v=new Uint32Array(e),t.HEAPF32=new Float32Array(e),t.HEAPF64=new Float64Array(e)}t.INITIAL_MEMORY;var R,S=[],L=[],P=[];var F=0,C=null,B=null;function D(e){t.onAbort&&t.onAbort(e),m(e="Aborted("+e+")"),x=!0,1,e+=". Build with -sASSERTIONS for more info.";var n=new WebAssembly.RuntimeError(e);throw r(n),n}var M,N,U="data:application/octet-stream;base64,";function O(e){return e.startsWith(U)}function k(e){try{if(e==M&&f)return new Uint8Array(f);if(i)return i(e);throw"both async and sync fetching of the wasm failed"}catch(e){D(e)}}function G(e){for(;e.length>0;)e.shift()(t)}O(M="fmb.04.2003_cubes_puzzle.wasm")||(N=M,M=t.locateFile?t.locateFile(N,l):l+N);var V={returnBool:function(e,t,n){void 0===n&&(n=!1),R.get(t)(e,n)},returnStr:function(e,n,r){void 0===r&&(r="");var i=function(e){var t=y(e)+1,n=je(t);n&&w(e,_,n,t);return n}(r);R.get(n)(e,i),t._free(i)},callCallback:function(e,t){void 0===t&&(t=!1),R.get(e.callback)(e.context,t),e.context=null,e.callback=null}};var X=function(e,t){return new Promise((function(n,r){var i=new XMLHttpRequest;i.open("GET",e.trim(),!0),i.responseType=t||"arraybuffer",i.onload=function(){200===i.status?n({type:i.getResponseHeader("Content-Type"),data:i.response,code:i.status,text:i.statusText}):r({code:i.status,text:i.statusText})},i.onabort=function(){r({code:-2,text:i.statusText})},i.onerror=function(e){fe.error("XML HTTP Request: type: "+e.type+" loaded: "+e.loaded+" bytes"),r({code:-1,text:i.statusText})},i.send()}))},j=function(e,n){if(0!==Object.keys(e).length){const r=[];for(const t in e)r.push(W.open(t,e[t]));Promise.all(r).then((function(){t.VFSLoadedCallback&&t.VFSLoadedCallback(),R.get(n)()}))}else R.get(n)()},W={Files:{},loaded:!1,UnpackCallback:void 0,getArchiveFilePath:function(e){let t=e.split(".")[0];return"/"==t.charAt(0)&&(t=t.substr(1)),t},onFileReceived:function(e,n){if(n.type&&n.type.includes("w4pack")||e.includes("w4pack")){const e=n.data;if(void 0!==e){const n=e.byteLength,r=t._malloc(n),i=new Uint8Array(t.HEAPU8.buffer,r,n);i.set(new Uint8Array(e)),W.UnpackCallback=function(e,t,n,r){const i=new Uint8Array(g.buffer,n,r),o={type:A(t),data:i};W.put(A(e),o)},t._loadZipFile(i.byteOffset,n)}}else W.put(e,n)},open:function(e,t){if(this.parse(e,t,this.onFileReceived))return;return function(t){return new Promise(((n,r)=>{X(t).then((function(t){W.onFileReceived(e,t),n()}),(function(i){fe.warning("XML HTTP Request: "+t+" on error status: "+i.code+" "+i.text),X(t).then((function(t){W.onFileReceived(e,t),n()}),(function(e){fe.error("XML HTTP Request: again "+t+" on error status: "+e.code+" "+e.text),r()}))}))}))}(t)},Ascii85:{_alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz!#$%&()*+-;<=>?@^_`{|}~",decode:function(e){let t,n,r,i,o,a,s=W.Ascii85._alphabet,c="";for(r=0,o=e.length;r<o;){for(t=[0,0,0,0,0],i=0;i<5;i++)e[r]&&(t[i]=s.indexOf(e[r++]));for(n=t[0],i=1;i<5;i++)n=85*n+t[i];for(a=[0,0,0,0],i=0;i<4;i++)a[3-i]=String.fromCharCode(n%256),n=Math.floor(n/256);for(i=0;i<4;i++)c+=a[i]}return c}},parse:function(e,t,n){const r=";base85,",i=t.substring(0,64),o=i.indexOf(r);if(-1!=o){const r=i.substring(5,o),a=t.substring(o+8),s=W.Ascii85.decode(a),c=s.length,u=new ArrayBuffer(c),l=new Uint8Array(u);for(let e=0;e<c;e++)l[e]=s.charCodeAt(e);return n(e,{type:r,data:u}),!0}return!1},close:function(e){delete W.Files[e]},put:function(e,t){W.Files[e]=t},isExists:function(e){return void 0!==W.Files[e]},isURL:function(e){let t;try{t=new URL(e)}catch(e){return!1}return!0},get:function(e){const t=W.Files[e];return void 0===t&&(console.log(W.Files),ue("No file "+e+" in file system")),t}};function H(e){try{return g.grow(e-h.byteLength+65535>>>16),I(g.buffer),1}catch(e){}}var Y={};function z(){if(!z.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:s||"./this.program"};for(var t in Y)void 0===Y[t]?delete e[t]:e[t]=Y[t];var n=[];for(var t in e)n.push(t+"="+e[t]);z.strings=n}return z.strings}function K(e,t,n){for(var r=0;r<e.length;++r)_[t++>>0]=e.charCodeAt(r);n||(_[t>>0]=0)}var Z=[null,[],[]];function q(e,t){var n=Z[e];0===t||10===t?((1===e?d:m)(b(n,0)),n.length=0):n.push(t)}function J(e){return e%4==0&&(e%100!=0||e%400==0)}var Q=[31,29,31,30,31,30,31,31,30,31,30,31],$=[31,28,31,30,31,30,31,31,30,31,30,31];function ee(e,t){_.set(e,t)}function te(e,t,n,r){var i=E[r+40>>2],o={tm_sec:E[r>>2],tm_min:E[r+4>>2],tm_hour:E[r+8>>2],tm_mday:E[r+12>>2],tm_mon:E[r+16>>2],tm_year:E[r+20>>2],tm_wday:E[r+24>>2],tm_yday:E[r+28>>2],tm_isdst:E[r+32>>2],tm_gmtoff:E[r+36>>2],tm_zone:i?A(i):""},a=A(n),s={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var c in s)a=a.replace(new RegExp(c,"g"),s[c]);var u=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],l=["January","February","March","April","May","June","July","August","September","October","November","December"];function f(e,t,n){for(var r="number"==typeof e?e.toString():e||"";r.length<t;)r=n[0]+r;return r}function d(e,t){return f(e,t,"0")}function m(e,t){function n(e){return e<0?-1:e>0?1:0}var r;return 0===(r=n(e.getFullYear()-t.getFullYear()))&&0===(r=n(e.getMonth()-t.getMonth()))&&(r=n(e.getDate()-t.getDate())),r}function g(e){switch(e.getDay()){case 0:return new Date(e.getFullYear()-1,11,29);case 1:return e;case 2:return new Date(e.getFullYear(),0,3);case 3:return new Date(e.getFullYear(),0,2);case 4:return new Date(e.getFullYear(),0,1);case 5:return new Date(e.getFullYear()-1,11,31);case 6:return new Date(e.getFullYear()-1,11,30)}}function h(e){var t=function(e,t){for(var n=new Date(e.getTime());t>0;){var r=J(n.getFullYear()),i=n.getMonth(),o=(r?Q:$)[i];if(!(t>o-n.getDate()))return n.setDate(n.getDate()+t),n;t-=o-n.getDate()+1,n.setDate(1),i<11?n.setMonth(i+1):(n.setMonth(0),n.setFullYear(n.getFullYear()+1))}return n}(new Date(e.tm_year+1900,0,1),e.tm_yday),n=new Date(t.getFullYear(),0,4),r=new Date(t.getFullYear()+1,0,4),i=g(n),o=g(r);return m(i,t)<=0?m(o,t)<=0?t.getFullYear()+1:t.getFullYear():t.getFullYear()-1}var _={"%a":function(e){return u[e.tm_wday].substring(0,3)},"%A":function(e){return u[e.tm_wday]},"%b":function(e){return l[e.tm_mon].substring(0,3)},"%B":function(e){return l[e.tm_mon]},"%C":function(e){return d((e.tm_year+1900)/100|0,2)},"%d":function(e){return d(e.tm_mday,2)},"%e":function(e){return f(e.tm_mday,2," ")},"%g":function(e){return h(e).toString().substring(2)},"%G":function(e){return h(e)},"%H":function(e){return d(e.tm_hour,2)},"%I":function(e){var t=e.tm_hour;return 0==t?t=12:t>12&&(t-=12),d(t,2)},"%j":function(e){return d(e.tm_mday+function(e,t){for(var n=0,r=0;r<=t;n+=e[r++]);return n}(J(e.tm_year+1900)?Q:$,e.tm_mon-1),3)},"%m":function(e){return d(e.tm_mon+1,2)},"%M":function(e){return d(e.tm_min,2)},"%n":function(){return"\n"},"%p":function(e){return e.tm_hour>=0&&e.tm_hour<12?"AM":"PM"},"%S":function(e){return d(e.tm_sec,2)},"%t":function(){return"\t"},"%u":function(e){return e.tm_wday||7},"%U":function(e){var t=e.tm_yday+7-e.tm_wday;return d(Math.floor(t/7),2)},"%V":function(e){var t=Math.floor((e.tm_yday+7-(e.tm_wday+6)%7)/7);if((e.tm_wday+371-e.tm_yday-2)%7<=2&&t++,t){if(53==t){var n=(e.tm_wday+371-e.tm_yday)%7;4==n||3==n&&J(e.tm_year)||(t=1)}}else{t=52;var r=(e.tm_wday+7-e.tm_yday-1)%7;(4==r||5==r&&J(e.tm_year%400-1))&&t++}return d(t,2)},"%w":function(e){return e.tm_wday},"%W":function(e){var t=e.tm_yday+7-(e.tm_wday+6)%7;return d(Math.floor(t/7),2)},"%y":function(e){return(e.tm_year+1900).toString().substring(2)},"%Y":function(e){return e.tm_year+1900},"%z":function(e){var t=e.tm_gmtoff,n=t>=0;return t=(t=Math.abs(t)/60)/60*100+t%60,(n?"+":"-")+String("0000"+t).slice(-4)},"%Z":function(e){return e.tm_zone},"%%":function(){return"%"}};for(var c in a=a.replace(/%%/g,"\0\0"),_)a.includes(c)&&(a=a.replace(new RegExp(c,"g"),_[c](o)));a=a.replace(/\0\0/g,"%");var p,v,x,T,b,I,R=(p=a,v=!1,T=x>0?x:y(p)+1,b=new Array(T),I=w(p,b,0,b.length),v&&(b.length=I),b);return R.length>t?0:(ee(R,e),R.length-1)}var ne={context:void 0,debugLogging:!1,debugCheckErrors:!0,loadedGeometries:0,loadedTextures:0,frame:0,frameRenderCalls:0,frameTriangles:0,framePoints:0,frameLines:0,initialize:function(e){this.context=e},startFrame:function(){this.frame++,this.frameRenderCalls=0,this.frameTriangles=0,this.framePoints=0,this.frameLines=0},updateFrame:function(e,t,n){switch(this.frameRenderCalls++,mode){case Ue.TRIANGLES:this.frameTriangles+=n*(t/3);break;case Ue.LINES:this.frameLines+=n*(t/2);break;case Ue.LINE_STRIP:this.frameLines+=n*(t-1);break;case Ue.LINE_LOOP:this.frameLines+=n*t;break;case Ue.POINTS:this.framePoints+=n*t;break;default:console.error("Unknown primitive type: ",e)}}},re={context:void 0,_primitiveTypeMap:void 0,initialize:function(e){this.context=e,this._primitiveTypeMap={0:Ue.POINTS,1:Ue.LINE_STRIP,2:Ue.LINE_LOOP,3:Ue.LINES,4:Ue.TRIANGLE_STRIP,5:Ue.TRIANGLE_FAN,6:Ue.TRIANGLES}},number2glPrimitiveType:function(e){return this._primitiveTypeMap[e]},number2glShaderType:function(e){switch(e){case 1:return Ue.VERTEX_SHADER;case 2:return Ue.FRAGMENT_SHADER}fe.error("Unknown shader type: "+e)},glShaderType2number:function(e){switch(e){case Ue.VERTEX_SHADER:return 1;case Ue.FRAGMENT_SHADER:return 2}fe.error("Unknown shader type: "+e)},number2glClearMask:function(e){let t=0;return 0!=(1&e)&&(t|=Ue.COLOR_BUFFER_BIT),0!=(2&e)&&(t|=Ue.DEPTH_BUFFER_BIT),t},number2glBlendEnum:function(e){switch(e){case 0:return Ue.ZERO;case 1:return Ue.ONE;case 2:return Ue.SRC_COLOR;case 3:return Ue.ONE_MINUS_SRC_COLOR;case 4:return Ue.DST_COLOR;case 5:return Ue.ONE_MINUS_DST_COLOR;case 6:return Ue.SRC_ALPHA;case 7:return Ue.ONE_MINUS_SRC_ALPHA;case 8:return Ue.DST_ALPHA;case 9:return Ue.ONE_MINUS_DST_ALPHA;case 10:return Ue.CONSTANT_COLOR;case 11:return Ue.ONE_MINUS_CONSTANT_COLOR;case 12:return Ue.CONSTANT_ALPHA;case 13:return Ue.ONE_MINUS_CONSTANT_ALPHA;case 14:return Ue.SRC_ALPHA_SATURATE}return fe.error("Unknown blend enum: "+e),Ue.ZERO},number2glCullFaceMode:function(e){switch(e){case 0:return Ue.BACK;case 1:return Ue.FRONT;case 2:return Ue.FRONT_AND_BACK;case 3:return Ue.ZERO}return fe.error("Unknown cull face enum: "+e),Ue.BACK},string2glValueEnum:function(e){switch(e){case"int":return Ue.INT;case"float":return Ue.FLOAT;case"w4::math::vec2":return Ue.FLOAT_VEC2;case"w4::math::vec3":return Ue.FLOAT_VEC3;case"w4::math::vec4":return Ue.FLOAT_VEC4;case"w4::math::mat3":return Ue.FLOAT_MAT3;case"w4::math::mat4":return Ue.FLOAT_MAT4;case"TextureOuterId":return Ue.SAMPLER_2D}fe.error("Unknown GL value type: "+e)},glValueEnum2size:function(e){switch(e){case"ID":case Ue.FLOAT:return 1;case Ue.FLOAT_VEC2:return 2;case Ue.FLOAT_VEC3:return 3;case Ue.FLOAT_VEC4:return 4;case Ue.INT:return 1;case Ue.INT_VEC2:return 2;case Ue.INT_VEC3:return 3;case Ue.INT_VEC4:return 4;case Ue.BOOL:return 1;case Ue.BOOL_VEC2:return 2;case Ue.BOOL_VEC3:return 3;case Ue.BOOL_VEC4:case Ue.FLOAT_MAT2:return 4;case Ue.FLOAT_MAT3:return 9;case Ue.FLOAT_MAT4:return 16;case Ue.SAMPLER_2D:case Ue.SAMPLER_CUBE:return 1}return fe.error("Unknown uniform type: "+e),0}},ie={context:void 0,isWebGL2:!1,drawBuffers:!1,logarithmicDepthBuffer:!1,vertexTextures:!1,floatFragmentTextures:!1,floatVertexTextures:!1,maxPrecision:0,maxAnisotropy:0,maxTextures:0,maxVertexTextures:0,maxTextureSize:0,maxCubemapSize:0,maxVertexAttributes:0,maxVertexUniforms:0,maxVaryings:0,maxFragmentUniforms:0,maxSamples:0,hasFloatTextures:!1,hasDepthTextures:!1,depthSupportedFormat:null,depthInternalFormat:null,_extensions:{},initialize:function(e){if(this.context=e,this.isWebGL2="undefined"!=typeof WebGL2RenderingContext&&this.context instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&this.context instanceof WebGL2ComputeRenderingContext,this.isWebGL2)this.getExtension("EXT_color_buffer_float"),this.hasExtension("EXT_color_buffer_float")&&(this.hasFloatTextures=!0),this.hasDepthTextures=!0,this.depthSupportedFormat=this.context.DEPTH_COMPONENT24,this.depthInternalFormat=this.context.DEPTH_COMPONENT24;else{if(fe.error("WebGL1! 6.7% - https://developer.android.com/about/dashboards#OpenGL"),this.getExtension("OES_texture_float"),this.getExtension("OES_texture_half_float"),this.getExtension("OES_texture_half_float_linear"),this.getExtension("OES_standard_derivatives"),this.getExtension("ANGLE_instanced_arrays"),this.hasExtension("OES_element_index_uint")||ue("OES_element_index_uint isn't supported"),this.hasExtension("OES_vertex_array_object")){const e=this.getExtension("OES_vertex_array_object");this.context.createVertexArray=function(){return e.createVertexArrayOES()},this.context.bindVertexArray=function(t){e.bindVertexArrayOES(t)},this.context.deleteVertexArray=function(t){e.deleteVertexArrayOES(t)}}else ue("OES_vertex_array_object isn't supported");this.hasExtension("WEBGL_depth_texture")&&(this.hasDepthTextures=!0,this.depthSupportedFormat=this.context.DEPTH_COMPONENT,this.depthInternalFormat=this.context.DEPTH_COMPONENT16)}if(this.getExtension("OES_texture_float_linear"),this.getExtension("EXT_color_buffer_half_float"),this.getExtension("WEBGL_multisampled_render_to_texture"),this.hasExtension("EXT_texture_filter_anisotropic")){const e=this.getExtension("EXT_texture_filter_anisotropic");this.maxAnisotropy=this.context.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;void 0===this.context.getShaderPrecisionFormat&&(this.context.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}});let t="highp";this.maxPrecision=this.getMaxPrecision(t),this.maxPrecision!==t&&fe.warning(t+" not supported, using "+this.maxPrecision),this.drawBuffers=this.isWebGL2||this.hasExtension("WEBGL_draw_buffers"),this.logarithmicDepthBuffer=!0,this.maxTextures=this.context.getParameter(this.context.MAX_TEXTURE_IMAGE_UNITS),this.maxVertexTextures=this.context.getParameter(this.context.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=this.context.getParameter(this.context.MAX_TEXTURE_SIZE),this.maxCubemapSize=this.context.getParameter(this.context.MAX_CUBE_MAP_TEXTURE_SIZE),this.maxVertexAttributes=this.context.getParameter(this.context.MAX_VERTEX_ATTRIBS),this.maxVertexUniforms=this.context.getParameter(this.context.MAX_VERTEX_UNIFORM_VECTORS),this.maxVaryings=this.context.getParameter(this.context.MAX_VARYING_VECTORS),this.maxFragmentUniforms=this.context.getParameter(this.context.MAX_FRAGMENT_UNIFORM_VECTORS),this.maxSamples=this.isWebGL2?this.context.getParameter(this.context.MAX_SAMPLES):0,this.vertexTextures=this.maxVertexTextures>0,this.floatFragmentTextures=this.isWebGL2||this.hasExtension("OES_texture_float"),this.floatVertexTextures=this.vertexTextures&&this.floatFragmentTextures,fe.__internal.pushIndentLevel(),fe.trace("isWebGL2: "+this.isWebGL2),fe.trace("drawBuffers: "+this.drawBuffers),fe.trace("logarithmicDepthBuffer: "+this.logarithmicDepthBuffer),fe.trace("vertexTextures: "+this.vertexTextures),fe.trace("floatFragmentTextures: "+this.floatFragmentTextures),fe.trace("floatVertexTextures: "+this.floatVertexTextures),fe.trace("maxPrecision: "+this.maxPrecision),fe.trace("maxAnisotropy: "+this.maxAnisotropy),fe.trace("maxTextures: "+this.maxTextures),fe.trace("maxVertexTextures: "+this.maxVertexTextures),fe.trace("maxTextureSize: "+this.maxTextureSize),fe.trace("maxCubemapSize: "+this.maxCubemapSize),fe.trace("maxVertexAttributes: "+this.maxVertexAttributes),fe.trace("maxVertexUniforms: "+this.maxVertexUniforms),fe.trace("maxVaryings: "+this.maxVaryings),fe.trace("maxFragmentUniforms: "+this.maxFragmentUniforms),fe.trace("maxSamples: "+this.maxSamples),fe.trace("hasFloatTextures: "+this.hasFloatTextures),fe.trace("hasDepthTextures: "+this.hasDepthTextures),fe.trace("depthSupportedFormat: "+this.depthSupportedFormat),fe.trace("depthInternalFormat: "+this.depthInternalFormat),fe.trace("extensions:"),fe.__internal.pushIndentLevel();for(const e in this._extensions)fe.trace(e+": "+(null!==this._extensions[e]));fe.__internal.popIndentLevel(),fe.__internal.popIndentLevel()},getExtension:function(e){let t=this._extensions[e];if(void 0!==t)return t;switch(e){case"WEBGL_depth_texture":t=this.context.getExtension("WEBGL_depth_texture")||this.context.getExtension("MOZ_WEBGL_depth_texture")||this.context.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":t=this.context.getExtension("EXT_texture_filter_anisotropic")||this.context.getExtension("MOZ_EXT_texture_filter_anisotropic")||this.context.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":t=this.context.getExtension("WEBGL_compressed_texture_s3tc")||this.context.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||this.context.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":t=this.context.getExtension("WEBGL_compressed_texture_pvrtc")||this.context.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:t=this.context.getExtension(e)}return this._extensions[e]=t,t},hasExtension:function(e){return null!==this.getExtension(e)},getMaxPrecision:function(e){let t=e;if("highp"===t){if(this.context.getShaderPrecisionFormat(this.context.VERTEX_SHADER,this.context.HIGH_FLOAT).precision>0&&this.context.getShaderPrecisionFormat(this.context.FRAGMENT_SHADER,this.context.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&this.context.getShaderPrecisionFormat(this.context.VERTEX_SHADER,this.context.MEDIUM_FLOAT).precision>0&&this.context.getShaderPrecisionFormat(this.context.FRAGMENT_SHADER,this.context.MEDIUM_FLOAT).precision>0?"mediump":"lowp"},getContextAttributes:function(){return this.context.getContextAttributes()}},oe={canvas:void 0,context:void 0,_isContextLost:!1,_onContextLostHandler:function(e){fe.warning("GL: Context lost"),e.preventDefault(),oe._isContextLost=!0},_onContextRestoreHandler:function(){fe.warning("GL: Context restored"),oe._isContextLost=!1},_onContextCreationErrorHandler:function(e){fe.error("GL: Context creating error: ",e.statusMessage)},createContext:function(e,t=!1){this.context&&ue("Context was already initialized"),this.canvas=e;const n=["webgl2","experimental-webgl2","webgl","experimental-webgl","webkit-3d","moz-webgl"];t&&(fe.warning("GL: Forced WebGL1"),n.shift(),n.shift());for(let t=0;t<n.length&&(this.context=e.getContext(n[t],{preserveDrawingBuffer:!0,alpha:!1}),!this.context);++t);this.context?fe.trace("WebGL context initialized"):ue("WebGL context init failed"),Ue=this.context,this.canvas.addEventListener("webglcontextlost",this._onContextLostHandler,!1),this.canvas.addEventListener("webglcontextrestored",this._onContextRestoreHandler,!1),this.canvas.addEventListener("webglcontextcreationerror",this._onContextCreationErrorHandler,!1),ne.initialize(this.context),re.initialize(this.context),ie.initialize(this.context),this.context.enable(this.context.CULL_FACE),this.context.cullFace(this.context.BACK),this.context.enable(this.context.DEPTH_TEST),this.context.depthFunc(this.context.LESS),ne.debugLogging&&fe.trace("GL: createContext")},destroyContext:function(){fe.warning("GL: destroyContext"),this.canvas.removeEventListener("webglcontextlost",this._onContextLostHandler,!1),this.canvas.removeEventListener("webglcontextrestored",this._onContextRestoreHandler,!1),this.canvas.removeEventListener("webglcontextcreationerror",this._onContextCreationErrorHandler,!1)},forceContextLoss:function(){const e=ie.getExtension("WEBGL_lose_context");e&&(fe.trace("GL: forceContextLoss"),e.loseContext())},forceContextRestore:function(){const e=ie.getExtension("WEBGL_lose_context");e&&(fe.trace("GL: forceContextRestore"),e.restoreContext())},prepareRender:function(){this.context.enable(this.context.CULL_FACE),this.context.cullFace(this.context.BACK),this.context.enable(this.context.DEPTH_TEST),this.context.depthFunc(this.context.LEQUAL)},cleanupRender:function(){this.context.bindVertexArray(null)},enableBlend:function(){this.context.enable(this.context.BLEND)},disableBlend:function(){this.context.disable(this.context.BLEND)},enableDepthTest:function(){this.context.enable(this.context.DEPTH_TEST)},disableDepthTest:function(){this.context.disable(this.context.DEPTH_TEST)},enableDepthWrite:function(){this.context.depthMask(!0)},disableDepthWrite:function(){this.context.depthMask(!1)},dropVao:function(){this.context.bindVertexArray(null)},clearBackBuffer:function(e,t){0!=(e&this.context.COLOR_BUFFER_BIT)&&this.context.clearColor(t[0],t[1],t[2],t[3]),0!==e&&this.context.clear(e)},glClear:function(e=!0,t=!0,n=!0){let r=0;e&&(r|=Ue.COLOR_BUFFER_BIT),t&&(r|=Ue.DEPTH_BUFFER_BIT),n&&(r|=Ue.STENCIL_BUFFER_BIT),Ue.clear(r)}};var ae={context:void 0,initialize:function(){const e=window.AudioContext||window.webkitAudioContext;this.context=new e},create:function(e){const t=this.context,n={source:e,__callbacks:[]},r=W.get(e);void 0===r&&ue("file '"+e+"' not found");let i=r.data.slice(0);return i.buffer&&(i=i.buffer),t.decodeAudioData(i,(function(e){n.buffer=e,n.__callbacks.forEach((function(e){e()}));for(const e in n)"buffer"!==e&&"source"!==e&&delete n[e];Object.freeze(n)}),(function(t){fe.error("fail to decode audio data '"+e+"': "+t),ue()})),le.make(n,void 0,"AudioData")},get:function(e){return new Promise((function(t){const n=le.get(e);"buffer"in n?t(n):n.__callbacks.push((function(){t(n)}))}))},delete:function(e){le.free(e)}},se={State:{IDLE:0,PLAYED:1,PAUSED:2},DistanceModel:{0:"inverse",1:"linear",2:"exponential"},PanningModel:{0:"equalpower",1:"HRTF"},UserCallbackNames:["click","mousedown","keydown","touchstart","touchend"],context:null,listener:null,listenerGainNode:null,listenerFilter:null,globalPause:!1,audioSourceById:{},globalGain:1,waitingForInteraction:!1,isCreated:function(){return null!==se.context},isRunning:function(){return se.context&&"running"===se.context.state},isWaitingForInteraction:function(){return se.waitingForInteraction},initialize:function(){if(!se.isRunning()){if(null===se.context||"closed"===se.context.state){const e=window.AudioContext||window.webkitAudioContext;se.context=new e,se.listener=se.context.listener,se.listenerGainNode=se.context.createGain(),se.listenerGainNode.connect(se.context.destination),se.setGlobalGain(se.globalGain);for(const e in se.audioSourceById)se.createAudioSourceInternal(se.audioSourceById[e])}if(!se.waitingForInteraction&&("suspended"===se.context.state||"interrupted"===se.context.state)){se.waitingForInteraction=!0;const e=function(t){se.context.resume().then((function(){if(se.waitingForInteraction){se.waitingForInteraction=!1,fe.info("W4Audio context initialized: "+se.context.state+" by "+t.type);for(const t of se.UserCallbackNames)document.documentElement.removeEventListener(t,e,!1);for(const e in se.audioSourceById)se.createAudioSourceInternal(se.audioSourceById[e])}}))};for(const t of se.UserCallbackNames)document.documentElement.addEventListener(t,e,!1);e({type:"manual"})}}},setListenerTransform:function(e,t,n,r,i,o,a,s,c,u){if(this.listener.positionX){const l=this.context.currentTime+u;this.listener.positionX.linearRampToValueAtTime(e,l),this.listener.positionY.linearRampToValueAtTime(t,l),this.listener.positionZ.linearRampToValueAtTime(n,l),this.listener.forwardX.linearRampToValueAtTime(r,l),this.listener.forwardY.linearRampToValueAtTime(i,l),this.listener.forwardZ.linearRampToValueAtTime(o,l),this.listener.upX.linearRampToValueAtTime(a,l),this.listener.upY.linearRampToValueAtTime(s,l),this.listener.upZ.linearRampToValueAtTime(c,l)}else this.listener.setPosition(e,t,n),this.listener.setOrientation(r,i,o,a,s,c)},setListenerFilter:function(e){null===this.listenerFilter?this.listenerGainNode.disconnect(this.context.destination):(this.listenerGainNode.disconnect(this.listenerFilter),this.listenerFilter.disconnect(this.context.destination)),null===this.filter?(this.listenerFilter=null,this.listenerGainNode.connect(this.context.destination)):(this.listenerFilter=e,this.listenerGainNode.connect(this.listenerFilter),this.listenerFilter.connect(this.context.destination))},getGlobalGain:function(){return se.globalGain},setGlobalGain:function(e){se.globalGain=e,se.listenerGainNode.gain.setTargetAtTime(se.globalGain,se.context.currentTime,.01)},_audioSourceDestructor:function(e){e&&e.sourceNode&&e.sourceNode.stop()},createAudioSource:function(e){const t={state:this.State.IDLE,sourceNode:null,gainNode:null,pannerNode:null,startTime:0,startOffset:0,loop:!1,playbackRate:1,description:null,buffer:null};se.createAudioSourceInternal(t),ae.get(e).then((function(e){t.description=e.source,t.buffer=e.buffer,t.state===se.State.PLAYED&&se.playAudioSource(t)}));const n=le.make(t,this._audioSourceDestructor,"AudioSource");return this.audioSourceById[n]=t,n},createAudioSourceInternal:function(e){e.gainNode=se.context.createGain(),e.gainNode.connect(se.listenerGainNode),e.buffer&&e.state===se.State.PLAYED&&se.resumeAudioSourceInternal(e)},deleteAudioSource:function(e){this.audioSourceById.hasOwnProperty(e)&&delete this.audioSourceById[e],le.free(e)},getAudioSourceGain:function(e){return e.gainNode.gain.value},setAudioSourceGain:function(e,t){e.gainNode.gain.setValueAtTime(t,this.context.currentTime)},setAudioSourceGainLinear:function(e,t,n){e.gainNode.gain.linearRampToValueAtTime(t,this.context.currentTime+n)},getAudioSourcePlaybackRate:function(e){return e.playbackRate},setAudioSourcePlaybackRate:function(e,t){e.playbackRate=t,e.sourceNode&&(e.sourceNode.playbackRate.value=e.playbackRate)},getAudioSourceIsLooped:function(e){return e.loop},setAudioSourceIsLooped:function(e,t){e.loop=t,e.sourceNode&&(e.sourceNode.loop=e.loop)},getAudioSourceIsLoading:function(e){return!e.buffer},getAudioSourceIsPlaying:function(e){return e.state===this.State.PLAYED},getAudioSourceIsPaused:function(e){return e.state===this.State.PAUSED},playAudioSource:function(e){se.playAudioSourceInternal(e),e.state=this.State.PLAYED},playAudioSourceInternal:function(e){se.isRunning()&&(se.getAudioSourceIsPlaying(e)&&se.stopAudioSource(e),se.getAudioSourceIsLoading(e)||(e.sourceNode=this.context.createBufferSource(),e.sourceNode.buffer=e.buffer,e.sourceNode.connect(e.gainNode),e.sourceNode.addEventListener("ended",(function(){this===e.sourceNode&&e.state===se.State.PLAYED&&(e.state=se.State.IDLE)})),this.setAudioSourceIsLooped(e,e.loop),this.setAudioSourcePlaybackRate(e,e.playbackRate),e.sourceNode.start(0))),e.startTime=Date.now()},pauseAudioSource:function(e){se.getAudioSourceIsPlaying(e)?(se.pauseAudioSourceInternal(e),e.state=this.State.PAUSED):fe.warning(e.description+": fail to pause - not played")},pauseAudioSourceInternal:function(e){se.isRunning()&&(se.getAudioSourceIsLoading(e)||(e.startOffset+=(Date.now()-e.startTime)/1e3,e.startOffset-=Math.floor(e.startOffset/e.buffer.duration)),e.sourceNode&&(e.sourceNode.stop(),e.sourceNode=null))},resumeAudioSource:function(e){se.getAudioSourceIsPaused(e)?(se.resumeAudioSourceInternal(e),e.state=this.State.PLAYED):fe.warning(e.description+": fail to resume - not paused")},resumeAudioSourceInternal:function(e){se.isRunning()&&!se.getAudioSourceIsLoading(e)&&(se.stopAudioSourceInternal(e),e.sourceNode=this.context.createBufferSource(),e.sourceNode.buffer=e.buffer,e.sourceNode.connect(e.gainNode),this.setAudioSourceIsLooped(e,e.loop),this.setAudioSourcePlaybackRate(e,e.playbackRate),e.sourceNode.start(0,e.startOffset)),e.startTime=Date.now()},stopAudioSource:function(e){se.stopAudioSourceInternal(e),e.state=this.State.IDLE},stopAudioSourceInternal:function(e){e.sourceNode&&(e.sourceNode.stop(),e.sourceNode=null)},createPanner:function(e){e.pannerNode?fe.warning("pannerNode already exists"):(e.gainNode.disconnect(this.listenerGainNode),e.pannerNode=this.context.createPanner(),e.gainNode.connect(e.pannerNode),e.pannerNode.connect(this.listenerGainNode))},deletePanner:function(e){e.pannerNode?(e.gainNode.disconnect(e.pannerNode),e.pannerNode.disconnect(this.listenerGainNode),e.pannerNode=null,e.gainNode.connect(this.listenerGainNode)):fe.warning("pannerNode already destroyed")},setPannerTransform:function(e,t,n,r,i,o,a,s){e.pannerNode.setPosition(t,n,r),e.pannerNode.setOrientation(i,o,a)},setPannerDistance:function(e,t,n,r){e.pannerNode.refDistance=t,e.pannerNode.maxDistance=n,e.pannerNode.rolloffFactor=r},setPannerCone:function(e,t,n,r){e.pannerNode.coneInnerAngle=t,e.pannerNode.coneOuterAngle=n,e.pannerNode.coneOuterGain=r},setPannerModel:function(e,t,n){e.pannerNode.distanceModel=this.DistanceModel[t],e.pannerNode.panningModel=this.PanningModel[n]}};var ce={types:{},defaultTypeConvertions:{bool:function(e,t){return new Int8Array(g.buffer,e,t)},int:function(e,t){return new Int32Array(g.buffer,e,t)},int32_t:function(e,t){return new Int32Array(g.buffer,e,t)},uint32_t:function(e,t){return new Uint32Array(g.buffer,e,t)},uint:function(e,t){return new Uint32Array(g.buffer,e,t)},float:function(e,t){return new Float32Array(g.buffer,e,t)},"w4::core::OuterID::ndxType":function(e,t){return new Int32Array(g.buffer,e,t)},TextureOuterId:function(e,t){return new Int32Array(g.buffer,e,t)},utf8CharPtr:function(e,t){return new Int32Array(g.buffer,e,t)},"w4::math::uvec2":function(e,t){return new Uint32Array(g.buffer,e,2*t)},"w4::math::point":function(e,t){return new Uint32Array(g.buffer,e,2*t)},"w4::math::ivec2":function(e,t){return new Int32Array(g.buffer,e,2*t)},"w4::math::ivec3":function(e,t){return new Int32Array(g.buffer,e,3*t)},"w4::math::ivec4":function(e,t){return new Int32Array(g.buffer,e,4*t)},"w4::math::vec2":function(e,t){return new Float32Array(g.buffer,e,2*t)},"w4::math::vec3":function(e,t){return new Float32Array(g.buffer,e,3*t)},"w4::math::vec4":function(e,t){return new Float32Array(g.buffer,e,4*t)},"w4::math::mat3":function(e,t){return new Float32Array(g.buffer,e,9*t)},"w4::math::mat4":function(e,t){return new Float32Array(g.buffer,e,16*t)},"w4::math::rect":function(e,t){return new Float32Array(g.buffer,e,4*t)}},createProxy:function(e,t,n){const r=n.control,i={ctr:new Int8Array(g.buffer,t+r,1),set:function(e,t,n,r){return e[t]=n,this.ctr[0]=1,!0}};return new Proxy(e,i)},createPodRepl:function(e,t){let n;const r={__meta:{}};for(const i in t.descr){const o=t.descr[i];if("count"in o){const t=[];for(let r=0;r<o.count;++r)n=this.createField(e+o.offset+o.size*r,o.type,1),"control"in o&&(n=this.createProxy(n,e,o)),t.push(n);r[i]=t,r.__meta[i]={type:o.type,isArray:!0}}else n=this.createField(e+o.offset,o.type,1),"control"in o&&(n=this.createProxy(n,e,o)),null!=n&&(r[i]=n,r.__meta[i]={type:o.type,isArray:!1})}return r},createField:function(e,t,n){const r=this.defaultTypeConvertions[t];if(r)return r(e,n);const i=this.types[t];if(!i)return;const o=le.get(i);return this.createPodRepl(e,o)},registerPOD:function(e,t){const n=le.get(t),r=this.createPodRepl(e,n);return le.make(r,ce.deletePOD,`PodInstance.${n.typeName}`)},deletePOD:function(e){},registerType:function(e){const t=ge(e),n=le.make({descr:{},typeName:t},ce.deleteTypeDescr,`PodType.${t}`);return this.types[t]=n,n},deleteTypeDescr:function(e){}};function ue(e){fe.error("JS: "+e),he.stopUpdate();const t=document.getElementById("w4-gui");if(void 0===t)alert("JS: W4 FATAL ERROR:\n\n"+e);else{const n=document.createElement("div");n.classList.add("w4-fatal");const r=document.createTextNode("JS: W4 FATAL ERROR: "+e+" ... ");n.appendChild(r),t.appendChild(n)}throw"JS: W4L: TERMINATE :  "+e}var le={_table:{},_deleters:{},_types:{},_nextId:1,invalid:0,make:function(e,t,n){if(null==e)return 0;const r=this._nextId;return this._nextId++,this._table[r]=e,e.__outerId=r,t&&(this._deleters[r]=t),n&&(this._types[r]=n),r},isValid:function(e){return e!==this.invalid},get:function(e){return e in this._table||ue("Invalid pointer index "+e),this._table[e]},free:function(e){e in this._table||ue("Double free "+e);const t=this._table[e];e in this._deleters&&(this._deleters[e](t),delete this._deleters[e]),e in this._types&&delete this._types[e],delete this._table[e]}},fe={__internal:{remote:{clientId:void 0,connected:!1,address:void 0,lastTimeConnected:0,lastErrorTime:0,reconnectTimeout:5e3},Level:{TRACE:0,DEBUG:1,INFO:2,WARNING:3,ERROR:4,FATAL:5},Color:{0:"LightSlateGray",1:"darkgray",2:"darkcyan",3:"DarkGoldenRod",4:"maroon",5:"purple",6:"steelblue",7:"gray",8:"mediumpurple",9:"chocolate",10:"red",11:"crimson"},indentLevel:0,pushIndentLevel:function(){this.indentLevel+=1},popIndentLevel:function(){this.indentLevel>0&&(this.indentLevel-=1)},writeLog:function(e,t,n,r,i){this.writeLocalLog(Date.now(),e,t,n,r,i)},writeLocalLog:function(e,t,n,r,i,o){const a=new Date(e);let s=a.getMilliseconds()+"";for(;s.length<3;)s="0"+s;const c=a.getDate()+"."+a.getMonth()+"."+a.getFullYear()+" "+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()+"."+s,u=Object.keys(this.Level)[t][0],l=this.Color[t+n];let f="%c";t>this.Level.INFO&&void 0!==i&&(f+="("+i,void 0!==o&&(f+=":"+o),f+=")"),t>this.Level.ERROR?console.error((new Error).stack):t>this.Level.INFO?console.error("%c"+c+" ["+u+"] "+"  ".repeat(this.indentLevel)+r+f,"color:"+l,"color:black"):console.log("%c"+c+" ["+u+"] "+"  ".repeat(this.indentLevel)+r+f,"color:"+l,"color:black"),"object"==typeof r&&console.dir(r)},writeRemoteLog:function(e,t,n,r,i,o){const a={id:this.remote.clientId,level:t,timestamp:e,message:r};void 0!==i&&(a.fileName=i,void 0!==o&&(a.lineNumber=o)),t>this.Level.INFO&&(a.stack=(new Error).stack),fetch(this.remote.address,{method:"POST",mode:"no-cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then((function(){fe.__internal.remote.connected=!0}),(function(a){const s=new Error,c=Date.now();fe.__internal.remote.connected=!1,fe.__internal.remote.lastTimeConnected=c,c-fe.__internal.remote.lastErrorTime>fe.__internal.remote.reconnectTimeout&&(fe.__internal.writeLocalLog(fe.__internal.remote.lastTimeConnected,fe.__internal.Level.ERROR,0,"fail send log to remote server '"+fe.__internal.remote.address+"': "+a,s.fileName,s.lineNumber),fe.__internal.remote.lastErrorTime=c),fe.__internal.writeLocalLog(e,t,n,r,i,o)}))}},trace:function(e){this.__internal.writeLog(this.__internal.Level.TRACE,0,e)},debug:function(e){this.__internal.writeLog(this.__internal.Level.DEBUG,0,e)},info:function(e){this.__internal.writeLog(this.__internal.Level.INFO,0,e)},warning:function(e){this.__internal.writeLog(this.__internal.Level.WARNING,0,e)},error:function(e){this.__internal.writeLog(this.__internal.Level.ERROR,0,e)},initialize:function(e,t){this.__internal.remote.clientId=e,this.__internal.remote.address=t}};function de(){var e=function(){var e=new Error;if(!e.stack){try{throw new Error}catch(t){e=t}if(!e.stack)return"(no stack trace available)"}return e.stack.toString()}();return t.extraStackTrace&&(e+="\n"+t.extraStackTrace()),e.replace(/\b_Z[\w\d_]+/g,(function(e){return e==e?e:e+" ["+e+"]"}))}function me(e,t){return K(e,t,!1)}function ge(e){for(var t="";;){var n=p[e++>>0];if(!n)return t;t+=String.fromCharCode(n)}}var he={isUpdating:!1,fpsCap:8.333333333333334,_previousFrameTime:1721909443388,_updateCallback:void 0,_updateCallbackId:void 0,load:function(e,t){fe.trace("JS: load script : "+e);const n=document.createElement("script");n.src=e,document.body.appendChild(n),n.onload=t},onPause:function(){const e=se.getGlobalGain();se.setGlobalGain(0);const t=function(){se.setGlobalGain(e),document.removeEventListener("touchstart",t)};document.addEventListener("touchstart",t)},setUpdate:function(e){fe.trace("Set update callback"),this._previousFrameTime=Date.now(),this._updateCallback=e;const t=this;!function e(n){now=Date.now();let r=now-t._previousFrameTime;t._updateCallbackId=requestAnimationFrame(e),r>t.fpsCap&&(t._previousFrameTime=now-r%t.fpsCap,t._updateCallback())}(),this.isUpdating=!0},stopUpdate:function(){fe.trace("Stop update"),this._updateCallbackId?(cancelAnimationFrame(this._updateCallbackId),this.isUpdating=!1):fe.error("Call to stopUpdate() without set callback function")},startUpdate:function(){fe.trace("Start update"),this._updateCallback?this.setUpdate(this._updateCallback):fe.error("Call to startUpdate() without set callback function")},toggleUpdate:function(){this.isUpdating?this.stopUpdate():this.startUpdate()},abort:function(e){fe.error(de()),ue(e)},setFPSCap:function(e){fe.trace("Setting fps cap: "+e),this.fpsCap=1e3/e}};var _e=function(e){const t=e>>>0;return[(4278190080&t)>>>24,(16711680&t)>>>16,(65280&t)>>>8,255&t]},pe=function(e){const t=e>>>0;return"rgba("+[(4278190080&t)>>>24,(16711680&t)>>>16,(65280&t)>>>8,(255&t)/255].join(",")+")"},Ee={initialize:function(e,t){ve.callbackCreateBegin=e,ve.callbackCreateEnd=t},create:function(e,t,n=!1){const r=n?Ee.prototype(t,new Uint8Array(ve.defaultTextures.transparent.textureData),ve.defaultTextures.transparent.textureWidth,ve.defaultTextures.transparent.textureHeight):Ee.prototype(t,new Uint8Array(ve.defaultTextures.default.textureData),ve.defaultTextures.default.textureWidth,ve.defaultTextures.default.textureHeight);return ve.texturesParams[r]=t,ve.callbackCreateBegin(r),Re.get(e).then((function(e){const t=Re.processImagePowerOf2(e);Ue.bindTexture(Ue.TEXTURE_2D,le.get(r)),Ue.pixelStorei(Ue.UNPACK_FLIP_Y_WEBGL,!0),Ue.texImage2D(Ue.TEXTURE_2D,0,Ue.RGBA,Ue.RGBA,Ue.UNSIGNED_BYTE,t);const n=ve.texturesParams[r];ve.validateParameters(n),ve.setParameters(n),ve.generateMipmap(n),Ue.bindTexture(Ue.TEXTURE_2D,null),Ue.pixelStorei(Ue.UNPACK_FLIP_Y_WEBGL,!1),ve.callbackCreateEnd(r)})),Ue.bindTexture(Ue.TEXTURE_2D,null),r},createEmpty:function(e){const t=Ue.createTexture();return Ue.bindTexture(Ue.TEXTURE_2D,t),ve.validateParameters(e),ve.setParameters(e),le.make(t,ve.deleteTexture,"Texture")},prototype:function(e,t,n,r){const i=Ee.createEmpty(e);return Ue.texImage2D(Ue.TEXTURE_2D,0,Ue.RGBA,n,r,0,Ue.RGBA,Ue.UNSIGNED_BYTE,t),ve.generateMipmap(e),i},update:function(e,t){Ue.bindTexture(Ue.TEXTURE_2D,le.get(e)),ve.texturesParams[e]=t,ve.validateParameters(t),ve.setParameters(t),ve.generateMipmap(t),Ue.bindTexture(Ue.TEXTURE_2D,null)},delete:function(e){delete ve.texturesParams[e],le.free(e)}},ve={defaults:{minFilter:function(){return Ue.LINEAR},magFilter:function(){return Ue.LINEAR},wrapS:function(){return Ue.CLAMP_TO_EDGE},wrapT:function(){return Ue.CLAMP_TO_EDGE}},defaultTextures:{default:{textureData:[0,0,0,255,255,0,255,255,255,0,255,255,0,0,0,255],textureWidth:2,textureHeight:2},transparent:{textureData:[0,0,0,0,255,0,255,0,255,0,255,0,0,0,0,0],textureWidth:2,textureHeight:2}},anisoExt:void 0,getAnisoExt:function(){return void 0===this.anisoExt&&(this.anisoExt=Ue.getExtension("EXT_texture_filter_anisotropic")||Ue.getExtension("MOZ_EXT_texture_filter_anisotropic")||Ue.getExtension("WEBKIT_EXT_texture_filter_anisotropic")),this.anisoExt},deleteTexture:function(e){Ue.deleteTexture(e)},setParameters:function(e){if(Ue.texParameterf(Ue.TEXTURE_2D,Ue.TEXTURE_MIN_FILTER,e.minFilter),Ue.texParameterf(Ue.TEXTURE_2D,Ue.TEXTURE_MAG_FILTER,e.magFilter),Ue.texParameterf(Ue.TEXTURE_2D,Ue.TEXTURE_WRAP_S,e.wrapS),Ue.texParameterf(Ue.TEXTURE_2D,Ue.TEXTURE_WRAP_T,e.wrapT),!0===e.hasAniso){const e=this.getAnisoExt();if(e){const t=Ue.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT);Ue.texParameterf(Ue.TEXTURE_2D,e.TEXTURE_MAX_ANISOTROPY_EXT,t)}}},decodeFilterLevel:function(e,t){switch(e){case 0:return t.minFilter=Ue.NEAREST,void(t.magFilter=Ue.NEAREST);case 1:return t.minFilter=Ue.LINEAR,void(t.magFilter=Ue.LINEAR);case 2:return t.minFilter=Ue.LINEAR_MIPMAP_NEAREST,void(t.magFilter=Ue.LINEAR);case 3:return t.minFilter=Ue.LINEAR_MIPMAP_LINEAR,void(t.magFilter=Ue.LINEAR);case 4:return t.minFilter=Ue.LINEAR_MIPMAP_NEAREST,t.magFilter=Ue.LINEAR,void(t.hasAniso=!0);case 5:return t.minFilter=Ue.LINEAR_MIPMAP_LINEAR,t.magFilter=Ue.LINEAR,void(t.hasAniso=!0)}ue("texture.setFilters: unsupported filter level '"+e+"'")},decodeWrap:function(e,t,n){switch(e){case 0:return void(t[n]=Ue.REPEAT);case 1:return void(t[n]=Ue.MIRRORED_REPEAT);case 2:return void(t[n]=Ue.CLAMP_TO_EDGE)}ue("texture.setFilters: unsupported '"+n+"' wrapping '"+e+"'")},decodeParameters:function(e,t,n,r){return this.decodeFilterLevel(t,e),this.decodeWrap(n,e,"wrapS"),this.decodeWrap(r,e,"wrapT"),e},validateParameters:function(e){e.hasOwnProperty("minFilter")||(e.minFilter=ve.defaults.minFilter()),e.hasOwnProperty("magFilter")||(e.magFilter=ve.defaults.magFilter()),e.hasOwnProperty("wrapS")||(e.wrapS=ve.defaults.wrapS()),e.hasOwnProperty("wrapT")||(e.wrapT=ve.defaults.wrapT())},generateMipmap:function(e){(e.minFilter===Ue.LINEAR||e.minFilter===Ue.LINEAR_MIPMAP_LINEAR||e.minFilter===Ue.LINEAR_MIPMAP_NEAREST)&&Ue.generateMipmap(Ue.TEXTURE_2D)},callbackCreateBegin:function(e){},callbackCreateEnd:function(e){},texturesParams:{}},xe=function(e){var t=Ue.createTexture();return Ue.bindTexture(Ue.TEXTURE_CUBE_MAP,t),we.setParameters(e,!0),we.loadImage(e.sources.POSITIVE_X,t,"POSITIVE_X"),we.loadImage(e.sources.NEGATIVE_X,t,"NEGATIVE_X"),we.loadImage(e.sources.POSITIVE_Y,t,"POSITIVE_Y"),we.loadImage(e.sources.NEGATIVE_Y,t,"NEGATIVE_Y"),we.loadImage(e.sources.POSITIVE_Z,t,"POSITIVE_Z"),we.loadImage(e.sources.NEGATIVE_Z,t,"NEGATIVE_Z"),Ue.bindTexture(Ue.TEXTURE_CUBE_MAP,null),le.make(t,we.delete,"Cubemap")},Te=function(e){var t=Ue.createTexture();return Ue.bindTexture(Ue.TEXTURE_CUBE_MAP,t),we.setParameters({},!0),Ue.texImage2D(Ue.TEXTURE_CUBE_MAP_POSITIVE_X,0,Ue.RGBA,ve.defaultTextures.default.textureWidth,ve.defaultTextures.default.textureHeight,0,Ue.RGBA,Ue.UNSIGNED_BYTE,new Uint8Array(ve.defaultTextures.default.textureData)),Ue.texImage2D(Ue.TEXTURE_CUBE_MAP_NEGATIVE_X,0,Ue.RGBA,ve.defaultTextures.default.textureWidth,ve.defaultTextures.default.textureHeight,0,Ue.RGBA,Ue.UNSIGNED_BYTE,new Uint8Array(ve.defaultTextures.default.textureData)),Ue.texImage2D(Ue.TEXTURE_CUBE_MAP_POSITIVE_Y,0,Ue.RGBA,ve.defaultTextures.default.textureWidth,ve.defaultTextures.default.textureHeight,0,Ue.RGBA,Ue.UNSIGNED_BYTE,new Uint8Array(ve.defaultTextures.default.textureData)),Ue.texImage2D(Ue.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,Ue.RGBA,ve.defaultTextures.default.textureWidth,ve.defaultTextures.default.textureHeight,0,Ue.RGBA,Ue.UNSIGNED_BYTE,new Uint8Array(ve.defaultTextures.default.textureData)),Ue.texImage2D(Ue.TEXTURE_CUBE_MAP_POSITIVE_Z,0,Ue.RGBA,ve.defaultTextures.default.textureWidth,ve.defaultTextures.default.textureHeight,0,Ue.RGBA,Ue.UNSIGNED_BYTE,new Uint8Array(ve.defaultTextures.default.textureData)),Ue.texImage2D(Ue.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,Ue.RGBA,ve.defaultTextures.default.textureWidth,ve.defaultTextures.default.textureHeight,0,Ue.RGBA,Ue.UNSIGNED_BYTE,new Uint8Array(ve.defaultTextures.default.textureData)),Ue.bindTexture(Ue.TEXTURE_CUBE_MAP,null),le.make(t,we.delete,"CubemapDefault")},be=function(e,t){Ue.bindTexture(Ue.TEXTURE_CUBE_MAP,le.get(e)),we.setParameters(t,!1),Ue.bindTexture(Ue.TEXTURE_CUBE_MAP,null)},Ae=function(e){le.free(e)},we={defaults:{min:function(){return Ue.LINEAR},mag:function(){return Ue.LINEAR},wrapS:function(){return Ue.CLAMP_TO_EDGE},wrapT:function(){return Ue.CLAMP_TO_EDGE},NEGATIVE_X:[1,0,0,1],POSITIVE_X:[0,1,1,1],NEGATIVE_Y:[0,1,0,1],POSITIVE_Y:[1,0,1,1],NEGATIVE_Z:[0,0,1,1],POSITIVE_Z:[1,1,0,1]},setParameters:function(e,t){("min"in e||t)&&Ue.texParameteri(Ue.TEXTURE_CUBE_MAP,Ue.TEXTURE_MIN_FILTER,"min"in e?e.min:this.defaults.min()),("mag"in e||t)&&Ue.texParameteri(Ue.TEXTURE_CUBE_MAP,Ue.TEXTURE_MAG_FILTER,"mag"in e?e.mag:this.defaults.mag()),("wrapS"in e||t)&&Ue.texParameteri(Ue.TEXTURE_CUBE_MAP,Ue.TEXTURE_WRAP_S,"wrapS"in e?e.wrapS:this.defaults.wrapS()),("wrapT"in e||t)&&Ue.texParameteri(Ue.TEXTURE_CUBE_MAP,Ue.TEXTURE_WRAP_T,"wrapT"in e?e.wrapT:this.defaults.wrapT())},loadImage:function(e,t,n){Ue.texImage2D(Ue["TEXTURE_CUBE_MAP_"+n],0,Ue.RGBA,ve.defaultTextures.default.textureWidth,ve.defaultTextures.default.textureHeight,0,Ue.RGBA,Ue.UNSIGNED_BYTE,new Uint8Array(ve.defaultTextures.default.textureData)),Re.get(e).then((function(e){Ue.isTexture(t)&&(Ue.bindTexture(Ue.TEXTURE_CUBE_MAP,t),Ue.texImage2D(Ue["TEXTURE_CUBE_MAP_"+n],0,Ue.RGBA,Ue.RGBA,Ue.UNSIGNED_BYTE,e),Ue.bindTexture(Ue.TEXTURE_CUBE_MAP,null))}))},delete:function(e){Ue.deleteTexture(e)},decodeFilterLevel:function(e,t){switch(e){case 0:return t.min=Ue.NEAREST,void(t.mag=Ue.NEAREST);case 1:return t.min=Ue.LINEAR,void(t.mag=Ue.LINEAR);case 2:return t.min=Ue.LINEAR_MIPMAP_NEAREST,void(t.mag=Ue.LINEAR);case 3:return t.min=Ue.LINEAR_MIPMAP_LINEAR,void(t.mag=Ue.LINEAR)}},decodeWrap:function(e,t,n){switch(e){case 0:return void(t[n]=Ue.REPEAT);case 1:return void(t[n]=Ue.MIRRORED_REPEAT);case 2:return void(t[n]=Ue.CLAMP_TO_EDGE)}},decodeParameters:function(e,t,n,r){return this.decodeFilterLevel(t,e),this.decodeWrap(n,e,"wrapS"),this.decodeWrap(r,e,"wrapT"),e}};var ye={loader:void 0,initialize:function(e,t){fe.trace("Creating loader..."),this.loader=document.getElementById(t),e.appendChild(this.loader)}},Ie={baseDiv:void 0,canvas:void 0,onResizeCallback:void 0,aspectW:9,aspectH:16,aspectWH:null,aspectHW:null,DPR:1,initialize:function(e,t,n,r){this.baseDiv=document.getElementById(e),(void 0===this.baseDiv||null===this.baseDiv||"DIV"!==this.baseDiv.tagName)&&ue("Window initialize: '"+e+"' is not DIV element"),this.onResizeCallback=t,this.canvas=document.createElement("canvas"),this.canvas.id=e+"-canvas",this.canvas.style.cssText="position: absolute; display: block; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: all; ",this.baseDiv.appendChild(this.canvas),this.canvas.width=this.canvas.clientWidth,this.canvas.height=this.canvas.clientHeight,fe.trace("W4: Canvas: "+this.canvas.width+"x"+this.canvas.height);const i=document.createElement("div");i.id="w4-gui",i.style.cssText="position: relative; display: block; width: 100%; height: 100%;  pointer-events: none; top: 0; left: 0; margin: auto; z-index: 2;",this.baseDiv.appendChild(i),ye.initialize(this.baseDiv,"w4-loader"),fe.trace("W4: create WebGL Context..."),oe.createContext(this.canvas),this.DPR=window.devicePixelRatio,this.setStyle(this.baseDiv.className),window.addEventListener("resize",(function(){Ie.doResize()}),!0),window.addEventListener("blur",(function(e){n(),e.preventDefault()}),!1),window.addEventListener("focus",(function(e){r(),e.preventDefault()}),!1),window.addEventListener("pagehide",(function(e){n(),e.preventDefault()}),!1),window.addEventListener("pageshow",(function(e){r(),e.preventDefault()}),!1),window.addEventListener("visibilitychange",(function(e){"visible"===document.visibilityState?r():n(),e.preventDefault()}),!1)},setAspect:function(e,t){this.aspectW=e,this.aspectH=t,this.aspectWH=e/t,this.aspectHW=t/e,this.setStyle(this.currentStyle)},setStyle:function(e){this.currentStyle=e;const t=window.innerWidth,n=window.innerHeight,r=t/n;fe.trace("Platform::SetStyle("+e+")  "+this.aspectW+" / "+this.aspectH+"  "+t+" x "+n);const i="top:0; left:0; z-index: 0; pointer-events: all; margin: auto;";let o={};r<=this.aspectWH?(o.portrait=i+"position: absolute; bottom: 0;right: 0; width: 100vw; height: calc(100vw * "+this.aspectHW+");",o.landscape=i+"position: absolute; bottom: 0; right: 0; width: 100vw; height: calc(100vw * "+this.aspectHW+");"):(o.portrait=i+"position: relative; width: calc(100vh * "+this.aspectWH+"); height: 100vh;",o.landscape=i+"position: relative; width: calc(100vh * "+this.aspectWH+"); height: 100vh;"),void 0===o[e]?this.baseDiv.style.cssText=i+"position: absolute; width: 100%; height: 100%;":this.baseDiv.style.cssText=o[e],this.applyResize()},applyResize:function(){this.canvas.width=Math.floor(this.canvas.clientWidth*this.DPR),this.canvas.height=Math.floor(this.canvas.clientHeight*this.DPR),this.onResizeCallback(this.canvas.width,this.canvas.height),oe.context.viewport(0,0,this.canvas.width,this.canvas.height),oe.context.bindFramebuffer(oe.context.FRAMEBUFFER,null)},doResize:function(){this.currentStyle&&this.setStyle(this.currentStyle)}},Re={isPowerOfTwo:function(e){return 0==(e&e-1)},nextHighestPowerOfTwo:function(e){--e;for(var t=1;t<32;t<<=1)e|=e>>t;return e+1},processImagePowerOf2:function(e){if(null==e)return null;if(!Re.isPowerOfTwo(e.width)||!Re.isPowerOfTwo(e.height)){const t=document.createElement("canvas");t.width=Re.nextHighestPowerOfTwo(e.width),t.height=Re.nextHighestPowerOfTwo(e.height);return t.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height),t}return e},_createInternal:function(e){const t={image:new Image,isLoading:!0,isError:!1,callbacks:[]};return t.image.onload=function(){const e=t.image.src;URL.revokeObjectURL(e),t.isLoading=!1,t.callbacks.forEach((function(e){e()}))},t.image.onerror=function(){t.isLoading=!1,t.isError=!0,fe.warning("fail to load image from '"+e+"'")},t.image.crossOrigin="anonymous",t},createFromUrl:function(e){const t=Re._createInternal();let n=e;if(!W.isURL(e)){const t=W.get(e);void 0===t&&ue("fail to load image from '"+e+"'");const r=new Blob([t.data],{type:t.type});n=(window.URL||window.webkitURL).createObjectURL(r)}return t.image.src=n,le.make(t,void 0,"Image.FromUrl")},createFromData:function(e,t){const n=Re._createInternal(),r=new Blob([t],{type:e}),i=window.URL||window.webkitURL;return n.image.src=i.createObjectURL(r),le.make(n,void 0,"Image.FromData")},createFromBlob:function(e){const t=Re._createInternal();return t.image.src=e,le.make(t,void 0,"Image.FromBlob")},get:function(e){return new Promise((function(t){const n=le.get(e),r=function(){t(n.image)};n.isLoading?n.callbacks.push(r):r()}))},delete:function(e){le.free(e)}};var Se={gamePadCount:0,gamepadData:void 0,_updateCallbackId:void 0,initialize:function(e,t){this.gamepadData=t,e.addEventListener("gamepadconnected",(function(t){fe.info("JS: Gamepad connected at index "+t.gamepad.index+": "+t.gamepad.id+". "+t.gamepad.buttons.length+" buttons, "+t.gamepad.axes.length+" axes."),Se.gamePadCount++,function t(n){if(Se.gamePadCount){let n;if(navigator.getGamepads)n=navigator.getGamepads();else{if(!navigator.webkitGetGamepads)return;n=navigator.webkitGetGamepads()}let r=n[0];Se.gamepadData.buttonsCount[0]=r.buttons.length,Se.gamepadData.axesCount[0]=r.axes.length;for(let e=0;e<r.buttons.length;++e)Se.gamepadData.buttonsState[e][0]=r.buttons[e].pressed?1:0;for(let e=0;e<r.axes.length;++e)Se.gamepadData.axesState[e][0]=r.axes[e].valueOf();Se._updateCallbackId=e.requestAnimationFrame(t)}}()})),e.addEventListener("gamepaddisconnected",(function(e){fe.info("Gamepad disconnected from index "+e.gamepad.index+": "+e.gamepad.id),Se.gamePadCount--}))}};var Le={keyboardLocked:!1,KeyCodeByName:{Unidentified:0,Backspace:8,Tab:9,Enter:13,NumpadEnter:13,ShiftLeft:16,ShiftRight:16,ControlLeft:17,ControlRight:17,AltLeft:18,AltRight:8,Pause:19,CapsLock:20,Escape:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,ArrowLeft:37,ArrowUp:38,ArrowRight:39,ArrowDown:40,PrintScreen:44,Insert:45,Delete:46,Digit0:48,Digit1:49,Digit2:50,Digit3:51,Digit4:52,Digit5:53,Digit6:54,Digit7:55,Digit8:56,Digit9:57,KeyA:65,KeyB:66,KeyC:67,KeyD:68,KeyE:69,KeyF:70,KeyG:71,KeyH:72,KeyI:73,KeyJ:74,KeyK:75,KeyL:76,KeyM:77,KeyN:78,KeyO:79,KeyP:80,KeyQ:81,KeyR:82,KeyS:83,KeyT:84,KeyU:85,KeyV:86,KeyW:87,KeyX:88,KeyY:89,KeyZ:90,MetaLeft:91,MetaRight:92,ContextMenu:93,Numpad0:96,Numpad1:97,Numpad2:98,Numpad3:99,Numpad4:100,Numpad5:101,Numpad6:102,Numpad7:103,Numpad8:104,Numpad9:105,NumpadMultiply:106,NumpadAdd:107,NumpadSubtract:109,NumpadDecimal:110,NumpadDivide:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NumLock:144,ScrollLock:145,AudioVolumeMute:173,VolumeMute:173,AudioVolumeDown:174,VolumeDown:174,AudioVolumeUp:175,VolumeUp:175,Semicolon:186,Equal:187,Comma:188,Minus:189,Period:190,Slash:191,Backquote:192,BracketLeft:219,Backslash:220,BracketRight:221,Quote:222},getPlatformKeyboardCode:function(e){return this.KeyCodeByName.hasOwnProperty(e)?this.KeyCodeByName[e]:0},initialize:function(e,t,n){e.addEventListener("keydown",(function(e){const r=e.altKey|e.ctrlKey<<1|e.shiftKey<<2;if(t(Le.getPlatformKeyboardCode(e.code),1,r),1===e.key.length&&!e.ctrlKey&&!e.metaKey){const t=e.key.codePointAt(0);n(t)}Le.keyboardLocked&&e.preventDefault()}),!1),e.addEventListener("keyup",(function(e){const n=e.altKey|e.ctrlKey<<1|e.shiftKey<<2;t(Le.getPlatformKeyboardCode(e.code),0,n),Le.keyboardLocked&&e.preventDefault()}),!1)}};var Pe={context:void 0,PointerState:{up:0,down:1,move:2},_contextMenuBlockHandler:function(e){e.preventDefault()},_pointerLockHandler:function(){Pe.isPointerLocked()||Pe.requestPointerLock()},initialize:function(e,t){this.context=e;{let n=new Set;e.addEventListener("mousedown",(function(r){const i=Pe.getMousePos(e,r),o=r.movementX||r.mozMovementX||r.webkitMovementX||r.msMovementX||r.oMovementX||0,a=r.movementY||r.mozMovementY||r.webkitMovementY||r.msMovementY||r.oMovementY||0,s=r.hasOwnProperty("id")?r.id:0;n.add(r.button),t(i.x,i.y,o,a,r.button,Pe.PointerState.down,s)}),!1),e.addEventListener("mouseup",(function(r){const i=Pe.getMousePos(e,r),o=r.movementX||r.mozMovementX||r.webkitMovementX||r.msMovementX||r.oMovementX||0,a=r.movementY||r.mozMovementY||r.webkitMovementY||r.msMovementY||r.oMovementY||0,s=r.hasOwnProperty("id")?r.id:0;n.delete(r.button),t(i.x,i.y,o,a,r.button,Pe.PointerState.up,s)}),!1),e.addEventListener("mousemove",(function(n){const r=Pe.getMousePos(e,n),i=n.movementX||n.mozMovementX||n.webkitMovementX||n.msMovementX||n.oMovementX||0,o=n.movementY||n.mozMovementY||n.webkitMovementY||n.msMovementY||n.oMovementY||0,a=n.hasOwnProperty("id")?n.id:0;t(r.x,r.y,i,o,n.button,Pe.PointerState.move,a)}),!1),window.addEventListener("mouseup",(function(t){if(n.has(t.button)){let n=new MouseEvent("mouseup",t);e.dispatchEvent(n)}}),!1);let r={},i={};e.addEventListener("touchstart",(function(t){for(let n=0;n<t.changedTouches.length;++n){let o=t.changedTouches[n],a=new MouseEvent("mousedown",{clientX:o.clientX,clientY:o.clientY,movementX:0,movementY:0,button:100});a.id=o.identifier,r[o.identifier]=o.clientX,i[o.identifier]=o.clientY,e.dispatchEvent(a)}t.preventDefault()}),!1),e.addEventListener("touchend",(function(t){for(let n=0;n<t.changedTouches.length;++n){let r=t.changedTouches[n],i=new MouseEvent("mouseup",{clientX:r.clientX,clientY:r.clientY,movementX:0,movementY:0,button:100});i.id=r.identifier,e.dispatchEvent(i)}t.preventDefault()}),!1),e.addEventListener("touchmove",(function(t){for(let n=0;n<t.changedTouches.length;++n){let o=t.changedTouches[n],a=new MouseEvent("mousemove",{clientX:o.clientX,clientY:o.clientY,movementX:o.clientX-r[o.identifier],movementY:o.clientY-i[o.identifier],button:100});a.id=o.identifier,r[o.identifier]=o.clientX,i[o.identifier]=o.clientY,e.dispatchEvent(a)}t.preventDefault()}),!1)}},getMousePos:function(e,t){const n=e.getBoundingClientRect();return{x:(t.clientX-n.left)*Ie.DPR,y:(t.clientY-n.top)*Ie.DPR}},isPointerLocked:function(){return null!==(document.pointerLockElement||document.mozPointerLockElement||document.webkitPointerLockElement||document.msPointerLockElement||document.oPointerLockElement||null)},requestPointerLock:function(){const e=this.context.requestPointerLock||this.context.mozRequestPointerLock||this.context.webkitRequestPointerLock||this.context.msRequestPointerLock||this.context.oRequestPointerLock||null;null===e?fe.warning("Pointer lock is not supported in this browser."):this.isPointerLocked()?fe.trace("Pointer is already locked"):e.bind(this.context)()},exitPointerLock:function(){const e=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock||document.msExitPointerLock||document.oExitPointerLock||null;null===e?console.warn("Pointer lock exit is not supported in this browser."):this.isPointerLocked()?e.bind(document)():console.warn("Pointer is already unlocked")},setPointerLockedOnce:function(e){e?this.requestPointerLock():this.exitPointerLock()},setPointerLockedAlways:function(e){e?(this.requestPointerLock(),this.context.addEventListener("click",this._pointerLockHandler)):(this.exitPointerLock(),this.context.removeEventListener("click",this._pointerLockHandler))},setContextMenuEnabled:function(e,t){const n=e||this.context;t?n.removeEventListener("contextmenu",Pe._contextMenuBlockHandler):n.addEventListener("contextmenu",Pe._contextMenuBlockHandler)}};var Fe=function(e,t){const n=function(e){const n=(e.deltaY||-e.wheelDelta||e.detail)>>10||1;t(n)};e.addEventListener("wheel",n,!1),e.addEventListener("mousewheel",n,!1),e.addEventListener("DOMMouseScroll",n,!1)};var Ce={renderState:{isBlending:!1,prevProgram:null,prevMatInst:null,prevVao:null,frame:null,shadowData:null,object:null,buildInId:[],buildInData:[],_convertTypes:function(e){e.__glBinding={};for(const t in e.__meta){let n=re.string2glValueEnum(e.__meta[t].type);if(n){let r=e[t];if(Array.isArray(r))for(let i=0;i<r.length;++i)e.__glBinding[t+"["+i+"]"]={type:n,value:r[i]};else e.__glBinding[t]={type:n,value:r}}}},_updateBuildInData:function(e,t){e.__idx=t,this.buildInData[t]=e,this._convertTypes(e),this.buildInId[t]?this.buildInId[t]++:this.buildInId[t]=1},updateRenderState:function(e,t,n,r){this.frame=e,this._updateBuildInData(this.frame,0),this.shadowData=t,this._updateBuildInData(this.shadowData,1),this.object=n,this._updateBuildInData(this.object,2),this.objectData=r}},_setupBuiltinParams:function(e,t,n){const r=e.__idx,i=t.material;i.buildInId[r]!==this.renderState.buildInId[r]&&(Be.resetBuiltinParams(i,r,e),i.buildInId[r]=this.renderState.buildInId[r]),Be.setupBuiltinParams(t,r,n)},draw:function(){const e=this.renderState,t=e.object,n=e.objectData.surface[0],r=le.get(n),i=this.overrideMaterial||r.material;if(r.hasVao){const t=r.getVao(i);t!==e.prevVao&&(Ue.bindVertexArray(t),e.prevVao=t)}else Ue.bindVertexArray(null),e.prevVao=null,Me.bindBuffers(r,i);const o=r.renderType,a=Be.getShaderProgram(i,o);if(a!==e.prevProgram){Ue.useProgram(a),Be.resetBuiltinContext(i,o);const t=e.frame,n=e.shadowData;this._setupBuiltinParams(t,i,o),this._setupBuiltinParams(n,i,o),e.prevProgram=a,e.prevMatInst=void 0}e.prevMatInst!==i&&(Be.setupUserParams(i,o),e.prevMatInst=i),this._setupBuiltinParams(t,i,o),Ce.renderState.isBlending&&Ue.blendFunc(i.blending.src,i.blending.dst);const s=i.scissor.enabled,c=i.depthWrite,u=i.cullFaceMode;if(s){Ue.enable(Ue.SCISSOR_TEST);const{posX:e,posY:t,sizeX:n,sizeY:r}=i.scissor;Ue.scissor(e,t,n,r)}!1===c&&Ue.depthMask(!1),u!==Ue.BACK&&(u===Ue.ZERO?Ue.disable(Ue.CULL_FACE):Ue.cullFace(u)),Ue.drawElements(i.material.primitiveType,r.indicesBuffer.count,Ue.UNSIGNED_INT,r.indicesBuffer.offset),s&&Ue.disable(Ue.SCISSOR_TEST),!1===c&&Ue.depthMask(!0),u!==Ue.BACK&&(u===Ue.ZERO?Ue.enable(Ue.CULL_FACE):Ue.cullFace(Ue.BACK))}},Be={materialCache:{},invalidMaterial:void 0,findInCache:function(e,t){return e in this.materialCache?this.materialCache[e][t]:null},createUniformView:function(e,t,n){const r=re.glValueEnum2size(t)*(n||1);switch(t){case Ue.INT:return new Int32Array(g.buffer,e,r);case Ue.FLOAT:case Ue.FLOAT_VEC2:case Ue.FLOAT_VEC3:case Ue.FLOAT_VEC4:case Ue.FLOAT_MAT3:case Ue.FLOAT_MAT4:return new Float32Array(g.buffer,e,r);case Ue.SAMPLER_2D:case Ue.SAMPLER_CUBE:return new Int32Array(g.buffer,e,r)}return fe.error("RenderState: unsupported field type '"+t+"'"),null},createShader:function(e,t){let n=null;switch(t){case 1:n=Ue.VERTEX_SHADER;break;case 2:n=Ue.FRAGMENT_SHADER}const r=Ue.createShader(n);Ue.shaderSource(r,ge(e)),Ue.compileShader(r);return Ue.getShaderParameter(r,Ue.COMPILE_STATUS)?le.make(r,Be.deleteShader,"Shader"):(console.error("could not compile shader("+t+"): "+Ue.getShaderInfoLog(r)+"\n"+ge(e)),le.invalid)},deleteShader:function(e){Ue.deleteShader(e)},createShaderProgram:function(e,n,r,i,o){let a=this.findInCache(n,r);if(a)for(let n=0;n<a.paramMapping.length;++n){let r=a.paramMapping[n].uniform,i=t._malloc(r.name.length+1);me(r.name,i);let s=4*re.glValueEnum2size(r.type);R.get(o)(e.context,i,r.type,s),t._free(i)}else{const i=Ue.createProgram();Ue.attachShader(i,le.get(n)),Ue.attachShader(i,le.get(r)),Ue.linkProgram(i);if(!Ue.getProgramParameter(i,Ue.LINK_STATUS))return console.error("program failed to link: "+Ue.getProgramInfoLog(i)),le.invalid;const s=Ue.getProgramParameter(i,Ue.ACTIVE_UNIFORMS),c=[],u={};for(let n=0;n<s;n++){const r=Ue.getActiveUniform(i,n);let a,s=Ue.getUniformLocation(i,r.name);if("[0]"===r.name.substr(-3)){a=r.name.slice(0,-3);for(let e=0;e<r.size;++e){const t=a+"["+e+"]";s=Ue.getUniformLocation(i,t),u[t]={info:r,location:s}}}else a=r.name,u[a]={info:r,location:s};let l=!1;for(let e=0;e<Ce.renderState.buildInData.length;e++)if(a in Ce.renderState.buildInData[e]){l=!0;break}if(l)continue;const f=t._malloc(r.name.length+1);me(r.name,f);const d=4*re.glValueEnum2size(r.type),m=R.get(o)(e.context,f,r.type,d);t._free(f),c.push({uniform:r,location:s,offset:m})}const l=Ue.getProgramParameter(i,Ue.ACTIVE_ATTRIBUTES),f={},d={};for(let e=0;e<l;e++){const t=Ue.getActiveAttrib(i,e);f[e]=t;const n=Ue.getAttribLocation(i,t.name);d[t.name]={info:t,location:n}}a={program:i,paramMapping:c,attributes:d,uniforms:u,buildInSetters:[],builtInContext:{currentTextureIdx:0}},n in this.materialCache||(this.materialCache[n]={}),this.materialCache[n][r]=a}return e.programs[i]=a,e.programs.length-1},createMaterial:function(e,t){return le.make({context:e,programs:{},buildInId:[],primitiveType:re.number2glPrimitiveType(t)},Be.deleteMaterial,"Material")},getShaderProgram:function(e,t){return e.material.programs[t].program},deleteMaterial:function(e){Ue.deleteProgram(e.program)},createMaterialInst:function(e,t){const n={},r={},i=le.get(e);for(const e in i.programs){const o=i.programs[e],a={},s=[];for(const e in o.paramMapping){const n=o.paramMapping[e],r={view:this.createUniformView(t+n.offset,n.uniform.type),location:n.location,uniform:n.uniform};a[n.uniform.name]=r,s.push(r)}n[e]=a,r[e]=s}return le.make({material:i,dataPtr:t,userParams:n,userParamsList:r,blending:{src:Ue.ONE,dst:Ue.ZERO},scissor:{enabled:!1,posX:0,posY:0,sizeX:0,sizeY:0},depthWrite:!0,cullFaceMode:Ue.BACK},Be.deleteMaterialInst,"MaterialInstance")},deleteMaterialInst:function(e){},setupUserParams:function(e,t){const n={currentTextureIdx:e.material.programs[t].builtInContext.currentTextureIdx},r=e.userParamsList[t];for(let e=0,t=r.length;e<t;e++){const t=r[e];this.setParam(t.location,t.uniform.type,t.view,n)}},getAttributes:function(e,t){return e.material.programs[t].attributes},resetBuiltinParams:function(e,t,n){for(const r in e.programs){const i=e.programs[r];i.buildInSetters[t]=[];for(const e in n.__glBinding){const r=n.__glBinding[e],o=r.value,a=i.uniforms[e];void 0!==a&&Be.addBuiltinSetter(i,t,a,r.type,o)}}},resetBuiltinContext:function(e,t){e.material.programs[t].builtInContext.currentTextureIdx=0},setupBuiltinParams:function(e,t,n){const r=e.material.programs[n];for(let e=0,n=r.buildInSetters[t].length;e<n;e++)r.buildInSetters[t][e]()},addBuiltinSetter:function(e,t,n,r,i){e.buildInSetters[t].push((function(){Be.setParam(n.location,r,i,e.builtInContext)}))},setBlending:function(e,t,n){const r=le.get(e);r.blending.src=t,r.blending.dst=n},setScissor:function(e,t,n,r,i,o){const a=le.get(e);a.scissor.enabled=t,a.scissor.posX=n,a.scissor.posY=r,a.scissor.sizeX=i,a.scissor.sizeY=o},setDepthWrite:function(e,t){le.get(e).depthWrite=t},setCullFace:function(e,t){le.get(e).cullFaceMode=t},setParam:function(e,t,n,r){let i,o,a;switch(t){case Ue.FLOAT:Ue.uniform1f(e,n);break;case Ue.INT:Ue.uniform1i(e,n);break;case Ue.FLOAT_VEC2:Ue.uniform2fv(e,n);break;case Ue.FLOAT_VEC3:Ue.uniform3fv(e,n);break;case Ue.FLOAT_VEC4:Ue.uniform4fv(e,n);break;case Ue.FLOAT_MAT3:Ue.uniformMatrix3fv(e,!1,n);break;case Ue.FLOAT_MAT4:Ue.uniformMatrix4fv(e,!1,n);break;case Ue.SAMPLER_2D:i=n[0],i!=le.invalid&&(o=le.get(i),a=o,Ue.activeTexture(Ue.TEXTURE0+r.currentTextureIdx),a?(Ue.bindTexture(Ue.TEXTURE_2D,a),Ue.uniform1i(e,r.currentTextureIdx)):Ue.bindTexture(Ue.TEXTURE_2D,null),r.currentTextureIdx+=1);break;case Ue.SAMPLER_CUBE:i=n[0],i!=le.invalid&&(o=le.get(i),a=o,Ue.activeTexture(Ue.TEXTURE0+r.currentTextureIdx),a?(Ue.bindTexture(Ue.TEXTURE_CUBE_MAP,a),Ue.uniform1i(e,+r.currentTextureIdx)):Ue.bindTexture(Ue.TEXTURE_CUBE_MAP,null),r.currentTextureIdx+=1)}}};var De={_board:null,_onGUIEvent:void 0,virtualSize:{width:0,height:0},widgetClasses:{},imagesBlobs:{},isValid:function(){return void 0!==De._board&&null!==De._board},onEvent:function(e,t){R.get(De._onGUIEvent)(e,t)},Event:{Tap:0,TouchBegin:1,TouchEnd:2},registerWidgetClass:function(e,t){void 0!==t.init&&t.init(),De.widgetClasses[e]=t},findWidgetClass:function(e){return De.widgetClasses[e]},addElement:function(e){return De._board.appendChild(e),le.make(e)},findElement:function(e){return le.get(e)},removeElement:function(e){if(null!=e){var t=le.get(e);t&&(De._board.removeChild(t),le.free(e))}},init:function(e,t){if(De._board=document.getElementById(e),De._onGUIEvent=t,null!=De._board){var n=De._board.getBoundingClientRect();n.width>n.height?(De.virtualSize.width=1920,De.virtualSize.height=1080):(De.virtualSize.width=1080,De.virtualSize.height=1920)}},getScreenSize:function(){if(null!=De._board){var e=De._board.getBoundingClientRect();return{width:e.width,height:e.height}}},getVirtualSize:function(){return De.virtualSize},toNormalizeCoord:function(e,t){return{x:e.x/De.virtualSize.width*100,y:e.y/De.virtualSize.height*100}},delete:function(e){le.free(e)},getImageUrl:function(e){var t,n,r,i;if(0==e&&ue("getImageUrl '"+e+" is null pointer'"),0!=(t=A(e)).length)return t in this.imagesBlobs?this.imagesBlobs[t]:W.isURL(t)?t:(void 0===(n=W.get(t))&&ue("fail to load image from '"+t+"'"),r=new Blob([n.data],{type:n.type}),i=(window.URL||window.webkitURL).createObjectURL(r),this.imagesBlobs[t]=i,i)},toColor:function(e){return"rgba("+[(4278190080&(e>>>=0))>>>24,(16711680&e)>>>16,(65280&e)>>>8,(255&e)/255].join(",")+")"},CSSlinearGradient:function(e,t){return"linear-gradient(to bottom, "+this.toColor(e)+", "+this.toColor(t)+")"},toDarkenColor:function(e,t){return this.toLightenDarkenColor(e,-t)},toLightenColor:function(e,t){return this.toLightenDarkenColor(e,t)},toLightenDarkenColor:function(e,t){var n=(65280&(e>>>=0))>>>8,r=(16711680&e)>>>16,i=(4278190080&e)>>>24;return(i+=t)>255?i=255:i<0&&(i=0),(n+=t)>255?n=255:n<0&&(n=0),(r+=t)>255?r=255:r<0&&(r=0),"rgba("+[i,r,n,(255&e)/255].join(",")+")"},getFont:function(e){var t;switch(e){case 0:default:t="Courier New, Courier, monospace";break;case 1:t="Arial, sans-serif";break;case 2:t="Times, serif";break;case 3:t="Copperplate, fantasy";break;case 4:t="Helvetica, sans-serif";break;case 5:t="FreeMono, monospace";break;case 6:t="ComicSans, cursive";break;case 7:t="Tahoma, sans-serif";break;case 8:t="Lato, sans-serif"}return t}};var Me={__internal:{cache:{},surfacesByVao:{},bindBuffers:function(e,t){Ue.bindBuffer(Ue.ARRAY_BUFFER,e.verticesBuffer),Ue.bindBuffer(Ue.ELEMENT_ARRAY_BUFFER,e.indicesBuffer);const n=Be.getAttributes(t,e.renderType);for(const t in n){const r=n[t].location,i=e.verticesBuffer.vertexFormat.attributes[t];void 0===i&&ue("Unknown vertex attribute "+t),Ue.vertexAttribPointer(r,i.size/4,Ue.FLOAT,!1,e.verticesBuffer.vertexFormat.stride,i.offset),Ue.enableVertexAttribArray(r)}},getVao:function(e,t){if(void 0!==t&&void 0!==e.verticesBuffer&&void 0!==e.indicesBuffer){const n=t.__outerId;n in this.cache||(this.cache[n]={});const r=this.cache[n];if(!(e.verticesBufferId in r)||e.verticesBuffer.updated){const t=r[e.verticesBufferId];t&&Object.entries(t).map((([e,t])=>{Ue.bindVertexArray(null),Ue.deleteVertexArray(t)})),r[e.verticesBufferId]={},e.verticesBuffer.updated=!1}const i=r[e.verticesBufferId];if(!(e.indicesBufferId in i)||e.indicesBuffer.updated){e.indicesBuffer.updated=!1;const n=i[e.indicesBufferId];n&&(Ue.bindVertexArray(null),Ue.deleteVertexArray(n));const r=Ue.createVertexArray();i[e.indicesBufferId]=r,Ue.bindVertexArray(r),this.bindBuffers(e,t),Ue.bindVertexArray(null)}return i[e.indicesBufferId]}return null},updateVao:function(e){e.needUpdate&&(e.vao=this.getVao(e,e.material),e.vao&&(e.needUpdate=!1))},delete:function(e){}},create:function(e){const t={vao:void 0,hasVao:e,material:void 0,verticesBuffer:void 0,verticesBufferId:void 0,indicesBuffer:void 0,indicesBufferId:void 0,renderType:void 0,needUpdate:!0,__vaoCache:{},__prevMat:{__outerId:void 0},__prevVao:void 0,getVao:function(e){(this.verticesBuffer.updated||this.indicesBuffer.updated)&&(this.needUpdate=!0,Me.__internal.updateVao(this),this.__prevMat={__outerId:void 0},this.__prevVao=void 0);const t=e.__outerId;if(t===this.material.__outerId)return this.vao;if(t===this.__prevMat.__outerId)return this.__prevVao;let n=this.__vaoCache[t];return n||(n=Me.__internal.getVao(this,e),this.__vaoCache[t]=n),this.__prevMat=e,this.__prevVao=n,n}};return le.make(t,(function(){Me.__internal.delete(t)}),"Surface")},setMaterial:function(e,t){const n=le.get(e);n.materialId=t,n.material=le.get(t),n.needUpdate=!0,n.hasVao&&this.__internal.updateVao(n)},setRenderType:function(e,t){const n=le.get(e);n.renderType=t,n.needUpdate=!0,n.hasVao&&this.__internal.updateVao(n)},setVerticesBuffer:function(e,t){const n=le.get(e);n.needUpdate=!0,n.verticesBufferId=t,n.verticesBuffer=le.get(t),n.__vaoCache={},n.hasVao&&this.__internal.updateVao(n)},setIndicesBuffer:function(e,t){const n=le.get(e);n.needUpdate=void 0===n.indicesBuffer,n.indicesBufferId=t,n.indicesBuffer=le.get(t),n.__vaoCache={},n.hasVao&&this.__internal.updateVao(n)},bindBuffers:function(e,t){this.__internal.bindBuffers(e,t)}};var Ne={__internal:{indicesTypeLength:4,decryptBufferUsage:function(e){switch(e){case 0:return Ue.STATIC_DRAW;case 1:return Ue.DYNAMIC_DRAW;case 2:return Ue.STREAM_DRAW}ue("invalid buffer usage value: "+e)},delete:function(e){Ue.deleteBuffer(e)}},createVerticesBuffer:function(e,t){const n=Ue.createBuffer();n.type=Ue.ARRAY_BUFFER,n.usage=e,n.vertexFormat={attributes:le.get(t).descr,stride:0};for(const e in n.vertexFormat.attributes)n.vertexFormat.stride+=n.vertexFormat.attributes[e].size;return n.data=void 0,le.make(n,this.__internal.delete,"VerticesBuffer")},createIndicesBuffer:function(e){const t=Ue.createBuffer();return t.type=Ue.ELEMENT_ARRAY_BUFFER,t.usage=e,t.offset=0,t.count=0,le.make(t,this.__internal.delete,"IndicesBuffer")},updateData:function(e,t,n){const r=le.get(e);let i;Ue.bindBuffer(r.type,r),r.data&&(delete r.data,r.data=null),i=r.type===Ue.ELEMENT_ARRAY_BUFFER?new Uint32Array(g.buffer,t,n/4):new Float32Array(g.buffer,t,n/4),r.data=i,r.updated=!0,Ue.bufferData(r.type,i,r.usage)},updateIndicesUsage:function(e,t,n){const r=le.get(e);r.offset=t,r.count=n}};var Ue,Oe=function(e){Ue.deleteFramebuffer(e)};function ke(e){return t["_"+e]}function Ge(e,t,n,r,i){var o={string:e=>{var t=0;if(null!=e&&0!==e){var n=1+(e.length<<2);(function(e,t,n){w(e,p,t,n)})(e,t=Ye(n),n)}return t},array:e=>{var t=Ye(e.length);return ee(e,t),t}};var a=ke(e),s=[],c=0;if(r)for(var u=0;u<r.length;u++){var l=o[n[u]];l?(0===c&&(c=We()),s[u]=l(r[u])):s[u]=r[u]}var f=a.apply(null,s);return f=function(e){return 0!==c&&He(c),function(e){return"string"===t?A(e):"boolean"===t?Boolean(e):e}(e)}(f)}window.w4gl=oe,window.W4WebGLProfiler=ne,fe.info("W4 Engine is loading..."),t.W4L=he,D=he.abort,window.w4=t,t.W4Platform=Ie,t.registerWidgetClass=De.registerWidgetClass;var Ve,Xe={ga:function(e,t){void 0!==window.GameInterface&&window.GameInterface.gameComplete().then((()=>{V.returnBool(e,t,!0)}))},$:function(e,t){void 0!==window.GameInterface&&window.GameInterface.gameOver().then((()=>{V.returnBool(e,t,!0)}),(()=>{V.returnBool(e,t,!1)}))},Ja:function(){void 0!==window.GameInterface&&window.GameInterface.gameReady()},za:function(e,t,n){void 0!==window.GameInterface&&window.GameInterface.gameStart(n).then((()=>{V.returnBool(e,t,!0)}),(()=>{V.returnBool(e,t,!1)}))},La:function(e){if(void 0!==window.GameInterface){var t=A(e);return window.GameInterface.storage.getItem(t)}},Ua:function(e){if(void 0!==window.GameInterface)return window.GameInterface.hasFeature(A(e))},db:function(e,t){void 0!==window.GameInterface?window.GameInterface.init().then((()=>{V.returnBool(e,t,!0)}),(()=>{V.returnBool(e,t,!1)})):V.returnBool(e,t,!0)},Qa:function(e){if(void 0!==window.GameInterface)return window.GameInterface.isMuted()},cb:function(e,t){window.GameInterface.onAudioStateChange((n=>{V.returnBool(e,t,n)}))},N:function(e,t){void 0!==window.GameInterface&&window.GameInterface.onGoToLevel((n=>{V.returnStr(e,t,n.toString())}))},U:function(e,t){void 0!==window.GameInterface&&window.GameInterface.onGoToNextLevel((()=>{V.returnBool(e,t,!0)}))},Oa:function(e,t){void 0!==window.GameInterface&&(window.GameInterface.log("fmbAPI_OnOffsetChangeHandler subscribe"),window.GameInterface.onOffsetChange((n=>{V.returnBool(e,t,!0),window.GameInterface.log("tag fmbAPI_OnOffsetChangeHandler")})))},Ra:function(e,t){window.GameInterface.onPauseStateChange((n=>{V.returnBool(e,t,n)}))},C:function(e,t){void 0!==window.GameInterface&&window.GameInterface.onRestartGame((()=>{V.returnBool(e,t,!0)}))},Ka:function(e){void 0!==window.GameInterface&&window.GameInterface.sendPreloadProgress(e)},pa:function(e){void 0!==window.GameInterface&&window.GameInterface.sendProgress(e)},Na:function(){if(void 0!==window.GameInterface){let e=window.GameInterface.getOffsets(),t=w4.W4Platform.baseDiv,n=w4.W4Platform.canvas,r=t.style.width,i=t.style.height;t.style.width="100%",t.style.height="100%";let o=t.offsetWidth-(e.right+e.left),a=t.offsetHeight-(e.top+e.bottom);if(r==o+"px"&&i==a+"px")return t.style.width=r,void(t.style.height=i);t.style.width=o+"px",t.style.height=a+"px",t.style["margin-left"]=e.left+"px",t.style["margin-top"]=e.top+"px",t.style["margin-right"]=e.right+"px",t.style["margin-bottom"]=e.bottom+"px",n.width=o*w4.W4Platform.DPR,n.height=a*w4.W4Platform.DPR,w4.W4Platform.applyResize()}},Ma:function(e,t){if(void 0!==window.GameInterface){var n=A(e);window.GameInterface.storage.setItem(n,t)}},Pa:function(e,t,n){void 0!==window.GameInterface&&window.GameInterface.showInterstitialAd(A(n)).then((()=>{V.returnBool(e,t,!0)}))},Ia:function(e,t){window.GameInterface},q:function(e,t,n,r){W.UnpackCallback&&W.UnpackCallback(e,t,n,r)},Ea:function(e){W.Files={},R.get(e)()},Fa:function(e,n){if(W.Files={},t.getFileFromVFS=W.get,t.isFileSystemValid=W.isLoaded,0!==e){console.log(A(e));const t=JSON.parse(A(e));j(t,n)}else void 0!==window.W4_VFS_DEC?j(window.W4_VFS_DEC,n):ue("W4_VFS_DEC not found. File system is not declared")},Da:function(e){return A(e)in W.Files?1:0},Ca:function(e,n,r){const i=W.get(A(e));if(null==i)return void ue("VFS_sync: "+e+" file not found ");const o=i.data;if(void 0!==o){const e=o.byteLength,i=t._malloc(e),a=new Uint8Array(t.HEAPU8.buffer,i,e);a.set(new Uint8Array(o)),R.get(r)(n,a.byteOffset,e)}else R.get(r)(n,null,0)},_a:function(){return true},a:function(){D("")},r:function(){return Date.now()},Xa:function(e){var t,n,r=p.length,i=1073741824;if((e>>>=0)>i)return!1;for(var o=1;o<=4;o*=2){var a=r*(1+.2/o);if(a=Math.min(a,e+100663296),H(Math.min(i,(t=Math.max(e,a))+((n=65536)-t%n)%n)))return!0}return!1},Va:function(e,t){var n=0;return z().forEach((function(r,i){var o=t+n;v[e+4*i>>2]=o,K(r,o),n+=r.length+1})),0},Wa:function(e,t){var n=z();v[e>>2]=n.length;var r=0;return n.forEach((function(e){r+=e.length+1})),v[t>>2]=r,0},Ya:function(e){return 52},Sa:function(e,t,n,r,i){return 70},Za:function(e,t,n,r){for(var i=0,o=0;o<n;o++){var a=v[t>>2],s=v[t+4>>2];t+=8;for(var c=0;c<s;c++)q(e,p[a+c]);i+=s}return v[r>>2]=i,0},Ta:function(e,t,n,r,i){return te(e,t,n,r)},Z:function(){return ie.hasDepthTextures},Y:function(){return ie.hasFloatTextures},oa:function(){se.initialize()},p:function(e){se.setGlobalGain(e)},ma:function(e){return ae.create(A(e))},la:function(e){ae.delete(e)},na:function(){ae.initialize()},va:function(e){return se.createAudioSource(e)},ua:function(e){se.deleteAudioSource(e)},sa:function(e){return se.getAudioSourceIsPlaying(le.get(e))},ra:function(e){se.playAudioSource(le.get(e))},ta:function(e,t){se.setAudioSourceIsLooped(le.get(e),t>0)},qa:function(e){se.stopAudioSource(le.get(e))},Ga:function(){fe.info("W4 Engine was loaded")},G:function(e,t,n,r,i,o,a,s,c){return xe(we.decodeParameters({sources:{POSITIVE_X:e,NEGATIVE_X:t,POSITIVE_Y:n,NEGATIVE_Y:r,POSITIVE_Z:i,NEGATIVE_Z:o}},a,s,c))},H:function(){return Te()},F:function(e){Ae(e)},E:function(e,t,n,r){be(e,we.decodeParameters({},t,n,r))},D:function(e,t,n){return Re.createFromData(A(e),new Uint8Array(g.buffer,t,n))},B:function(e){return Re.createFromUrl(A(e))},A:function(e){return Re.delete(e)},ha:function(e){Se.initialize(window,le.get(e))},fa:function(e,t){Le.initialize(window,R.get(e),R.get(t))},ea:function(e){Pe.initialize(Ie.canvas,R.get(e))},da:function(e){Fe(Ie.canvas,R.get(e))},d:function(e){void 0!==ye.loader&&(ye.loader.style.display=0===e?"none":"block")},O:function(e,t){return Be.createMaterialInst(e,t)},M:function(e,t,n){return Be.setBlending(e,re.number2glBlendEnum(t),re.number2glBlendEnum(n))},J:function(e,t){return Be.setCullFace(e,re.number2glCullFaceMode(t))},K:function(e,t){return Be.setDepthWrite(e,0!==t)},L:function(e,t,n,r,i,o){return Be.setScissor(e,0!==t,n,r,i,o)},P:function(e,t){return Be.createMaterial(e,t)},Ha:function(e){le.free(e)},o:function(){return Ie.DPR},ba:function(){return Ie.canvas.height},ca:function(){return Ie.canvas.width},ia:function(e,t,n,r){Ie.initialize(A(e),R.get(t),R.get(n),R.get(r))},Q:function(e,t,n,r,i){return Be.createShaderProgram(le.get(e),t,n,r,i)},I:function(e,t){return Be.createShader(e,t)},w:function(e,t,n,r){const i=ve.decodeParameters({},t,n,r);return le.isValid(e)?Ee.create(e,i):Ee.createEmpty(i)},y:function(e){const t=_e(e),n=[t[0],t[1],t[2],t[3],t[0],t[1],t[2],t[3],t[0],t[1],t[2],t[3],t[0],t[1],t[2],t[3]],r={};return r.minFilter=Ue.NEAREST,r.magFilter=Ue.NEAREST,r.wrapS=Ue.REPEAT,r.wrapT=Ue.REPEAT,Ee.prototype(r,new Uint8Array(n),2,2)},z:function(){const e=ve.defaultTextures.default,t={};return t.minFilter=Ue.NEAREST,t.magFilter=Ue.NEAREST,t.wrapS=Ue.REPEAT,t.wrapT=Ue.REPEAT,Ee.prototype(t,new Uint8Array(e.textureData),e.textureWidth,e.textureHeight)},x:function(e,t,n,r,i,o,a,s,c,u,l,f,d,m,h){const _={};_.minFilter=Ue.NEAREST,_.magFilter=Ue.NEAREST,_.wrapS=Ue.CLAMP_TO_EDGE,_.wrapT=Ue.CLAMP_TO_EDGE;const p=A(e),E=document.createElement("canvas"),v=E.getContext("2d");v.textAlign="left",v.textBaseline="top";const x=["normal","italic","oblique"],T=["normal","bold","bolder","lighter","100","200","300","400","500","600","700","800","900"];let b;b=n&&r?x[n]+" "+T[r]+" "+t+"px "+A(i):n?x[n]+" "+t+"px "+A(i):r?T[r]+" "+t+"px "+A(i):t+"px "+A(i),v.font=b;const w=v.measureText(p);E.width=w.width+m+f,E.height=Math.abs(w.actualBoundingBoxDescent)+Math.abs(w.actualBoundingBoxAscent)+l+d,v.textAlign="left",v.textBaseline="top",v.font=b,0!=(4&o)&&(v.fillStyle=pe(u),v.fillRect(0,0,E.width,E.height)),0!=(2&o)&&(v.lineWidth=a,v.strokeStyle=pe(c),v.strokeText(p,m,l)),0!=(1&o)&&(v.fillStyle=pe(s),v.fillText(p,m,l));const y=Re.createFromBlob(v.canvas.toDataURL("image/png")),I=new Uint32Array(g.buffer,h,2);return I[0]=E.width,I[1]=E.height,le.isValid(y)?Ee.create(y,_,!0):Ee.createEmpty(_)},v:function(e){Ee.delete(e)},u:function(e,t,n,r){Ee.update(e,ve.decodeParameters({},t,n,r))},aa:function(e,t){De.virtualSize.width=e,De.virtualSize.height=t},n:function(e){return Me.create(e)},m:function(e){le.free(e)},_:function(e){const t=le.get(e).vao;t&&(Ue.bindVertexArray(null),Ue.deleteVertexArray(t))},i:function(e,t){Me.setIndicesBuffer(e,t)},h:function(e,t){Me.setMaterial(e,t)},g:function(e,t){Me.setRenderType(e,t)},f:function(e,t){Me.setVerticesBuffer(e,t)},bb:function(e){return Ne.createIndicesBuffer(Ne.__internal.decryptBufferUsage(e))},$a:function(e,t){return Ne.createVerticesBuffer(Ne.__internal.decryptBufferUsage(e),t)},s:function(e){le.free(e)},t:function(e,t,n){Ne.updateData(e,t,n)},ab:function(e,t,n){Ne.updateIndicesUsage(e,t,n)},Ba:function(e){ue(A(e))},Aa:function(e,t,n,r){fe.__internal.writeLog(e,6,A(r),A(t),n)},ya:function(e,t){fe.initialize(A(e),0===t?void 0:A(t))},wa:function(){fe.__internal.popIndentLevel()},xa:function(){fe.__internal.pushIndentLevel()},e:function(e,t){return ce.registerPOD(e,t)},W:function(){oe.cleanupRender()},b:function(){const e=Ce.renderState.frame.clearColor,t=re.number2glClearMask(Ce.renderState.frame.clearMask[0]);oe.clearBackBuffer(t,e),Ce.renderState.prevProgram=null,Ce.renderState.prevMatInst=null,Ce.renderState.prevVao=null},l:function(){Ce.draw()},X:function(){oe.prepareRender()},c:function(e){Ce.renderState.isBlending=e,e?oe.enableBlend():oe.disableBlend()},V:function(e){e===le.invalid?(Ce.overrideMaterial=null,Ce.overrideMaterialId=null):(Ce.overrideMaterial=le.get(e),Ce.overrideMaterialId=e)},S:function(e,t,n,r,i){const o=Ue.createFramebuffer();Ue.bindFramebuffer(Ue.FRAMEBUFFER,o);const a=le.get(r);if(Ue.bindTexture(Ue.TEXTURE_2D,a),n?(Ue.texImage2D(Ue.TEXTURE_2D,0,Ue.RGBA32F,e,t,0,Ue.RGBA,Ue.FLOAT,null),Ue.framebufferTexture2D(Ue.FRAMEBUFFER,Ue.COLOR_ATTACHMENT0,Ue.TEXTURE_2D,a,0)):(Ue.texImage2D(Ue.TEXTURE_2D,0,Ue.RGBA,e,t,0,Ue.RGBA,Ue.UNSIGNED_BYTE,null),Ue.texParameterf(Ue.TEXTURE_2D,Ue.TEXTURE_MIN_FILTER,Ue.LINEAR),Ue.texParameterf(Ue.TEXTURE_2D,Ue.TEXTURE_MAG_FILTER,Ue.LINEAR),Ue.texParameteri(Ue.TEXTURE_2D,Ue.TEXTURE_WRAP_S,Ue.CLAMP_TO_EDGE),Ue.texParameteri(Ue.TEXTURE_2D,Ue.TEXTURE_WRAP_T,Ue.CLAMP_TO_EDGE),Ue.framebufferTexture2D(Ue.FRAMEBUFFER,Ue.COLOR_ATTACHMENT0,Ue.TEXTURE_2D,a,0)),i&&i!==le.invalid){const n=le.get(i);Ue.bindTexture(Ue.TEXTURE_2D,n),Ue.texImage2D(Ue.TEXTURE_2D,0,ie.depthSupportedFormat,e,t,0,Ue.DEPTH_COMPONENT,Ue.UNSIGNED_INT,null),Ue.framebufferTexture2D(Ue.FRAMEBUFFER,Ue.DEPTH_ATTACHMENT,Ue.TEXTURE_2D,n,0)}else{const n=Ue.createRenderbuffer();Ue.bindRenderbuffer(Ue.RENDERBUFFER,n),Ue.renderbufferStorage(Ue.RENDERBUFFER,ie.depthInternalFormat,e,t),Ue.framebufferRenderbuffer(Ue.FRAMEBUFFER,Ue.DEPTH_ATTACHMENT,Ue.RENDERBUFFER,n),Ue.bindRenderbuffer(Ue.RENDERBUFFER,null)}return Ue.checkFramebufferStatus(Ue.FRAMEBUFFER)!==Ue.FRAMEBUFFER_COMPLETE&&console.log(Ue.getError()),Ue.bindFramebuffer(Ue.FRAMEBUFFER,null),le.make(o,Oe,"Framebuffer")},R:function(e){le.free(e)},k:function(e,t,n,r,i){i===le.invalid?Ue.bindFramebuffer(Ue.FRAMEBUFFER,null):Ue.bindFramebuffer(Ue.FRAMEBUFFER,le.get(i)),Ue.viewport(e,t,n,r)},T:function(e,t,n,r){Ce.renderState.updateRenderState(le.get(e),le.get(t),le.get(n),le.get(r))},j:function(){return Date.now()},ja:function(e,t,n,r,i,o,a){const s=le.get(e),c={};c.type=ge(n),c.offset=r,c.size=i,o>0&&(c.count=o),a>0&&(c.control=a-1),s.descr[ge(t)]=c},ka:function(e){return ce.registerType(e)}},je=(function(){var e={a:Xe};function n(e,n){var r,i=e.exports;t.asm=i,I((g=t.asm.eb).buffer),R=t.asm.lb,r=t.asm.fb,L.unshift(r),function(e){if(F--,t.monitorRunDependencies&&t.monitorRunDependencies(F),0==F&&(null!==C&&(clearInterval(C),C=null),B)){var n=B;B=null,n()}}()}function i(e){n(e.instance)}function o(t){return(f||!c&&!u||"function"!=typeof fetch?Promise.resolve().then((function(){return k(M)})):fetch(M,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+M+"'";return e.arrayBuffer()})).catch((function(){return k(M)}))).then((function(t){return WebAssembly.instantiate(t,e)})).then((function(e){return e})).then(t,(function(e){m("failed to asynchronously prepare wasm: "+e),D(e)}))}if(F++,t.monitorRunDependencies&&t.monitorRunDependencies(F),t.instantiateWasm)try{return t.instantiateWasm(e,n)}catch(e){m("Module.instantiateWasm callback failed with error: "+e),r(e)}(f||"function"!=typeof WebAssembly.instantiateStreaming||O(M)||"function"!=typeof fetch?o(i):fetch(M,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(i,(function(e){return m("wasm streaming compile failed: "+e),m("falling back to ArrayBuffer instantiation"),o(i)}))}))).catch(r)}(),t.___wasm_call_ctors=function(){return(t.___wasm_call_ctors=t.asm.fb).apply(null,arguments)},t._entry=function(){return(t._entry=t.asm.gb).apply(null,arguments)},t._draw=function(){return(t._draw=t.asm.hb).apply(null,arguments)},t._loadZipFile=function(){return(t._loadZipFile=t.asm.ib).apply(null,arguments)},t._malloc=function(){return(je=t._malloc=t.asm.jb).apply(null,arguments)}),We=(t._free=function(){return(t._free=t.asm.kb).apply(null,arguments)},t.stackSave=function(){return(We=t.stackSave=t.asm.mb).apply(null,arguments)}),He=t.stackRestore=function(){return(He=t.stackRestore=t.asm.nb).apply(null,arguments)},Ye=t.stackAlloc=function(){return(Ye=t.stackAlloc=t.asm.ob).apply(null,arguments)};function ze(e){function r(){Ve||(Ve=!0,t.calledRun=!0,x||(!0,G(L),n(t),t.onRuntimeInitialized&&t.onRuntimeInitialized(),function(){if(t.postRun)for("function"==typeof t.postRun&&(t.postRun=[t.postRun]);t.postRun.length;)e=t.postRun.shift(),P.unshift(e);var e;G(P)}()))}e=e||a,F>0||(!function(){if(t.preRun)for("function"==typeof t.preRun&&(t.preRun=[t.preRun]);t.preRun.length;)e=t.preRun.shift(),S.unshift(e);var e;G(S)}(),F>0||(t.setStatus?(t.setStatus("Running..."),setTimeout((function(){setTimeout((function(){t.setStatus("")}),1),r()}),1)):r()))}if(t.cwrap=function(e,t,n,r){var i=(n=n||[]).every((e=>"number"===e||"boolean"===e));return"string"!==t&&i&&!r?ke(e):function(){return Ge(e,t,n,arguments)}},B=function e(){Ve||ze(),Ve||(B=e)},t.preInit)for("function"==typeof t.preInit&&(t.preInit=[t.preInit]);t.preInit.length>0;)t.preInit.pop()();return ze(),t.ready}})();"object"==typeof exports&&"object"==typeof module?module.exports=Module:"function"==typeof define&&define.amd?define([],(function(){return Module})):"object"==typeof exports&&(exports.Module=Module),window.W4_VFS_DEC={"default.w4a":"resources/default.w4a","config/adaptiveNodesSettings.json":"resources/config/adaptiveNodesSettings.json","config/camera.json":"resources/config/camera.json","config/customSettings.json":"resources/config/customSettings.json","config/digitsSettings.json":"resources/config/digitsSettings.json","config/meshesContainerSettings.json":"resources/config/meshesContainerSettings.json","config/particlesSettings.json":"resources/config/particlesSettings.json","config/progressBarContainerSettings.json":"resources/config/progressBarContainerSettings.json","config/resources.json":"resources/config/resources.json","config/settings.json":"resources/config/settings.json","config/spriteContainerSettings.json":"resources/config/spriteContainerSettings.json","fonts/comic_sans.json":"resources/fonts/comic_sans.json","fonts/opensans-bold.json":"resources/fonts/opensans-bold.json","match3_config/items.json":"resources/match3_config/items.json","match3_config/match3Config.json":"resources/match3_config/match3Config.json","models/cube.w4a":"resources/models/cube.w4a","sounds/click.mp3":"resources/sounds/click.mp3","sounds/fail.mp3":"resources/sounds/fail.mp3","sounds/merge.mp3":"resources/sounds/merge.mp3","sounds/music.mp3":"resources/sounds/music.mp3","sounds/restart.mp3":"resources/sounds/restart.mp3","sounds/start.mp3":"resources/sounds/start.mp3","sounds/win.mp3":"resources/sounds/win.mp3","config/game_config/account.json":"resources/config/game_config/account.json","config/game_config/debug.json":"resources/config/game_config/debug.json","config/game_config/levels/level_1.json":"resources/config/game_config/levels/level_1.json","config/game_config/levels/level_10.json":"resources/config/game_config/levels/level_10.json","config/game_config/levels/level_11.json":"resources/config/game_config/levels/level_11.json","config/game_config/levels/level_12.json":"resources/config/game_config/levels/level_12.json","config/game_config/levels/level_13.json":"resources/config/game_config/levels/level_13.json","config/game_config/levels/level_14.json":"resources/config/game_config/levels/level_14.json","config/game_config/levels/level_15.json":"resources/config/game_config/levels/level_15.json","config/game_config/levels/level_16.json":"resources/config/game_config/levels/level_16.json","config/game_config/levels/level_17.json":"resources/config/game_config/levels/level_17.json","config/game_config/levels/level_18.json":"resources/config/game_config/levels/level_18.json","config/game_config/levels/level_19.json":"resources/config/game_config/levels/level_19.json","config/game_config/levels/level_2.json":"resources/config/game_config/levels/level_2.json","config/game_config/levels/level_20.json":"resources/config/game_config/levels/level_20.json","config/game_config/levels/level_21.json":"resources/config/game_config/levels/level_21.json","config/game_config/levels/level_22.json":"resources/config/game_config/levels/level_22.json","config/game_config/levels/level_23.json":"resources/config/game_config/levels/level_23.json","config/game_config/levels/level_24.json":"resources/config/game_config/levels/level_24.json","config/game_config/levels/level_25.json":"resources/config/game_config/levels/level_25.json","config/game_config/levels/level_26.json":"resources/config/game_config/levels/level_26.json","config/game_config/levels/level_27.json":"resources/config/game_config/levels/level_27.json","config/game_config/levels/level_28.json":"resources/config/game_config/levels/level_28.json","config/game_config/levels/level_29.json":"resources/config/game_config/levels/level_29.json","config/game_config/levels/level_3.json":"resources/config/game_config/levels/level_3.json","config/game_config/levels/level_30.json":"resources/config/game_config/levels/level_30.json","config/game_config/levels/level_31.json":"resources/config/game_config/levels/level_31.json","config/game_config/levels/level_32.json":"resources/config/game_config/levels/level_32.json","config/game_config/levels/level_33.json":"resources/config/game_config/levels/level_33.json","config/game_config/levels/level_34.json":"resources/config/game_config/levels/level_34.json","config/game_config/levels/level_35.json":"resources/config/game_config/levels/level_35.json","config/game_config/levels/level_36.json":"resources/config/game_config/levels/level_36.json","config/game_config/levels/level_37.json":"resources/config/game_config/levels/level_37.json","config/game_config/levels/level_38.json":"resources/config/game_config/levels/level_38.json","config/game_config/levels/level_39.json":"resources/config/game_config/levels/level_39.json","config/game_config/levels/level_4.json":"resources/config/game_config/levels/level_4.json","config/game_config/levels/level_40.json":"resources/config/game_config/levels/level_40.json","config/game_config/levels/level_41.json":"resources/config/game_config/levels/level_41.json","config/game_config/levels/level_42.json":"resources/config/game_config/levels/level_42.json","config/game_config/levels/level_5.json":"resources/config/game_config/levels/level_5.json","config/game_config/levels/level_6.json":"resources/config/game_config/levels/level_6.json","config/game_config/levels/level_7.json":"resources/config/game_config/levels/level_7.json","config/game_config/levels/level_8.json":"resources/config/game_config/levels/level_8.json","config/game_config/levels/level_9.json":"resources/config/game_config/levels/level_9.json"};